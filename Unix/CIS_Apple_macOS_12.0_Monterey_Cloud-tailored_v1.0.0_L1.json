{
    "custom_item_1": {
        "description": "MacOS 12 is installed",
        "cmd": "/usr/bin/sw_vers | /usr/bin/grep 'ProductVersion'",
        "expect": "^ProductVersion[\\\\s]*:[\\\\s]*@PLATFORM_VERSION@"
    },
    "custom_item_2": {
        "description": "1.1 Ensure All Apple-provided Software Is Current",
        "info": "Software vendors release security patches and software updates for their products when security vulnerabilities are discovered. There is no simple way to complete this action without a network connection to an Apple software repository. Please ensure appropriate access for this control. This check is only for what Apple provides through software update.\n\nSoftware updates should be run at minimum every 30 days. Run the following command to verify when software update was previously run: $ /usr/bin/sudo /usr/bin/defaults read /Library/Preferences/com.apple.SoftwareUpdate | grep -e LastFullSuccessfulDate The response should be in the last 30 days (\n\nExample\n\n): LastFullSuccessfulDate = \"2020-07-30 12:45:25 +0000\";\n\nIt is important that these updates be applied in a timely manner to prevent unauthorized persons from exploiting the identified vulnerabilities.",
        "solution": "Run the following command to verify what packages need to be installed:\n\n% /usr/bin/sudo /usr/sbin/softwareupdate -l\n\nThe output will include the following: Software Update found the following new or updated software:\n\nRun the following command to install all the packages that need to be updated:\n\nTo install all updates run the command:\n\n% /usr/bin/sudo /usr/sbin/softwareupdate -i -a\n\nOr run the following command to install individual packages:\n\n% /usr/bin/sudo /usr/sbin/softwareupdate -i ''\n\nNote: If one of the software updates listed includes Action: restart then you must attach the -R flag to force a system restart. If the system update is complete but no restart occurs, then the system is in an unknown state that requires a future restart. It is advised to run updates and forced restarts during system downtime and not while in active use.\n\nexample:\n\n% /usr/bin/sudo /usr/sbin/softwareupdate -l\n\nSoftware Update Tool\n\nFinding available software\nSoftware Update found the following new or updated software:\n* Label: ProVideoFormats-2.2.7\n\tTitle: Pro Video Formats, Version: 2.2.7, Size: 9693KiB, Recommended: YES,\n* Label: Command Line Tools for Xcode-15.0\n\tTitle: Command Line Tools for Xcode, Version: 15.0, Size: 721962KiB, Recommended: YES,\n\n% /usr/bin/sudo /usr/sbin/softwareupdate -i 'ProVideoFormats-2.2.7'\n\nSoftware Update Tool\n\nFinding available software\nAttempting to quit apps: (\n    \"com.apple.Compressor\"\n)\nWaiting for user to quit any relevant apps\nSuccessfully quit all apps\n\nDownloaded Pro Video Formats\nInstalling Pro Video Formats\nDone with Pro Video Formats\nDone.\n\nIn the above example, if a restart was required, the command to remediate would be /usr/bin/sudo /usr/sbin/softwareupdate -i 'ProVideoFormats-2.2.7' -R\n\nImpact:\n\nInstallation of updates can be disruptive to users, especially if a restart is required. Major updates need to be applied after creating an organizational patch policy. It is also advised to run updates and forced restarts during system downtime and not while in active use.",
        "reference": "800-171|3.11.2,800-171|3.11.3,800-171|3.14.1,800-53|RA-5,800-53|SI-2,800-53|SI-2(2),800-53r5|RA-5,800-53r5|SI-2,800-53r5|SI-2(2),CN-L3|8.1.4.4(e),CN-L3|8.1.10.5(a),CN-L3|8.1.10.5(b),CN-L3|8.5.4.1(b),CN-L3|8.5.4.1(d),CN-L3|8.5.4.1(e),CSCv7|3.4,CSCv7|3.5,CSCv8|7.3,CSCv8|7.4,CSF|DE.CM-8,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.IP-12,CSF|RS.CO-3,CSF|RS.MI-3,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.6.1,ITSG-33|RA-5,ITSG-33|SI-2,ITSG-33|SI-2(2),LEVEL|1A,NESA|M1.2.2,NESA|M5.4.1,NESA|T7.6.2,NESA|T7.7.1,NIAv2|PR9,PCI-DSSv3.2.1|6.1,PCI-DSSv3.2.1|6.2,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.1,PCI-DSSv4.0|6.3.3,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|2.2,SWIFT-CSCv1|2.7",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "#!/bin/bash\n{\nswversion=$(\n(sw_vers -productVersion | cut -c1-2)\n)\n\nswversion1=$(($swversion+1))\n\nswversion2=$(($swversion+2))\n\nswuptodate=$(\nsoftwareupdate -l | grep -e Version | grep -v \"macOS.*$swversion1\" | grep -v \"macOS.*$swversion2\" 2> /dev/null\n)\n\nif [ \"$swuptodate\" == \"\" ] ; then\n  output=True\nelse\n  output=False\nfi\n\n# If result returns 0 pass, otherwise fail.\nif [ \"$output\" = True ] ; then\n\techo \"PASSED: There are no updates available\"\nelse\n    # print the reason why we are failing\n    echo \"FAILED: There are available updates that need to be installed\"\n    echo \"$swuptodate\"\nfi\n}",
        "expect": "^PASSED: There are no updates available$"
    },
    "custom_item_3": {
        "description": "1.2 Ensure Auto Update Is Enabled",
        "info": "Auto Update verifies that your system has the newest security patches and software updates. If \"Automatically check for updates\" is not selected, background updates for new malware definition files from Apple for XProtect and Gatekeeper will not occur.\n\nhttp://macops.ca/os-x-admins-your-clients-are-not-getting-background-security-updates/\n\nhttps://derflounder.wordpress.com/2014/12/17/forcing-xprotect-blacklist-updates-on-mavericks-and-yosemite/\n\nIt is important that a system has the newest updates applied so as to prevent unauthorized persons from exploiting identified vulnerabilities.",
        "solution": "Run the following command to enable auto update:\n\n% /usr/bin/sudo /usr/bin/defaults write /Library/Preferences/com.apple.SoftwareUpdate AutomaticCheckEnabled -bool true\n\nImpact:\n\nWithout automatic update, updates may not be made in a timely manner and the system will be exposed to additional risk.",
        "reference": "800-171|3.11.2,800-171|3.11.3,800-171|3.14.1,800-53|RA-5,800-53|SI-2,800-53|SI-2(2),800-53r5|RA-5,800-53r5|SI-2,800-53r5|SI-2(2),CN-L3|8.1.4.4(e),CN-L3|8.1.10.5(a),CN-L3|8.1.10.5(b),CN-L3|8.5.4.1(b),CN-L3|8.5.4.1(d),CN-L3|8.5.4.1(e),CSCv7|3.4,CSCv7|3.5,CSCv8|7.3,CSCv8|7.4,CSF|DE.CM-8,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.IP-12,CSF|RS.CO-3,CSF|RS.MI-3,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.6.1,ITSG-33|RA-5,ITSG-33|SI-2,ITSG-33|SI-2(2),LEVEL|1A,NESA|M1.2.2,NESA|M5.4.1,NESA|T7.6.2,NESA|T7.7.1,NIAv2|PR9,PCI-DSSv3.2.1|6.1,PCI-DSSv3.2.1|6.2,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.1,PCI-DSSv4.0|6.3.3,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|2.2,SWIFT-CSCv1|2.7",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "expect": "true",
        "payload_key": "AutomaticCheckEnabled",
        "payload_type": "com.apple.SoftwareUpdate"
    },
    "custom_item_4": {
        "description": "1.3 Ensure Download New Updates When Available Is Enabled",
        "info": "In the GUI, both \"Install macOS updates\" and \"Install app updates from the App Store\" are dependent on whether \"Download new updates when available\" is selected.\n\nIt is important that a system has the newest updates downloaded so that they can be applied.",
        "solution": "Run the following command to enable auto update:\n\n% /usr/bin/sudo /usr/bin/defaults write /Library/Preferences/com.apple.SoftwareUpdate AutomaticDownload -bool true\n\nImpact:\n\nIf \"Download new updates when available\" is not selected, updates may not be made in a timely manner and the system will be exposed to additional risk.",
        "reference": "800-171|3.11.2,800-171|3.11.3,800-171|3.14.1,800-53|RA-5,800-53|SI-2,800-53|SI-2(2),800-53r5|RA-5,800-53r5|SI-2,800-53r5|SI-2(2),CN-L3|8.1.4.4(e),CN-L3|8.1.10.5(a),CN-L3|8.1.10.5(b),CN-L3|8.5.4.1(b),CN-L3|8.5.4.1(d),CN-L3|8.5.4.1(e),CSCv7|3.4,CSCv7|3.5,CSCv8|7.3,CSCv8|7.4,CSF|DE.CM-8,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.IP-12,CSF|RS.CO-3,CSF|RS.MI-3,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.6.1,ITSG-33|RA-5,ITSG-33|SI-2,ITSG-33|SI-2(2),LEVEL|1A,NESA|M1.2.2,NESA|M5.4.1,NESA|T7.6.2,NESA|T7.7.1,NIAv2|PR9,PCI-DSSv3.2.1|6.1,PCI-DSSv3.2.1|6.2,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.1,PCI-DSSv4.0|6.3.3,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|2.2,SWIFT-CSCv1|2.7",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "expect": "true",
        "payload_key": "AutomaticDownload",
        "payload_type": "com.apple.SoftwareUpdate"
    },
    "custom_item_5": {
        "description": "1.4 Ensure Installation of App Update Is Enabled",
        "info": "Ensure that application updates are installed after they are available from Apple. These updates do not require reboots or administrator privileges for end users.\n\nPatches need to be applied in a timely manner to reduce the risk of vulnerabilities being exploited.",
        "solution": "Run the following command to turn on App Store auto updating:\n\n% /usr/bin/sudo /usr/bin/defaults write /Library/Preferences/com.apple.commerce AutoUpdate -bool TRUE\n\nImpact:\n\nUnpatched software may be exploited.",
        "reference": "800-171|3.11.2,800-171|3.11.3,800-171|3.14.1,800-53|RA-5,800-53|SI-2,800-53|SI-2(2),800-53r5|RA-5,800-53r5|SI-2,800-53r5|SI-2(2),CN-L3|8.1.4.4(e),CN-L3|8.1.10.5(a),CN-L3|8.1.10.5(b),CN-L3|8.5.4.1(b),CN-L3|8.5.4.1(d),CN-L3|8.5.4.1(e),CSCv7|3.4,CSCv7|3.5,CSCv8|7.3,CSCv8|7.4,CSF|DE.CM-8,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.IP-12,CSF|RS.CO-3,CSF|RS.MI-3,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.6.1,ITSG-33|RA-5,ITSG-33|SI-2,ITSG-33|SI-2(2),LEVEL|1A,NESA|M1.2.2,NESA|M5.4.1,NESA|T7.6.2,NESA|T7.7.1,NIAv2|PR9,PCI-DSSv3.2.1|6.1,PCI-DSSv3.2.1|6.2,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.1,PCI-DSSv4.0|6.3.3,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|2.2,SWIFT-CSCv1|2.7",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "expect": "true",
        "payload_key": "AutoUpdate",
        "payload_type": "com.apple.commerce"
    },
    "custom_item_6": {
        "description": "CriticalUpdateInstall",
        "expect": "true",
        "payload_key": "CriticalUpdateInstall",
        "payload_type": "com.apple.SoftwareUpdate"
    },
    "custom_item_7": {
        "description": "ConfigDataInstall",
        "expect": "true",
        "payload_key": "ConfigDataInstall",
        "payload_type": "com.apple.SoftwareUpdate"
    },
    "custom_item_8": {
        "description": "1.6 Ensure Install of macOS Updates Is Enabled",
        "info": "Ensure that macOS updates are installed after they are available from Apple. This setting enables macOS updates to be automatically installed. Some environments will want to approve and test updates before they are delivered. It is best practice to perform testing first where updates can and have caused disruptions to operations. Automatic updates should be turned off where changes are tightly controlled and there are mature testing and approval processes. Automatic updates should not be turned off simply to allow the administrator to contact users in order to verify installation. A dependable, repeatable process involving a patch agent or remote management tool should be in place before auto-updates are turned off.\n\nPatches need to be applied in a timely manner to reduce the risk of vulnerabilities being exploited.",
        "solution": "Run the following command to to enable automatic checking and installing of macOS updates:\n\n% /usr/bin/sudo /usr/bin/defaults write /Library/Preferences/com.apple.SoftwareUpdate AutomaticallyInstallMacOSUpdates -bool TRUE\n\nImpact:\n\nUnpatched software may be exploited.",
        "reference": "800-171|3.11.2,800-171|3.11.3,800-171|3.14.1,800-53|RA-5,800-53|SI-2,800-53|SI-2(2),800-53r5|RA-5,800-53r5|SI-2,800-53r5|SI-2(2),CN-L3|8.1.4.4(e),CN-L3|8.1.10.5(a),CN-L3|8.1.10.5(b),CN-L3|8.5.4.1(b),CN-L3|8.5.4.1(d),CN-L3|8.5.4.1(e),CSCv7|3.4,CSCv7|3.5,CSCv8|7.3,CSCv8|7.4,CSF|DE.CM-8,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.IP-12,CSF|RS.CO-3,CSF|RS.MI-3,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.6.1,ITSG-33|RA-5,ITSG-33|SI-2,ITSG-33|SI-2(2),LEVEL|1A,NESA|M1.2.2,NESA|M5.4.1,NESA|T7.6.2,NESA|T7.7.1,NIAv2|PR9,PCI-DSSv3.2.1|6.1,PCI-DSSv3.2.1|6.2,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.1,PCI-DSSv4.0|6.3.3,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|2.2,SWIFT-CSCv1|2.7",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "expect": "true",
        "payload_key": "AutomaticallyInstallMacOSUpdates",
        "payload_type": "com.apple.SoftwareUpdate"
    },
    "custom_item_9": {
        "description": "2.1.1 Ensure \"Set time and date automatically\" Is Enabled",
        "info": "Correct date and time settings are required for authentication protocols, file creation, modification dates, and log entries.\n\nNote: If your organization has internal time servers, enter them here. Enterprise mobile devices may need to use a mix of internal and external time servers. If multiple servers are required, use the Date & Time System Preference with each server separated by a space.\n\nAdditional Note: The default Apple time server is time.apple.com. Variations include time.euro.apple.com. While it is certainly more efficient to use internal time servers, there is no reason to block access to global Apple time servers or to add a time.apple.com alias to internal DNS records. There are no reports that Apple gathers any information from NTP synchronization, as the computers already phone home to Apple for Apple services including iCloud use and software updates. Best practice is to allow DNS resolution to an authoritative time service for time.apple.com, preferably to connect to Apple servers, but local servers are acceptable as well.\n\nKerberos may not operate correctly if the time on the Mac is off by more than 5 minutes. This in turn can affect Apple's single sign-on feature, Active Directory logons, and other features.",
        "solution": "Run the following commands to enable the date and time setting automatically:\n\n% /usr/bin/sudo /usr/sbin/systemsetup -setnetworktimeserversetNetworkTimeServer:% /usr/bin/sudo /usr/sbin/systemsetup -setusingnetworktime on\n\nsetUsingNetworkTime: On\n\nexample\n\n:\n\n% /usr/bin/sudo /usr/sbin/systemsetup -setnetworktimeserver time.apple.com\n\nsetNetworkTimeServer: time.apple.com\n\n% /usr/bin/sudo /usr/sbin/systemsetup -setusingnetworktime on\n\nsetUsingNetworkTime: On\n\nRun the following commands if you have not set, or need to set, a new time zone:\n\n% /usr/bin/sudo /usr/sbin/systemsetup -listtimezones\n\n% /usr/bin/sudo /usr/sbin/systemsetup -settimezoneexample\n\n:\n\n% /usr/bin/sudo /usr/sbin/systemsetup -listtimezones\n\nTime Zones:\n Africa/Abidjan\n Africa/Accra\n Africa/Addis_Ababa\n ...\n\n% /usr/bin/sudo /usr/sbin/systemsetup -settimezone America/New_York\n\nSet TimeZone: America/New_York\n\nImpact:\n\nThe timed service will periodically synchronize with named time servers and will make the computer time more accurate.",
        "reference": "800-171|3.3.6,800-171|3.3.7,800-53|AU-7,800-53|AU-8,800-53r5|AU-7,800-53r5|AU-8,CN-L3|7.1.2.3(c),CN-L3|8.1.4.3(b),CSCv7|6.1,CSCv8|8.4,CSF|PR.PT-1,CSF|RS.AN-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-7,ITSG-33|AU-8,LEVEL|1A,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,QCSC-v1|13.2,SWIFT-CSCv1|6.4,TBA-FIISB|37.4",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/usr/sbin/systemsetup -getusingnetworktime",
        "expect": "Network Time:[\\\\s]*On"
    },
    "custom_item_10": {
        "description": "2.1.2 Ensure Time Is Set Within Appropriate Limits",
        "info": "Correct date and time settings are required for authentication protocols, file creation, modification dates and log entries. Ensure that time on the computer is within acceptable limits. Truly accurate time is measured within milliseconds. For this audit, a drift under four and a half minutes passes the control check. Since Kerberos is one of the important features of macOS integration into Directory systems, the guidance here is to warn you before there could be an impact to operations. From the perspective of accurate time, this check is not strict, so it may be too great for your organization. Your organization can adjust to a smaller offset value as needed.\n\nIf there are consistent drift issues on the OS, some of the most common drift issues should be investigated:\n\n -\n\nThe chosen time server is not reachable based on network firewall rules on the current network\n\n -\n\nThe computer is offline often and the battery drains, and the network is not immediately available\n\n -\n\nThe chosen time server is a special internal or non-public time server that does not provide a reliable time source\n\nNote: ntpdate has been deprecated with 10.14. sntp replaces that command.\n\nKerberos may not operate correctly if the time on the Mac is off by more than 5 minutes. This in turn can affect Apple's single sign-on feature, Active Directory logons, and other features. Audit check is for more than 4 minutes and 30 seconds ahead or behind.",
        "solution": "Terminal Method:\n\nRun the following commands to ensure your time is set within an appropriate limit:\n\n% /usr/bin/sudo /usr/sbin/systemsetup -getnetworktimeserver\n\nThe output will include Network Time Server: and the name of your time server\n\nexample\n\n: Network Time Server: time.apple.com\n\n% /usr/bin/sudo /usr/bin/sntp -sSexample\n\n:\n\n% /usr/bin/sudo /usr/sbin/systemsetup -getnetworktimeserver\n\nNetwork Time Server: time.apple.com\n\n% /usr/bin/sudo /usr/bin/sntp -sS time.apple.com\n\nImpact:\n\nAccurate time is required for many computer functions.",
        "reference": "800-171|3.3.6,800-171|3.3.7,800-53|AU-7,800-53|AU-8,800-53r5|AU-7,800-53r5|AU-8,CN-L3|7.1.2.3(c),CN-L3|8.1.4.3(b),CSCv7|6.1,CSCv8|8.4,CSF|PR.PT-1,CSF|RS.AN-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-7,ITSG-33|AU-8,LEVEL|1A,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,QCSC-v1|13.2,SWIFT-CSCv1|6.4,TBA-FIISB|37.4",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/usr/sbin/systemsetup -getnetworktimeserver | /usr/bin/cut -d ' ' -f 4 | xargs /usr/bin/sntp | /usr/bin/grep '+/-'",
        "expect": "^[\\\\-\\\\+]?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-6][0-9]|270)\\\\.([\\\\d]{1,6})[\\\\s]+"
    },
    "custom_item_11": {
        "description": "2.2.1 Ensure an Inactivity Interval of 20 Minutes Or Less for the Screen Saver Is Enabled",
        "info": "A locking screen saver is one of the standard security controls to limit access to a computer and the current user's session when the computer is temporarily unused or unattended. In macOS, the screen saver starts after a value is selected in the drop-down menu. 20 minutes or less is an acceptable value. Any value can be selected through the command line or script, but a number that is not reflected in the GUI can be problematic. 20 minutes is the default for new accounts.\n\nSetting an inactivity interval for the screen saver prevents unauthorized persons from viewing a system left unattended for an extensive period of time.",
        "solution": "Run the following command to verify that the idle time of the screen saver to 20 minutes of less (<=1200):\n\n% sudo -udefaults -currentHost write com.apple.screensaver idleTime -intNote:\n\nIssues arise if the command line is used to make the setting something other than what is available in the GUI Menu. The GUI allows the options of 1 (60), 2 (120), 5 (300), 10 (600), or 20 (120) minutes, so use one of those values to avoid any issues.\n\nImpact:\n\nIf the screen saver is not set, users may leave the computer available for an unauthorized person to access information.",
        "reference": "800-171|3.1.1,800-171|3.1.10,800-171|3.1.11,800-53|AC-2(5),800-53|AC-11,800-53|AC-11(1),800-53|AC-12,800-53r5|AC-2(5),800-53r5|AC-11,800-53r5|AC-11(1),800-53r5|AC-12,CN-L3|7.1.2.2(d),CN-L3|7.1.3.2(d),CN-L3|7.1.3.7(b),CN-L3|8.1.4.1(b),CSCv7|16.11,CSCv8|4.3,CSF|PR.AC-1,CSF|PR.AC-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(iii),ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.11.2.8,ITSG-33|AC-2(5),ITSG-33|AC-11,ITSG-33|AC-11(1),ITSG-33|AC-12,LEVEL|1A,NIAv2|AM23c,NIAv2|AM23d,NIAv2|AM28,NIAv2|NS5j,NIAv2|NS49,NIAv2|SS14e,PCI-DSSv3.2.1|8.1.8,PCI-DSSv4.0|8.2.8,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,TBA-FIISB|36.2.1,TBA-FIISB|37.1.4",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "regex": ".* = ([1-9]|[1-9][0-9]|[1-9][0-9][0-9]|1[0-1][0-9][0-9]|1200)$",
        "plist_item": "idleTime",
        "plist_name": "com.apple.screensaver",
        "plist_user": "all"
    },
    "custom_item_12": {
        "description": "2.3.1 Ensure Remote Apple Events Is Disabled",
        "info": "Apple Events is a technology that allows one program to communicate with other programs. Remote Apple Events allows a program on one computer to communicate with a program on a different computer.\n\nDisabling Remote Apple Events mitigates the risk of an unauthorized program gaining access to the system.",
        "solution": "Run the following commands to set Remote Apple Events to Off:\n\n% /usr/bin/sudo /usr/sbin/systemsetup -setremoteappleevents off\n\nsetremoteappleevents: Off\n\nImpact:\n\nWith remote Apple events turned on, an AppleScript program running on another Mac can interact with the local computer.",
        "reference": "800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-53|CM-1,800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,CSCv7|5.1,CSCv7|9.2,CSCv8|4.1,CSCv8|4.8,CSF|DE.AE-1,CSF|ID.GV-1,CSF|ID.GV-3,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,GDPR|32.1.b,GDPR|32.4,HIPAA|164.306(a)(1),ITSG-33|CM-1,ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|1A,NESA|M1.2.2,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|GS8b,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,NIAv2|VL7a,NIAv2|VL7b,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|7.2,SWIFT-CSCv1|2.3",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/usr/sbin/systemsetup -getremoteappleevents",
        "expect": "^Remote Apple Events:[\\\\s]*Off"
    },
    "custom_item_13": {
        "description": "2.3.2 Ensure File Sharing Is Disabled",
        "info": "File sharing from a user workstation creates additional risks, including:\n\n - Open ports are created that can be probed and attacked\n - Passwords are attached to user accounts for access that may be exposed and endanger other parts of the organizational environment, including directory accounts\n - Increased complexity makes security more difficult and may expose additional attack vectors\n\nApple's File Sharing uses the Server Message Block (SMB) protocol to share to other computers that can mount SMB shares. This includes other macOS computers.\n\nApple warns that SMB sharing stored passwords is less secure, and anyone with system access can gain access to the password for that account. When sharing with SMB, each user accessing the Mac must have SMB enabled. Storing passwords, especially copies of valid directory passwords, decreases security for the directory account and should not be used.\n\nBy disabling File Sharing, the remote attack surface and risk of unauthorized access to files stored on the system is reduced.",
        "solution": "Run the following command to disable File Sharing:\n\n% /usr/bin/sudo /bin/launchctl disable system/com.apple.smbd\n\n% /usr/bin/sudo /bin/launchctl bootout system/com.apple.smbd\n\nImpact:\n\nFile Sharing can be used to share documents with other users, but hardened servers should be used rather than user endpoints. Turning on File Sharing increases the visibility and attack surface of a system unnecessarily.",
        "reference": "800-171|3.1.5,800-171|3.1.6,800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-53|AC-6(2),800-53|AC-6(5),800-53|CM-1,800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|AC-6(2),800-53r5|AC-6(5),800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.10.6(a),CSCv7|4.3,CSCv7|5.1,CSCv7|9.2,CSCv8|4.1,CSCv8|4.8,CSCv8|5.4,CSF|DE.AE-1,CSF|ID.GV-1,CSF|ID.GV-3,CSF|PR.AC-4,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,GDPR|32.1.b,GDPR|32.4,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.2.3,ITSG-33|AC-6(2),ITSG-33|AC-6(5),ITSG-33|CM-1,ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|1A,NESA|M1.2.2,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.6.1,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|AM1,NIAv2|AM23f,NIAv2|AM32,NIAv2|AM33,NIAv2|GS8b,NIAv2|SS3,NIAv2|SS13c,NIAv2|SS15a,NIAv2|SS15c,NIAv2|SS16,NIAv2|VL2,NIAv2|VL3a,NIAv2|VL7a,NIAv2|VL7b,PCI-DSSv3.2.1|2.2.2,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|7.2,SWIFT-CSCv1|1.2,SWIFT-CSCv1|2.3,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/bin/launchctl list | /usr/bin/grep -c \"com.apple.smbd\"",
        "expect": "^0$"
    },
    "custom_item_14": {
        "description": "2.4.1.1 Ensure Firewall Is Enabled",
        "info": "A firewall is a piece of software that blocks unwanted incoming connections to a system. Apple has posted general documentation about the application firewall:\n\nhttp://support.apple.com/en-us/HT201642\n\nA firewall minimizes the threat of unauthorized users gaining access to your system while connected to a network or the Internet.",
        "solution": "Run the following command to enable the firewall:\n\n% /usr/bin/sudo /usr/bin/defaults write /Library/Preferences/com.apple.alf globalstate -intFor theuse either 1 specific services, or 2 essential services only.\n\nImpact:\n\nThe firewall may block legitimate traffic. Applications that are unsigned will require special handling.",
        "reference": "800-171|3.3.1,800-171|3.3.2,800-171|3.3.6,800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.6.1,800-171|3.13.1,800-171|3.13.2,800-171|3.13.5,800-171|3.13.6,800-171|3.14.6,800-171|3.14.7,800-53|AU-6(1),800-53|AU-7,800-53|CM-1,800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|IR-4(1),800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53|SC-7,800-53|SC-7(5),800-53|SI-4(2),800-53|SI-4(5),800-53r5|AU-6(1),800-53r5|AU-7,800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|IR-4(1),800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,800-53r5|SC-7,800-53r5|SC-7(5),800-53r5|SI-4(2),800-53r5|SI-4(5),CN-L3|7.1.2.2(c),CN-L3|7.1.2.3(c),CN-L3|7.1.3.3(d),CN-L3|7.1.3.5(a),CN-L3|8.1.10.5(b),CN-L3|8.1.10.6(f),CN-L3|8.1.10.6(j),CSCv7|5.1,CSCv7|9.4,CSCv7|9.5,CSCv8|4.1,CSCv8|4.5,CSCv8|13.1,CSF|DE.AE-1,CSF|DE.AE-2,CSF|DE.AE-3,CSF|DE.AE-4,CSF|DE.AE-5,CSF|DE.CM-1,CSF|DE.CM-5,CSF|DE.CM-7,CSF|DE.DP-2,CSF|DE.DP-4,CSF|ID.GV-1,CSF|ID.GV-3,CSF|ID.RA-1,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.IP-8,CSF|PR.PT-1,CSF|PR.PT-3,CSF|PR.PT-4,CSF|RC.RP-1,CSF|RS.AN-1,CSF|RS.AN-3,CSF|RS.CO-2,CSF|RS.CO-3,CSF|RS.RP-1,GDPR|32.1.b,GDPR|32.1.d,GDPR|32.4,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.13.1.3,ITSG-33|AU-6(1),ITSG-33|AU-7,ITSG-33|CM-1,ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|IR-4(1),ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,ITSG-33|SC-7,ITSG-33|SC-7(5),ITSG-33|SI-4(2),ITSG-33|SI-4(5),LEVEL|1A,NESA|M1.2.2,NESA|M5.2.5,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NESA|T8.2.8,NESA|T8.2.9,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|GS7b,NIAv2|GS8b,NIAv2|NS25,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,NIAv2|VL7a,NIAv2|VL7b,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,PCI-DSSv4.0|10.4.1.1,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|7.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,QCSC-v1|13.2,SWIFT-CSCv1|2.3,SWIFT-CSCv1|6.4,TBA-FIISB|43.1,TBA-FIISB|45.2.5",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "expect": "^[12]$",
        "payload_key": "globalstate",
        "payload_type": "com.apple.alf"
    },
    "custom_item_15": {
        "description": "2.4.1.2 Ensure Firewall Stealth Mode Is Enabled",
        "info": "While in Stealth mode, the computer will not respond to unsolicited probes, dropping that traffic.\n\nhttp://support.apple.com/en-us/HT201642\n\nStealth mode on the firewall minimizes the threat of system discovery tools while connected to a network or the Internet.",
        "solution": "Run the following command to enable stealth mode:\n\n% /usr/bin/sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setstealthmode on\n\nStealth mode enabled\n\nImpact:\n\nTraditional network discovery tools like ping will not succeed. Other network tools that measure activity and approved applications will work as expected.\n\nThis control aligns with the primary macOS use case of a laptop that is often connected to untrusted networks where host segregation may be non-existent. In that use case, hiding from the other inmates is likely more than desirable. In use cases where use is only on trusted LANs with static IP addresses, stealth mode may not be desirable.",
        "reference": "800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-171|3.13.5,800-171|3.13.6,800-53|CM-1,800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53|SC-7,800-53|SC-7(5),800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,800-53r5|SC-7,800-53r5|SC-7(5),CN-L3|7.1.2.2(c),CN-L3|8.1.10.6(j),CSCv7|5.1,CSCv7|9.4,CSCv8|4.1,CSCv8|4.5,CSCv8|4.8,CSF|DE.AE-1,CSF|DE.CM-1,CSF|ID.GV-1,CSF|ID.GV-3,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,GDPR|32.4,HIPAA|164.306(a)(1),ISO/IEC-27001|A.13.1.3,ITSG-33|CM-1,ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,ITSG-33|SC-7,ITSG-33|SC-7(5),LEVEL|1A,NESA|M1.2.2,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|GS7b,NIAv2|GS8b,NIAv2|NS25,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,NIAv2|VL7a,NIAv2|VL7b,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|7.2,QCSC-v1|8.2.1,SWIFT-CSCv1|2.3,TBA-FIISB|43.1",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "expect": "^1$",
        "payload_key": "stealthenabled",
        "payload_type": "com.apple.alf"
    },
    "custom_item_16": {
        "description": "2.4.3 Ensure Limit Ad Tracking Is Enabled",
        "info": "Apple provides a framework that allows advertisers to target Apple users and end-users with advertisements. While many people prefer to see advertising that is relevant to them and their interests, the detailed information that is collected, correlated, and available to advertisers in repositories via data mining is often disconcerting. This information is valuable to both advertisers and attackers, and has been used with other metadata to reveal users' identities.\n\nOrganizations should manage advertising settings on computers rather than allow users to configure the settings.\n\nApple Information\n\nAd tracking should be limited on 10.15 and prior.\n\nOrganizations should manage user privacy settings on managed devices to align with organizational policies and user data protection requirements.",
        "solution": "For each needed user, run the following command to enable limited ad tracking:\n\n% /usr/bin/sudo -u/usr/bin/defaults write /Users//Library/Preferences/com.apple.Adlib.plist allowApplePersonalizedAdvertising -bool false\n\nImpact:\n\nUses will see generic advertising rather than targeted advertising. Apple warns that this will reduce the number of relevant ads.",
        "reference": "800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-53|CM-6,800-53|CM-7,800-53r5|CM-6,800-53r5|CM-7,CSCv7|9.2,CSCv8|4.8,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6,ITSG-33|CM-7,LEVEL|1A,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,SWIFT-CSCv1|2.3",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "regex": "0$",
        "plist_item": "allowApplePersonalizedAdvertising",
        "plist_name": "com.apple.AdLib.plist",
        "plist_user": "all"
    },
    "custom_item_17": {
        "description": "2.4.4 Ensure Gatekeeper Is Enabled",
        "info": "Gatekeeper is Apple's application that utilizes allowlisting to restrict downloaded applications from launching. It functions as a control to limit applications from unverified sources from running without authorization.\n\nDisallowing unsigned software will reduce the risk of unauthorized or malicious applications from running on the system.",
        "solution": "Run the following command to enable Gatekeeper to allow applications from App Store and identified developers:\n\n% /usr/bin/sudo /usr/sbin/spctl --master-enable",
        "reference": "800-171|3.14.2,800-171|3.14.4,800-171|3.14.5,800-53|SI-3,800-53|SI-16,800-53r5|SI-3,800-53r5|SI-16,CN-L3|7.1.3.6(b),CN-L3|8.1.4.5,CN-L3|8.1.9.6(a),CN-L3|8.1.9.6(b),CN-L3|8.1.10.5(b),CN-L3|8.1.10.7(a),CN-L3|8.1.10.7(b),CSCv7|8.2,CSCv7|8.4,CSCv8|10.1,CSCv8|10.2,CSCv8|10.5,CSF|DE.CM-4,CSF|DE.DP-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.2.1,ITSG-33|SI-3,ITSG-33|SI-16,LEVEL|1A,NIAv2|GS8a,PCI-DSSv3.2.1|5.1,PCI-DSSv3.2.1|5.1.1,PCI-DSSv4.0|5.2.1,QCSC-v1|3.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,TBA-FIISB|49.2.1,TBA-FIISB|49.2.2,TBA-FIISB|49.3.1,TBA-FIISB|49.3.2,TBA-FIISB|50.2.1,TBA-FIISB|51.2.4,TBA-FIISB|51.2.7",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/usr/sbin/spctl --status",
        "expect": "assessments[\\\\s]+enabled"
    },
    "custom_item_18": {
        "description": "2.4.5 Ensure a Custom Message for the Login Screen Is Enabled",
        "info": "An access warning informs the user that the system is reserved for authorized use only, and that the use of the system may be monitored.\n\nAn access warning may reduce a casual attacker's tendency to target the system. Access warnings may also aid in the prosecution of an attacker by evincing the attacker's knowledge of the system's private status, acceptable use policy, and authorization requirements.",
        "solution": "Run the following command to enable a custom login screen message:\n\n% /usr/bin/sudo /usr/bin/defaults write /Library/Preferences/com.apple.loginwindow LoginwindowText \"\"\n\nImpact:\n\nIf users are not informed of their responsibilities, unapproved activities may occur. Users that are not approved for access may take the lack of a warning banner as implied consent to access.",
        "reference": "800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-53|CM-1,800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,CSCv7|5.1,CSCv8|4.1,CSF|DE.AE-1,CSF|ID.GV-1,CSF|ID.GV-3,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,GDPR|32.1.b,GDPR|32.4,HIPAA|164.306(a)(1),ITSG-33|CM-1,ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|1A,NESA|M1.2.2,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|GS8b,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,NIAv2|VL7a,NIAv2|VL7b,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|7.2,SWIFT-CSCv1|2.3",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "expect": "@ACCESS_WARNING@",
        "payload_key": "LoginwindowText",
        "payload_type": "com.apple.loginwindow"
    },
    "custom_item_19": {
        "description": "2.4.6 Ensure a Password is Required to Wake the Computer From Sleep or Screen Saver Is Enabled",
        "info": "Sleep and screen saver modes are low power modes that reduce electrical consumption while the system is not in use.\n\nPrompting for a password when waking from sleep or screen saver mode mitigates the threat of an unauthorized person gaining access to a system in the user's absence.",
        "solution": "Run the following command to require a password to unlock the computer after the screen saver engages or the computer sleeps:\n\n% /usr/bin/sudo /usr/sbin/sysadminctl -screenLock immediate -passwordor\n\n% /usr/bin/sudo /usr/sbin/sysadminctl -screenLock 5 seconds -passwordImpact:\n\nWithout a screen lock in place, anyone with physical access to the computer would be logged in and able to use the active user's session.",
        "reference": "800-171|3.5.2,800-53|IA-5,800-53r5|IA-5,CSCv7|4.2,CSCv8|4.7,CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5,LEVEL|1A,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/usr/sbin/sysadminctl -screenLock status",
        "expect": "(screenLock delay is immediate|screenLock delay is [1-5] seconds)"
    },
    "custom_item_20": {
        "description": "3.1 Ensure Security Auditing Is Enabled",
        "info": "macOS's audit facility, auditd receives notifications from the kernel when certain system calls, such as open fork and exit are made. These notifications are captured and written to an audit log.\n\nLogs generated by auditd may be useful when investigating a security incident as they may help reveal the vulnerable application and the actions taken by a malicious actor.",
        "solution": "Run the following command to load auditd:\n\n% /usr/bin/sudo /bin/launchctl load -w /System/Library/LaunchDaemons/com.apple.auditd.plist",
        "reference": "800-171|3.3.1,800-171|3.3.2,800-171|3.3.6,800-53|AU-2,800-53|AU-3,800-53|AU-3(1),800-53|AU-7,800-53|AU-12,800-53r5|AU-2,800-53r5|AU-3,800-53r5|AU-3(1),800-53r5|AU-7,800-53r5|AU-12,CN-L3|7.1.2.3(a),CN-L3|7.1.2.3(b),CN-L3|7.1.2.3(c),CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|8.1.4.3(a),CN-L3|8.1.4.3(b),CSCv7|4.9,CSCv7|6.2,CSCv8|8.2,CSCv8|8.5,CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,CSF|RS.AN-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-2,ITSG-33|AU-3,ITSG-33|AU-3(1),ITSG-33|AU-7,ITSG-33|AU-12,LEVEL|1A,NESA|M1.2.2,NESA|M5.5.1,NESA|T3.6.2,NIAv2|AM7,NIAv2|AM11a,NIAv2|AM11b,NIAv2|AM11c,NIAv2|AM11d,NIAv2|AM11e,NIAv2|AM34a,NIAv2|AM34b,NIAv2|AM34c,NIAv2|AM34d,NIAv2|AM34e,NIAv2|AM34f,NIAv2|AM34g,NIAv2|SS30,NIAv2|VL8,PCI-DSSv3.2.1|10.1,PCI-DSSv3.2.1|10.3,PCI-DSSv3.2.1|10.3.1,PCI-DSSv3.2.1|10.3.2,PCI-DSSv3.2.1|10.3.3,PCI-DSSv3.2.1|10.3.4,PCI-DSSv3.2.1|10.3.5,PCI-DSSv3.2.1|10.3.6,PCI-DSSv4.0|10.2.2,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,QCSC-v1|13.2,SWIFT-CSCv1|6.4",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/bin/launchctl list | /usr/bin/grep -i auditd",
        "expect": "com.apple.auditd"
    },
    "custom_item_21": {
        "description": "all_max",
        "file": "/etc/asl/com.apple.install",
        "regex": "all_max=",
        "expect": "all_max="
    },
    "custom_item_22": {
        "description": "ttl",
        "file": "/etc/asl/com.apple.install",
        "regex": "(?i)ttl",
        "expect": "(?i)ttl[\\\\s]*=[\\\\s]*(36[5-9]|3[7-9][0-9]|[4-9][0-9]{2,}|[1-9][0-9]{3,})"
    },
    "custom_item_23": {
        "description": "3.4 Ensure Security Auditing Retention Is Enabled",
        "info": "The macOS audit capability contains important information to investigate security or operational issues. This resource is only completely useful if it is retained long enough to allow technical staff to find the root cause of anomalies in the records.\n\nRetention can be set to respect both size and longevity. To retain as much as possible under a certain size, the recommendation is to use the following:\n\nexpire-after:60d OR 5G\n\nThis recomendation is based on minimum storage for review and investigation. When a third party tool is in use to allow remote logging or the store and forwarding of logs, this local storage requirement is not required.\n\nThe audit records need to be retained long enough to be reviewed as necessary.",
        "solution": "Perform the following to set the audit retention length:\n\nEdit the /etc/security/audit_control file so that expire-after: is at least 60d OR 5G\n\nImpact:\n\nThe recommendation is that at least 60 days or 5 gigabytes of audit records are retained. Systems that have very little remaining disk space may have issues retaining sufficient data.",
        "reference": "800-171|3.3.1,800-171|3.3.2,800-53|AU-1,800-53|AU-2,800-53|AU-4,800-53r5|AU-1,800-53r5|AU-2,800-53r5|AU-4,CN-L3|8.1.4.3(a),CSCv7|6.4,CSCv7|6.7,CSCv8|8.1,CSCv8|8.3,CSF|ID.GV-1,CSF|ID.GV-3,CSF|PR.DS-4,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-1,ITSG-33|AU-2,ITSG-33|AU-4,LEVEL|1A,NESA|M1.2.2,NESA|M5.5.1,NESA|T3.3.1,NESA|T3.6.2,NIAv2|AM7,NIAv2|AM11a,NIAv2|AM11b,NIAv2|AM11c,NIAv2|AM11d,NIAv2|AM11e,NIAv2|SS30,NIAv2|VL8,PCI-DSSv3.2.1|10.8,QCSC-v1|8.2.1,QCSC-v1|13.2,SWIFT-CSCv1|6.4",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "file": "/etc/security/audit_control",
        "regex": "^[\\\\s]*expire-after[\\\\s]*:",
        "expect": "^[\\\\s]*expire-after[\\\\s]*:[\\\\s]*([6-9][0-9]|[1-9][0-9]{2,})d[\\\\s]+OR[\\\\s]+([5-9]|[\\\\d]{2,})G"
    },
    "custom_item_24": {
        "description": "group",
        "cmd": "/bin/ls -n $(/usr/bin/grep '^dir' /etc/security/audit_control | /usr/bin/awk -F: '{print $2}') | /usr/bin/awk '{s+=$4} END {print s}'",
        "expect": "^0$"
    },
    "custom_item_25": {
        "description": "owner",
        "cmd": "/bin/ls -n $(/usr/bin/grep '^dir' /etc/security/audit_control | /usr/bin/awk -F: '{print $2}') | /usr/bin/awk '{s+=$3} END {print s}'",
        "expect": "^0$"
    },
    "custom_item_26": {
        "description": "/etc/security/audit_control",
        "file": "/etc/security/audit_control",
        "owner": "root",
        "mask": "337",
        "group": "wheel"
    },
    "custom_item_27": {
        "description": "permissions",
        "cmd": "/bin/ls -l $(/usr/bin/grep '^dir' /etc/security/audit_control | /usr/bin/awk -F: '{print $2}') | /usr/bin/awk '!/-r--r-----|current|total/{print $1}' | /usr/bin/wc -l | /usr/bin/tr -d ' '",
        "expect": "^0$"
    },
    "custom_item_28": {
        "description": "loggingoption",
        "expect": "^2$",
        "payload_key": "loggingoption",
        "payload_type": "com.apple.alf"
    },
    "custom_item_29": {
        "description": "loggingenabled",
        "expect": "^1$",
        "payload_key": "loggingenabled",
        "payload_type": "com.apple.alf"
    },
    "custom_item_30": {
        "description": "4.2 Ensure HTTP Server Is Disabled",
        "info": "macOS used to have a graphical front-end to the embedded Apache web server in the Operating System. Personal web sharing could be enabled to allow someone on another computer to download files or information from the user's computer. Personal web sharing from a user endpoint has long been considered questionable, and Apple has removed that capability from the GUI. Apache, however, is still part of the Operating System and can be easily turned on to share files and provide remote connectivity to an end-user computer. Web sharing should only be done through hardened web servers and appropriate cloud services.\n\nWeb serving should not be done from a user desktop. Dedicated webservers or appropriate cloud storage should be used. Open ports make it easier to exploit the computer.",
        "solution": "Run the following command to disable the HTTP server services:\n\n% /usr/bin/sudo /usr/sbin/apachectl stop\n\n% /usr/bin/sudo /bin/launchctl unload -w /System/Library/LaunchDaemons/org.apache.httpd.plist\n\nImpact:\n\nThe web server is both a point of attack for the system and a means for unauthorized file transfers.",
        "reference": "800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-53|CM-1,800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,CSCv7|5.1,CSCv7|9.2,CSCv8|4.1,CSCv8|4.8,CSF|DE.AE-1,CSF|ID.GV-1,CSF|ID.GV-3,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,GDPR|32.1.b,GDPR|32.4,HIPAA|164.306(a)(1),ITSG-33|CM-1,ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|1A,NESA|M1.2.2,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|GS8b,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,NIAv2|VL7a,NIAv2|VL7b,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|7.2,SWIFT-CSCv1|2.3",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/bin/launchctl list | /usr/bin/grep -c \"org.apache.httpd\"",
        "expect": "^0$"
    },
    "custom_item_31": {
        "description": "com.apple.nfsd",
        "cmd": "/bin/launchctl list | /usr/bin/grep -c 'com.apple.nfsd'",
        "expect": "^0$"
    },
    "custom_item_32": {
        "description": "/etc/exports",
        "file": "/etc/exports"
    },
    "custom_item_33": {
        "description": "5.10 Ensure Secure Keyboard Entry Terminal.app Is Enabled",
        "info": "Secure Keyboard Entry prevents other applications on the system and/or network from detecting and recording what is typed into Terminal. Unauthorized applications and malicious code could intercept keystrokes entered in the Terminal.\n\nEnabling Secure Keyboard Entry minimizes the risk of a key logger from detecting what is entered in Terminal.",
        "solution": "Run the following command to ensure keyboard entries are secure in Terminal for every user that is non-compliant:\n\n% /usr/bin/sudo -u/usr/bin/defaults write -app Terminal SecureKeyboardEntry -bool true\n\nImpact:\n\nEnabling this in Terminal would prevent an application that is otherwise validly intercepting keyboard input from intercepting that input in Terminal.app. This could impact productivity tools.",
        "reference": "800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-53|CM-6,800-53|CM-7,800-53r5|CM-6,800-53r5|CM-7,CSCv7|4.1,CSCv7|5.1,CSCv7|9.2,CSCv8|4.8,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6,ITSG-33|CM-7,LEVEL|1A,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,SWIFT-CSCv1|2.3",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "regex": "1$",
        "plist_item": "SecureKeyboardEntry",
        "plist_name": "com.apple.Terminal",
        "plist_user": "all"
    },
    "custom_item_34": {
        "description": "5.1.1 Ensure Home Folders Are Secure",
        "info": "By default, macOS allows all valid users into the top level of every other user's home folder and restricts access to the Apple default folders within. Another user on the same system can see you have a \"Documents\" folder but cannot see inside it. This configuration does work for personal file sharing but can expose user files to standard accounts on the system.\n\nThe best parallel for Enterprise environments is that everyone who has a Dropbox account can see everything that is at the top level but can't see your pictures. Similarly with macOS, users can see into every new Directory that is created because of the default permissions.\n\nHome folders should be restricted to access only by the user. Sharing should be used on dedicated servers or cloud instances that are managing access controls. Some environments may encounter problems if execute rights are removed as well as read and write. Either no access or execute only for group or others is acceptable.\n\nAllowing all users to view the top level of all networked users' home folder may not be desirable since it may lead to the revelation of sensitive information.",
        "solution": "For each user, run the following command to secure all home folders:\n\n% /usr/bin/sudo /bin/chmod -R og-rwx /Users/Alternately, run the following command if there needs to be executable access for a home folder:\n\n% /usr/bin/sudo /bin/chmod -R og-rw /Users/Impact:\n\nIf implemented, users will not be able to use the \"Public\" folders in other users' home folders. \"Public\" folders with appropriate permissions would need to be set up in the /Shared folder.",
        "reference": "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|MP-2,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|MP-2,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|14.6,CSCv8|3.3,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-2,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|MP-2,ITSG-33|MP-2a.,LEVEL|1A,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,NIAv2|SS29,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/usr/bin/find /System/Volumes/Data/Users -mindepth 1 -maxdepth 1 -type d -not -perm 700 | /usr/bin/grep -v 'Shared' | /usr/bin/grep -v 'Guest' | /usr/bin/awk '{print} END {if (NR == 0) print \"none\"}'",
        "expect": "^none$",
        "timeout": "@FIND_TIMEOUT@"
    },
    "custom_item_35": {
        "description": "5.11 Ensure XProtect Is Running and Updated",
        "info": "XProtect is Apple's native signature-based antivirus technology. XProtect both finds and blocks the execution of known malware. There are many AV and Endpoint Threat Detection and Response (ETDR) tools available for Mac OS. The native Apple provisioned tool looks for specific known malware is completely integrated into the OS. No matter what other tools are being used, XProtect should have the latest signatures available.\n\nApple creates signatures for known malware that actually affects Macs and that knowledge should be leveraged.",
        "solution": "Run the following command to enable and update XProtect:\n\n% /usr/bin/sudo /bin/launchctl load -w /Library/Apple/System/Library/LaunchDaemons/com.apple.XProtect.daemon.scan.plist\n\n% /usr/bin/sudo /bin/launchctl load -w /Library/Apple/System/Library/LaunchDaemons/com.apple.XprotectFramework.PluginService.plist\n\n% /usr/bin/sudo /usr/sbin/softwareupdate -l --background-critical\n\nsoftwareupdate[97180]: Triggering a background check with forced scan (critical and config-data updates only) ...\n\nNote: Xprotect can only be enabled/disabled if SIP (System Integrity Protection) is disabled. If Xprotect is disabled, the system might be compromised and needs to be investigated.\n\nImpact:\n\nSome organizations may have effective Mac OS anti-malware tools that XProtect conflicts with.",
        "reference": "800-171|3.14.2,800-171|3.14.4,800-171|3.14.5,800-53|SI-3,800-53|SI-16,800-53r5|SI-3,800-53r5|SI-16,CN-L3|7.1.3.6(b),CN-L3|8.1.4.5,CN-L3|8.1.9.6(a),CN-L3|8.1.9.6(b),CN-L3|8.1.10.5(b),CN-L3|8.1.10.7(a),CN-L3|8.1.10.7(b),CSCv7|8.2,CSCv7|8.4,CSCv8|10.1,CSCv8|10.2,CSCv8|10.5,CSF|DE.CM-4,CSF|DE.DP-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.2.1,ITSG-33|SI-3,ITSG-33|SI-16,LEVEL|1A,NIAv2|GS8a,PCI-DSSv3.2.1|5.1,PCI-DSSv3.2.1|5.1.1,PCI-DSSv4.0|5.2.1,QCSC-v1|3.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,TBA-FIISB|49.2.1,TBA-FIISB|49.2.2,TBA-FIISB|49.3.1,TBA-FIISB|49.3.2,TBA-FIISB|50.2.1,TBA-FIISB|51.2.4,TBA-FIISB|51.2.7",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/bin/launchctl list | /usr/bin/grep -cE \"(com.apple.XprotectFramework.PluginService$|com.apple.XProtect.daemon.scan$)\"",
        "expect": "^2$"
    },
    "custom_item_36": {
        "description": "5.1.2 Ensure System Integrity Protection Status (SIP) Is Enabled",
        "info": "System Integrity Protection is a security feature introduced in OS X 10.11 El Capitan. System Integrity Protection restricts access to System domain locations and restricts runtime attachment to system processes. Any attempt to inspect or attach to a system process will fail. Kernel Extensions are now restricted to /Library/Extensions and are required to be signed with a Developer ID.\n\nRunning without System Integrity Protection on a production system runs the risk of the modification of system binaries or code injection of system processes that would otherwise be protected by SIP.",
        "solution": "Perform the following steps to enable System Integrity Protection:\n\n - Reboot into the Recovery Partition (reboot and hold down Command + R )\n - Select Utilities\n - Select Terminal\n - Run the following command:\n\n% /usr/bin/sudo /usr/bin/csrutil enable\n\nSuccessfully enabled System Integrity Protection. Please restart the machine for the changes to take effect.- Reboot the computer\n\nNote: You should research why the system had SIP disabled. It might be a better option to erase the Mac and reinstall the operating system. That is at your discretion.\n\nNote: You cannot enable System Integrity Protection from the booted operating system. If the remediation is attempted in the booted OS and not the Recovery Partition the output will give the error csrutil: failed to modify system integrity configuration. This tool needs to be executed from the Recovery OS.\n\nImpact:\n\nSystem binaries and processes could become compromised.",
        "reference": "800-171|3.4.1,800-171|3.4.6,800-171|3.4.7,800-171|3.4.9,800-53|CM-7,800-53|CM-7(1),800-53|CM-7(2),800-53|CM-8(3),800-53|CM-10,800-53|CM-11,800-53|SI-16,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-7(2),800-53r5|CM-8(3),800-53r5|CM-10,800-53r5|CM-11,800-53r5|SI-16,CN-L3|8.1.10.2(a),CN-L3|8.1.10.2(b),CSCv7|2.6,CSCv8|2.3,CSCv8|2.6,CSCv8|10.5,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.6.2,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-7(2),ITSG-33|CM-8(3),ITSG-33|SI-16,LEVEL|1A,NESA|T1.2.1,NESA|T1.2.2,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,SWIFT-CSCv1|2.3,SWIFT-CSCv1|5.1",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/usr/bin/csrutil status",
        "expect": "System Integrity Protection status: enabled"
    },
    "custom_item_37": {
        "description": "5.1.3 Ensure Apple Mobile File Integrity (AMFI) Is Enabled",
        "info": "Apple Mobile File Integrity (AMFI) was first released in macOS 10.12. The daemon and service block attempts to run unsigned code. AMFI uses lanchd, code signatures, certificates, entitlements, and provisioning profiles to create a filtered entitlement dictionary for an app. AMFI is the macOS kernel module that enforces code-signing and library validation.\n\nApple Mobile File Integrity validates that application code is validated.",
        "solution": "Run the following command to enable the Apple Mobile File Integrity service:\n\n% /usr/bin/sudo /usr/sbin/nvram boot-args=\"\"\n\nImpact:\n\nApplications could be compromised with malicious code.",
        "reference": "800-171|3.4.1,800-171|3.4.6,800-171|3.4.7,800-171|3.4.9,800-53|CM-7,800-53|CM-7(1),800-53|CM-7(2),800-53|CM-8(3),800-53|CM-10,800-53|CM-11,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-7(2),800-53r5|CM-8(3),800-53r5|CM-10,800-53r5|CM-11,CN-L3|8.1.10.2(a),CN-L3|8.1.10.2(b),CSCv7|2.6,CSCv8|2.3,CSCv8|2.6,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.6.2,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-7(2),ITSG-33|CM-8(3),LEVEL|1A,NESA|T1.2.1,NESA|T1.2.2,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,SWIFT-CSCv1|2.3,SWIFT-CSCv1|5.1",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/usr/sbin/nvram -p | /usr/bin/grep -c 'amfi_get_out_of_my_way=1'",
        "expect": "^0$"
    },
    "custom_item_38": {
        "description": "5.1.4 Ensure Signed System Volume (SSV) Is Enabled",
        "info": "Sealed System Volume is a security feature introduced in macOS 11.0 Big Sur.\n\nDuring system installation, a SHA-256 cryptographic hash is calculated for all immutable system files and stored in a Merkle tree which itself is hashed as the Seal. Both are stored in the metadata of the snapshot created of the System volume.\n\nThe seal is verified by the boot loader at startup. macOS will not boot if system files have been tampered with. If validation fails, the user will be instructed to reinstall the operating system.\n\nDuring read operations for files located in the Sealed System Volume, a hash is calculated and compared to the value stored in the Merkle tree.\n\nRunning without Sealed System Volume on a production system could run the risk of Apple software that integrates directly with macOS being modified.",
        "solution": "If SSV has been disabled, assume that the operating system has been compromised. Back up any files, and do a clean install to a known good Operating System.\n\nImpact:\n\nApple Software that integrates with the operating system could become compromised.",
        "reference": "800-171|3.5.2,800-171|3.13.16,800-53|IA-5(1),800-53|SC-28,800-53|SC-28(1),800-53r5|IA-5(1),800-53r5|SC-28,800-53r5|SC-28(1),CN-L3|8.1.4.7(b),CN-L3|8.1.4.8(b),CSCv7|13.6,CSCv7|14.8,CSCv8|3.6,CSCv8|3.11,CSF|PR.AC-1,CSF|PR.DS-1,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(d),HIPAA|164.312(e)(2)(ii),ITSG-33|IA-5(1),ITSG-33|SC-28,ITSG-33|SC-28a.,ITSG-33|SC-28(1),LEVEL|1A,NESA|T5.2.3,PCI-DSSv3.2.1|3.4,PCI-DSSv4.0|3.3.2,PCI-DSSv4.0|3.5.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1,TBA-FIISB|28.1",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/usr/bin/csrutil authenticated-root status",
        "expect": "Authenticated Root status: enabled"
    },
    "custom_item_39": {
        "description": "5.1.5 Ensure Appropriate Permissions Are Enabled for System Wide Applications",
        "info": "Applications in the System Applications Directory (/Applications) should be world-executable since that is their reason to be on the system. They should not be world-writable and allow any process or user to alter them for other processes or users to then execute modified versions.\n\nUnauthorized modifications of applications could lead to the execution of malicious code.",
        "solution": "Run the following command to change the permissions for each application that does not meet the requirements:\n\n% /usr/bin/sudo IFS=$'\\n'\nfor apps in $( /usr/bin/find /System/Volumes/Data/Applications -iname \"*\\.app\" -type d -perm -2 | grep -v Xcode.app ); do\n  /bin/chmod -R o-w \"$apps\"\ndone\n\nNote: Global changes should not be performed where mission-critical applications are part of the improperly permissioned applications.\n\nImpact:\n\nApplications changed will no longer be world-writable. Depending on the environment, there will be different risk tolerances on each non-conforming application. Global changes should not be performed where mission-critical applications are misconfigured.",
        "reference": "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|MP-2,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|MP-2,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|14.6,CSCv8|3.3,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-2,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|MP-2,ITSG-33|MP-2a.,LEVEL|1A,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,NIAv2|SS29,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/usr/bin/find /System/Volumes/Data/Applications -iname '*\\.app' -type d -perm -2 -ls | /usr/bin/grep -v 'Xcode.app' | /usr/bin/awk '{print} END {if (NR == 0) print \"none\"}'",
        "expect": "^none$",
        "timeout": "@FIND_TIMEOUT@"
    },
    "custom_item_40": {
        "description": "5.1.6 Ensure No World Writable Files Exist in the System Folder",
        "info": "Software sometimes insists on being installed in the /System/Volumes/Data/System Directory and has inappropriate world-writable permissions.\n\nMacs with writable files in System should be investigated forensically. A file with open writable permissions is a sign of at best a rogue application. It could also be a sign of a computer compromise and a persistent presence on the system.\n\nFolders in /System/Volumes/Data/System should not be world-writable. The audit check excludes the \"Drop Box\" folder that is part of Apple's default user template.",
        "solution": "Run the following command to set permissions so that folders are not world-writable in the /System folder:\n\n% /usr/bin/sudo IFS=$'\\n'\nfor sysPermissions in $( /usr/bin/sudo /usr/bin/find /System/Volumes/Data/System -type d -perm -2 | /usr/bin/grep -v \"downloadDir\" ); do\n  /bin/chmod -R o-w \"$sysPermissions\"\ndone\n\nImpact:\n\nChanging file permissions could disrupt the use of applications that rely on files in the System Folder with vulnerable permissions.",
        "reference": "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|MP-2,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|MP-2,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|14.6,CSCv8|3.3,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-2,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|MP-2,ITSG-33|MP-2a.,LEVEL|1A,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,NIAv2|SS29,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/usr/bin/find /System/Volumes/Data/System -type d -perm -2 -ls | /usr/bin/grep -v 'downloadDir' | /usr/bin/awk '{print} END {if (NR == 0) print \"none\"}'",
        "expect": "none",
        "timeout": "@FIND_TIMEOUT@"
    },
    "custom_item_41": {
        "description": "policyAttributeMaximumFailedAuthentications",
        "cmd": "/usr/bin/pwpolicy -getaccountpolicies 2> /dev/null | /usr/bin/tail +2 | /usr/bin/xmllint --xpath '//dict/key[text()=\"policyAttributeMaximumFailedAuthentications\"]/following-sibling::integer[1]/text()' -",
        "expect": "^@ACCOUNT_LOCKOUT_THRESHOLD@$"
    },
    "custom_item_42": {
        "description": "policyAttributeMinutesUntilFailedAuthenticationReset",
        "cmd": "/usr/bin/pwpolicy -getaccountpolicies | /usr/bin/grep -A1 \"policyAttributeMinutesUntilFailedAuthenticationReset\" | /usr/bin/tail -1 | /usr/bin/cut -d'>' -f2 | /usr/bin/cut -d '<' -f1",
        "expect": "^@ACCOUNT_LOCKOUT_TIME@$"
    },
    "custom_item_43": {
        "description": "5.2.2 Ensure Password Minimum Length Is Configured",
        "info": "A minimum password length is the fewest number of characters a password can contain to meet a system's requirements.\n\nEnsure that a minimum of a 15-character password is part of the password policy on the computer.\n\nWhere the confidentiality of encrypted information in FileVault is more of a concern, requiring a longer password or passphrase may be sufficient rather than imposing additional complexity requirements that may be self-defeating.\n\nInformation systems that are not protected with strong password schemes including passwords of minimum length provide a greater opportunity for attackers to crack the password and gain access to the system.",
        "solution": "Run the following command to set the password length to greater than or equal to 15:\n\n% /usr/bin/sudo /usr/bin/pwpolicy -n /Local/Default -setglobalpolicy \"minChars==15>\"\n\nImpact:\n\nShort passwords can be easily attacked.",
        "reference": "800-171|3.5.2,800-53|IA-5(1),800-53r5|IA-5(1),CSCv7|4.4,CSCv8|5.2,CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5(1),LEVEL|1A,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/usr/bin/pwpolicy -getaccountpolicies | /usr/bin/grep -e \"policyAttributePassword matches\" | /usr/bin/cut -b 46-53 | /usr/bin/cut -d',' -f1 | /usr/bin/cut -d'{' -f2",
        "expect": "^@MINIMUM_PASSWORD_LENGTH@$"
    },
    "custom_item_44": {
        "description": "5.2.7 Ensure Password Age Is Configured",
        "info": "Over time, passwords can be captured by third parties through mistakes, phishing attacks, third-party breaches, or merely brute-force attacks. To reduce the risk of exposure and to decrease the incentives of password reuse (passwords that are not forced to be changed periodically generally are not ever changed), users should reset passwords periodically.This control uses 365 days as the acceptable value. Some organizations may be more or less restrictive. This control mainly exists to mitigate against password reuse of the macOS account password in other realms that may be more prone to compromise. Attackers take advantage of exposed information to attack other accounts.\n\nPasswords should be changed periodically to reduce exposure.",
        "solution": "Run the following command to require that passwords expire after at most 365 days:\n\n% /usr/bin/sudo /usr/bin/pwpolicy -n /Local/Default -setglobalpolicy \"maxMinutesUntilChangePassword=\"\n\nImpact:\n\nRequired password changes will lead to some locked computers requiring admin assistance.",
        "reference": "800-171|3.1.1,800-53|AC-2(3),800-53r5|AC-2(3),CN-L3|7.1.3.2(e),CN-L3|8.1.4.2(c),CSCv7|16.9,CSCv8|5.3,CSF|PR.AC-1,CSF|PR.AC-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.9.2.6,ITSG-33|AC-2(3),LEVEL|1A,NIAv2|AM26,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,TBA-FIISB|36.2.2",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/usr/bin/pwpolicy -getaccountpolicies | /usr/bin/grep -A1 policyAttributeDaysUntilExpiration | /usr/bin/tail -1 | /usr/bin/cut -d'>' -f2 | /usr/bin/cut -d '<' -f1",
        "expect": "^@PASSWORD_AGE@"
    },
    "custom_item_45": {
        "description": "5.2.8 Ensure Password History Is Configured",
        "info": "Over time, passwords can be captured by third parties through mistakes, phishing attacks, third-party breaches, or merely brute-force attacks. To reduce the risk of exposure and to decrease the incentives of password reuse (passwords that are not forced to be changed periodically generally are not ever changed), users must reset passwords periodically. This control ensures that previous passwords are not reused immediately by keeping a history of previous password hashes. Ensure that password history checks are part of the password policy on the computer. This control checks whether a new password is different than the previous 15.The latest NIST guidance based on exploit research referenced in this section details how one of the greatest risks is password exposure rather than password cracking. Passwords should be changed to a new unique value whenever a password might have been exposed to anyone other than the account holder. Attackers have maintained persistent control based on predictable password change patterns and substantially different patterns should be used in case of a leak.\n\nOld passwords should not be reused.",
        "solution": "Run the following command to require that the password must to be different from at least the last 15 passwords:\n\n% /usr/bin/sudo /usr/bin/pwpolicy -n /Local/Default -setglobalpolicy \"usingHistory==15>\"\n\nImpact:\n\nRequired password changes will lead to some locked computers requiring admin assistance.",
        "reference": "800-171|3.5.2,800-53|IA-5(1),800-53r5|IA-5(1),CSCv7|4.4,CSCv8|5.2,CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5(1),LEVEL|1A,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/usr/bin/pwpolicy -getaccountpolicies | /usr/bin/grep -A1 policyAttributePasswordHistoryDepth | /usr/bin/tail -1 | /usr/bin/cut -d'>' -f2 | /usr/bin/cut -d '<' -f1",
        "expect": "^@PASSWORD_HISTORY@$"
    },
    "custom_item_46": {
        "description": "/etc/sudoers.d",
        "file": "/etc/sudoers.d",
        "owner": "root",
        "group": "wheel"
    },
    "custom_item_47": {
        "description": "sudo",
        "cmd": "/usr/bin/sudo -V | /usr/bin/grep \"Authentication timestamp timeout:\"",
        "expect": "Authentication timestamp timeout: 0.0 minutes"
    },
    "custom_item_48": {
        "description": "5.4 Ensure a Separate Timestamp Is Enabled for Each User/tty Combo",
        "info": "Using tty tickets ensures that a user must enter the sudo password in each Terminal session.\n\nWith sudo versions 1.8 and higher, introduced in 10.12, the default value is to have tty tickets for each interface so that root access is limited to a specific terminal. The default configuration can be overwritten or not configured correctly on earlier versions of macOS.\n\nIn combination with removing the sudo timeout grace period, a further mitigation should be in place to reduce the possibility of a background process using elevated rights when a user elevates to root in an explicit context or tty.\n\nAdditional mitigation should be in place to reduce the risk of privilege escalation of background processes.",
        "solution": "Run the following command to edit the sudo settings:\n\n% /usr/bin/sudo /usr/sbin/visudo -f /etc/sudoers.d/example:\n\n% /usr/bin/sudo /usr/sbin/visudo -f /etc/sudoers.d/10_cissudoconfiguration\n\nNote: Unlike other Unix and/or Linux distros, macOS will ignore configuration files in the sudoers.d folder that contain a so do not add a file extension to the configuration file.\n\nAdd the line Defaults timestamp_type=tty to the configuration file.\n\nNote: The Defaults timestamp_type=tty line can be added to an existing configuration file or a new one. That will depend on your organization's preference and works either way.\n\nImpact:\n\nThis control should have no user impact. Developers or installers may have issues if background processes are spawned with different interfaces than where sudo was executed.",
        "reference": "800-171|3.1.1,800-171|3.1.10,800-171|3.1.11,800-53|AC-2(5),800-53|AC-11,800-53|AC-11(1),800-53|AC-12,800-53r5|AC-2(5),800-53r5|AC-11,800-53r5|AC-11(1),800-53r5|AC-12,CN-L3|7.1.2.2(d),CN-L3|7.1.3.2(d),CN-L3|7.1.3.7(b),CN-L3|8.1.4.1(b),CSCv7|16.11,CSCv8|4.3,CSF|PR.AC-1,CSF|PR.AC-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(iii),ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.11.2.8,ITSG-33|AC-2(5),ITSG-33|AC-11,ITSG-33|AC-11(1),ITSG-33|AC-12,LEVEL|1A,NIAv2|AM23c,NIAv2|AM23d,NIAv2|AM28,NIAv2|NS5j,NIAv2|NS49,NIAv2|SS14e,PCI-DSSv3.2.1|8.1.8,PCI-DSSv4.0|8.2.8,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,TBA-FIISB|36.2.1,TBA-FIISB|37.1.4",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/usr/bin/sudo -V | /usr/bin/grep -c \"Type of authentication timestamp record: tty\"",
        "expect": "^1$"
    },
    "custom_item_49": {
        "description": "5.5 Ensure the \"root\" Account Is Disabled",
        "info": "The root account is a superuser account that has access privileges to perform any actions and read/write to any file on the computer. With some versions of Linux, the system administrator may commonly use the root account to perform administrative functions.\n\nEnabling and using the root account puts the system at risk since any successful exploit or mistake while the root account is in use could have unlimited access privileges within the system. Using the sudo command allows users to perform functions as a root user while limiting and password protecting the access privileges. By default the root account is not enabled on a macOS computer. An administrator can escalate privileges using the sudo command (use -s or -i to get a root shell).",
        "solution": "Run the following command to disable the root user:\n\n% /usr/bin/sudo /usr/sbin/dsenableroot -d\n\nusername = root\nuser password:\n\nImpact:\n\nSome legacy POSIX software might expect an available root account.",
        "reference": "800-171|3.1.5,800-171|3.1.6,800-53|AC-6(2),800-53|AC-6(5),800-53r5|AC-6(2),800-53r5|AC-6(5),CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.10.6(a),CSCv7|4.3,CSCv8|5.4,CSF|PR.AC-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.2.3,ITSG-33|AC-6(2),ITSG-33|AC-6(5),LEVEL|1A,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.6.1,NIAv2|AM1,NIAv2|AM23f,NIAv2|AM32,NIAv2|AM33,NIAv2|SS13c,NIAv2|SS15c,NIAv2|VL3a,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|5.2.2,QCSC-v1|6.2,SWIFT-CSCv1|1.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/usr/bin/dscl . -read /Users/root AuthenticationAuthority",
        "expect": "(No such key: AuthenticationAuthority|Disabled)"
    },
    "custom_item_50": {
        "description": "5.6 Ensure Automatic Login Is Disabled",
        "info": "The automatic login feature saves a user's system access credentials and bypasses the login screen. Instead, the system automatically loads to the user's desktop screen.\n\nDisabling automatic login decreases the likelihood of an unauthorized person gaining access to a system.",
        "solution": "Run the following command to disable automatic login:\n\n% /usr/bin/sudo /usr/bin/defaults delete /Library/Preferences/com.apple.loginwindow autoLoginUser\n\nImpact:\n\nIf automatic login is not disabled, an unauthorized user could gain access to the system without supplying any credentials.",
        "reference": "800-171|3.5.2,800-53|IA-5,800-53r5|IA-5,CSCv7|4.2,CSCv8|4.7,CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5,LEVEL|1A,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "expect": "^$",
        "payload_key": "autoLoginUser",
        "payload_type": "com.apple.loginwindow"
    },
    "custom_item_51": {
        "description": "5.7 Ensure an Administrator Account Cannot Log In to Another User's Active and Locked Session",
        "info": "macOS has a privilege that can be granted to any user that will allow that user to unlock an active user's sessions.\n\nDisabling the administrator's and/or user's ability to log into another user's active and locked session prevents unauthorized persons from viewing potentially sensitive and/or personal information.",
        "solution": "Run the following command to disable a user logging into another user's active and/or locked session:\n\n% /usr/bin/sudo /usr/bin/security authorizationdb write system.login.screensaver authenticate-session-owner\n\nYES (0)\n\nImpact:\n\nWhile Fast user switching is a workaround for some lab environments, especially where there is even less of an expectation of privacy, this setting change may impact some maintenance workflows.",
        "reference": "800-171|3.1.1,800-171|3.1.10,800-171|3.1.11,800-53|AC-2(5),800-53|AC-11,800-53|AC-11(1),800-53|AC-12,800-53r5|AC-2(5),800-53r5|AC-11,800-53r5|AC-11(1),800-53r5|AC-12,CN-L3|7.1.2.2(d),CN-L3|7.1.3.2(d),CN-L3|7.1.3.7(b),CN-L3|8.1.4.1(b),CSCv7|16.11,CSCv8|4.3,CSF|PR.AC-1,CSF|PR.AC-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(iii),ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.11.2.8,ITSG-33|AC-2(5),ITSG-33|AC-11,ITSG-33|AC-11(1),ITSG-33|AC-12,LEVEL|1A,NIAv2|AM23c,NIAv2|AM23d,NIAv2|AM28,NIAv2|NS5j,NIAv2|NS49,NIAv2|SS14e,PCI-DSSv3.2.1|8.1.8,PCI-DSSv4.0|8.2.8,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,TBA-FIISB|36.2.1,TBA-FIISB|37.1.4",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/usr/bin/security authorizationdb read system.login.screensaver 2>&1 | /usr/bin/grep -c 'authenticate-session-owner'",
        "expect": "^1$"
    },
    "custom_item_52": {
        "description": "5.9 Ensure Users' Accounts Do Not Have a Password Hint",
        "info": "Password hints help the user recall their passwords for various systems and/or accounts. In most cases, password hints are simple and closely related to the user's password.\n\nPassword hints that are closely related to the user's password are a security vulnerability, especially in the social media age. Unauthorized users are more likely to guess a user's password if there is a password hint. The password hint is very susceptible to social engineering attacks and information exposure on social media networks.",
        "solution": "Run the following command to remove a user's password hint:\n\n% /usr/bin/sudo /usr/bin/dscl . -delete /Users/hint\n\nexample\n\n:\n\n% /usr/bin/sudo /usr/bin/dscl . -delete /Users/firstuser hint\n\n% /usr/bin/sudo /usr/bin/dscl . -delete /Users/seconduser hint",
        "reference": "800-171|3.5.2,800-53|IA-5(1),800-53r5|IA-5(1),CSCv7|4.4,CSCv8|5.2,CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5(1),LEVEL|1A,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/usr/bin/dscl . -list /Users hint | /usr/bin/awk '{ if ($2) print $1\" - fail\" }' | /usr/bin/awk '{print} END {if (NR == 0) print \"pass\";}'",
        "expect": "^pass$"
    },
    "custom_item_53": {
        "description": "6.1.1 Ensure Login Window Displays as Name and Password Is Enabled",
        "info": "The login window prompts a user for his/her credentials, verifies their authorization level, and then allows or denies the user access to the system.\n\nPrompting the user to enter both their username and password makes it twice as hard for unauthorized users to gain access to the system since they must discover two attributes.",
        "solution": "Run the following command to enable the login window to display name and password:\n\n% /usr/bin/sudo /usr/bin/defaults write /Library/Preferences/com.apple.loginwindow SHOWFULLNAME -bool true\n\nNote: The GUI will not display the updated setting until the current user(s) logs out.",
        "reference": "800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-53|CM-1,800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,CSCv7|5.1,CSCv8|4.1,CSF|DE.AE-1,CSF|ID.GV-1,CSF|ID.GV-3,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,GDPR|32.1.b,GDPR|32.4,HIPAA|164.306(a)(1),ITSG-33|CM-1,ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|1A,NESA|M1.2.2,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|GS8b,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,NIAv2|VL7a,NIAv2|VL7b,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|7.2,SWIFT-CSCv1|2.3",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "expect": "true",
        "payload_key": "SHOWFULLNAME",
        "payload_type": "com.apple.loginwindow"
    },
    "custom_item_54": {
        "description": "6.1.2 Ensure Show Password Hints Is Disabled",
        "info": "Password hints are user-created text displayed when an incorrect password is used for an account.\n\nPassword hints make it easier for unauthorized persons to gain access to systems by displaying information provided by the user to assist in remembering the password. This info could include the password itself or other information that might be readily discerned with basic knowledge of the end user.",
        "solution": "Run the following command to disable password hints:\n\n% /usr/bin/sudo /usr/bin/defaults write /Library/Preferences/com.apple.loginwindow RetriesUntilHint -int 0\n\nImpact:\n\nThe user can set the hint to any value, including the password itself or clues that allow trivial social engineering attacks.",
        "reference": "800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-53|CM-1,800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,CSCv7|5.1,CSCv8|4.1,CSF|DE.AE-1,CSF|ID.GV-1,CSF|ID.GV-3,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,GDPR|32.1.b,GDPR|32.4,HIPAA|164.306(a)(1),ITSG-33|CM-1,ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|1A,NESA|M1.2.2,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|GS8b,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,NIAv2|VL7a,NIAv2|VL7b,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|7.2,SWIFT-CSCv1|2.3",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "expect": "^0$",
        "payload_key": "RetriesUntilHint",
        "payload_type": "com.apple.loginwindow"
    },
    "custom_item_55": {
        "description": "6.1.3 Ensure Guest Account Is Disabled",
        "info": "The guest account allows users access to the system without having to create an account or password. Guest users are unable to make setting changes and cannot remotely login to the system. All files, caches, and passwords created by the guest user are deleted upon logging out.\n\nDisabling the guest account mitigates the risk of an untrusted user doing basic reconnaissance and possibly using privilege escalation attacks to take control of the system.",
        "solution": "Run the following command to disable the guest account:\n\n% /usr/bin/sudo /usr/bin/defaults write /Library/Preferences/com.apple.loginwindow GuestEnabled -bool false\n\nImpact:\n\nA guest user can use that access to find out additional information about the system and might be able to use privilege escalation vulnerabilities to establish greater access.",
        "reference": "800-171|3.1.1,800-171|3.1.5,800-171|3.3.8,800-171|3.3.9,800-171|3.5.2,800-53|AC-1,800-53|AC-2,800-53|AC-2(1),800-53|AC-3,800-53|AC-6,800-53|AC-6(1),800-53|AC-6(7),800-53|AU-9(4),800-53|IA-5(1),800-53r5|AC-1,800-53r5|AC-2,800-53r5|AC-2(1),800-53r5|AC-3,800-53r5|AC-6,800-53r5|AC-6(1),800-53r5|AC-6(7),800-53r5|AU-9(4),800-53r5|IA-5(1),CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(d),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(e),CN-L3|8.1.4.2(f),CN-L3|8.1.4.3(d),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.1.10.6(c),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|4.4,CSCv8|5.2,CSCv8|6.2,CSCv8|6.8,CSF|DE.CM-1,CSF|DE.CM-3,CSF|ID.GV-1,CSF|ID.GV-3,CSF|PR.AC-1,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(b),HIPAA|164.312(d),ISO/IEC-27001|A.9.1.1,ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.9.2.5,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.4,ISO/IEC-27001|A.9.4.5,ISO/IEC-27001|A.12.4.2,ITSG-33|AC-1,ITSG-33|AC-2,ITSG-33|AC-2(1),ITSG-33|AC-3,ITSG-33|AC-6,ITSG-33|AC-6(1),ITSG-33|AU-9(4),ITSG-33|AU-9(4)(a),ITSG-33|AU-9(4)(b),ITSG-33|IA-5(1),LEVEL|1A,NESA|M1.1.3,NESA|M1.2.2,NESA|M5.2.3,NESA|M5.5.2,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.2.3,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|AM28,NIAv2|AM29,NIAv2|AM30,NIAv2|AM31,NIAv2|GS3,NIAv2|GS4,NIAv2|GS8c,NIAv2|NS5j,NIAv2|SM5,NIAv2|SM6,NIAv2|SS13c,NIAv2|SS14e,NIAv2|SS15c,NIAv2|SS29,NIAv2|VL3b,PCI-DSSv3.2.1|7.1.2,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,PCI-DSSv4.0|10.3.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,SWIFT-CSCv1|4.1,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "expect": "false",
        "payload_key": "GuestEnabled",
        "payload_type": "com.apple.loginwindow"
    },
    "custom_item_56": {
        "description": "6.1.4 Ensure Guest Access to Shared Folders Is Disabled",
        "info": "Allowing guests to connect to shared folders enables users to access selected shared folders and their contents from different computers on a network.\n\nNot allowing guests to connect to shared folders mitigates the risk of an untrusted user doing basic reconnaissance and possibly using privilege escalation attacks to take control of the system.",
        "solution": "Run the following commands to verify that shared folders are not accessible to guest users:\n\n% /usr/bin/sudo /usr/sbin/sysadminctl -smbGuestAccess off\n\nImpact:\n\nUnauthorized users could access shared files on the system.",
        "reference": "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|MP-2,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|MP-2,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|14.6,CSCv8|3.3,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-2,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|MP-2,ITSG-33|MP-2a.,LEVEL|1A,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,NIAv2|SS29,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "cmd": "/usr/sbin/sysadminctl -smbGuestAccess status",
        "expect": "SMB guest access disabled"
    },
    "custom_item_57": {
        "description": "6.1.5 Ensure the Guest Home Folder Does Not Exist",
        "info": "In the previous two controls, the guest account login has been disabled and sharing to guests has been disabled, as well. There is no need for the legacy Guest home folder to remain in the file system. When normal user accounts are removed, you have the option to archive it, leave it in place, or delete. In the case of the guest folder, the folder remains in place without a GUI option to remove it. If at some point in the future a Guest account is needed, it will be re-created. The presence of the Guest home folder can cause automated audits to fail when looking for compliant settings within all User folders, as well. Rather than ignoring the folder's continued existence, it is best removed.\n\nThe Guest home folders are unneeded after the Guest account is disabled and could be used inappropriately.",
        "solution": "Run the following command to remove the Guest user home folder:\n\n% /usr/bin/sudo /bin/rm -R /Users/Guest\n\nImpact:\n\nThe Guest account should not be necessary after it is disabled, and it will be automatically re-created if the Guest account is re-enabled",
        "reference": "800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-53|CM-1,800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,CSCv7|5.1,CSCv8|4.1,CSF|DE.AE-1,CSF|ID.GV-1,CSF|ID.GV-3,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,GDPR|32.1.b,GDPR|32.4,HIPAA|164.306(a)(1),ITSG-33|CM-1,ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|1A,NESA|M1.2.2,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|GS8b,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,NIAv2|VL7a,NIAv2|VL7b,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|7.2,SWIFT-CSCv1|2.3",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "file": "/Users/Guest"
    },
    "custom_item_58": {
        "description": "6.2 Ensure Show All Filename Extensions Setting is Enabled",
        "info": "A filename extension is a suffix added to a base filename that indicates the base filename's file format.\n\nVisible filename extensions allow the user to identify the file type and the application it is associated with, which leads to quick identification of misrepresented malicious files.",
        "solution": "Run the following command to enable displaying of file extensions:\n\n% /usr/bin/sudo -u/usr/bin/defaults write /Users//Library/Preferences/.GlobalPreferences.plist AppleShowAllExtensions -bool true\n\n% /usr/bin/sudo killall Finder\n\nImpact:\n\nThe user of the system can open files of unknown or unexpected filetypes if the extension is not visible.",
        "reference": "800-171|3.4.1,800-171|3.4.7,800-171|3.4.9,800-53|CM-7(2),800-53|CM-8(3),800-53|CM-10,800-53|CM-11,800-53r5|CM-7(2),800-53r5|CM-8(3),800-53r5|CM-10,800-53r5|CM-11,CN-L3|8.1.10.2(a),CN-L3|8.1.10.2(b),CSCv7|2.6,CSCv8|2.3,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.6.2,ITSG-33|CM-7(2),ITSG-33|CM-8(3),LEVEL|1A,NESA|T1.2.1,NESA|T1.2.2,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,SWIFT-CSCv1|2.3,SWIFT-CSCv1|5.1",
        "see_also": "https://workbench.cisecurity.org/benchmarks/17467",
        "regex": "1$",
        "plist_item": "AppleShowAllExtensions",
        "plist_name": ".GlobalPreferences",
        "plist_user": "all"
    }
}