{
    "custom_item_1": {
        "description": "Check for BIND 9 installation",
        "cmd": "/usr/sbin/named -v",
        "expect": "^[\\\\s]*BIND @PLATFORM_VERSION@.*"
    },
    "custom_item_2": {
        "description": "2.9 Isolate BIND with chroot'ed Subdirectory",
        "info": "The chroot() system call causes an application to run with limited file system access so that a subdirectory becomes the root directory for the application environment. When this is done, the application is 'jailed' and no longer has access to the entire file structure but is limited to the given subdirectory.\n\nThe chroot'd subdirectory and the recommendations in section 'Enable SELinux to Restrict BIND Processes' provide similar controls, in that the DNS service is prevented from accessing and modifying inappropriate files. SELinux goes well beyond what the chroot is able to prevent, however for audit purposes either control, the chroot'd subdirectory or the SELinux in enforcing mode is sufficient.\n\nRationale:\n\nAlthough there are ways that a chroot jail can be broken, most methods require that a process be running as root in order to escape. Since BIND should be run as a different user than root, a chroot is an effective defense, to limit access to sensitive system configuration files. In the event that BIND has a vulnerability that allows code execution, the attack will not have access to the real system files such as /etc/password, but will be limited to the files placed in the chroot subdirectory.",
        "solution": "Perform the following:\n\nStop the named service and install the bind-chroot package to provide the chroot directories.\n\n# systemctl stop named.service\n# yum install bind-chroot\n\nEdit the /etc/sysconfig/named configuration file to have a line similar to the one shown below that sets the ROOTDIR environment variable.\n\nROOTDIR='/var/named/chroot'\n\nMove all the configuration files and any master zone files into their respective directions under the subdirectory /var/named/chroot/\n\nIt may be helpful to create symbolic links from a couple of system /etc files such as /etc/named.conf and /etc/rndc.key to the real files in the chroot'ed subdirectory, so that utilities like rndc will work as expected. Do not create symbolic links or hard links from inside the chroot to external resources! Instead use symbolic links to point from the outside resources into the chroot.\n\nRestart the named service and test the configuration.\n\n# systemctl start named.service\n\nDefault Value:\n\nThe BIND service is not chroot'ed by default.",
        "reference": "800-171|3.1.1,800-53|AC-3,800-53r5|AC-3,CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv6|14.4,CSCv7|14.6,CSF|PR.AC-4,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,LEVEL|2A,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS29,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|13.2,TBA-FIISB|31.1",
        "see_also": "https://workbench.cisecurity.org/files/2997",
        "cmd": "ls -ld /proc/`pidof named`/root | awk '{print} END {if (NR == 0) print \"Named process not found\" }'",
        "expect": "chroot"
    },
    "custom_item_3": {
        "description": "5.1 Securely Authenticate Zone Transfers",
        "info": "A zone transfer is a mechanism commonly used by DNS deployments to replicate zone information from master/primary servers to slave/secondary servers. Each pair of name servers participating in zone transfers should authenticate the requests and ensure the integrity of the responses by using a unique shared secret TSIG key. BIND can be configured to respond only to authenticated transfer requests by using the allow-transfer statement with a key statement, that restricts the transfers to servers that provide a MAC using the named key.\n\nRationale:\n\nA zone transfer is a popular information disclosure attack as it provides the entire list of resource records for a zone. There should be very few systems such as the slave name servers that should be authorized to perform a zone transfer for your domains. Authentication of transfer requests should not be made using only an IP address, since IP addresses can be spoofed, but rather by using TSIG keys.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Generate TSIG keys 256 bits in length, unique for each host-to-host communication. Securely Transfer the keys and configure the keys to be required in all allow-transfer statements.\n\nDefault Value:\n\nIf the allow-transfer statement is missing, then transfers are allowed to any host.",
        "reference": "800-171|3.5.2,800-53|IA-5,800-53|IA-5(1),800-53r5|IA-5,800-53r5|IA-5(1),CSCv6|9.1,CSCv7|16.4,CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5,ITSG-33|IA-5(1),LEVEL|2A,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1",
        "see_also": "https://workbench.cisecurity.org/files/2997",
        "cmd": "/usr/bin/awk '/^\\\\s*allow-transfer\\\\s*{/,/};/ { print; o=1 } END { if (o == 0) print \"fail - transfer-query Not Found\" }' @CONFIG_FILES@/* @ZONE_FILES@/*",
        "expect": "Manual Review Required"
    },
    "custom_item_4": {
        "description": "8.1 Install the Haveged Package for Enhanced Entropy",
        "info": "Install the haveged package to provide enhanced entropy for generating cryptographic keys. Haveged is a user space entropy daemon which is not dependent upon the standard mechanisms for harvesting randomness for the system entropy pool. Haveged uses HAVEGE (HArdware Volatile Entropy Gathering and Expansion) to maintain a pool of 1 million random bytes used to fill /dev/random.\n\nRationale:\n\nIt is important for authoritative DNS servers deploying DNSSEC domains to have a good source of entropy to generate secure cryptographic keys. DNS servers are typically not multi-user systems and generally deployed as headless servers. In such situations generating keys without enhanced entropy can be painfully time-consuming, or may lack sufficient entropy. The haveged daemon ensures that keys can be generated timely and securely.",
        "solution": "Install the haveged package with the appropriate package manager and configure it to start, as shown below.\n\n\n\n# yum install haveged\n\n# systemctl enable haveged\n\n# systemctl start haveged\n\nDefault Value:\n\nThe haveged package is not installed or enabled by default.",
        "reference": "LEVEL|2A",
        "see_also": "https://workbench.cisecurity.org/files/2997",
        "name": "haveged"
    },
    "custom_item_5": {
        "description": "8.2 Ensure Signing Keys are Generated with a Secure Algorithm",
        "info": "When Zone Signing Keys (ZSK) or Key Signing Keys (KSK) are generated there are several secure DNSSEC digital signature algorithms that are recommended. The algorithms are listed below with the standard DNSSEC algorithm number followed by the common name, and then the BIND 9 mnemonic name used by dnssec-keygen.\n\n- 8 RSA/SHA-256  RSASHA256\n\n- 10 RSA/SHA-512  RSASHA512\n\n- 13 ECDSA/SHA-256ECDSAP256SHA256\n\n- 14 ECDSA/SHA-384ECDSAP384SHA384\n\n- 15 Ed25519ED25519\n\nRationale:\n\nA secure public key algorithm along with a secure hash algorithm, are part of the foundation for a secure digital secure. Weaknesses in older public key algorithms continue to develop, and it is important to use a recommended algorithm that is expected to be secure for the near future.",
        "solution": "To remediate a weak key, perform the following:\n\nGenerate a new key to replace the weak key using dnssec-keygen and one of the recommended algorithms. Examples commands are shown below.\n\n# dnssec-keygen -a RSASHA256 -b 2048 example.com\n# dnssec-keygen -a ECDSAP384SHA384 cisecurity.org\n\nImplement a rollover period to phase out the weak key and replace it with the newly generated key.\n\nOnce the key is fully deleted from active use, remove the file.\n\nDefault Value:\n\nThe default algorithm is RSASHA1.",
        "reference": "800-171|3.13.10,800-53|SC-12,800-53r5|SC-12,CSCv7|18.5,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.10.1.2,ITSG-33|SC-12,ITSG-33|SC-12a.,LEVEL|2A,NESA|T7.4.1,NESA|T7.4.2,NIAv2|CY2,NIAv2|CY8,NIAv2|CY9,QCSC-v1|5.2.2,QCSC-v1|6.2",
        "see_also": "https://workbench.cisecurity.org/files/2997",
        "cmd": "cd @BIND_HOME@; find . -name 'K*.private' | xargs grep '^Algorithm:' | grep -vE 'Algorithm:\\\\s+(8|10|13|14|15)\\\\s+\\\\((RSASHA256|RSASHA512|ECDSAP256SHA256|ECDSAP384SHA384|ED25519)\\\\)' | awk '{print} END {if (NR == 0) print \"pass\"; else print \"fail\"}'",
        "expect": "^pass$"
    },
    "custom_item_6": {
        "description": "8.3 Ensure Any Signing Keys using RSA Have a Length of 2048 or Greater",
        "info": "If one of the RSA digital signature algorithms is used, then then key length should be at least 2048 bits. The Elliptic Curve algorithms have sufficient key length without any additional options, and will provide for smaller signed DNS responses then the RSA algorithms.\n\nRationale:\n\nRSA keys of 1024 bits in length are no longer considered secure against brute force attacks. A key length of at least 2048 bits is required.",
        "solution": "To remediate a weak RSA key, perform the following:\n\nGenerate a new key to replace the weak key using dnssec-keygen and one of the recommended algorithms and key lengths. Examples commands are shown below.\n\n# dnssec-keygen -a RSASHA256 -b 2048 example.com\n# dnssec-keygen -a ECDSAP384SHA384 cisecurity.org\n\nImplement a rollover period to phase out the weak key and replace it with the the newly generated key.\n\nOnce the key is fully deleted from the active use, remove the file.\n\nDefault Value:\n\nIf an RSA algorithm is chosen the default key length is 1024 for the ZSK and 2048 for the KSK.",
        "reference": "800-53|SC-20,800-53r5|SC-20,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-20,LEVEL|2A,QCSC-v1|5.2.1",
        "see_also": "https://workbench.cisecurity.org/files/2997",
        "cmd": "find @KEYDIR@ -name 'K*.private' -print0 | xargs -0 awk -e '/^Prime1:/ {print FILENAME,length($2)}' | grep -v -E ' ([0-9]{4,}|[2-9][0-9][0-9]|1[8-9][0-9]|17[4-9])$' | awk '{print} END {if (NR == 0) print \"pass\" ; else print \"fail\"}'",
        "expect": "^pass$"
    },
    "custom_item_7": {
        "description": "8.4 Restrict Access to Zone and Key Signing Keys",
        "info": "The files and directories for Zone Signing Keys (ZSK) and Key Signing Keys (KSK) should be read-only by the named user, with no access to other.\n\nRationale:\n\nThe named daemon does not require write access to the key files or the directories, Implementing a minimal read-only access provides an additional layer of denfense, so that if the service was exploited, the exploit would not be able to modify signing keys. Likewise restricting read access to the keys will prevent inappropriate disclosure of the private keys.",
        "solution": "Perform the following:\n\nchmod  -R g-w,o-rwX $KEYDIR\n\nDefault Value:\n\nThe BIND signing key files and directory do not exist by default.",
        "reference": "800-171|3.1.1,800-53|AC-3,800-53r5|AC-3,CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|14.6,CSF|PR.AC-4,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,LEVEL|2A,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS29,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|13.2,TBA-FIISB|31.1",
        "see_also": "https://workbench.cisecurity.org/files/2997",
        "cmd": "find @KEYDIR@ -perm /027 -ls | awk '{print} END {if (NR == 0) print \"pass\" ; else print \"fail\"}'",
        "expect": "pass"
    },
    "custom_item_8": {
        "description": "8.6 Ensure Full Digital Chain of Trust can be Validated",
        "info": "For each authoritative domain ensure the digital signatures are is fully trusted starting from the root zone.\n\nRationale:\n\nIn order for the the digital signatures to be trusted by other systems, The parent zone must be a DS (delegated signer) record that verifies the authenticity of the child zones KSK (key signing key). The delegated signature forms a chain of trust, delegated down from the root zone.",
        "solution": "If the zone has a valid signature but the signature is not trusted, the delegation from the parent zone, or the registrar may not be properly configured. Check with your parent zone administrator or with your name registrar's process to be sure the required information has been provided and that sufficient time has been allowed for new DS record to propagate. Each registrar may have slightly different processes. Generating a DS record from the KSK will likley provide some of the required information.\n\n# dnssec-dsfromkey -a SHA-256 Kexample.com.+013+09798.key\nexample.com. IN DS 9798 13 2 D9AA106E44 . . .",
        "reference": "800-171|3.13.11,800-53|SC-13,800-53r5|SC-13,CSF|PR.DS-5,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(e)(2)(ii),ISO/IEC-27001|A.10.1.1,ITSG-33|SC-13,ITSG-33|SC-13a.,LEVEL|2A,NESA|M5.2.6,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5e,QCSC-v1|6.2",
        "see_also": "https://workbench.cisecurity.org/files/2997",
        "cmd": "delv @8.8.8.8 cisecurity.org",
        "expect": ";[\\\\s]+fully[\\\\s]+validated"
    },
    "custom_item_9": {
        "description": "8.7 Ensure Signing Keys are Unique",
        "info": "Each zone should have a unique Zone Signing Keys (ZSK) and a unique Key Signing Keys (KSK) that is different from all other keys.\n\nRationale:\n\nThe ZSK key typically has a shorter expiration date then the KSK, and should be unique from the KSK as well as keys used for other zones. If a private key is compromised, the damage is limited to unique key that was disclosed, rather the compromising multiple zones.",
        "solution": "To remediate a duplicate key, perform the following:\n\nGenerate a new key to replace the duplicate key using dnssec-keygen and one of the recommended algorithms. An example command is shown below:\n\n# dnssec-keygen -a ECDSAP256SHA256 example.org\n\nImplement a rollover period to phase out the duplicate key and replace it with the the newly generated key.\n\nOnce the key is fully deleted from the active use, remove the file.",
        "reference": "800-171|3.13.11,800-53|SC-13,800-53r5|SC-13,CSF|PR.DS-5,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(e)(2)(ii),ISO/IEC-27001|A.10.1.1,ITSG-33|SC-13,ITSG-33|SC-13a.,LEVEL|2A,NESA|M5.2.6,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5e,QCSC-v1|6.2",
        "see_also": "https://workbench.cisecurity.org/files/2997",
        "cmd": "find @KEYDIR@ -name '*.key' | xargs grep -ho 'DNSKEY .*' | sort | uniq -c | grep -v -E '^\\\\s*1\\\\s+DNSKEY' | awk '{print} END {if (NR == 0) print \"pass\" ; else print \"fail\"}'",
        "expect": "^pass$"
    },
    "custom_item_10": {
        "description": "8.8 Ensure Zones are Signed with NSEC or NSEC3",
        "info": "The NSEC records are used to prove that a name does not exist, by providing the name before it, and the name after it. NSEC3 records are similar, while using a hash to link records in order to make zone enumeration much more difficult. Either record type will securely validate a negative answer that a name does not exist.\n\nRationale:\n\nThe DNSSEC RRSIG records allows verification of the integrity and authenticity of answers for names which exist. However when the authoritative name server answers that a name does not exist. The nonexistent answer is not signed, and cannot be securely signed. An attacker could take advantage of this by spoofing nonexistent name answers to prevent resolving legitimate names. The NSEC and NSEC3 records provide a means for a DNSSEC validating resolver to verify the authenticity of a nonexistent answer.",
        "solution": "An NSEC record and NSEC signatures are generated automatically by BIND for DNSSEC signed zones. If the audit fails, then verify that the zone has a valid signature and has delegated trust from the parent domain as in the previous recommendations '8.5 Ensure each Zone has a Valid Digital Signature' and '8.6 Ensure Full Digital Chain of Trust can be Validated' The signed zone file, or a zone transfer can also be checked for NSEC signatures. With a command such as:\n\n$ dig @127.0.0.1 example.org AXFR | grep -w 'NSEC'\nexample.org.86400INNSECwww.example.org. A NS SOA RRSIG NSEC DNSKEY TYPE65534\nexample.org.86400INRRSIG NSEC 8 2 86400 20200325222408 20200224212408 4236\n. . .\n\nConverting NSEC signing to NSEC3 signing is helpful to prevent zone walking of the linked NSEC records which easily reveal all of the names in a zone. The NSEC3 algorithm creates a linked list of signed hash values, instead of names, to prevent the simple disclosure of all names. The rndc signing command can be used to convert NSEC signing to NSEC3 signing. For example:\n\n#  rndc signing -nsec3param 1 0 10  auto example.org\nnsec3param request queued. . .\nzone example.org/IN (signed): sending notifies (serial 2020031005)\n. . .\n\n# dig @127.0.0.1 example.org AXFR +onesoa | grep NSEC\nexample.org.0INRRSIG  NSEC3PARAM 8 2 0 20200422125535 20200323125407 42363 example.org. CCHlbQud0W2XrNlmYHO. . . Kg7ltg==\nexample.org.0INNSEC3PARAM 1 0 10 74139101AD2E623E\n. . .\n\nDefault Value:\n\nFor signed domains the NSEC records and signatures are generated by default.",
        "reference": "800-171|3.14.2,800-171|3.14.4,800-171|3.14.5,800-53|SI-3,800-53r5|SI-3,CN-L3|7.1.3.6(b),CN-L3|8.1.4.5,CN-L3|8.1.9.6(a),CN-L3|8.1.9.6(b),CN-L3|8.1.10.5(b),CN-L3|8.1.10.7(a),CN-L3|8.1.10.7(b),CSCv7|8,CSF|DE.CM-4,CSF|DE.DP-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.2.1,ITSG-33|SI-3,LEVEL|2A,NIAv2|GS8a,PCI-DSSv3.2.1|5.1,PCI-DSSv3.2.1|5.1.1,PCI-DSSv4.0|5.2.1,QCSC-v1|3.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,TBA-FIISB|49.2.1,TBA-FIISB|49.2.2,TBA-FIISB|49.3.1,TBA-FIISB|49.3.2,TBA-FIISB|50.2.1,TBA-FIISB|51.2.4,TBA-FIISB|51.2.7",
        "see_also": "https://workbench.cisecurity.org/files/2997",
        "cmd": "delv @8.8.8.8 nosuch-name.isc.org",
        "expect": ";[\\\\s]+negative[\\\\s]+response,[\\\\s]+fully[\\\\s]+validated"
    },
    "custom_item_11": {
        "description": "9.6 Ensure Signing Keys are Scheduled to be Replaced Periodically - ZSK",
        "info": "Implement a periodic key rollover process for both the Zone Signing Keys (ZSK) and the Key Signing Keys (KSK). The ZSK should be replaced within 2 years or less. The KSK should be replaced within 6 years or less. Keys are replaced by generating a new key before the existing key expires, and scheduling a rollover date when the new key will phase out and replace the old key.\n\nRationale:\n\nCryptographic keys like passwords need to be periodically replaced. By using strong key algorithms and appropriately long bit lengths, the lifetime for keys can be longer than a generally recommended for passwords. Typically, the Zone Signing Keys are rolled over more frequently than the Key Signing Keys.",
        "solution": "To replace an aged key, perform the following:\n\nGenerate a new key to replace the old key using dnssec-keygen and one of the recommended algorithms. An example command is shown below:\n\n# dnssec-keygen -a ED25519 example.org\n# dnssec-keygen -a ED25519 -f KSK example.org\n\nImplement a rollover period to phase out the old key and replace it with the newly generated key. The older key should have dates set for the keys to be inactive and then deleted.\n\n# dnssec-settime -I +30d -D +60d  Kexample.org.+013+46651.key\n\nOnce the date for key deletion has passed, and the key is no longer included in the zone, then remove the key files.\n\nDefault Value:\n\nSigning key rollover is NOT implemented by default.",
        "reference": "800-171|3.13.11,800-53|SC-13,800-53r5|SC-13,CSF|PR.DS-5,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(e)(2)(ii),ISO/IEC-27001|A.10.1.1,ITSG-33|SC-13,ITSG-33|SC-13a.,LEVEL|2A,NESA|M5.2.6,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5e,QCSC-v1|6.2",
        "see_also": "https://workbench.cisecurity.org/files/2997",
        "cmd": "ZKEYS=$(find @KEYDIR@ -name '*.key' | xargs grep -l 'DNSKEY 256 3' ); for zk in $ZKEYS; do dtime=$(dnssec-settime -u -pA $zk | awk '{print $2}'); ttime=$(date -u --date \"2 years ago\" +'%s'); [ $dtime -lt $ttime ] && echo -n \"$zk: \" && dnssec-settime -pA $zk; done | awk '{print} END {if (NR == 0) print \"pass\"; else print \"fail\"}'",
        "expect": "^pass$"
    },
    "custom_item_12": {
        "description": "9.6 Ensure Signing Keys are Scheduled to be Replaced Periodically - KSK",
        "info": "Implement a periodic key rollover process for both the Zone Signing Keys (ZSK) and the Key Signing Keys (KSK). The ZSK should be replaced within 2 years or less. The KSK should be replaced within 6 years or less. Keys are replaced by generating a new key before the existing key expires, and scheduling a rollover date when the new key will phase out and replace the old key.\n\nRationale:\n\nCryptographic keys like passwords need to be periodically replaced. By using strong key algorithms and appropriately long bit lengths, the lifetime for keys can be longer than a generally recommended for passwords. Typically, the Zone Signing Keys are rolled over more frequently than the Key Signing Keys.",
        "solution": "To replace an aged key, perform the following:\n\nGenerate a new key to replace the old key using dnssec-keygen and one of the recommended algorithms. An example command is shown below:\n\n# dnssec-keygen -a ED25519 example.org\n# dnssec-keygen -a ED25519 -f KSK example.org\n\nImplement a rollover period to phase out the old key and replace it with the newly generated key. The older key should have dates set for the keys to be inactive and then deleted.\n\n# dnssec-settime -I +30d -D +60d  Kexample.org.+013+46651.key\n\nOnce the date for key deletion has passed, and the key is no longer included in the zone, then remove the key files.\n\nDefault Value:\n\nSigning key rollover is NOT implemented by default.",
        "reference": "800-171|3.13.11,800-53|SC-13,800-53r5|SC-13,CSF|PR.DS-5,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(e)(2)(ii),ISO/IEC-27001|A.10.1.1,ITSG-33|SC-13,ITSG-33|SC-13a.,LEVEL|2A,NESA|M5.2.6,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5e,QCSC-v1|6.2",
        "see_also": "https://workbench.cisecurity.org/files/2997",
        "cmd": "ZKEYS=$(find @KEYDIR@ -name '*.key' | xargs grep -l 'DNSKEY 257 3' ); for zk in $ZKEYS; do dtime=$(dnssec-settime -u -pA $zk | awk '{print $2}'); ttime=$(date -u --date \"6 years ago\" +'%s'); [ $dtime -lt $ttime ] && echo -n \"$zk: \" && dnssec-settime -pA $zk; done | awk '{print} END {if (NR == 0) print \"pass\"; else print \"fail\"}'",
        "expect": "^pass$"
    },
    "custom_item_13": {
        "description": "10.1 Ensure SELinux Is Enabled in Enforcing Mode - current mode",
        "info": "SELinux (Security-Enhanced Linux) is a Linux kernel security module that provides mandatory access control security policies with type enforcement that are checked after the traditional discretionary access controls. It was created by the US National Security Agency and can enforce rules on files and processes in a Linux system, and restrict actions, based on defined policies.\n\nRationale:\n\nDNS servers act as a foundation for most of the internet and internal traffic. Web and mobile applications, email, cloud services and VPN connections, internal LAN connections all depend on DNS to translate names and route traffic to the correct destination. With DNS being such a critical service, it is a ripe target for attacks which may allow black-hat criminals to gain access to information and servers. The threat is especially high because DNS servers are often externally accessible and continue to have serious vulnerabilities. The SELinux mandatory access controls provide a much stronger security model which can be used to implement a deny-by-default model which only allows what is explicitly permitted.",
        "solution": "Perform the following to implement the recommended state:\n\nIf SELinux is not enabled in the configuration file, edit the file /etc/selinux/config and set the value of SELINUX as enforcing and reboot the system for the new configuration to be effective.\n\nSELINUX=enforcing\n\nIf the current mode is not enforcing, and an immediate reboot is not possible, the current mode can be set to enforcing with the setenable command shown below.\n\n# setenforce 1\n\nDefault Value:\n\nSELinux is enforcing by default on some Linux distributions such as Red Hat Enterprise Linux 8.",
        "reference": "800-171|3.1.1,800-53|AC-3,800-53r5|AC-3,CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv6|14.4,CSCv7|14.6,CSCv7|14.7,CSF|PR.AC-4,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,LEVEL|2A,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS29,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|13.2,TBA-FIISB|31.1",
        "see_also": "https://workbench.cisecurity.org/files/2997",
        "cmd": "sestatus | grep -i 'current mode'",
        "expect": "enforcing"
    },
    "custom_item_14": {
        "description": "10.1 Ensure SELinux Is Enabled in Enforcing Mode - config file",
        "info": "SELinux (Security-Enhanced Linux) is a Linux kernel security module that provides mandatory access control security policies with type enforcement that are checked after the traditional discretionary access controls. It was created by the US National Security Agency and can enforce rules on files and processes in a Linux system, and restrict actions, based on defined policies.\n\nRationale:\n\nDNS servers act as a foundation for most of the internet and internal traffic. Web and mobile applications, email, cloud services and VPN connections, internal LAN connections all depend on DNS to translate names and route traffic to the correct destination. With DNS being such a critical service, it is a ripe target for attacks which may allow black-hat criminals to gain access to information and servers. The threat is especially high because DNS servers are often externally accessible and continue to have serious vulnerabilities. The SELinux mandatory access controls provide a much stronger security model which can be used to implement a deny-by-default model which only allows what is explicitly permitted.",
        "solution": "Perform the following to implement the recommended state:\n\nIf SELinux is not enabled in the configuration file, edit the file /etc/selinux/config and set the value of SELINUX as enforcing and reboot the system for the new configuration to be effective.\n\nSELINUX=enforcing\n\nIf the current mode is not enforcing, and an immediate reboot is not possible, the current mode can be set to enforcing with the setenable command shown below.\n\n# setenforce 1\n\nDefault Value:\n\nSELinux is enforcing by default on some Linux distributions such as Red Hat Enterprise Linux 8.",
        "reference": "800-171|3.1.1,800-53|AC-3,800-53r5|AC-3,CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv6|14.4,CSCv7|14.6,CSCv7|14.7,CSF|PR.AC-4,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,LEVEL|2A,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS29,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|13.2,TBA-FIISB|31.1",
        "see_also": "https://workbench.cisecurity.org/files/2997",
        "cmd": "sestatus | grep -i 'mode from config file'",
        "expect": "enforcing"
    },
    "custom_item_15": {
        "description": "10.2 Ensure BIND Processes Run in the named_t Confined Context Type",
        "info": "SELinux includes customizable targeted policies that may be used to confine the BIND named server to enforce least privileges so that the server has only the minimal access to specified directories, files and network ports. Access is controlled by process types (domains) defined for the named process. There are about a dozen related types defined in a default named SELinux policy. The default SELinux policies work well for a default BIND installation, however testing of the SELinux polices with the specific BIND operations is highly recommended. All directories and files to be accessed by the named server process must have security labels with appropriate types. The following file context types are a sample of the most commonly used:\n\nnamed_cache_t - Directories and files with dynamically updated contents\n\nnamed_conf_t - Directories and Configuration files to be read, but not updated\n\nnamed_exec_t - BIND related Executables\n\nThe seinfo may be used list the types that are configured. For example, the following will list the relevant types that begin with named_\n\n# seinfo -t | grep ' named_'\n\nThe semanage fcontext command may be used to list file context mapping. For example:\n\n# semanage fcontext -l | grep ':named_'\n\nRationale:\n\nWith the proper implementation of SELinux, vulnerabilities in the BIND named server may be prevented from being exploited due to the additional restrictions. For example, a vulnerability that allows an attacker to read inappropriate system files may be prevented from execution by SELinux because the inappropriate files are not labeled with necessary named specific context. Likewise writing to an unexpected directory or execution of unexpected content can be prevented by similar mandatory security labels enforced by SELinux.",
        "solution": "If the running named process is not confined to the named_t SELinux context. Then check the labeled context for the named binaries and set the binary files to have a context of named_exec_t as shown below. The named-checkconf executable should have named_checkconf_exec_t type.\n\n# ls -Z  /usr/sbin/named /usr/sbin/named-checkconf /usr/sbin/unbound-anchor\n          system_u:object_r:named_exec_t:s0 /usr/sbin/named\nsystem_u:object_r:named_checkconf_exec_t:s0 /usr/sbin/named-checkconf\n          system_u:object_r:named_exec_t:s0 /usr/sbin/unbound-anchor\n\nIf the executable files are not labeled correctly, they may be relabeled with the chcon command, as shown, however the file system labeling is based on the SELinux file context mapping polices and the file systems will on some occasions be relabeled according to the policy.\n\n# chcon -t named_exec_t /usr/sbin/named /usr/sbin/unbound-anchor\n# chcon -t named_checkconf_exec_t /usr/sbin/named-checkconf\n\nSince the file system may be relabeled based on SELinux policy, it's best to check the SELinux policy with semanage fcontext -l option. If the policy is not present, then add the pattern to the policy using the --add option. The restorecon command shown below will restore the file context label according to the current policy, which is required if a pattern was added.\n\n# ### Check the Policy\n# semanage fcontext -l | grep '/usr/sbin/named*'\n/usr/sbin/named            regular file system_u:object_r:named_exec_t:s0\n/usr/sbin/named-checkconf  regular file system_u:object_r:named_checkconf_exec_t:\ns0\n\n# semanage fcontext -l | grep /usr/sbin/unbound-anchor\n/usr/sbin/unbound-anchor   regular file system_u:object_r:named_exec_t:s0\n\n# ### Add to the policy, if not present\n# semanage fcontext --add -f f -t named_exec_t /usr/sbin/named\n# semanage fcontext --add -f f -t named_exec_t /usr/sbin/unbound-anchor\n# semanage fcontext --add -f f -t named_checkconf_exec_t /usr/sbin/named-checkconf\n\n# ### Restore the file labeling accord to the SELinux policy\n# restorecon -v /usr/sbin/named /usr/sbin/named-checkconf /usr/sbin/unbound-anchor\n\nRestarting the BIND named service will also be required.\n\nDefault Value:\n\nThe name_t is the default type for ISC BIND named if SELinux is enabled.",
        "reference": "800-171|3.1.1,800-53|AC-3,800-53r5|AC-3,CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv6|14.4,CSCv7|14.6,CSF|PR.AC-4,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,LEVEL|2A,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS29,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|13.2,TBA-FIISB|31.1",
        "see_also": "https://workbench.cisecurity.org/files/2997",
        "cmd": "ps -eZ | grep named | cut -f3 -d':'",
        "expect": "^named_t$"
    },
    "custom_item_16": {
        "description": "10.3 Ensure the named_t Process Type is Not in Permissive Mode",
        "info": "In addition to setting the entire SELinux configuration in permissive mode, it is possible to set individual process types (domains) such as named_t into a permissive mode as well. The permissive mode will not prevent any access or actions, instead, any actions that would have been denied are simply logged.\n\nRationale:\n\nUsage of the permissive mode is helpful for testing and ensuring that SELinux will not prevent access that is necessary for the proper function of the DNS server. However, inappropriate access will not be prevented in permissive mode by SELinux.",
        "solution": "Perform the following to implement the recommended state:\n\nIf the named_t type is in permissive mode; the customized permissive mode should be deleted with the following semanage command.\n\n# semanage permissive -d named_t\n\nDefault Value:\n\nThe named_t type is not in permissive mode by default.",
        "reference": "800-171|3.1.1,800-53|AC-3,800-53r5|AC-3,CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|14.6,CSF|PR.AC-4,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,LEVEL|2A,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS29,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|13.2,TBA-FIISB|31.1",
        "see_also": "https://workbench.cisecurity.org/files/2997",
        "cmd": "semodule -l | grep permissive_named_t | awk '{print} END {if (NR == 0) print \"pass\" ; else print \"fail\"}'",
        "expect": "pass"
    },
    "custom_item_17": {
        "description": "10.4 Ensure Only the Necessary SELinux Booleans are Enabled",
        "info": "SELinux booleans allow or disallow specific behaviors. There are two boolean variables specific to the ISC BIND DNS server:\n\nnamed_tcp_bind_http_port - Allow named to tcp bind http port\n\nnamed_write_master_zones - Allow named to write master zones\n\nThe named_tcp_bind_http_port would allow enabling the BIND statistics http channel which is not recommended. The named_write_master_zones allows BIND to update the master files, which is necessary when dynamic updates are performed, or the server is automatically maintaining DNSSEC digital signatures.\n\nRationale:\n\nEnabling only the necessary named related booleans provides a defense in depth approach, that will deny actions that are not in use or expected.",
        "solution": "Perform the following to implement the recommended state:\n\nDisable the SELinux boolean using the setsebool command as shown below with the -P option to make the change persistent.\n\n# setsebool -P named_tcp_bind_http_port off\n\nDefault Value:\n\nThe default value for named_tcp_bind_http_port is off.",
        "reference": "800-171|3.14.6,800-171|3.14.7,800-53|SI-4,800-53r5|SI-4,CN-L3|7.1.3.5(a),CN-L3|8.1.10.5(b),CN-L3|8.1.10.6(f),CSCv7|9.2,CSF|DE.AE-1,CSF|DE.AE-2,CSF|DE.AE-3,CSF|DE.AE-4,CSF|DE.CM-1,CSF|DE.CM-5,CSF|DE.CM-6,CSF|DE.CM-7,CSF|DE.DP-2,CSF|DE.DP-3,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.DS-5,CSF|PR.IP-8,CSF|RS.AN-1,CSF|RS.CO-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|SI-4,LEVEL|2A,NESA|M1.2.2,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2",
        "see_also": "https://workbench.cisecurity.org/files/2997",
        "cmd": "getsebool named_tcp_bind_http_port",
        "expect": "off"
    }
}