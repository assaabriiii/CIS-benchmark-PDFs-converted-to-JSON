{
    "custom_item_1": {
        "description": "Check if this is a Docker Host",
        "cmd": "/usr/bin/docker version --format '{{.Server.Platform.Name}}'",
        "expect": "^Docker Engine - Enterprise.*$"
    },
    "custom_item_2": {
        "system": "Linux",
        "description": "DKER-EE-001880 - The Docker Enterprise self-signed certificates in Docker Trusted Registry (DTR) must be replaced with DoD trusted, signed certificates.",
        "info": "Docker Enterprise includes the following capabilities that are considered non-essential:\n\n*NOTE: disabling these capabilities negatively affects the operation of Universal Control Plane (UCP) and DTR and should be disregarded when UCP and DTR are installed. The security capabilities provided by UCP and DTR offset any potential vulnerabilities associated with not disabling these essential capabilities the Engine provides.\n\n(Docker Engine - Enterprise: Standalone) - The majority of these items were originally identified as part of the CIS Docker Benchmark, which as of the CIS Docker Benchmark v1.2.0, are still applicable to Docker Engine - Enterprise 18.09\n- inter-container communication (icc)* (CIS Docker Benchmark Recommendation 2.1)\n- insecure registry communication (CIS Docker Benchmark Recommendation 2.4)\n- AUFS storage driver (applicable on Linux only) (CIS Docker Benchmark Recommendation 2.5)\n- listening on the TCP Daemon socket\n- userland proxy for loopback traffic* (CIS Docker Benchmark Recommendation 2.15)\n- experimental features (CIS Docker Benchmark Recommendation 2.17)\n- Swarm Mode (CIS Docker Benchmark Recommendation 7.1)\n\n(Docker Engine - Enterprise: As part of a UCP cluster)\n- insecure registry communication (CIS Docker Benchmark Recommendation 2.4)\n- AUFS storage driver (applicable on Linux only) (CIS Docker Benchmark Recommendation 2.5)\n- listening on the TCP Daemon socket\n- experimental features (CIS Docker Benchmark Recommendation 2.17)\n\n(UCP)\n- Managed user database\n- self-signed certificates\n- periodic usage reporting and API tracking\n- allow users and administrators to schedule containers on all nodes, including UCP managers and DTR nodes\n\n(DTR)\n- periodic data usage/analytics reporting\n- create repository on push\n- self-signed certificates\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "This fix only applies to the DTR component of Docker Enterprise.\n\nIntegrate DTR with a trusted CA.\n\nvia UI:\n\nIn the DTR web console, navigate to 'System' | 'General' and click on the 'Show TLS Settings' link in the 'Domain & Proxies' section. Fill in the 'TLS Root CA' field with the contents of the external public CA certificate. Assuming the user generated a server certificate from that CA for DTR, also fill in the 'TLS Certificate Chain' and 'TLS Private Key' fields with the contents of the public/private certificates respectively. The 'TLS Certificate Chain' field must include both the DTR server certificate and any intermediate certificates. Click on the 'Save' button.\n\nvia CLI:\n\nLinux: Execute the following command as a superuser on one of the UCP Manager nodes in the cluster:\n\ndocker run -it --rm docker/dtr:[dtr_version] reconfigure --dtr-ca '$(cat [ca.pem])' --dtr-cert '$(cat [dtr_cert.pem])' --dtr-key '$(cat [dtr_private_key.pem])'",
        "reference": "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|Docker_Enterprise_2-x_Linux-UNIX_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-235794r627509_rule,STIG-ID|DKER-EE-001880,STIG-Legacy|SV-104759,STIG-Legacy|V-95621,SWIFT-CSCv1|2.3,Vuln-ID|V-235794",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Docker_Enterprise_2-x_Linux-UNIX_V2R1_STIG.zip",
        "cmd": "/usr/bin/echo '' | /usr/bin/openssl s_client -connect @DTR_IP@:@DTR_PORT@ | /usr/bin/openssl x509 -noout -text",
        "expect": "Manual_Review"
    },
    "custom_item_3": {
        "system": "Linux",
        "description": "DKER-EE-003930 - Docker Trusted Registry (DTR) must be integrated with a trusted certificate authority (CA) in Docker Enterprise.",
        "info": "Both the Universal Control Plane (UCP) and DTR components of Docker Enterprise leverage the same authentication and authorization backplane known as eNZi. The eNZi backplane includes its own managed user database, and also allows for LDAP integration in UCP and DTR. To meet the requirements of this control, configure LDAP integration. UCP also includes two certificate authorities for establishing root of trust. One CA is used to sign client bundles and the other is used for TLS communication between UCP components and nodes. Both of these CAs should be integrated with an external, trusted CA. DTR should be integrated with this same external, trusted CA as well.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "This fix only applies to the DTR component of Docker Enterprise.\n\nIntegrate DTR with a trusted CA.\n\nvia UI:\n\nIn the DTR web console, navigate to 'System' | 'General' and click on the 'Show TLS Settings' link in the 'Domain & Proxies' section. Fill in the 'TLS Root CA' field with the contents of the trusted CA certificate. Assuming the user has generated a server certificate from that CA for DTR, also fill in the 'TLS Certificate Chain' and 'TLS Private Key' fields with the contents of the public/private certificates respectively. The 'TLS Certificate Chain' field must include both the DTR server certificate and any intermediate certificates. Click on the 'Save' button.\n\nvia CLI:\n\nLinux: Execute the following command as a superuser on one of the UCP Manager nodes in the cluster:\n\ndocker run -it --rm docker/dtr:[dtr_version] reconfigure --dtr-ca '$(cat [ca.pem])' --dtr-cert '$(cat [dtr_cert.pem])' --dtr-key '$(cat [dtr_private_key.pem])'",
        "reference": "800-171|3.13.15,800-53|SC-23(5),800-53r5|SC-23(5),CAT|II,CCI|CCI-002470,DISA_Benchmark|Docker_Enterprise_2-x_Linux-UNIX_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-23,ITSG-33|SC-23a.,NESA|T4.5.1,QCSC-v1|5.2.1,Rule-ID|SV-235842r627653_rule,STIG-ID|DKER-EE-003930,STIG-Legacy|SV-104857,STIG-Legacy|V-95719,Vuln-ID|V-235842",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Docker_Enterprise_2-x_Linux-UNIX_V2R1_STIG.zip",
        "cmd": "/usr/bin/echo '' | /usr/bin/openssl s_client -connect @DTR_IP@:@DTR_PORT@ | /usr/bin/openssl x509 -noout -text",
        "expect": "Manual_Review"
    }
}