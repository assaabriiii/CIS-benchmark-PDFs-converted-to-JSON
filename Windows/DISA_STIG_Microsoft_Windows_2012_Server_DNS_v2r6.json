{
    "custom_item_1": {
        "description": "Windows Server 2012 is installed",
        "value_data": "^[a-zA-Z0-9\\(\\)\\s]*@PLATFORM_VERSION@[a-zA-Z0-9\\(\\)\\s]*$",
        "reg_key": "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion",
        "reg_item": "ProductName"
    },
    "custom_item_2": {
        "description": "DNS Server is installed",
        "powershell_args": "Get-WindowsFeature -Name DNS | Where {$_.InstallState -eq 'Installed'} | Select DisplayName, InstallState"
    },
    "custom_item_3": {
        "description": "WDNS-AC-000001 - The Windows 2012 DNS Server must restrict incoming dynamic update requests to known clients.",
        "info": "Limiting the number of concurrent sessions reduces the risk of Denial of Service (DoS) on any system.\n\nA DNS server's function requires it to be able to handle multiple sessions at a time so limiting concurrent sessions could potentially cause an impact to availability.\nPrimary name servers need to be configured to limit the actual hosts from which they will accept dynamic updates and from which they will accept zone transfer requests, and all name servers should be configured to limit the hosts from/to which they receive/send zone transfers. Restricting sessions to known hosts will mitigate the DoS vulnerability.",
        "solution": "Log on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name and then expand Forward Lookup Zones.\n\nFrom the expanded list, click to select the zone.\n\nOnce selected, right-click the name of the zone.\n\nFrom the displayed context menu, click the 'Properties' option.\n\nOn the opened domain's properties box, click the 'General' tab.\n\nIf the Type: is not Active Directory-Integrated, configure the zone for AD-integration.\n\nSelect 'Secure only' from the Dynamic updates: drop-down list.",
        "reference": "800-53|AC-10,800-53r5|AC-10,CAT|II,CCI|CCI-000054,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|AC-10,NESA|T5.5.1,QCSC-v1|5.2.1,QCSC-v1|5.2.2,Rule-ID|SV-215647r879511_rule,STIG-ID|WDNS-AC-000001,STIG-Legacy|SV-72667,STIG-Legacy|V-58237,Vuln-ID|V-215647",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = @(); $zones = (Get-DnsServerZone | Select ZoneName, IsDsIntegrated, DynamicUpdate); foreach ($zone in $zones) { if (!($zone | Out-String | Select-String -Pattern '[\\s]*True[\\s]+Secure Only[\\s]*$')) { $non_compliant_zones += $zone; } }; ''; if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { $zones; ''; 'All Zones Compliant'; };"
    },
    "custom_item_4": {
        "description": "WDNS-AU-000001 - The Windows 2012 DNS Server must be configured to record, and make available to authorized personnel, who added/modified/deleted DNS zone information.",
        "info": "Without a means for identifying the individual that produced the information, the information cannot be relied upon. Identifying the validity of information may be delayed or deterred.\n\nThis requirement ensures organizational personnel have a means to identify who produced or changed specific information in transfers, zone information, or DNS configuration changes.",
        "solution": "Log on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nIf not automatically started, initialize the 'Server Manager' window by clicking its icon from the bottom left corner of the screen.\n\nOn the opened 'Server Manager' window, from the left pane, click to select 'DNS'.\n\nFrom the right pane, under the 'SERVERS' section, right-click the DNS server.\n\nFrom the displayed context menu, click the 'DNS Manager' option.\n\nClick on the 'Event Logging' tab.\n\nSelect the 'Errors and warnings' or 'All events' option.\n\nClick on 'Apply'.\n\nClick on 'OK'.",
        "reference": "800-171|3.4.2,800-53|AU-10(1)(b),800-53|CM-6b.,800-53r5|AU-10(1)(b),800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CCI|CCI-001902,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF|PR.PT-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-10(1),ITSG-33|CM-6b.,NESA|T3.2.1,NESA|T4.3.1,NESA|T7.3.3,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-215648r879725_rule,STIG-ID|WDNS-AU-000001,STIG-Legacy|SV-72973,STIG-Legacy|V-58543,SWIFT-CSCv1|2.3,Vuln-ID|V-215648",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "(Get-DnsServerDiagnostics).EventLogLevel"
    },
    "custom_item_5": {
        "description": "WDNS-AU-000005 - The Windows 2012 DNS Server log must be enabled.",
        "info": "Without the capability to generate audit records, it would be difficult to establish, correlate, and investigate the events relating to an incident, or identify those responsible for one. The actual auditing is performed by the OS/NDM, but the configuration to trigger the auditing is controlled by the DNS server.",
        "solution": "Log on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nRight-click the DNS server, select 'Properties'.\n\nClick on the 'Event Logging' tab. By default, all events are logged.\n\nSelect the 'Errors and warnings' or 'All events' option.\n\nClick on 'Apply'.\n\nClick 'OK'.",
        "reference": "800-171|3.3.1,800-171|3.3.2,800-53|AU-12a.,800-53r5|AU-12a.,CAT|II,CCI|CCI-000169,CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-12a.,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-215650r879559_rule,STIG-ID|WDNS-AU-000005,STIG-Legacy|SV-72979,STIG-Legacy|V-58549,SWIFT-CSCv1|6.4,Vuln-ID|V-215650",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "(Get-DnsServerDiagnostics).EventLogLevel"
    },
    "custom_item_6": {
        "description": "WDNS-AU-000006 - The Windows 2012 DNS Server logging must be enabled to record events from all DNS server functions.",
        "info": "DNS server performance can be affected when additional logging is enabled; however, the enhanced DNS logging and diagnostics feature in Windows Server 2012 R2 is designed to have a very low impact on performance. Enhanced DNS logging and diagnostics in Windows Server 2012 R2 and later includes DNS Audit events and DNS Analytic events. DNS audit logs are enabled by default and do not significantly affect DNS server performance. DNS analytical logs are not enabled by default and typically will only affect DNS server performance at very high DNS query rates.\n\nWithout the capability to generate audit records, it would be difficult to establish, correlate, and investigate the events relating to an incident or identify those responsible for one. The actual auditing is performed by the OS/NDM, but the configuration to trigger the auditing is controlled by the DNS server.\n\nIn order to compile an accurate risk assessment, it is essential for security personnel to know what is being performed on the system, where an event occurred, when an event occurred, and by whom the event was triggered. Logging the actions of specific events provides a means to investigate an attack, recognize resource utilization or capacity thresholds, or identify an improperly configured DNS system. If auditing is not comprehensive, it will not be useful for intrusion monitoring, security investigations, and forensic analysis. It is important, therefore, to log all possible data related to events so they can be correlated and analyzed to determine the risk.\n\nData required to be captured include: whether an event was successful or failed, the event type or category, timestamps for when the event occurred, where the event originated, who/what initiated the event, the effect the event had on the DNS implementation, and any processes associated with the event.",
        "solution": "Log on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nOpen an elevated Windows PowerShell prompt on the DNS server to which event logging needs to be enabled.\n\nUse the 'Set-DnsServerDiagnostics' cmdlet to enable the required diagnostic events.\n\nSet-DnsServerDiagnostics -$truefor the required diagnostic events.\n\nFor example, to set EnableLoggingForLocalLookupEvent to true, enter the following at the command line:\nSet-DnsServerDiagnostics -EnableLoggingForLocalLookupEvent $true",
        "reference": "800-171|3.3.1,800-171|3.3.2,800-53|AU-12a.,800-53r5|AU-12a.,CAT|II,CCI|CCI-000169,CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-12a.,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-215651r879559_rule,STIG-ID|WDNS-AU-000006,STIG-Legacy|SV-72981,STIG-Legacy|V-58551,SWIFT-CSCv1|6.4,Vuln-ID|V-215651",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$settings = (Get-DnsServerDiagnostics | Out-String | Select-String -Pattern '(Queries|Answers|Notifications|Update|QuestionTransactions|UnmatchedResponse|UseSystemEventLog|EnableLoggingFor(LocalLookupEvent|PluginDllEvent|RecursiveLookupEvent|RemoteServerEvent|ServerStartStopEvent|TombstoneEvent|ZoneDataWriteEvent|ZoneLoadingEvent))[\\s].*' -AllMatches | % { $_.Matches.Value }); $non_compliant = ($settings | Select-String -NotMatch -Pattern '(?s)[\\s]*True'); if ($non_compliant) { 'Non Compliant Settings:'; $non_compliant } else { $settings; ''; 'All Settings Compliant' }"
    },
    "custom_item_7": {
        "description": "manage",
        "value_data": "Administrators"
    },
    "custom_item_8": {
        "description": "permissions",
        "value_data": "STATUS: PASSED",
        "powershell_args": "$file = $env:SystemRoot+'\\System32\\Winevt\\Logs\\DNS Server.evtx'; $perms = 'NT SERVICE\\EventLog:*(F)', 'NT AUTHORITY\\SYSTEM:*(F)', 'BUILTIN\\Administrators:*(F)'; $required = $false; $status = 'PASSED'; $acls = icacls $file; $file+':'; foreach ($acl in $acls) { $acl = $acl.Replace($file, '').Trim(); if ((!$acl) -or ($acl -like 'Successfully processed*')) { continue } elseif ($perms -contains $acl) { '   '+$acl; $perms = $perms | Where-Object { $_ -ne $acl }; continue } else { $status = 'FAILED'; '   '+$acl+' ** incorrect **' } }; if (($perms.length) -and ($required)) { foreach ($acl in $perms) { $status = 'FAILED'; '   '+$acl+' ** missing **' } }; ''; 'STATUS: '+$status"
    },
    "custom_item_9": {
        "description": "WDNS-CM-000001 - The validity period for the RRSIGs covering the DS RR for a zones delegated children must be no less than two days and no more than one week.",
        "info": "The best way for a zone administrator to minimize the impact of a key compromise is by limiting the validity period of RRSIGs in the zone and in the parent zone. This strategy limits the time during which an attacker can take advantage of a compromised key to forge responses. An attacker that has compromised a ZSK can use that key only during the KSK's signature validity interval. An attacker that has compromised a KSK can use that key for only as long as the signature interval of the RRSIG covering the DS RR in the delegating parent. These validity periods should be short, which will require frequent re-signing.\n\nTo prevent the impact of a compromised KSK, a delegating parent should set the signature validity period for RRSIGs covering DS RRs in the range of a few days to 1 week. This re-signing does not require frequent rollover of the parent's ZSK, but scheduled ZSK rollover should still be performed at regular intervals.",
        "solution": "Log on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, click to select the zone.\n\nRight-click on the zone, choose DNSSEC->Properties.\n\nOn the ZSK tab, for DS signature validity period (hours), choose more than 48 and less than 168.",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-215661r879634_rule,STIG-ID|WDNS-CM-000001,STIG-Legacy|SV-73005,STIG-Legacy|V-58575,SWIFT-CSCv1|2.3,Vuln-ID|V-215661",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$items = @(); $non_compliant = @(); $zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false -and $_.IsReverseLookupZone -eq $false }); foreach ($zone in $zones) { $keys = (dnscmd /ZoneEnumSKDs $zone.ZoneName | Select-String -Pattern '(^[\\s]*$|(SKD GUID|DS signature|KSK flag))'); foreach ($key in $keys) { if (($key | Out-String).Trim()) { if ($key | Select-String -Pattern 'SKD GUID') { $guid = $key } if ($key | Select-String -Pattern 'DS signature') { if ($guid) { if ($key | Out-String | Select-String -Pattern 'DS signature validity period[\\s]*=[\\s]*(172800|172[8-9][0-9][0-9]|17[2-9][0-9][0-9][0-9]|1[7-9][0-9]{4}|[2-5][0-9][0-9][0-9][0-9][0-9]|60[0-3][0-9][0-9][0-9]|604[0-7][0-9][0-9]|604800)+[\\s]*') { $items += $guid; $items += $key; '' } else { $non_compliant += $guid; $non_compliant += $key; '' } } } if ($key | Select-String -Pattern 'KSK flag[\\s]*=[\\s]*1') { $guid = ''; } } } } if ($non_compliant) { 'Non Compliant Items:'; $non_compliant } else { $items; ''; 'All Items Compliant'}"
    },
    "custom_item_10": {
        "description": "root hints",
        "powershell_args": "(Get-DNSServerForwarder).UseRootHint"
    },
    "custom_item_11": {
        "description": "recursion",
        "powershell_args": "$forwarders = ((Get-DNSServerForwarder).IPAddress).IPAddressToString; if ($forwarders) { 'Forwarders:'; $forwarders; ''; 'All Settings Compliant'} else { $recursion = (Get-DNSServerRecursion).Enable; if (!($recursion)) { 'Recursion: ' + $recursion; ''; 'All Settings Compliant'} else { 'Non Compliant Settings.'; ''; 'No Forwarders Configured, Recursion: ' + $recursion } }"
    },
    "custom_item_12": {
        "description": "root hints",
        "powershell_args": "(Get-DNSServerForwarder).UseRootHint"
    },
    "custom_item_13": {
        "description": "forwarders",
        "powershell_args": "$forwarders = ((Get-DNSServerForwarder).IPAddress).IPAddressToString; if ($forwarders) { 'Forwarders:'; $forwarders } else { $recursion = (Get-DNSServerRecursion).Enable; if (!($recursion)) { 'Recursion: ' + $recursion; ''; 'All Settings Compliant'} else { 'Non Compliant Settings.'; ''; 'No Forwarders Configured, Recursion: ' + $recursion } }"
    },
    "custom_item_14": {
        "description": "WDNS-CM-000005 - The Windows 2012 DNS Server with a caching name server role must restrict recursive query responses to only the IP addresses and IP address ranges of known supported clients.",
        "info": "A potential vulnerability of DNS is that an attacker can poison a name server's cache by sending queries that will cause the server to obtain host-to-IP address mappings from bogus name servers that respond with incorrect information. Once a name server has been poisoned, legitimate clients may be directed to non-existent hosts (which constitutes a denial of service), or, worse, hosts that masquerade as legitimate ones to obtain sensitive data or passwords.\n\nTo guard against poisoning, name servers specifically fulfilling the role of providing recursive query responses for external zones need to be segregated from name servers authoritative for internal zones.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Configure a local or network firewall to only allow specific IP addresses/ranges to send inbound TCP and UDP port 53 traffic to a DNS caching server.",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-215575r879756_rule,STIG-ID|WDNS-CM-000005,STIG-Legacy|SV-73013,STIG-Legacy|V-58583,SWIFT-CSCv1|2.3,Vuln-ID|V-215575",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$authoritative = (Get-DNSServerZone | Where { $_.ZoneType -eq 'Primary' }); if (!($authoritative)) { 'Not an authoritative DNS server' } else { 'Manual Review Required' }"
    },
    "custom_item_15": {
        "description": "WDNS-CM-000006 - The Windows 2012 DNS Server with a caching name server role must be secured against pollution by ensuring the authenticity and integrity of queried records.",
        "info": "A potential vulnerability of DNS is that an attacker can poison a name server's cache by sending queries that will cause the server to obtain host-to-IP address mappings from bogus name servers that respond with incorrect information. Once a name server has been poisoned, legitimate clients may be directed to non-existent hosts (which constitutes a denial of service), or, worse, hosts that masquerade as legitimate ones to obtain sensitive data or passwords.\n\nTo guard against poisoning, name servers authoritative for .mil domains should be separated functionally from name servers that resolve queries on behalf of internal clients. Organizations may achieve this separation by dedicating machines to each function or, if possible, by running two instances of the name server software on the same machine: one for the authoritative function and the other for the resolving function. In this design, each name server process may be bound to a different IP address or network interface to implement the required segregation.\n\nWindows 2012 DNS Servers with a caching name server role must be secured against pollution by ensuring that the authenticity and integrity of queried records are verified before any data is cached.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Implement DNSSEC on all non-AD-integrated, standalone, caching Windows 2012 DNS Servers to ensure caching server validates signed zones when resolving and caching.",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-215576r879756_rule,STIG-ID|WDNS-CM-000006,STIG-Legacy|SV-73015,STIG-Legacy|V-58585,SWIFT-CSCv1|2.3,Vuln-ID|V-215576",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_integrated = Get-DnsServerZone | Where { $_.IsDsIntegrated -eq $false }; if ($non_integrated) { $non_integrated } else { 'All Zones AD Integrated' }"
    },
    "custom_item_16": {
        "description": "WDNS-CM-000007 - The Windows 2012 DNS Server must implement cryptographic mechanisms to detect changes to information during transmission unless otherwise protected by alternative physical safeguards, such as, at a minimum, a Protected Distribution System (PDS).",
        "info": "Encrypting information for transmission protects information from unauthorized disclosure and modification. Cryptographic mechanisms implemented to protect information integrity include, for example, cryptographic hash functions which have common application in digital signatures, checksums, and message authentication codes.\n\nConfidentiality is not an objective of DNS, but integrity is. DNSSEC and TSIG/SIG(0) both digitally sign DNS information to authenticate its source and ensure its integrity.",
        "solution": "Sign, or re-sign, the hosted zone(s) on the DNS server being validated.\n\nLog on to the DNS server using the account designated as Administrator or DNS Administrator.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, right-click to select the zone (repeat for each hosted zone), point to DNSSEC, and then click Sign the Zone, either using approved saved parameters or approved custom parameters.",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-215577r879811_rule,STIG-ID|WDNS-CM-000007,STIG-Legacy|SV-73017,STIG-Legacy|V-58587,SWIFT-CSCv1|2.3,Vuln-ID|V-215577",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription | Where { $_.ValidationErrorCode -ne 0 }); if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription ); ''; 'All Zones Compliant'; }"
    },
    "custom_item_17": {
        "description": "WDNS-CM-000008 - The validity period for the RRSIGs covering a zones DNSKEY RRSet must be no less than two days and no more than one week.",
        "info": "The best way for a zone administrator to minimize the impact of a key compromise is by limiting the validity period of RRSIGs in the zone and in the parent zone. This strategy limits the time during which an attacker can take advantage of a compromised key to forge responses. An attacker that has compromised a ZSK can use that key only during the KSK's signature validity interval. An attacker that has compromised a KSK can use that key for only as long as the signature interval of the RRSIG covering the DS RR in the delegating parent. These validity periods should be short, which will require frequent re-signing.\n\nTo minimize the impact of a compromised ZSK, a zone administrator should set a signature validity period of 1 week for RRSIGs covering the DNSKEY RRSet in the zone (the RRSet that contains the ZSK and KSK for the zone). The DNSKEY RRSet can be re-signed without performing a ZSK rollover, but scheduled ZSK rollovers should still be performed at regular intervals.",
        "solution": "Log on to the DNS server using the account designated as Administrator or DNS Administrator.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, click to select the zone.\n\nRight-click the zone and select DNSSEC, Properties.\n\nSelect the KSK Tab. For the 'DNSKEY RRSET signature validity period (hours):' setting, configure to a value between 48-168 hours.\n\nSelect the ZSK Tab. For the 'DNSKEY signature validity period (hours):' setting, configure to a value between 48-168 hours.",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-215578r879887_rule,STIG-ID|WDNS-CM-000008,STIG-Legacy|SV-73019,STIG-Legacy|V-58589,SWIFT-CSCv1|2.3,Vuln-ID|V-215578",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$items = @(); $non_compliant = @(); $zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false -and $_.IsReverseLookupZone -eq $false }); foreach ($zone in $zones) { $keys = (dnscmd /ZoneEnumSKDs $zone.ZoneName | Select-String -Pattern '(^[\\s]*$|(SKD GUID|DS signature))'); foreach ($key in $keys) { if (($key | Out-String).Trim()) { if ($key | Select-String -Pattern 'SKD GUID') { $guid = $key } if ($key | Select-String -Pattern 'DS signature') { if ($guid) { if ($key | Out-String | Select-String -Pattern 'DS signature validity period[\\s]*=[\\s]*(172800|172[8-9][0-9][0-9]|17[2-9][0-9][0-9][0-9]|1[7-9][0-9]{4}|[2-5][0-9][0-9][0-9][0-9][0-9]|60[0-3][0-9][0-9][0-9]|604[0-7][0-9][0-9]|604800)+[\\s]*') { $items += $guid; $items += $key; '' } else { $non_compliant += $guid; $non_compliant += $key; '' } } } } } } if ($non_compliant) { 'Non Compliant Items:'; $non_compliant } else { $items; ''; 'All Items Compliant'}"
    },
    "custom_item_18": {
        "description": "WDNS-CM-000009 - NSEC3 must be used for all internal DNS zones.",
        "info": "NSEC records list the resource record types for the name, as well as the name of the next resource record. With this information it is revealed that the resource record type for the name queried, or the resource record name requested, does not exist. NSEC uses the actual resource record names, whereas NSEC3 uses a one-way hash of the name. In this way, walking zone data from one record to the next is prevented, at the expense of some CPU cycles both on the authoritative server as well as the resolver. To prevent giving access to an entire zone file, NSEC3 should be configured and in order to use NSEC3, RSA/SHA-1 should be used as the algorithm, as some resolvers that understand RSA/SHA-1 might not understand NSEC3. Using RSA/SHA-256 is a safe alternative.",
        "solution": "Log on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nIf not automatically started, initialize the Server Manager window by clicking its icon from the bottom left corner of the screen.\n\nOnce the Server Manager window is initialized, from the left pane, click to select the DNS category.\n\nFrom the right pane, under the SERVERS section, right-click the DNS server.\n\nFrom the context menu that appears, click DNS Manager.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name and then expand Forward Lookup Zones.\n\nFrom the expanded list, click to select the zone.\n\nRight-click the zone, select DNSSEC, Sign the Zone.\n\nRe-sign the zone, using an NSEC3 algorithm (RSA/SHA-1 (NSEC3), RSA/SHA-256, RSA/SHA-512).",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-215579r879887_rule,STIG-ID|WDNS-CM-000009,STIG-Legacy|SV-73021,STIG-Legacy|V-58591,SWIFT-CSCv1|2.3,Vuln-ID|V-215579",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_nsec3 = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false} | Get-DnsServerDnsSecZoneSetting | Select ZoneName, DenialOfExistence | Where {$_.DenialOfExistence -ne 'NSec3'}); $non_dnssec = (Get-DnsServerZone | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription | Where { $_.ValidationErrorCode -ne 0 }); if ($non_nsec3 -or $non_dnssec) { 'Non Compliant Zones:'; $non_nsec3; ''; $non_dnssec; } else { (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false} | Get-DnsServerDnsSecZoneSetting | Select ZoneName, DenialOfExistence); ''; 'All Zones Compliant'; }"
    },
    "custom_item_19": {
        "description": "WDNS-CM-000010 - The Windows 2012 DNS Servers zone files must have NS records that point to active name servers authoritative for the domain specified in that record.",
        "info": "Poorly constructed NS records pose a security risk because they create conditions under which an adversary might be able to provide the missing authoritative name services that are improperly specified in the zone file. The adversary could issue bogus responses to queries that clients would accept because they learned of the adversary's name server from a valid authoritative name server, one that need not be compromised for this attack to be successful. The list of slave servers must remain current within 72 hours of any changes to the zone architecture that would affect the list of slaves. If a slave server has been retired or is not operational but remains on the list, then an adversary might have a greater opportunity to impersonate that slave without detection, rather than if the slave was actually online. For example, the adversary may be able to spoof the retired slave's IP address without an IP address conflict, which would not be likely to occur if the true slave were active.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "If DNS servers are AD-integrated, troubleshoot and remedy the replication problem where the non-responsive name server is not getting updated.\n\nIf DNS servers are not AD-integrated, Log on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, click to select the zone.\n\nReview the NS records for the zone.\n\nSelect the NS record for the non-responsive name server and remove the record.",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|I,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-215580r879887_rule,STIG-ID|WDNS-CM-000010,STIG-Legacy|SV-73023,STIG-Legacy|V-58593,SWIFT-CSCv1|2.3,Vuln-ID|V-215580",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "'Records to review'; ''; foreach ($zone in Get-DnsServerZone) { 'Zone: ' + $zone.ZoneName + ':'; ''; Get-DnsServerResourceRecord -ZoneName $zone.ZoneName -RRType 'NS'; ''; }"
    },
    "custom_item_20": {
        "description": "WDNS-CM-000012 - All authoritative name servers for a zone must be located on different network segments.",
        "info": "Most enterprises have an authoritative primary server and a host of authoritative secondary name servers. It is essential that these authoritative name servers for an enterprise be located on different network segments. This dispersion ensures the availability of an authoritative name server not only in situations in which a particular router or switch fails but also during events involving an attack on an entire network segment.\n\nA network administrator may choose to use a 'hidden' master authoritative server and only have secondary servers visible on the network. A hidden master authoritative server is an authoritative DNS server whose IP address does not appear in the name server set for a zone. If the master authoritative name server is 'hidden', a secondary authoritative name server may reside on the same network as the hidden master.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "For non-AD-integrated Windows DNS Servers, distribute secondary authoritative servers on separate network segments from the primary authoritative server.",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-215581r879887_rule,STIG-ID|WDNS-CM-000012,STIG-Legacy|SV-73025,STIG-Legacy|V-58595,SWIFT-CSCv1|2.3,Vuln-ID|V-215581",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_integrated = Get-DnsServerZone | Where { $_.IsDsIntegrated -eq $false }; if ($non_integrated) { $non_integrated } else { 'All Zones AD Integrated' }"
    },
    "custom_item_21": {
        "description": "WDNS-CM-000013 - All authoritative name servers for a zone must have the same version of zone information.",
        "info": "The only protection approach for content control of a DNS zone file is the use of a zone file integrity checker. The effectiveness of integrity checking using a zone file integrity checker depends upon the database of constraints built into the checker. The deployment process consists of developing these constraints with the right logic, and the only determinant of the truth value of these logical predicates is the parameter values for certain key fields in the format of various RRTypes.\n\nThe serial number in the SOA RDATA is used to indicate to secondary name servers that a change to the zone has occurred and a zone transfer should be performed. It should always be increased whenever a change is made to the zone data. DNS NOTIFY must be enabled on the master authoritative name server.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "If all DNS servers are AD-integrated, troubleshoot why and mitigate the replication is not taking place to the out-of-sync secondary name servers.\n\nLog on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, click to select the zone.\n\nInitiate a zone transfer to all secondary name servers for the zone.",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-215582r879887_rule,STIG-ID|WDNS-CM-000013,STIG-Legacy|SV-73027,STIG-Legacy|V-58597,SWIFT-CSCv1|2.3,Vuln-ID|V-215582",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_integrated = Get-DnsServerZone | Where { $_.IsDsIntegrated -eq $false }; if ($non_integrated) { $non_integrated } else { 'All Zones AD Integrated' }"
    },
    "custom_item_22": {
        "description": "WDNS-CM-000014 - The Windows 2012 DNS Server must be configured to enable DNSSEC Resource Records.",
        "info": "The specification for a digital signature mechanism in the context of the DNS infrastructure is in IETF's DNSSEC standard.  In DNSSEC, trust in the public key (for signature verification) of the source is established not by going to a third party or a chain of third parties (as in public key infrastructure [PKI] chaining), but by starting from a trusted zone (such as the root zone) and establishing the chain of trust down to the current source of response through successive verifications of signature of the public key of a child by its parent. The public key of the trusted zone is called the trust anchor. After authenticating the source, the next process DNSSEC calls for is to authenticate the response. DNSSEC mechanisms involve two main processes: sign and serve, and verify signature.\n\nBefore a DNSSEC-signed zone can be deployed, a name server must be configured to enable DNSSEC processing.",
        "solution": "Sign, or re-sign, the hosted zone(s) on the DNS server being validated.\n\nLog on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, right-click to select the zone (repeat for each hosted zone), point to DNSSEC, and then click Sign the Zone, either using approved saved parameters or approved custom parameters.",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|I,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-215583r879887_rule,STIG-ID|WDNS-CM-000014,STIG-Legacy|SV-73029,STIG-Legacy|V-58599,SWIFT-CSCv1|2.3,Vuln-ID|V-215583",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription | Where { $_.ValidationErrorCode -ne 0 }); if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription ); ''; 'All Zones Compliant'; }"
    },
    "custom_item_23": {
        "description": "WDNS-CM-000015 - Digital signature algorithm used for DNSSEC-enabled zones must be FIPS-compatible.",
        "info": "The choice of digital signature algorithm will be based on recommended algorithms in well-known standards. NIST's Digital Signature Standard (DSS) [FIPS186] provides three algorithm choices:\n* Digital Signature Algorithm (DSA)\n* RSA\n* Elliptic Curve DSA (ECDSA).\nOf these three algorithms, RSA and DSA are more widely available and hence are considered candidates of choice for DNSSEC. In terms of performance, both RSA and DSA have comparable signature generation speeds, but DSA is much slower for signature verification.\n\nRSA is the recommended algorithm as far as this guideline is concerned. RSA with SHA-1 is currently the only cryptographic algorithm mandated to be implemented with DNSSEC, although other algorithm suites (i.e. RSA/SHA-256, ECDSA) are also specified. It can be expected that name servers and clients will be able to use the RSA algorithm at the minimum. It is suggested that at least one ZSK for a zone use the RSA algorithm.\n\nNIST's Secure Hash Standard (SHS) (FIPS 180-3) specifies SHA-1, SHA-224, SHA-256, SHA-384, and SHA-512 as approved hash algorithms to be used as part of the algorithm suite for generating digital signatures using the digital signature algorithms in NIST's DSS[FIPS186]. It is expected that there will be support for Elliptic Curve Cryptography in the DNSSEC. The migration path for USG DNSSEC operation will be to ECDSA (or similar) from RSA/SHA-1 and RSA/SHA-256 before September 30th, 2015.",
        "solution": "Sign, or re-sign, the hosted zone(s) on the DNS server being validated.\n\nLog on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, right-click to select the zone (repeat for each hosted zone), point to DNSSEC, and then click Sign the Zone, either using approved saved parameters or approved custom parameters.",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-215584r879887_rule,STIG-ID|WDNS-CM-000015,STIG-Legacy|SV-73031,STIG-Legacy|V-58601,SWIFT-CSCv1|2.3,Vuln-ID|V-215584",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription | Where { $_.ValidationErrorCode -ne 0 }); if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription ); ''; 'All Zones Compliant'; }"
    },
    "custom_item_24": {
        "description": "WDNS-CM-000019 - Primary authoritative name servers must be configured to only receive zone transfer requests from specified secondary name servers.",
        "info": "Authoritative name servers (especially primary name servers) should be configured with an allow-transfer access control sub statement designating the list of hosts from which zone transfer requests can be accepted. These restrictions address the denial-of-service threat and potential exploits from unrestricted dissemination of information about internal resources. Based on the need-to-know, the only name servers that need to refresh their zone files periodically are the secondary name servers. Zone transfer from primary name servers should be restricted to secondary name servers. The zone transfer should be completely disabled in the secondary name servers. The address match list argument for the allow-transfer sub statement should consist of IP addresses of secondary name servers and stealth secondary name servers.",
        "solution": "Log on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, click to select the zone.\n\nRight-click the zone and select 'Properties'.\n\nSelect the 'Zone Transfers' tab.\n\nSelect the 'Only to servers listed on the Name Server tab' or 'Only to the following servers' check box or deselect the 'Allow zone transfers' check box.\n\nClick 'OK'.",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-215588r879887_rule,STIG-ID|WDNS-CM-000019,STIG-Legacy|SV-73039,STIG-Legacy|V-58609,SWIFT-CSCv1|2.3,Vuln-ID|V-215588",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant = (Get-DnsServerZone | Where { $_.SecureSecondaries -eq 'TransferAnyServer' } | Format-Table -Property ZoneName, SecureSecondaries); if ($non_compliant) { 'Non Compliant Zones:'; $non_compliant } else { Get-DnsServerZone | Format-Table -Property ZoneName, SecureSecondaries; ''; 'All Zones Compliant' }"
    },
    "custom_item_25": {
        "description": "WDNS-CM-000020 - The Windows 2012 DNS Servers zone database files must not be accessible for edit/write by users and/or processes other than the Windows 2012 DNS Server service account and/or the DNS database administrator.",
        "info": "Discretionary Access Control (DAC) is based on the premise that individual users are 'owners' of objects and therefore have discretion over who should be authorized to access the object and in which mode (e.g., read or write). Ownership is usually acquired as a consequence of creating the object or via specified ownership assignment. In a DNS implementation, DAC should be granted to a minimal number of individuals and objects because DNS does not interact directly with users and users do not store and share data with the DNS application directly.\n\nThe primary objective of DNS authentication and access control is the integrity of DNS records; only authorized personnel must be able to create and modify resource records, and name servers should only accept updates from authoritative master servers for the relevant zones. Integrity is best assured through authentication and access control features within the name server software and the file system the name server resides on. In order to protect the zone files and configuration data, which should only be accessed by the name service or an administrator, access controls need to be implemented on files, and rights should not be easily propagated to other users. Lack of a stringent access control policy places the DNS infrastructure at risk to malicious persons and attackers, in addition to potential denial of service to network resources.\n\nDAC allows the owner to determine who will have access to objects they control. An example of DAC includes user-controlled file permissions. DAC models have the potential for the access controls to propagate without limit, resulting in unauthorized access to said objects.\n\nWhen applications provide a DAC mechanism, the DNS implementation must be able to limit the propagation of those access rights.",
        "solution": "For a file-back Windows DNS implementation, Log on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, click to select each zone.\n\nRight-click each zone and select 'Properties'.\n\nSelect the 'Security' tab.\n\nDowngrade to READ privileges assigned to any group or user which has greater than READ privileges.",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-215589r879887_rule,STIG-ID|WDNS-CM-000020,STIG-Legacy|SV-73041,STIG-Legacy|V-58611,SWIFT-CSCv1|2.3,Vuln-ID|V-215589",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$review = @(); $zones = Get-DnsServerZone; foreach ($zone in $zones) { if ($zone.ZoneFile) { ''; $f = $env:SystemRoot + '\\system32\\dns\\' + $zone.ZoneFile; $acls = (icacls $f | Select-String -Pattern '^((?!(BUILTIN\\\\Administrators|NT AUTHORITY\\\\SYSTEM)).)*(\\(F\\)|\\(M\\)|\\(W\\))'); if ($acls) { $review += icacls $f } } } if ($review) { $review } else { 'All Permissions Compliant' }"
    },
    "custom_item_26": {
        "description": "WDNS-CM-000022 - The Windows 2012 DNS Server authoritative for local zones must only point root hints to the DNS servers that host the internal root domain.",
        "info": "All caching name servers must be authoritative for the root zone because, without this starting point, they would have no knowledge of the DNS infrastructure and thus would be unable to respond to any queries. The security risk is that an adversary could change the root hints and direct the caching name server to a bogus root server. At that point, every query response from that name server is suspect, which would give the adversary substantial control over the network communication of the name servers' clients. When authoritative servers are sent queries for zones that they are not authoritative for, and they are configured as a non-caching server (as recommended), they can either be configured to return a referral to the root servers or they can be configured to refuse to answer the query. The recommendation is to configure authoritative servers to refuse to answer queries for any zones for which they are not authoritative. This is more efficient for the server and allows it to spend more of its resources doing what its intended purpose is, answering authoritatively for its zone.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Log on to the authoritative DNS server using the Domain Admin or Enterprise Admin account.\n\nPress Windows Key + R, execute dnsmgmt.msc.\nRight-click the DNS server, select 'Properties'.\nSelect the 'Root Hints' tab.\nRemove the root hints from the DNS Manager, the CACHE.DNS file and from Active Directory for name servers outside of the internal network.\nReplace the existing root hints with new root hints of internal servers.\nIf the DNS server is forwarding, click to select the : 'Do not use recursion for this domain' check box on the 'Forwarders' tab in DNS Manager to make sure that the root hints will not be used.",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-215591r879887_rule,STIG-ID|WDNS-CM-000022,STIG-Legacy|SV-73045,STIG-Legacy|V-58615,SWIFT-CSCv1|2.3,Vuln-ID|V-215591",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$authoritative = (Get-DNSServerZone | Where { $_.ZoneType -eq 'Primary' }); if (!($authoritative)) { 'Not an authoritative DNS server' } else { $root_hints = Get-DnsServerRootHint; if (!($root_hints)) { 'Root Hints Empty' } else { $root_hints } }"
    },
    "custom_item_27": {
        "description": "WDNS-CM-000024 - The Windows 2012 DNS Servers zone files must not include resource records that resolve to a fully qualified domain name residing in another zone.",
        "info": "If a name server were able to claim authority for a resource record in a domain for which it was not authoritative, this would pose a security risk. In this environment, an adversary could use illicit control of a name server to impact IP address resolution beyond the scope of that name server (i.e., by claiming authority for records outside of that server's zones). Fortunately, all but the oldest versions of BIND and most other DNS implementations do not allow for this behavior. Nevertheless, the best way to eliminate this risk is to eliminate from the zone files any records for hosts in another zone.\n\nThe exceptions are glue records supporting zone delegations, CNAME records supporting a system migration, or CNAME records that point to third-party Content Delivery Networks (CDN) or cloud computing platforms.  In the case of third-party CDNs or cloud offerings, an approved mission need must be demonstrated.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Remove any resource records in a zone file if the resource record resolves to a fully qualified domain name residing in another zone.",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-215593r879887_rule,STIG-ID|WDNS-CM-000024,STIG-Legacy|SV-73049,STIG-Legacy|V-58619,SWIFT-CSCv1|2.3,Vuln-ID|V-215593",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$review = @(); $records = Get-DnsServerZone | Get-DnsServerResourceRecord; foreach ($record in $records) { $ext = ($record | Out-String | Select-String -Pattern '([a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}'); if ($ext) { $review += $record } } if ($review) { 'Review the following records:'; $review } else { 'All records compliant' }"
    },
    "custom_item_28": {
        "description": "WDNS-CM-000025 - The Windows 2012 DNS Servers zone files must not include CNAME records pointing to a zone with lesser security for more than six months.",
        "info": "The use of CNAME records for exercises, tests, or zone-spanning (pointing to zones with lesser security) aliases should be temporary (e.g., to facilitate a migration) and not be in place for more than six months. When a host name is an alias for a record in another zone, an adversary has two points of attack: the zone in which the alias is defined and the zone authoritative for the alias's canonical name. This configuration also reduces the speed of client resolution because it requires a second lookup after obtaining the canonical name. Furthermore, in the case of an authoritative name server, this information is promulgated throughout the enterprise to caching servers and thus compounds the vulnerability.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Remove any zone-spanning CNAME records that have been active for more than six months, which are not supporting zone delegations, CNAME records supporting a system migration, or CNAME records that point to third-party Content Delivery Networks (CDN) or cloud computing platforms.\n\nIn the case of third-party CDNs or cloud offerings, an approved mission need must be demonstrated (AO approval of use of a commercial cloud offering would satisfy this requirement).",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-215594r879887_rule,STIG-ID|WDNS-CM-000025,STIG-Legacy|SV-73051,STIG-Legacy|V-58621,SWIFT-CSCv1|2.3,Vuln-ID|V-215594",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$review = @(); foreach ($zone in Get-DnsServerZone) { $records = Get-DnsServerResourceRecord -ZoneName $zone.ZoneName -RRType 'CNAME'; if ($records) { $review += $zone.ZoneName + ':'; $review += ''; $review += $records } } if ($review) { 'Records to review'; ''; $review } else { 'No CNAME records found' }"
    },
    "custom_item_29": {
        "description": "WDNS-CM-000026 - Non-routable IPv6 link-local scope addresses must not be configured in any zone.",
        "info": "IPv6 link-local scope addresses are not globally routable and must not be configured in any DNS zone.  Similar to RFC1918 addresses, if a link-local scope address is inserted into a zone provided to clients, most routers will not forward this traffic beyond the local subnet.",
        "solution": "The SA should remove any link-local addresses and replace with appropriate Site-Local or Global scope addresses.",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-215595r879887_rule,STIG-ID|WDNS-CM-000026,STIG-Legacy|SV-73053,STIG-Legacy|V-58623,SWIFT-CSCv1|2.3,Vuln-ID|V-215595",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant = @(); $records = Get-DnsServerZone | Get-DnsServerResourceRecord; foreach ($record in $records) { $match = ($record | Out-String | Select-String -Pattern '[\\s]*(fe8|fe9|fea|feb)[0-9a-f]:'); if ($match) { $non_compliant += $match } } if ($non_compliant) { 'Non Compliant Records:'; $non_compliant; } else { 'All Records Compliant' }"
    },
    "custom_item_30": {
        "description": "WDNS-CM-000027 - AAAA addresses must not be configured in a zone for hosts that are not IPv6-aware.",
        "info": "DNS is only responsible for resolving a domain name to an IP address.  Applications and operating systems are responsible for processing the IPv6 or IPv4 record that may be returned.  With this in mind, a denial of service could easily be implemented for an application that is not IPv6-aware.  When the application receives an IP address in hexadecimal, it is up to the application/operating system to decide how to handle the response.  Combining both IPv6 and IPv4 records into the same domain can lead to application problems that are beyond the scope of the DNS administrator.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Remove any IPv6 records for hosts which are not IPv6-aware.",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-215596r879887_rule,STIG-ID|WDNS-CM-000027,STIG-Legacy|SV-73055,STIG-Legacy|V-58625,SWIFT-CSCv1|2.3,Vuln-ID|V-215596",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant = @(); $records = Get-DnsServerZone | Get-DnsServerResourceRecord; foreach ($record in $records) { $match = ($record | Out-String | Select-String -Pattern '[\\s]*(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))'); if ($match) { $non_compliant += $match } } if ($non_compliant) { 'IPv6 Records:'; $non_compliant; } else { 'No IPv6 Records' }"
    },
    "custom_item_31": {
        "description": "WDNS-CM-000029 - The Windows 2012 DNS Server must be configured to prohibit or restrict unapproved ports and protocols.",
        "info": "In order to prevent unauthorized connection of devices, unauthorized transfer of information, or unauthorized tunneling (i.e., embedding of data types within data types), organizations must disable or restrict unused or unnecessary physical and logical ports/protocols on information systems.\n\nApplications are capable of providing a wide variety of functions and services. Some of the functions and services provided by default may not be necessary to support essential organizational operations. Additionally, it is sometimes convenient to provide multiple services from a single component (e.g., email and web services); however, doing so increases risk over limiting the services provided by any one component.\n\nTo support the requirements and principles of least functionality, the application must support the organizational requirements by providing only essential capabilities and limiting the use of ports, protocols, and/or services to only those required, authorized, and approved to conduct official business or to address authorized quality of life issues.\n\nOn Windows 2012 DNS Server, during DNS resolution, DNS messages are sent from DNS clients to DNS servers or between DNS servers. Messages are sent over UDP and DNS servers bind to UDP port 53. When the message length exceeds the default message size for a User Datagram Protocol (UDP) datagram (512 octets), the first response to the message is sent with as much data as the UDP datagram will allow, and then the DNS server sets a flag indicating a truncated response. The message sender can then choose to reissue the request to the DNS server using TCP (over TCP port 53). The benefit of this approach is that it takes advantage of the performance of UDP but also has a backup failover solution for longer queries.\n\nIn general, all DNS queries are sent from a high-numbered source port (49152 or above) to destination port 53, and responses are sent from source port 53 to a high-numbered destination port.",
        "solution": "Re-install DNS.",
        "reference": "800-171|3.4.6,800-171|3.4.7,800-53|CM-7b.,800-53r5|CM-7b.,CAT|II,CCI|CCI-000382,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,Rule-ID|SV-215598r879588_rule,STIG-ID|WDNS-CM-000029,STIG-Legacy|SV-73059,STIG-Legacy|V-58629,SWIFT-CSCv1|2.3,Vuln-ID|V-215598",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$nc = @(); $pids = Get-Process -Name 'dns'; foreach ($p in $pids) { $ports = (Get-NetTCPConnection -State Listen -OwningProcess $p.Id | Select State, LocalPort, LocalAddress | Where {$_.LocalPort -ne 53}); if ($ports) { $nc += $ports } } if ($nc) { 'Non Compliant Ports:'; ''; $nc } else { 'Only listening on port 53' }"
    },
    "custom_item_32": {
        "description": "WDNS-IA-000001 - The Windows 2012 DNS Server must require devices to re-authenticate for each dynamic update request connection attempt.",
        "info": "Without re-authenticating devices, unidentified or unknown devices may be introduced, thereby facilitating malicious activity.\n\nIn addition to the re-authentication requirements associated with session locks, organizations may require re-authentication of devices, including, but not limited to, the following other situations:\n(i) When authenticators change;\n(ii) When roles change;\n(iii) When security categories of information systems change;\n(iv) After a fixed period of time; or\n(v) Periodically.\n\nDNS does perform server authentication when DNSSEC or TSIG/SIG(0) are used, but this authentication is transactional in nature (each transaction has its own authentication performed). So this requirement is applicable for every server-to-server transaction request.",
        "solution": "Log on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name and then expand Forward Lookup Zones.\n\nFrom the expanded list, click to select the zone.\n\nOnce selected, right-click the name of the zone, and from the displayed context menu, go to Properties.\n\nOn the opened domain's properties box, click the General tab.\n\nIf the Type: is not Active Directory-Integrated, configure the zone for AD-integration.\n\nSelect 'Secure only' from the Dynamic updates: drop-down list.",
        "reference": "800-53|IA-11,800-53r5|IA-11,CAT|II,CCI|CCI-002039,CSF|PR.AC-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(d),QCSC-v1|13.2,Rule-ID|SV-215599r879763_rule,STIG-ID|WDNS-IA-000001,STIG-Legacy|SV-73061,STIG-Legacy|V-58631,Vuln-ID|V-215599",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = @(); $zones = (Get-DnsServerZone | Select ZoneName, IsDsIntegrated, DynamicUpdate); foreach ($zone in $zones) { if (!($zone | Out-String | Select-String -Pattern '[\\s]*True[\\s]+Secure Only[\\s]*$')) { $non_compliant_zones += $zone; } }; ''; if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { $zones; ''; 'All Zones Compliant'; };"
    },
    "custom_item_33": {
        "description": "WDNS-IA-000003 - The secondary Windows DNS name servers must cryptographically authenticate zone transfers from primary name servers.",
        "info": "Without authenticating devices, unidentified or unknown devices may be introduced, thereby facilitating malicious activity. Device authentication is a solution enabling an organization to manage devices. It is an additional layer of authentication ensuring only specific pre-authorized devices can access the system.\n\nThis requirement applies to server-to-server (zone transfer) transactions only and is provided by TSIG/SIG(0), which enforces mutual server authentication using a key that is unique to each server pair (TSIG) or using PKI-based authentication (SIG(0)).",
        "solution": "Sign, or re-sign, the hosted zone(s) on the DNS server being validated.\n\nLog on to the DNS server using the account designated as Administrator or DNS Administrator.\nIf not automatically started, initialize the Server Manager window by clicking its icon from the bottom left corner of the screen.\n\nOnce the Server Manager window is initialized, from the left pane, click to select the DNS category.\n\nFrom the right pane, under the SERVERS section, right-click the DNS server.\n\nFrom the context menu that appears, click DNS Manager.\n\nIn the DNS Manager console tree on the DNS server being validated, navigate to Forward Lookup Zones.\n\nRight-click the zone (repeat for each hosted zone), point to DNSSEC, and then click Sign the Zone, either using approved saved parameters or approved custom parameters.",
        "reference": "800-53|IA-3,800-53r5|IA-3,CAT|II,CCI|CCI-001958,CSF|PR.AC-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-3,ITSG-33|IA-3a.,NESA|T5.4.3,QCSC-v1|13.2,Rule-ID|SV-215601r879767_rule,STIG-ID|WDNS-IA-000003,STIG-Legacy|SV-73065,STIG-Legacy|V-58635,TBA-FIISB|27.1,Vuln-ID|V-215601",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription | Where { $_.ValidationErrorCode -ne 0 }); if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription ); ''; 'All Zones Compliant'; }"
    },
    "custom_item_34": {
        "description": "WDNS-IA-000004 - The Windows DNS primary server must only send zone transfers to a specific list of secondary name servers.",
        "info": "Primary name servers also make outbound connection to secondary name servers to provide zone transfers and accept inbound connection requests from clients wishing to provide a dynamic update. Primary name servers should explicitly limit zone transfers to only be made to designated secondary name servers. Because zone transfers involve the transfer of entire zones and use TCP connections, they place substantial demands on network resources relative to normal DNS queries. Errant or malicious frequent zone transfer requests on the name servers of the enterprise can overload the master zone server and result in DoS to legitimate users.\n\nAD-integrated DNS servers replicate zone information via AD replication. Non-AD-integrated DNS servers replicate zone information via zone transfers.",
        "solution": "Log on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name and then expand Forward Lookup Zones.\n\nFrom the expanded list, click to select the zone.\n\nFrom the displayed context menu, click the 'Properties' option.\n\nOn the opened zone's properties box, go to the 'Zone Transfers' tab.\n\nOn the displayed interface, select the 'Allow zone transfers' check box.\n\nSelect the 'Only to servers listed on the Name Servers tab' radio button OR select the 'Only to the following servers' radio button.\n\nClick on 'Apply'.\n\nClick on 'OK'.",
        "reference": "800-53|IA-3,800-53r5|IA-3,CAT|II,CCI|CCI-001958,CSF|PR.AC-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-3,ITSG-33|IA-3a.,NESA|T5.4.3,QCSC-v1|13.2,Rule-ID|SV-215602r879511_rule,STIG-ID|WDNS-IA-000004,STIG-Legacy|SV-73067,STIG-Legacy|V-58637,TBA-FIISB|27.1,Vuln-ID|V-215602",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant = (Get-DnsServerZone | Where { $_.SecureSecondaries -eq 'TransferAnyServer' -And $_.IsDsIntegrated -eq $false} | Format-Table -Property ZoneName, SecureSecondaries); if ($non_compliant) { 'Non Compliant Zones:'; $non_compliant } else { (Get-DnsServerZone | Where { $_.IsDsIntegrated -eq $false} | Format-Table -Property ZoneName, SecureSecondaries); 'All Zones Compliant' }"
    },
    "custom_item_35": {
        "description": "WDNS-IA-000005 - The Windows 2012 DNS Server must provide its identity with returned DNS information by enabling DNSSEC and TSIG/SIG(0).",
        "info": "Weakly bound credentials can be modified without invalidating the credential; therefore, non-repudiation can be violated.\n\nThis requirement supports audit requirements that provide organizational personnel with the means to identify who produced specific information in the event of an information transfer. Organizations and/or data owners determine and approve the strength of the binding between the information producer and the information based on the security category of the information and relevant risk factors.\n\nDNSSEC and TSIG/SIG(0) both use digital signatures to establish the identity of the producer of particular pieces of information.",
        "solution": "Sign, or re-sign, the hosted zone(s) on the DNS server being validated.\nLog on to the DNS server using the account designated as Administrator or DNS Administrator.\n\nIn the DNS Manager console tree on the DNS server being validated, navigate to Forward Lookup Zones.\n\nRight-click the zone (repeat for each hosted zone), point to DNSSEC, and then click Sign the Zone, either using saved parameters or custom parameters.",
        "reference": "800-53|IA-3,800-53r5|IA-3,CAT|II,CCI|CCI-001958,CSF|PR.AC-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-3,ITSG-33|IA-3a.,NESA|T5.4.3,QCSC-v1|13.2,Rule-ID|SV-215603r879724_rule,STIG-ID|WDNS-IA-000005,STIG-Legacy|SV-73069,STIG-Legacy|V-58639,TBA-FIISB|27.1,Vuln-ID|V-215603",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription | Where { $_.ValidationErrorCode -ne 0 }); if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription ); ''; 'All Zones Compliant'; }"
    },
    "custom_item_36": {
        "description": "Verify Crypto folder exist",
        "value_data": "%ALLUSERSPROFILE%\\Microsoft\\Crypto"
    },
    "custom_item_37": {
        "description": "WDNS-IA-000006 - The Windows 2012 DNS Server must be configured to enforce authorized access to the corresponding private key.",
        "info": "The cornerstone of the PKI is the private key used to encrypt or digitally sign information. If the private key is stolen, this will lead to the compromise of the authentication and non-repudiation gained through PKI because the attacker can use the private key to digitally sign documents and pretend to be the authorized user. Both the holders of a digital certificate and the issuing authority must protect the computers, storage devices, or whatever they use to keep the private keys.\n\nSIG(0) is used for server-to-server authentication for DNS transactions, and it uses PKI-based authentication. So, in cases where SIG(0) is being used instead of TSIG (which uses a shared key, not PKI-based authentication), this requirement is applicable.",
        "solution": "Access Windows Explorer.\n\nNavigate to the following location:\n\n%ALLUSERSPROFILE%\\Microsoft\\Crypto\n\nModify permissions on the keys folder, sub-folders, and files to be limited to SYSTEM and Administrators FULL CONTROL and to all other Users/Groups to READ.",
        "reference": "800-171|3.5.2,800-53|IA-5(2)(b),800-53r5|IA-5(2)(b),CAT|II,CCI|CCI-000186,CSF|PR.AC-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5(2)(b),NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-215604r879613_rule,STIG-ID|WDNS-IA-000006,STIG-Legacy|SV-73071,STIG-Legacy|V-58641,Vuln-ID|V-215604",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$review = @(); $d = $env:AllUsersProfile + '\\Microsoft\\Crypto'; $files = Get-ChildItem -Recurse $d; $acls = (icacls $d | Select-String -Pattern '^((?!(BUILTIN\\\\Administrators|NT AUTHORITY\\\\SYSTEM)).)*(\\(F\\)|\\(M\\)|\\(W\\))'); if ($acls) { $review += icacls $d } foreach ($f in $files) { $acls = (icacls $f.FullName | Select-String -Pattern '^((?!(BUILTIN\\\\Administrators|NT AUTHORITY\\\\SYSTEM)).)*(\\(F\\)|\\(M\\)|\\(W\\))'); if ($acls) { $review += icacls $f.FullName } } if ($review) { $review } else { 'All Permissions Compliant' }"
    },
    "custom_item_38": {
        "description": "WDNS-IA-000007 - The Windows 2012 DNS Server key file must be owned by the account under which the Windows 2012 DNS Server service is run.",
        "info": "To enable zone transfer (requests and responses) through authenticated messages, it is necessary to generate a key for every pair of name servers. The key can also be used for securing other transactions, such as dynamic updates, DNS queries, and responses. The binary key string that is generated by most key generation utilities used with DNSSEC is Base64-encoded. TSIG is a string used to generate the message authentication hash stored in a TSIG RR and used to authenticate an entire DNS message.",
        "solution": "Access Windows Explorer.\n\nNavigate to the following location:\n\n%ALLUSERSPROFILE%\\Microsoft\\Crypto\n\nRight-click on each sub-folder, choose 'Properties', click on the 'Security' tab, and click on the 'Advanced' button.\n\nClick on 'Change' next to the listed Owner and change to be the account under which the DNS Server Service is running.",
        "reference": "800-171|3.5.2,800-53|IA-5(2)(b),800-53r5|IA-5(2)(b),CAT|II,CCI|CCI-000186,CSF|PR.AC-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5(2)(b),NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-215605r879613_rule,STIG-ID|WDNS-IA-000007,STIG-Legacy|SV-73073,STIG-Legacy|V-58643,Vuln-ID|V-215605",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$review = @(); $d = $env:AllUsersProfile + '\\Microsoft\\Crypto'; $user = (Get-Process -Name dns -IncludeUserName | Select UserName).UserName; $review += Get-Acl -Path $d | Where {$_.Owner -ne $user}; $files = Get-ChildItem -Recurse $d; foreach ($f in $files) { $review += Get-Acl -Path $f.FullName | Where {$_.Owner -ne $user} } if ($review) { 'The following files are not owned by ' + $user + ':'; ''; $review } else { 'All files owned by ' + $user }"
    },
    "custom_item_39": {
        "description": "WDNS-IA-000008 - The Windows 2012 DNS Server permissions must be set so that the key file can only be read or modified by the account that runs the name server software.",
        "info": "To enable zone transfer (requests and responses) through authenticated messages, it is necessary to generate a key for every pair of name servers. The key can also be used for securing other transactions, such as dynamic updates, DNS queries, and responses. The binary key string that is generated by most key generation utilities used with DNSSEC is Base64-encoded. TSIG is a string used to generate the message authentication hash stored in a TSIG RR and used to authenticate an entire DNS message.",
        "solution": "Access Windows Explorer.\n\nNavigate to the following location:\n%ALLUSERSPROFILE%\\Microsoft\\Crypto\n\nModify permissions on the folder, sub-folders and files to 'FULL CONTROL' for 'SYSTEM' and Administrators  and to 'READ' for all other Users/Groups.",
        "reference": "800-171|3.5.2,800-53|IA-5(2)(b),800-53r5|IA-5(2)(b),CAT|II,CCI|CCI-000186,CSF|PR.AC-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5(2)(b),NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-215606r879613_rule,STIG-ID|WDNS-IA-000008,STIG-Legacy|SV-73075,STIG-Legacy|V-58645,Vuln-ID|V-215606",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$review = @(); $d = $env:AllUsersProfile + '\\Microsoft\\Crypto'; $files = Get-ChildItem -Recurse $d; $acls = (icacls $d | Select-String -Pattern '^((?!(BUILTIN\\\\Administrators|NT AUTHORITY\\\\SYSTEM)).)*(\\(F\\)|\\(M\\)|\\(W\\))'); if ($acls) { $review += icacls $d } foreach ($f in $files) { $acls = (icacls $f.FullName | Select-String -Pattern '^((?!(BUILTIN\\\\Administrators|NT AUTHORITY\\\\SYSTEM)).)*(\\(F\\)|\\(M\\)|\\(W\\))'); if ($acls) { $review += icacls $f.FullName } } if ($review) { $review } else { 'All Permissions Compliant' }"
    },
    "custom_item_40": {
        "description": "WDNS-IA-000009 - The private key corresponding to the ZSK must only be stored on the name server that does support dynamic updates.",
        "info": "The private keys in the KSK and ZSK key pairs must be protected from unauthorized access. If possible, the private keys should be stored off-line (with respect to the Internet-facing, DNSSEC-aware name server) in a physically secure, non-network-accessible machine along with the zone file master copy.\n\nThis strategy is not feasible in situations in which the DNSSEC-aware name server has to support dynamic updates. To support dynamic update transactions, the DNSSEC-aware name server (which usually is a primary authoritative name server) has to have both the zone file master copy and the private key corresponding to the zone-signing key (ZSK-private) online to immediately update the signatures for the updated RRsets. The private key corresponding to the key-signing key (KSK-private) can still be kept off-line.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Ensure the private key corresponding to the ZSK is only stored on the name server accepting dynamic updates.",
        "reference": "800-171|3.5.2,800-53|IA-5(2)(b),800-53r5|IA-5(2)(b),CAT|II,CCI|CCI-000186,CSF|PR.AC-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5(2)(b),NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-215607r879613_rule,STIG-ID|WDNS-IA-000009,STIG-Legacy|SV-73077,STIG-Legacy|V-58647,Vuln-ID|V-215607",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_integrated = Get-DnsServerZone | Where { $_.IsDsIntegrated -eq $false } | Select ZoneName, IsDsIntegrated, DynamicUpdate; $dynamic = Get-DnsServerZone | Where { $_.DynamicUpdate -ne 'None' } | Select ZoneName, IsDsIntegrated, DynamicUpdate; if ($non_integrated -Or $dynamic) { 'Non Ds Integrated Zones:'; $non_integrated; ''; 'Dynamic Update Zones:'; $dynamic } else { Get-DnsServerZone | Select ZoneName, IsDsIntegrated, DynamicUpdate; ''; 'All Zones Integrated and/or Dynamic Updates disabled.' }"
    },
    "custom_item_41": {
        "description": "WDNS-SC-000001 - The salt value for zones signed using NSEC3 RRs must be changed every time the zone is completely re-signed.",
        "info": "NSEC records list the resource record types for the name, as well as the name of the next resource record. With this information it is revealed that the resource record type for the name queried, or the resource record name requested, does not exist. NSEC uses the actual resource record names, whereas NSEC3 uses a one-way hash of the name. In this way, walking zone data from one record to the next is prevented, at the expense of some CPU cycles both on the authoritative server as well as on the resolver. To prevent giving access to an entire zone file, NSEC3 should be configured, and, in order to use NSEC3, RSA/SHA-1 should be used as the algorithm, as some resolvers that understand RSA/SHA-1 might not understand NSEC3. Using RSA/SHA-256 is a safe alternative.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Sign, or re-sign, the hosted zone(s) on the DNS server being validated.\n\nLog on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, right-click to select the zone (repeat for each hosted zone), point to DNSSEC, and then click Sign the Zone, either using approved saved parameters or approved custom parameters.\n\nRe-validate the NSEC3PARAM Inception date and time against the DNSKEY date and time.",
        "reference": "800-171|3.13.11,800-53|SC-13,800-53r5|SC-13,CAT|II,CCI|CCI-002450,CSF|PR.DS-5,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(e)(2)(ii),ISO/IEC-27001|A.10.1.1,ITSG-33|SC-13,ITSG-33|SC-13a.,NESA|M5.2.6,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5e,QCSC-v1|6.2,Rule-ID|SV-215609r879887_rule,STIG-ID|WDNS-SC-000001,STIG-Legacy|SV-73081,STIG-Legacy|V-58651,Vuln-ID|V-215609",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_integrated = Get-DnsServerZone | Where { $_.IsDsIntegrated -eq $false }; if ($non_integrated) { $non_integrated } else { 'All Zones AD Integrated' }"
    },
    "custom_item_42": {
        "description": "WDNS-SC-000002 - The Windows 2012 DNS Server must include data origin with authoritative data the system returns in response to external name/address resolution queries.",
        "info": "The underlying feature in the major threat associated with DNS query/response (i.e., forged response or response failure) is the integrity of DNS data returned in the response. The security objective is to verify the integrity of each response received. An integral part of integrity verification is to ensure that valid data has originated from the right source. Establishing trust in the source is called data origin authentication.\n\nThe security objectives--and consequently the security services--that are required for securing the DNS query/response transaction are data origin authentication and data integrity verification.\n\nThe specification for a digital signature mechanism in the context of the DNS infrastructure is in IETF's DNSSEC standard. In DNSSEC, trust in the public key (for signature verification) of the source is established not by going to a third party or a chain of third parties (as in public key infrastructure [PKI] chaining), but by starting from a trusted zone (such as the root zone) and establishing the chain of trust down to the current source of response through successive verifications of signature of the public key of a child by its parent. The public key of the trusted zone is called the trust anchor.",
        "solution": "Sign, or re-sign, the hosted zone(s) on the DNS server being validated.\n\nLog on to the DNS server using the account designated as Administrator or DNS Administrator.\n\nIf not automatically started, initialize the Server Manager window by clicking its icon from the bottom left corner of the screen.\n\nOnce the Server Manager window is initialized, from the left pane, click to select the DNS category.\n\nFrom the right pane, under the SERVERS section, right-click the DNS server.\n\nFrom the context menu that appears, click DNS Manager.\n\nIn the DNS Manager console tree on the DNS server being validated, navigate to Forward Lookup Zones.\n\nRight-click the zone (repeat for each hosted zone), point to DNSSEC, and then click Sign the Zone, either using approved saved parameters or approved custom parameters.",
        "reference": "800-53|SC-20a.,800-53r5|SC-20a.,CAT|II,CCI|CCI-001178,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-20a.,NESA|T4.5.1,QCSC-v1|5.2.1,Rule-ID|SV-215610r879633_rule,STIG-ID|WDNS-SC-000002,STIG-Legacy|SV-73083,STIG-Legacy|V-58653,Vuln-ID|V-215610",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription | Where { $_.ValidationErrorCode -ne 0 }); if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription ); ''; 'All Zones Compliant'; }"
    },
    "custom_item_43": {
        "description": "WDNS-SC-000003 - The Windows 2012 DNS Servers IP address must be statically defined and configured locally on the server.",
        "info": "The major threat associated with DNS forged responses or failures are the integrity of the DNS data returned in the response. The principle of DNSSEC is to mitigate this threat by providing data origin authentication, establishing trust in the source. By requiring remote clients to obtain origin authentication and integrity verification assurances for the host/service name to network address resolution information obtained through the service, data origin is validated.\n\nEnsuring all name servers have static IP addresses makes it possible to configure restricted DNS communication, such as with DNSSEC, between the name servers.",
        "solution": "Log on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nLocate the 'Network Internet Access' icon, right-click on it and select 'Open Network & Sharing Center'.\n\nClick on 'Change adapter settings'.\n\nRight-click on the Ethernet and click 'Properties'.\n\nSelect Internet Protocol Version 4 (TCP/IPv4) and click 'Properties'.\n\nSelect the 'Use the following IP address' and populate with an IP address, subnet mask, and default gateway.",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53|SC-20(2),800-53r5|CM-6b.,800-53r5|SC-20(2),CAT|II,CCI|CCI-000366,CCI|CCI-002463,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,ITSG-33|SC-20,NESA|T3.2.1,QCSC-v1|5.2.1,Rule-ID|SV-215611r879791_rule,STIG-ID|WDNS-SC-000003,STIG-Legacy|SV-73085,STIG-Legacy|V-58655,SWIFT-CSCv1|2.3,Vuln-ID|V-215611",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$dhcp = Get-WmiObject -Class Win32_NetworkAdapterConfiguration -Filter 'IPEnabled=TRUE and DHCPEnabled=True'; if ($dhcp) { 'Non Compliant Adapters:'; $dhcp } else { Get-WmiObject -Class Win32_NetworkAdapterConfiguration -Filter IPEnabled=TRUE; ''; 'All Adapters Compliant'; }"
    },
    "custom_item_44": {
        "description": "WDNS-SC-000004 - The Windows 2012 DNS Server must return data information in responses to internal name/address resolution queries.",
        "info": "The major threat associated with DNS forged responses or failures is the integrity of the DNS data returned in the response. The principle of DNSSEC is to mitigate this threat by providing data origin authentication, establishing trust in the source. By requiring remote clients to obtain origin authentication and integrity verification assurances for the host/service name to network address resolution information obtained through the service, data origin is validated.",
        "solution": "Sign, or re-sign, the hosted zone(s) on the DNS server being validated.\n\nLog on to the Windows 2012 DNS server using the account designated as Administrator or DNS Administrator.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, right-click to select the zone (repeat for each hosted zone), point to DNSSEC, and then click Sign the Zone, either using approved saved parameters or approved custom parameters.",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53|SC-20(2),800-53r5|CM-6b.,800-53r5|SC-20(2),CAT|II,CCI|CCI-000366,CCI|CCI-002463,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,ITSG-33|SC-20,NESA|T3.2.1,QCSC-v1|5.2.1,Rule-ID|SV-215612r879791_rule,STIG-ID|WDNS-SC-000004,STIG-Legacy|SV-73087,STIG-Legacy|V-58657,SWIFT-CSCv1|2.3,Vuln-ID|V-215612",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription | Where { $_.ValidationErrorCode -ne 0 }); if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription ); ''; 'All Zones Compliant'; }"
    },
    "custom_item_45": {
        "description": "WDNS-SC-000005 - The Windows 2012 DNS Server must use DNSSEC data within queries to confirm data origin to DNS resolvers.",
        "info": "The major threat associated with DNS forged responses or failures are the integrity of the DNS data returned in the response. The principle of DNSSEC is to mitigate this threat by providing data origin authentication, establishing trust in the source. By requiring remote clients to obtain origin authentication and integrity verification assurances for the host/service name to network address resolution information obtained through the service, data origin is validated.\n\nA DNS server is an example of an information system providing name/address resolution service. Digital signatures and cryptographic keys are examples of additional artifacts. DNS resource records are examples of authoritative data. Applications other than the DNS, to map between host/service names and network addresses, must provide other means to assure the authenticity and integrity of response data.\n\nIn the case of DNS, employ DNSSEC to provide an additional data origin and integrity artifacts along with the authoritative data the system returns in response to DNS name/address resolution queries.",
        "solution": "Sign, or re-sign, the hosted zone(s) on the DNS server being validated.\n\nLog on to the Windows 2012 DNS server using the account designated as Administrator or DNS Administrator.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, right-click to select the zone (repeat for each hosted zone), point to DNSSEC, and then click Sign the Zone, either using approved saved parameters or approved custom parameters.",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53|SC-20(2),800-53r5|CM-6b.,800-53r5|SC-20(2),CAT|II,CCI|CCI-000366,CCI|CCI-002464,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,ITSG-33|SC-20,NESA|T3.2.1,QCSC-v1|5.2.1,Rule-ID|SV-215613r879792_rule,STIG-ID|WDNS-SC-000005,STIG-Legacy|SV-73089,STIG-Legacy|V-58659,SWIFT-CSCv1|2.3,Vuln-ID|V-215613",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription | Where { $_.ValidationErrorCode -ne 0 }); if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription ); ''; 'All Zones Compliant'; }"
    },
    "custom_item_46": {
        "description": "WDNS-SC-000006 - WINS lookups must be disabled on the Windows 2012 DNS Server.",
        "info": "The major threat associated with DNS forged responses or failures is the integrity of the DNS data returned in the response. The principle of DNSSEC is to mitigate this threat by providing data origin authentication, establishing trust in the source. By requiring remote clients to obtain origin authentication and integrity verification assurances for the host/service name to network address resolution information obtained through the service, data origin is validated.\n\nA DNS server is an example of an information system providing name/address resolution service. Digital signatures and cryptographic keys are examples of additional artifacts. DNS resource records are examples of authoritative data. Applications other than the DNS, to map between host/service names and network addresses, must provide other means to assure the authenticity and integrity of response data.\n\nIn the case of DNS, employ DNSSEC to provide an additional data origin and integrity artifacts along with the authoritative data the system returns in response to DNS name/address resolution queries.\n\nIf/when WINS lookups are enabled, the validity of the data becomes questionable since the WINS data is provided to the requestor, unsigned and invalidated. In order to be assured only the DNSSEC-signed data is being returned, WINS lookups must be disabled.",
        "solution": "Log on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, right-click each zone, and then click 'Properties'.\n\nIn the 'Properties' dialog box for the zone, click the 'WINS' tab.\n\nUncheck the 'Use WINS forward' lookup check box.\n\nClick 'OK'.",
        "reference": "800-53|SC-20a.,800-53r5|SC-20a.,CAT|II,CCI|CCI-002462,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-20a.,NESA|T4.5.1,QCSC-v1|5.2.1,Rule-ID|SV-215614r879793_rule,STIG-ID|WDNS-SC-000006,STIG-Legacy|SV-73091,STIG-Legacy|V-58661,Vuln-ID|V-215614",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$wins = (Get-DnsServerZone | Select ZoneName, IsWinsEnabled | Where {$_.IsWinsEnabled -eq $true}); if ($wins) { 'Non Compliant Zones:'; $wins } else { (Get-DnsServerZone | Select ZoneName, IsWinsEnabled); ''; 'All Zones Compliant'; }"
    },
    "custom_item_47": {
        "description": "WDNS-SC-000007 - The Windows 2012 DNS Server must use DNSSEC data within queries to confirm data integrity to DNS resolvers.",
        "info": "The major threat associated with DNS forged responses or failures is the integrity of the DNS data returned in the response. The principle of DNSSEC is to mitigate this threat by providing data origin authentication, establishing trust in the source. By requiring remote clients to obtain origin authentication and integrity verification assurances for the host/service name to network address resolution information obtained through the service, data origin is validated.\n\nA DNS server is an example of an information system providing name/address resolution service. Digital signatures and cryptographic keys are examples of additional artifacts. DNS resource records are examples of authoritative data. Applications other than the DNS, to map between host/service names and network addresses, must provide other means to assure the authenticity and integrity of response data.\n\nIn the case of DNS, employ DNSSEC to provide an additional data origin and integrity artifacts along with the authoritative data the system returns in response to DNS name/address resolution queries.",
        "solution": "Sign, or re-sign, the hosted zone(s) on the DNS server being validated.\n\nLog on to the Windows 2012 DNS server using the account designated as Administrator or DNS Administrator.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, right-click to select the zone (repeat for each hosted zone), point to DNSSEC, and then click Sign the Zone, either using approved saved parameters or approved custom parameters.",
        "reference": "800-53|SC-20a.,800-53r5|SC-20a.,CAT|II,CCI|CCI-002462,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-20a.,NESA|T4.5.1,QCSC-v1|5.2.1,Rule-ID|SV-215615r879793_rule,STIG-ID|WDNS-SC-000007,STIG-Legacy|SV-73093,STIG-Legacy|V-58663,Vuln-ID|V-215615",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription | Where { $_.ValidationErrorCode -ne 0 }); if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription ); ''; 'All Zones Compliant'; }"
    },
    "custom_item_48": {
        "description": "WDNS-SC-000008 - The Windows 2012 DNS Server must be configured with the DS RR carrying the signature for the RR that contains the public key of the child zone.",
        "info": "If name server replies are invalid or cannot be validated, many networking functions and communication would be adversely affected. With DNS, the presence of Delegation Signer (DS) records associated with child zones informs clients of the security status of child zones. These records are crucial to the DNSSEC chain of trust model. Each parent domain's DS record is used to verify the DNSKEY record in its sub domain, from the top of the DNS hierarchy down.\n\nA DNS server is an example of an information system providing name/address resolution service. Digital signatures and cryptographic keys are examples of additional artifacts. DNS resource records are examples of authoritative data. Applications other than the DNS, to map between host/service names and network addresses, must provide other means to assure the authenticity and integrity of response data.\n\nIn DNS, trust in the public key of the source is established by starting from a trusted name server and establishing the chain of trust down to the current source of response through successive verifications of signature of the public key of a child by its parent.\n\nA trust anchor is an authoritative entity represented via a public key and associated data. It is used in the context of public key infrastructures, X.509 digital certificates, and Domain Name System Security Extensions (DNSSEC).\n\nWhen there is a chain of trust, usually the top entity to be trusted becomes the trust anchor. A certification path starts with the subject certificate and proceeds through a number of intermediate certificates up to a trusted root certificate. In DNS, a trust anchor is a DNSKEY that is placed into a validating resolver so the validator can cryptographically validate the results for a given request back to a known public key (the trust anchor).\n\nAn example means to indicate the security status of child subspaces is through the use of delegation signer (DS) resource records in the DNS.\n\nPath validation is necessary for a relying party to make an informed trust decision when presented with any certificate not already explicitly trusted. Without path validation and a chain of trust, there can be no trust that the data integrity authenticity has been maintained during a transaction.",
        "solution": "Sign, or re-sign, the hosted zone(s) on the DNS server being validated.\nLog on to the Windows 2012 DNS server using the account designated as Administrator or DNS Administrator.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, right-click to select the zone (repeat for each hosted zone), point to DNSSEC, and then click Sign the Zone, either using approved saved parameters or approved custom parameters.",
        "reference": "800-53|SC-20b.,800-53r5|SC-20b.,CAT|II,CCI|CCI-001179,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-20,QCSC-v1|5.2.1,Rule-ID|SV-215616r879634_rule,STIG-ID|WDNS-SC-000008,STIG-Legacy|SV-73095,STIG-Legacy|V-58665,Vuln-ID|V-215616",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription | Where { $_.ValidationErrorCode -ne 0 }); if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription ); ''; 'All Zones Compliant'; }"
    },
    "custom_item_49": {
        "description": "WDNS-SC-000009 - The Windows 2012 DNS Server must enforce approved authorizations between DNS servers through the use of digital signatures in the RRSet.",
        "info": "A mechanism to detect and prevent unauthorized communication flow must be configured or provided as part of the system design. If information flow is not enforced based on approved authorizations, the system may become compromised. Information flow control regulates where information is allowed to travel within a system and between interconnected systems. The flow of all application information must be monitored and controlled so it does not introduce any unacceptable risk to the systems or data.\n\nApplication-specific examples of enforcement occur in systems that employ rule sets or establish configuration settings that restrict information system services or provide a message filtering capability based on message content (e.g., implementing key word searches or using document characteristics).\n\nApplications providing information flow control must be able to enforce approved authorizations for controlling the flow of information between interconnected systems in accordance with applicable policy.\n\nWithin the context of DNS, this is applicable in terms of controlling the flow of DNS information between systems, such as DNS zone transfers.",
        "solution": "Sign, or re-sign, the hosted zone(s) on the DNS server being validated.\n\nLog on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, click to select the zone.\n\nRight-click the zone (repeat for each hosted zone), point to DNSSEC, and then click Sign the Zone, either using approved saved parameters or approved custom parameters.",
        "reference": "800-53|SC-20b.,800-53r5|SC-20b.,CAT|II,CCI|CCI-001663,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-20,QCSC-v1|5.2.1,Rule-ID|SV-215617r879635_rule,STIG-ID|WDNS-SC-000009,STIG-Legacy|SV-73097,STIG-Legacy|V-58667,Vuln-ID|V-215617",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription | Where { $_.ValidationErrorCode -ne 0 }); if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription ); ''; 'All Zones Compliant'; }"
    },
    "custom_item_50": {
        "description": "WDNS-SC-000010 - The Name Resolution Policy Table (NRPT) must be configured in Group Policy to enforce clients to request DNSSEC validation for a domain.",
        "info": "The Name Resolution Policy Table (NRPT) is used to require DNSSEC validation. The NRPT can be configured in local Group Policy for a single computer or domain Group Policy for some or all computers in the domain.",
        "solution": "Implement this fix for configuring name resolvers, to include DNS servers configured for caching role only.\n\nOn Domain Controller, on the Server Manager menu bar, click Tools, and then click Group Policy Management.\n\nIn the Group Policy Management console tree, under Domains >; domainname >; Group Policy Objects, right-click Default Domain Policy, and then click Edit.\n\nIn the Group Policy Management Editor console tree, navigate to Computer Configuration >; Policies >; Windows Settings >; Name Resolution Policy.\n\nIn the details pane, under Create Rules and to which part of the namespace does this rule apply, choose Suffix from the drop-down list and type domain.mil next to Suffix.\n\nOn the DNSSEC tab, select the Enable DNSSEC in this rule check box and then under Validation select the Require DNS clients to check that name and address data has been validated by the DNS server check box.\n\nIn the bottom right corner, click Create and then verify that a rule for domain.mil was added under Name Resolution Policy Table.\n\nClick Apply, and then close the Group Policy Management Editor.\n\nOpen a Windows PowerShell prompt and enter the following commands:\ngpupdate /forceget-dnsclientnrptpolicyIn the results, select the True for 'DnsSecValidationRequired' setting for the domain.mil namespace.",
        "reference": "800-53|SC-20b.,800-53r5|SC-20b.,CAT|II,CCI|CCI-001663,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-20,QCSC-v1|5.2.1,Rule-ID|SV-215618r879635_rule,STIG-ID|WDNS-SC-000010,STIG-Legacy|SV-73099,STIG-Legacy|V-58669,Vuln-ID|V-215618",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$exist = Get-DnsClientNrptPolicy; $no_validate = (Get-DnsClientNrptPolicy | Where {$_.DnsSecValidationRequired -ne $true} | Select Namespace, DnsSecValidationRequired); if (!($exist)) { 'No DNS Client NRPT Policies defined' } elseif ($no_validate) { 'The following rules are missing DnsSecValidationRequired'; ''; $no_validate } else { Get-DnsClientNrptPolicy | Select Namespace, DnsSecValidationRequired; ''; 'All Settings Compliant' }"
    },
    "custom_item_51": {
        "description": "WDNS-SC-000011 - The Windows 2012 DNS Server must be configured to validate an authentication chain of parent and child domains via response data.",
        "info": "If name server replies are invalid or cannot be validated, many networking functions and communication would be adversely affected. With DNS, the presence of Delegation Signer (DS) records associated with child zones informs clients of the security status of child zones. These records are crucial to the DNSSEC chain of trust model. Each parent domain's DS record is used to verify the DNSKEY record in its sub domain, from the top of the DNS hierarchy down.\nLike the DNSKEY resource record, the delegation signer (DS) resource record can be used to create a trust anchor for a signed zone. The DS record is smaller in size than a DNSKEY record because it contains only a hash of the public key.\nThe DS record is not added to a zone during the signing process like some DNSSEC-related resource records, even if a delegation already exists in the zone. To add a DS record, you must manually add or import it. Fortunately, the DS resource record set (DSSET) is automatically added as a file to the Key Master when a zone is signed. The DSSET file can be used with the Import-DnsServerResourceRecordDS cmdlet to import DS records to the parent zone.\n\nA DNS server is an example of an information system providing name/address resolution service. Digital signatures and cryptographic keys are examples of additional artifacts. DNS resource records are examples of authoritative data. Applications other than the DNS, to map between host/service names and network addresses, must provide other means to assure the authenticity and integrity of response data.\n\nDNSSEC provides the means to verify integrity assurances for the host/service name to network address resolution information obtained through the service. By using the delegation signer (DS) resource records in the DNS, the security status of a child domain can be validated. The DS resource record is used to identify the DNSSEC signing key of a delegated zone.\n\nStarting from a trusted name server (such as the root name server) and down to the current source of response through successive verifications of signature of the public key of a child by its parent, the chain of trust is established. The public key of the trusted name servers is called the trust anchor. After authenticating the source, the next process DNSSEC calls for is to authenticate the response. This requires that responses consist of not only the requested RRs but also an authenticator associated with them. In DNSSEC, this authenticator is the digital signature of a Resource Record (RR) Set. The digital signature of an RRSet is encapsulated through a special RRType called RRSIG. The DNS client using the trusted public key of the source (whose trust has just been established) then verifies the digital signature to detect if the response is valid or bogus.\n\nThis control enables the DNS to obtain origin authentication and integrity verification assurances for the host/service name to network address resolution information obtained through the service. Without indication of the security status of a child domain and enabling verification of a chain of trust, integrity and availability of the DNS infrastructure cannot be assured.",
        "solution": "A DS records must be added manually or imported.\n\nThe DS resource record set (DSSET) is automatically added as a file to the Key Master when a zone is signed.\n\nThis file can be used with the Import-DnsServerResourceRecordDS cmdlet to import DS records to the parent zone.\n\nExample:\nPS C:\\> Import-DnsServerResourceRecordDS -ZoneName adatum.com -DSSetFile 'c:\\windows\\system32\\dns\\dsset-corp.adatum.com'",
        "reference": "800-53|SC-20b.,800-53r5|SC-20b.,CAT|II,CCI|CCI-001663,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-20,QCSC-v1|5.2.1,Rule-ID|SV-215619r879635_rule,STIG-ID|WDNS-SC-000011,STIG-Legacy|SV-73101,STIG-Legacy|V-58671,Vuln-ID|V-215619",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$no_ds = @(); $records = @(); $zones = Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false}; foreach ($zone in $zones) { $ds = Get-DnsServerResourceRecord -ZoneName $zone.ZoneName -RRType 'DS'; $records += $zone.ZoneName; $records += ''; $records += $ds; $recoreds += ''; if (!($ds)) { $no_ds += $zone.ZoneName } } if ($no_ds) { 'The following zones are missing DS records:'; ''; $no_ds } else { $ds; ''; 'All Zones Compliant'} $records"
    },
    "custom_item_52": {
        "description": "WDNS-SC-000012 - Trust anchors must be exported from authoritative Windows 2012 DNS Servers and distributed to validating Windows 2012 DNS Servers.",
        "info": "If name server replies are invalid or cannot be validated, many networking functions and communication would be adversely affected. With DNS, the presence of Delegation Signer (DS) records associated with child zones informs clients of the security status of child zones. These records are crucial to the DNSSEC chain of trust model. Each parent domain's DS record is used to verify the DNSKEY record in its sub domain, from the top of the DNS hierarchy down.\n\nA DNS server is an example of an information system providing name/address resolution service. Digital signatures and cryptographic keys are examples of additional artifacts. DNS resource records are examples of authoritative data. Applications other than the DNS, to map between host/service names and network addresses, must provide other means to assure the authenticity and integrity of response data.\n\nDNSSEC provides the means to verify integrity assurances for the host/service name to network address resolution information obtained through the service. By using the delegation signer (DS) resource records in the DNS, the security status of a child domain can be validated.  The DS resource record is used to identify the DNSSEC signing key of a delegated zone.\n\nStarting from a trusted name server (such as the root name server) and down to the current source of response through successive verifications of signature of the public key of a child by its parent, the chain of trust is established. The public key of the trusted name servers is called the trust anchor. After authenticating the source, the next process DNSSEC calls for is to authenticate the response. This requires that responses consist of not only the requested RRs but also an authenticator associated with them. In DNSSEC, this authenticator is the digital signature of a Resource Record (RR) Set. The digital signature of an RRSet is encapsulated through a special RRType called RRSIG. The DNS client using the trusted public key of the source (whose trust has just been established) then verifies the digital signature to detect if the response is valid or bogus.\n\nThis control enables the DNS to obtain origin authentication and integrity verification assurances for the host/service name to network address resolution information obtained through the service.  Without indication of the security status of a child domain and enabling verification of a chain of trust, integrity and availability of the DNS infrastructure cannot be assured.\n\nA trust anchor is a preconfigured public key associated with a specific zone. A validating DNS server must be configured with one or more trust anchors in order to perform validation. If the DNS server is running on a domain controller, trust anchors are stored in the forest directory partition in Active Directory Domain Services (AD DS) and can be replicated to all domain controllers in the forest. On standalone DNS servers, trust anchors are stored in a file named TrustAnchors.dns. A DNS server running Windows Server 2012 or Windows Server 2012 R2 also displays configured trust anchors in the DNS Manager console tree in the Trust Points container. Trust anchors can also be viewed by executing Windows PowerShell commands or Dnscmd.exe at a Windows command prompt.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Log onto the primary DNS server and click Windows Explorer on the taskbar.\n\nNavigate to C:\\Windows\\System32, right-click the dns folder, point to Share with, and then click Advanced sharing.\n\nIn the dns Properties dialog box, click Advanced Sharing, select the Share this folder check box, verify the Share name is dns, and then click OK.\n\nClick Close and then close Windows Explorer.\n\nLog onto each of the validating Windows 2012 DNS Servers.\n\nIn the DNS Manager console tree, navigate to the Trust Points folder.\n\nRight-click Trust Points, point to Import, and then click DNSKEY.\n\nIn the Import DNSKEY dialog box, type \\\\primaryhost\\dns\\keyset-domain.mil (where primaryhost represent the FQDN of the Primary DNS Server and domain.mil represents the zone(s)).\n\nClick OK.",
        "reference": "800-53|SC-20b.,800-53r5|SC-20b.,CAT|II,CCI|CCI-001663,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-20,QCSC-v1|5.2.1,Rule-ID|SV-215620r879635_rule,STIG-ID|WDNS-SC-000012,STIG-Legacy|SV-73103,STIG-Legacy|V-58673,Vuln-ID|V-215620",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_integrated = Get-DnsServerZone | Where { $_.IsDsIntegrated -eq $false }; if ($non_integrated) { $non_integrated } else { 'All Zones AD Integrated' }"
    },
    "custom_item_53": {
        "description": "WDNS-SC-000013 - Automatic Update of Trust Anchors must be enabled on key rollover.",
        "info": "A trust anchor is a preconfigured public key associated with a specific zone. A validating DNS server must be configured with one or more trust anchors in order to perform validation. If the DNS server is running on a domain controller, trust anchors are stored in the forest directory partition in Active Directory Domain Services (AD DS) and can be replicated to all domain controllers in the forest. On standalone DNS servers, trust anchors are stored in a file named TrustAnchors.dns. A DNS server running Windows Server 2012 or Windows Server 2012 R2 also displays configured trust anchors in the DNS Manager console tree in the Trust Points container. Trust anchors can also be viewed by executing Windows PowerShell commands or Dnscmd.exe at a Windows command prompt.",
        "solution": "Log on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nIf not automatically started, initialize the Server Manager window by clicking its icon from the bottom left corner of the screen.\n\nOnce the Server Manager window is initialized, from the left pane, click to select the DNS category.\n\nFrom the right pane, under the SERVERS section, right-click the DNS server.\n\nFrom the context menu that appears, click DNS Manager.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name and then expand Forward Lookup Zones.\n\nFrom the expanded list, click to select and then right-click the zone name.\n\nFrom the displayed context menu, click DNSSEC>>Properties.\n\nClick the KSK tab.\n\nFor each KSK that is listed under Key signing keys (KSKs), click the KSK, click Edit, and in the Key Rollover section, select the 'Enable automatic rollover' check box.",
        "reference": "800-53|SC-20b.,800-53r5|SC-20b.,CAT|II,CCI|CCI-001663,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-20,QCSC-v1|5.2.1,Rule-ID|SV-215621r879635_rule,STIG-ID|WDNS-SC-000013,STIG-Legacy|SV-73105,STIG-Legacy|V-58675,Vuln-ID|V-215621",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$items = @(); $non_compliant = @(); $zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false -and $_.IsReverseLookupZone -eq $false }); foreach ($zone in $zones) { $keys = (dnscmd /ZoneEnumSKDs $zone.ZoneName | Select-String -Pattern '(^[\\s]*$|(SKD GUID|rollover period|KSK flag))'); foreach ($key in $keys) { if (($key | Out-String).Trim()) { if ($key | Select-String -Pattern 'SKD GUID') { $guid = $key } if ($key | Select-String -Pattern 'rollover period') { if ($guid) { if ($key | Select-String -Pattern 'rollover period[\\s]*=[\\s]*-1') { $non_compliant += $guid; $non_compliant += $key; '' } else { $items += $guid; $items += $key; '' } } } if ($key | Select-String -Pattern 'KSK flag[\\s]*=[\\s]*0') { $guid = ''; } } } } if ($non_compliant) { 'Non Compliant Items:'; $non_compliant } else { $items; ''; 'All Items Compliant'}"
    },
    "custom_item_54": {
        "description": "WDNS-SC-000014 - The Windows DNS secondary servers must request data origin authentication verification from the primary server when requesting name/address resolution.",
        "info": "If data origin authentication and data integrity verification are not performed, the resultant response could be forged, it may have come from a poisoned cache, the packets could have been intercepted without the resolver's knowledge, or resource records could have been removed that would result in query failure or denial of service. Data origin authentication must be performed to thwart these types of attacks.\n\nEach client of name resolution services either performs this validation on its own or has authenticated channels to trusted validation providers. Information systems that provide name and address resolution services for local clients include, for example, recursive resolving or caching DNS servers. DNS client resolvers either perform validation of DNSSEC signatures, or clients use authenticated channels to recursive resolvers that perform such validations.",
        "solution": "Sign, or re-sign, the hosted zone(s) on the DNS server being validated.\n\nLog on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, right-click to select the zone (repeat for each hosted zone), point to DNSSEC, and then click Sign the Zone, either using approved saved parameters or approved custom parameters.",
        "reference": "800-53|SC-21,800-53r5|SC-21,CAT|II,CCI|CCI-002465,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-21,ITSG-33|SC-21a.,NESA|T4.5.1,QCSC-v1|5.2.1,Rule-ID|SV-215622r879794_rule,STIG-ID|WDNS-SC-000014,STIG-Legacy|SV-73107,STIG-Legacy|V-58677,Vuln-ID|V-215622",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription | Where { $_.ValidationErrorCode -ne 0 }); if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription ); ''; 'All Zones Compliant'; }"
    },
    "custom_item_55": {
        "description": "WDNS-SC-000015 - The Windows DNS secondary server must request data integrity verification from the primary server when requesting name/address resolution.",
        "info": "If data origin authentication and data integrity verification are not performed, the resultant response could be forged, it may have come from a poisoned cache, the packets could have been intercepted without the resolver's knowledge, or resource records could have been removed that would result in query failure or denial of service. Data integrity verification must be performed to thwart these types of attacks.\n\nEach client of name resolution services either performs this validation on its own or has authenticated channels to trusted validation providers. Information systems that provide name and address resolution services for local clients include, for example, recursive resolving or caching DNS servers. DNS client resolvers either perform validation of DNSSEC signatures, or clients use authenticated channels to recursive resolvers that perform such validations.",
        "solution": "Sign, or re-sign, the hosted zone(s) on the DNS server being validated.\n\nLog on to the Windows 2012 DNS server using the account designated as Administrator or DNS Administrator.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, right-click to select the zone (repeat for each hosted zone), point to DNSSEC, and then click Sign the Zone, either using approved saved parameters or approved custom parameters.",
        "reference": "800-53|SC-21,800-53r5|SC-21,CAT|II,CCI|CCI-002466,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-21,ITSG-33|SC-21a.,NESA|T4.5.1,QCSC-v1|5.2.1,Rule-ID|SV-215623r879795_rule,STIG-ID|WDNS-SC-000015,STIG-Legacy|SV-73109,STIG-Legacy|V-58679,Vuln-ID|V-215623",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription | Where { $_.ValidationErrorCode -ne 0 }); if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription ); ''; 'All Zones Compliant'; }"
    },
    "custom_item_56": {
        "description": "WDNS-SC-000017 - The Windows DNS secondary server must validate data integrity verification on the name/address resolution responses received from primary name servers.",
        "info": "If data origin authentication and data integrity verification are not performed, the resultant response could be forged, it may have come from a poisoned cache, the packets could have been intercepted without the resolver's knowledge, or resource records could have been removed that would result in query failure or denial of service. Data integrity verification must be performed to thwart these types of attacks.\n\nEach client of name resolution services either performs this validation on its own or has authenticated channels to trusted validation providers. Information systems that provide name and address resolution services for local clients include, for example, recursive resolving or caching DNS servers. DNS client resolvers either perform validation of DNSSEC signatures, or clients use authenticated channels to recursive resolvers that perform such validations.",
        "solution": "Sign, or re-sign, the hosted zone(s) on the DNS server being validated.\n\nLog on to the Windows 2012 DNS server using the account designated as Administrator or DNS Administrator.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, right-click to select the zone (repeat for each hosted zone), point to DNSSEC, and then click Sign the Zone, either using approved saved parameters or approved custom parameters.",
        "reference": "800-53|SC-21,800-53r5|SC-21,CAT|II,CCI|CCI-002467,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-21,ITSG-33|SC-21a.,NESA|T4.5.1,QCSC-v1|5.2.1,Rule-ID|SV-215624r879796_rule,STIG-ID|WDNS-SC-000017,STIG-Legacy|SV-73111,STIG-Legacy|V-58681,Vuln-ID|V-215624",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription | Where { $_.ValidationErrorCode -ne 0 }); if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription ); ''; 'All Zones Compliant'; }"
    },
    "custom_item_57": {
        "description": "WDNS-SC-000018 - The Windows DNS secondary server must validate data origin verification authentication on the name/address resolution responses received from primary name servers.",
        "info": "If data origin authentication and data integrity verification are not performed, the resultant response could be forged, it may have come from a poisoned cache, the packets could have been intercepted without the resolver's knowledge, or resource records could have been removed that would result in query failure or denial of service. Data origin authentication verification must be performed to thwart these types of attacks.\n\nEach client of name resolution services either performs this validation on its own or has authenticated channels to trusted validation providers. Information systems that provide name and address resolution services for local clients include, for example, recursive resolving or caching DNS servers. DNS client resolvers either perform validation of DNSSEC signatures, or clients use authenticated channels to recursive resolvers that perform such validations.",
        "solution": "Sign, or re-sign, the hosted zone(s) on the DNS server being validated.\n\nLog on to the Windows 2012 DNS server using the account designated as Administrator or DNS Administrator.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, right-click to select the zone (repeat for each hosted zone), point to DNSSEC, and then click Sign the Zone, either using approved saved parameters or approved custom parameters.",
        "reference": "800-53|SC-21,800-53r5|SC-21,CAT|II,CCI|CCI-002468,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-21,ITSG-33|SC-21a.,NESA|T4.5.1,QCSC-v1|5.2.1,Rule-ID|SV-215625r879797_rule,STIG-ID|WDNS-SC-000018,STIG-Legacy|SV-73113,STIG-Legacy|V-58683,Vuln-ID|V-215625",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription | Where { $_.ValidationErrorCode -ne 0 }); if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription ); ''; 'All Zones Compliant'; }"
    },
    "custom_item_58": {
        "description": "WDNS-SC-000019 - The Windows 2012 DNS Server must protect the authenticity of zone transfers via transaction signing.",
        "info": "Without identifying devices, unidentified or unknown devices may be introduced, thereby facilitating malicious activity. This applies to server-to-server (zone transfer) transactions and is provided by TSIG/SIG(0), which enforces mutual server authentication using a key that is unique to each server pair (TSIG) or using PKI-based authentication (SIG(0)), thus uniquely identifying the other server.\n\nTSIG and SIG(0) are not configurable in Windows 2012 DNS Server.\n\nTo meet the requirement for authentication between Windows DNS servers, IPsec will be implemented between the Windows DNS servers which hosts any non-AD-integrated zones.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Complete the following procedures twice for each pair of name servers.\n\nFirst create a rule for UDP connections, and then create a rule for TCP connections.\n\nRefer to the U_Windows_Domain_Name_Service_2012_Overview.pdf for Microsoft links for this procedure.\n\nLog on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nPress Windows Key + R, execute gpme.msc to open the Group Policy Management feature.\n\nIn the Browse for Group Policy Object dialog box, double-click Domain Controllers.domain.com.\n\nClick Default Domain Controllers Policy and click OK.\n\nIn the console tree, open Computer Configuration\\Policies\\Windows Settings\\Security Settings\\Windows Firewall with Advanced Security\\Windows Firewall with Advanced Security - LDAP.\n\nRight-Click Connection Security Rules and select New.\n\nFor Rule Type, select the 'Server-to-server' radio button, click Next.\n\nFor Endpoint 1 and Endpoint 2, select 'These IP addresses:' and add the IP addresses of all DNS servers, click Next.\n\nFor Requirements, select 'Request authentication for inbound and outbound connections', click Next.\n\nFor Authentication Method, select Computer certificate and from the 'Signing Algorithm:' drop-down, select 'RSA (default)'.\n\nFrom the 'Certificate store type:' drop-down, select 'Root CA (default).\n\nFrom the 'CA name:', click Browse and select the certificate generated by the internally-managed server performing the Active Directory Certificate Services (AD CS) role, click Next.\n\nOn Profile, accept default selections, click Next.\n\nOn Name, enter a name applicable to the rule's function (i.e., DNSSEC UDP), click Finish.",
        "reference": "800-171|3.13.15,800-53|SC-23,800-53r5|SC-23,CAT|II,CCI|CCI-001184,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-23,ITSG-33|SC-23a.,NESA|T4.5.1,QCSC-v1|5.2.1,Rule-ID|SV-215626r879636_rule,STIG-ID|WDNS-SC-000019,STIG-Legacy|SV-73115,STIG-Legacy|V-58685,Vuln-ID|V-215626",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_integrated = Get-DnsServerZone | Where { $_.IsDsIntegrated -eq $false }; if ($non_integrated) { $non_integrated } else { 'All Zones AD Integrated' }"
    },
    "custom_item_59": {
        "description": "WDNS-SC-000020 - The Windows 2012 DNS Server must protect the authenticity of dynamic updates via transaction signing.",
        "info": "DNS is a fundamental network service that is prone to various attacks, such as cache poisoning and man-in-the middle attacks. If communication sessions are not provided appropriate validity protections, such as the employment of DNSSEC, the authenticity of the data cannot be guaranteed.\n\nThe combination of signing DNS zones by DNSSEC and requiring clients to send their dynamic updates securely assures the authenticity of those DNS records when providing query responses for them.",
        "solution": "Sign, or re-sign, the hosted zone(s) on the DNS server being validated.\n\nLog on to the Windows 2012 DNS server using the account designated as Administrator or DNS Administrator.\n\nIf not automatically started, initialize the Server Manager window by clicking its icon from the bottom left corner of the screen.\n\nOnce the Server Manager window is initialized, from the left pane, click to select the DNS category.\n\nFrom the right pane, under the SERVERS section, right-click the DNS server.\n\nFrom the context menu that appears, click DNS Manager.\n\nIn the DNS Manager console tree on the DNS server being validated, navigate to Forward Lookup Zones.\n\nRight-click the zone (repeat for each hosted zone), point to DNSSEC, and then click Sign the Zone, either using approved saved parameters or approved custom parameters.",
        "reference": "800-171|3.13.15,800-53|SC-23,800-53r5|SC-23,CAT|I,CCI|CCI-001184,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-23,ITSG-33|SC-23a.,NESA|T4.5.1,QCSC-v1|5.2.1,Rule-ID|SV-215627r879636_rule,STIG-ID|WDNS-SC-000020,STIG-Legacy|SV-73117,STIG-Legacy|V-58687,Vuln-ID|V-215627",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription | Where { $_.ValidationErrorCode -ne 0 }); if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription ); ''; 'All Zones Compliant'; }"
    },
    "custom_item_60": {
        "description": "WDNS-SC-000021 - The Windows 2012 DNS Server must protect the authenticity of query responses via DNSSEC.",
        "info": "The underlying feature in the major threat associated with DNS query/response (i.e., forged response or response failure) is the integrity of DNS data returned in the response. An integral part of integrity verification is to ensure that valid data has originated from the right source. DNSSEC is required for securing the DNS query/response transaction by providing data origin authentication and data integrity verification through signature verification and the chain of trust.",
        "solution": "Sign, or re-sign, the hosted zone(s) on the DNS server being validated.\n\nIn the DNS Manager console tree on the DNS server being validated, navigate to Forward Lookup Zones.\n\nRight-click the zone (repeat for each hosted zone), point to DNSSEC, and then click Sign the Zone, either using saved parameters or custom parameters.",
        "reference": "800-171|3.13.15,800-53|SC-23,800-53r5|SC-23,CAT|II,CCI|CCI-001184,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-23,ITSG-33|SC-23a.,NESA|T4.5.1,QCSC-v1|5.2.1,Rule-ID|SV-215628r879636_rule,STIG-ID|WDNS-SC-000021,STIG-Legacy|SV-73119,STIG-Legacy|V-58689,Vuln-ID|V-215628",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription | Where { $_.ValidationErrorCode -ne 0 }); if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription ); ''; 'All Zones Compliant'; }"
    },
    "custom_item_61": {
        "description": "WDNS-SC-000022 - The Windows 2012 DNS Server must only allow the use of an approved DoD PKI-established certificate authorities for verification of the establishment of protected transactions.",
        "info": "Untrusted Certificate Authorities (CA) can issue certificates, but they may be issued by organizations or individuals that seek to compromise DoD systems or by organizations with insufficient security controls. If the CA used for verifying the certificate is not a DoD-approved CA, trust of this CA has not been established.\n\nThe DoD will only accept PKI certificates obtained from a DoD-approved internal or external certificate authority. Reliance on CAs for the establishment of secure sessions includes, for example, the use of SSL/TLS certificates.\n\nTSIG and SIG(0) are not configurable in Windows 2012 DNS Server. To meet the requirement for authentication between Windows DNS servers, IPsec must be implemented between the Windows DNS servers.\n\nNOTE: If multiple certificates from the same CA are present on the DNS server, IPsec authentication might fail due to an incorrect certificate being chosen. For this purpose, an Active Directory Certificate Services (AD CS) role must be installed and configured as an Enterprise certification authority (CA).\n\nRefer to the U_Windows_Domain_Name_Service_2012_Overview.pdf for references on deploying certificates for this procedure.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Complete the following procedures twice for each pair of name servers.\n\nFirst create a rule for UDP connections, and then create a rule for TCP connections.\n\nRefer to the U_Windows_Domain_Name_Service_2012_Overview.pdf for Microsoft links for this procedure.\n\nLog on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nPress Windows Key + R, execute gpme.msc to open the Group Policy Management feature.\n\nIn the Browse for Group Policy Object dialog box, double-click Domain Controllers.domain.com.\n\nClick Default Domain Controllers Policy and click OK.\n\nIn the console tree, open Computer Configuration\\Policies\\Windows Settings\\Security Settings\\Windows Firewall with Advanced Security\\Windows Firewall with Advanced Security - LDAP.\n\nRight-Click Connection Security Rules and select New.\n\nFor Rule Type, select the 'Server-to-server' radio button, click Next.\n\nFor Endpoint 1 and Endpoint 2, select 'These IP addresses:' and add the IP addresses of all DNS servers, click Next.\n\nFor Requirements, select 'Request authentication for inbound and outbound connections', click Next.\n\nFor Authentication Method, select Computer certificate and from the 'Signing Algorithm:' drop-down, select 'RSA (default)'.\n\nFrom the 'Certificate store type:' drop-down, select 'Root CA (default).\n\nFrom the 'CA name:', click Browse and select the certificate generated by the internally-managed server performing the Active Directory Certificate Services (AD CS) role, click Next.\n\nOn Profile, accept default selections, click Next.\n\nOn Name, enter a name applicable to the rule's function (i.e., DNSSEC UDP), click Finish.",
        "reference": "800-171|3.13.15,800-53|SC-23(5),800-53r5|SC-23(5),CAT|II,CCI|CCI-002470,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-23,ITSG-33|SC-23a.,NESA|T4.5.1,QCSC-v1|5.2.1,Rule-ID|SV-215629r879798_rule,STIG-ID|WDNS-SC-000022,STIG-Legacy|SV-73121,STIG-Legacy|V-58691,Vuln-ID|V-215629",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_integrated = Get-DnsServerZone | Where { $_.IsDsIntegrated -eq $false }; if ($non_integrated) { $non_integrated } else { 'All Zones AD Integrated' }"
    },
    "custom_item_62": {
        "description": "WDNS-SC-000025 - The Windows 2012 DNS Server must not contain zone records that have not been validated in over a year.",
        "info": "If zone information has not been validated in over a year, then there is no assurance that it is still valid.  If invalid records are in a zone, then an adversary could potentially use their existence for improper purposes. An SOP detailing this process can resolve this requirement.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Create a separate database to maintain record documentation for non-AD-integrated zones.\n\nDevelop a procedure to validate annually all zone information on the DNS server against the separately maintained database.\n\nLog on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, click to select the zone.\n\nSelect the zone records which have not been validated in over a year and revalidate.",
        "reference": "800-171|3.13.16,800-53|SC-28(1),800-53r5|SC-28(1),CAT|I,CCI|CCI-002475,CN-L3|8.1.4.7(b),CN-L3|8.1.4.8(b),CSF|PR.DS-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(e)(2)(ii),ITSG-33|SC-28(1),PCI-DSSv3.2.1|3.4,PCI-DSSv4.0|3.3.2,PCI-DSSv4.0|3.5.1,QCSC-v1|5.2.2,QCSC-v1|6.2,Rule-ID|SV-215631r953852_rule,STIG-ID|WDNS-SC-000025,STIG-Legacy|SV-73125,STIG-Legacy|V-58695,TBA-FIISB|28.1,Vuln-ID|V-215631",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_integrated = Get-DnsServerZone | Where { $_.IsDsIntegrated -eq $false }; if ($non_integrated) { $zones = Get-DnsServerZone; foreach ($zone in $zones) { $zone.ZoneName + ':'; ''; Get-DnsServerResourceRecord -ZoneName $zone.ZoneName } } else { 'All Zones AD Integrated' }"
    },
    "custom_item_63": {
        "description": "SeRemoteInteractiveLogonRight",
        "value_data": "Administrators"
    },
    "custom_item_64": {
        "description": "SeDenyNetworkLogonRight",
        "value_data": "Guests"
    },
    "custom_item_65": {
        "description": "SeDenyInteractiveLogonRight",
        "value_data": "Guests"
    },
    "custom_item_66": {
        "description": "WDNS-SC-000027 - The Windows 2012 DNS Server must use DNS Notify to prevent denial of service through increase in workload.",
        "info": "In the case of application DoS attacks, care must be taken when designing the application to ensure the application makes the best use of system resources. SQL queries have the potential to consume large amounts of CPU cycles if they are not tuned for optimal performance. Web services containing complex calculations requiring large amounts of time to complete can bog down if too many requests for the service are encountered within a short period of time.",
        "solution": "Log on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, click to select the zone.\n\nIn the list of hosts, review the Name Server (NS) records. Determine if any of the hosts listed as NS records are non-AD-integrated servers.\n\nIf the DNS server only hosts AD-integrated zones and there are not any non-AD-integrated DNS servers acting as secondary DNS servers for the zones, this check is Not Applicable.\n\nFor a non-AD-integrated DNS server, Log on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name and then expand Forward Lookup Zones.\n\nFrom the expanded list, click to select and then right-click the zone name.\n\nFrom the displayed context menu, click the 'Properties' option.\n\nOn the opened zone's properties box, go to the 'Zone Transfers' tab.\n\nOn the displayed interface, verify if the 'Allow zone transfers' check box is selected.\n\nIf the 'Allow zone transfers' check box is selected, click on the 'Notify' button and enable Notify to the non-AD-integrated DNS servers.",
        "reference": "800-53|SC-5(2),800-53r5|SC-5(2),CAT|II,CCI|CCI-001095,CSF|PR.DS-4,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-5(2),NESA|T3.3.1,NIAv2|GS8e,NIAv2|GS10c,QCSC-v1|8.2.1,Rule-ID|SV-215633r879651_rule,STIG-ID|WDNS-SC-000027,STIG-Legacy|SV-73129,STIG-Legacy|V-58699,SWIFT-CSCv1|6.4,Vuln-ID|V-215633",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = (Get-DnsServerZone | Select ZoneName, IsDsIntegrated, Notify | Where { $_.IsDsIntegrated -eq $false -And $_.Notify -eq 'NoNotify' }); if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { Get-DnsServerZone | Select ZoneName, IsDsIntegrated, Notify; ''; 'All Zones Compliant'; }"
    },
    "custom_item_67": {
        "description": "WDNS-SC-000028 - The Windows 2012 DNS Server must protect the integrity of transmitted information.",
        "info": "Without protection of the transmitted information, confidentiality and integrity may be compromised since unprotected communications can be intercepted and either read or altered.\n\nCommunication paths outside the physical protection of a controlled boundary are exposed to the possibility of interception and modification. Protecting the confidentiality and integrity of organizational information can be accomplished by physical means (e.g., employing physical distribution systems) or by logical means (e.g., employing cryptographic techniques). If physical means of protection are employed, then logical means (cryptography) do not have to be employed, and vice versa.\n\nConfidentiality is not an objective of DNS, but integrity is. DNSSEC and TSIG/SIG(0) both digitally sign DNS information to authenticate its source and ensure its integrity.",
        "solution": "Sign, or re-sign, the hosted zone(s) on the DNS server being validated.\n\nLog on to the Windows 2012 DNS server using the account designated as Administrator or DNS Administrator.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, right-click to select the zone (repeat for each hosted zone), point to DNSSEC, and then click Sign the Zone, either using approved saved parameters or approved custom parameters.",
        "reference": "800-171|3.13.8,800-53|SC-8,800-53r5|SC-8,CAT|II,CCI|CCI-002418,CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CSF|PR.DS-2,CSF|PR.DS-5,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),ITSG-33|SC-8,ITSG-33|SC-8a.,NESA|T4.3.1,NESA|T4.3.2,NESA|T4.5.1,NESA|T4.5.2,NESA|T7.3.3,NESA|T7.4.1,NIAv2|IE8,NIAv2|IE9,NIAv2|IE12,NIAv2|NS29,NIAv2|SS24,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,Rule-ID|SV-215634r917686_rule,STIG-ID|WDNS-SC-000028,STIG-Legacy|SV-73131,STIG-Legacy|V-58701,Vuln-ID|V-215634",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription | Where { $_.ValidationErrorCode -ne 0 }); if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription ); ''; 'All Zones Compliant'; }"
    },
    "custom_item_68": {
        "description": "WDNS-SC-000029 - The Windows 2012 DNS Server must maintain the integrity of information during preparation for transmission.",
        "info": "Information can be either unintentionally or maliciously disclosed or modified during preparation for transmission, including, for example, during aggregation, at protocol transformation points, and during packing/unpacking. These unauthorized disclosures or modifications compromise the confidentiality or integrity of the information.",
        "solution": "Sign, or re-sign, the hosted zone(s) on the DNS server being validated.\n\nLog on to the Windows 2012 DNS server using the account designated as Administrator or DNS Administrator.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, right-click to select the zone (repeat for each hosted zone), point to DNSSEC, and then click Sign the Zone, either using approved saved parameters or approved custom parameters.",
        "reference": "800-171|3.13.8,800-53|SC-8(1),800-53r5|SC-8(1),CAT|II,CCI|CCI-002421,CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CSF|PR.DS-2,CSF|PR.DS-5,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8(1),NESA|T7.4.1,NIAv2|NS5d,NIAv2|NS6b,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,Rule-ID|SV-215635r879812_rule,STIG-ID|WDNS-SC-000029,STIG-Legacy|SV-73133,STIG-Legacy|V-58703,SWIFT-CSCv1|2.1,TBA-FIISB|29.1,Vuln-ID|V-215635",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription | Where { $_.ValidationErrorCode -ne 0 }); if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription ); ''; 'All Zones Compliant'; }"
    },
    "custom_item_69": {
        "description": "WDNS-SC-000030 - The Windows 2012 DNS Server must maintain the integrity of information during reception.",
        "info": "Information can be either unintentionally or maliciously disclosed or modified during preparation for transmission, including, for example, during aggregation, at protocol transformation points, and during packing/unpacking. These unauthorized disclosures or modifications compromise the confidentiality or integrity of the information.",
        "solution": "Sign, or re-sign, the hosted zone(s) on the DNS server being validated.\n\nLog on to the Windows 2012 DNS server using the Domain Admin or Enterprise Admin account.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, right-click to select the zone (repeat for each hosted zone), point to DNSSEC, and then click Sign the Zone, either using approved saved parameters or approved custom parameters.",
        "reference": "800-171|3.13.8,800-53|SC-8(2),800-53r5|SC-8(2),CAT|II,CCI|CCI-002420,CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CSF|PR.DS-2,CSF|PR.DS-5,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),ITSG-33|SC-8(2),ITSG-33|SC-9(2),NESA|T4.3.1,NESA|T4.3.2,NESA|T4.5.1,NESA|T4.5.2,NESA|T7.3.3,NESA|T7.4.1,NIAv2|IE8,NIAv2|IE9,NIAv2|IE12,NIAv2|NS29,NIAv2|SS24,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,Rule-ID|SV-215636r879813_rule,STIG-ID|WDNS-SC-000030,STIG-Legacy|SV-73135,STIG-Legacy|V-58705,SWIFT-CSCv1|2.1,Vuln-ID|V-215636",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription | Where { $_.ValidationErrorCode -ne 0 }); if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription ); ''; 'All Zones Compliant'; }"
    },
    "custom_item_70": {
        "description": "WDNS-SC-000031 - The Windows 2012 DNS Server must implement NIST FIPS-validated cryptography for provisioning digital signatures, generating cryptographic hashes, and protecting unclassified information requiring confidentiality.",
        "info": "Use of weak or untested encryption algorithms undermines the purposes of utilizing encryption to protect data. The application must implement cryptographic modules adhering to the higher standards approved by the federal government since this provides assurance they have been tested and validated.\n\nThe choice of digital signature algorithm will be based on recommended algorithms in well-known standards. NIST's Digital Signature Standard (DSS) [FIPS186] provides three algorithm choices:\n* Digital Signature Algorithm (DSA)\n* RSA\n* Elliptic Curve DSA (ECDSA).\n\nOf these three algorithms, RSA and DSA are more widely available and considered candidates of choice for DNSSEC. In terms of performance, both RSA and DSA have comparable signature generation speeds, but DSA is much slower for signature verification. RSA is the recommended algorithm as far as this guideline is concerned.\n\nRSA with SHA-1 is currently the only cryptographic algorithm mandated to be implemented with DNSSEC, although other algorithm suites (i.e. RSA/SHA-256, ECDSA) are also specified.\n\nIt can be expected that name servers and clients will be able to use the RSA algorithm at the minimum. It is suggested that at least one ZSK for a zone use the RSA algorithm.\n\nNIST's Secure Hash Standard (SHS) (FIPS 180-3) specifies SHA-1, SHA-224, SHA-256, SHA-384, and SHA-512 as approved hash algorithms to be used as part of the algorithm suite for generating digital signatures using the digital signature algorithms in the NIST's DSS[FIPS186]. It is expected that there will be support for Elliptic Curve Cryptography in the DNSSEC. The migration path for USG DNSSEC operation will be to ECDSA (or similar) from RSA/SHA-1 and RSA/SHA-256 before September 30th, 2015.",
        "solution": "Sign or re-sign, the hosted zone(s) on the DNS server being validated.\n\nLog on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, right-click to select the zone (repeat for each hosted zone), point to DNSSEC, and then click 'Sign the Zone', either using approved saved parameters or approved custom parameters.",
        "reference": "800-171|3.13.11,800-53|SC-13,800-53r5|SC-13,CAT|II,CCI|CCI-002450,CSF|PR.DS-5,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(e)(2)(ii),ISO/IEC-27001|A.10.1.1,ITSG-33|SC-13,ITSG-33|SC-13a.,NESA|M5.2.6,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5e,QCSC-v1|6.2,Rule-ID|SV-215637r879885_rule,STIG-ID|WDNS-SC-000031,STIG-Legacy|SV-72987,STIG-Legacy|V-58557,Vuln-ID|V-215637",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_compliant_zones = (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription | Where { $_.ValidationErrorCode -ne 0 }); if ($non_compliant_zones) { 'Non Compliant Zones:'; $non_compliant_zones } else { (Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false } | Test-DnsServerDnsSecZoneSetting | Select ZoneName, ValidationErrorCode, ValidationErrorCodeDescription ); ''; 'All Zones Compliant'; }"
    },
    "custom_item_71": {
        "description": "WDNS-SI-000002 - The Windows 2012 DNS Server must follow procedures to re-role a secondary name server as the master name server should the master name server permanently lose functionality.",
        "info": "Failing to an unsecure condition negatively impacts application security and can lead to system compromise. Failure conditions include, for example, loss of communications among critical system components or between system components and operational facilities. Fail-safe procedures include, for example, alerting operator personnel and providing specific instructions on subsequent steps to take (e.g., do nothing, reestablish system settings, shutdown processes, restart the system, or contact designated organizational personnel).\n\nIf a component such as the DNSSEC or TSIG/SIG(0) signing capabilities were to fail, the DNS server should shut itself down to prevent continued execution without the necessary security components in place. Transactions such as zone transfers would not be able to work correctly anyway in this state.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Active Directory-integrated DNS servers will handle the promotion of a secondary DNS server whenever a primary DNS server loses functionality.\n\nDevelop, test, and implement documented procedures for re-roling a non-AD-integrated secondary name server to a master name server role in the event a master name server loses functionality.",
        "reference": "800-53|SI-10(3),800-53r5|SI-10(3),CAT|II,CCI|CCI-002754,CN-L3|8.1.4.4(d),DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-10,ITSG-33|SI-10a.,NESA|T7.3.1,NIAv2|SS6e,Rule-ID|SV-215639r879822_rule,STIG-ID|WDNS-SI-000002,STIG-Legacy|SV-73139,STIG-Legacy|V-58709,Vuln-ID|V-215639",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$non_integrated = Get-DnsServerZone | Where { $_.IsDsIntegrated -eq $false }; if ($non_integrated) { $non_integrated } else { 'All Zones AD Integrated' }"
    },
    "custom_item_72": {
        "description": "WDNS-SI-000003 - The DNS Name Server software must be configured to refuse queries for its version information.",
        "info": "Each newer version of the name server software, especially the BIND software, generally is devoid of vulnerabilities found in earlier versions because it has design changes incorporated to take care of those vulnerabilities. Of course, these vulnerabilities have been exploited (i.e., some form of attack was launched), and sufficient information has been generated with respect to the nature of those exploits. Thus, it makes good business sense to run the latest version of name server software because theoretically it is the safest version.\n\nIn some installations, it may not be possible to switch over to the latest version of name server software immediately. If the version of the name server software is revealed in queries, this information may be used by attackers who are looking for a specific version of the software which has a discovered weakness. To prevent information about which version of name server software is running on a system, name servers should be configured to refuse queries for its version information.",
        "solution": "To disable the version being returned in queries, execute the following command:\n\ndnscmd /config /EnableVersionQuery 0",
        "reference": "800-53|SI-11a.,800-53r5|SI-11a.,CAT|II,CCI|CCI-001312,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-11b.,Rule-ID|SV-215640r879710_rule,STIG-ID|WDNS-SI-000003,STIG-Legacy|SV-73167,STIG-Legacy|V-58737,Vuln-ID|V-215640",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "(Get-DnsServerSetting -All).EnableVersionQuery"
    },
    "custom_item_73": {
        "description": "WDNS-SI-000004 - The HINFO, RP, TXT and LOC RR types must not be used in the zone SOA.",
        "info": "There are several types of RRs in the DNS that are meant to convey information to humans and applications about the network, hosts, or services. These RRs include the Responsible Person (RP) record, the Host Information (HINFO) record, the Location (LOC) record, and the catch-all text string resource record (TXT) [RFC1035]. Although these record types are meant to provide information to users in good faith, they also allow attackers to gain knowledge about network hosts before attempting to exploit them. For example, an attacker may query for HINFO records, looking for hosts that list an OS or platform known to have exploits.\n\nTherefore, great care should be taken before including these record types in a zone. In fact, they are best left out altogether.\n\nMore careful consideration should be taken with the TXT resource record type. A DNS administrator will have to decide if the data contained in a TXT RR constitutes an information leak or is a necessary piece of information. For example, several authenticated email technologies use TXT RR's to store email sender policy information such as valid email senders for a domain. These judgments will have to be made on a case-by-case basis.\n\nA DNS administrator should take care when including HINFO, RP, TXT, LOC, or other RR types that could divulge information that would be useful to an attacker or the external view of a zone if using split DNS.\n\nRRs such as HINFO and TXT provide information about software name and versions (e.g., for resources such as Web servers and mail servers) that will enable the well-equipped attacker to exploit the known vulnerabilities in those software versions and launch attacks against those resources.",
        "solution": "Log on to the DNS server using the Domain Admin or Enterprise Admin account or Local Administrator account.\n\nPress Windows Key + R, execute dnsmgmt.msc.\n\nOn the opened DNS Manager snap-in from the left pane, expand the server name for the DNS server, and then expand Forward Lookup Zones.\n\nFrom the expanded list, click to select the zone.\n\nRemove all HINFO, RP, TXT, and LOC RRs from all zones hosted by the DNS Server.",
        "reference": "800-53|SI-11a.,800-53r5|SI-11a.,CAT|II,CCI|CCI-001312,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-11b.,Rule-ID|SV-215641r879710_rule,STIG-ID|WDNS-SI-000004,STIG-Legacy|SV-73169,STIG-Legacy|V-58739,Vuln-ID|V-215641",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "powershell_args": "$records = (Get-DnsServerZone | Get-DnsServerResourceRecord | Where {$_.RecordType -eq 'HINFO' -Or $_.RecordType -eq 'RP' -Or $_.RecordType -eq 'LOC' -Or $_.RecordType -eq 'TXT' }); if ($records) { 'The following records were found:'; $records } else { 'No HINFO, RP, TXT or LOC records found'}"
    },
    "custom_item_74": {
        "description": "WDNS-SI-000006 - The Windows 2012 DNS Server must perform verification of the correct operation of security functions: upon system start-up and/or restart; upon command by a user with privileged access; and/or every 30 days.",
        "info": "Security function is defined as the hardware, software, and/or firmware of the information system responsible for enforcing the system security policy and supporting the isolation of code and data on which the protection is based. Security functionality includes, but is not limited to, establishing system accounts, configuring access authorizations (i.e., permissions, privileges), setting events to be audited, and setting intrusion detection parameters. Without verification, security functions may not operate correctly and this failure may go unnoticed.\n\nNotifications provided by information systems include, for example, electronic alerts to system administrators, messages to local computer consoles, and/or hardware indications, such as lights.\n\nThe DNS server should perform self-tests, such as at server start-up, to confirm that its security functions are working properly.",
        "solution": "Follow the ESS guidance to install all ESS products on the Windows DNS Server.",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53|SI-17,800-53r5|CM-6b.,800-53r5|SI-17,CAT|II,CCI|CCI-000366,CCI|CCI-002775,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|Microsoft_Windows_2012_Server_Domain_Name_System_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,ITSG-33|SI-17,NESA|T3.2.1,QCSC-v1|3.2,Rule-ID|SV-215643r879844_rule,STIG-ID|WDNS-SI-000006,STIG-Legacy|SV-73143,STIG-Legacy|V-58713,SWIFT-CSCv1|2.3,Vuln-ID|V-215643",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_2012_Server_DNS_V2R6_STIG.zip",
        "value_data": "HBSS is installed and running",
        "powershell_args": "IAAkAHMAZQByAHYAaQBjAGUAIAA9ACAAKABHAGUAdAAtAFcATQBJAE8AYgBqAGUAYwB0ACAAVwBpAG4AMwAyAF8AUwBlAHIAdgBpAGMAZQAgAC0ARQByAHIAbwByAEEAYwB0AGkAbwBuACAAUwB0AG8AcAAgAHwAIABXAGgAZQByAGUALQBPAGIAagBlAGMAdAAgAC0AUAByAG8AcABlAHIAdAB5ACAATgBhAG0AZQAgAC0AbABpAGsAZQAgACcAbQBhAHMAdgBjACcAIAB8ACAAUwBlAGwAZQBjAHQALQBPAGIAagBlAGMAdAAgAE4AYQBtAGUALAAgAEQAaQBzAHAAbABhAHkATgBhAG0AZQAsACAAUwB0AGEAcgB0AGUAZAAsACAAUwB0AGEAdABlACkADQAKAA0ACgAkAGEAZwBlAG4AdAAgAD0AIAAoAEcAZQB0AC0AVwBNAEkATwBiAGoAZQBjAHQAIABXAGkAbgAzADIAXwBQAHIAbwBkAHUAYwB0ACAALQBFAHIAcgBvAHIAQQBjAHQAaQBvAG4AIABTAHQAbwBwACAAfAAgAFcAaABlAHIAZQAtAE8AYgBqAGUAYwB0ACAALQBQAHIAbwBwAGUAcgB0AHkAIABOAGEAbQBlACAALQBsAGkAawBlACAAJwBNAGMAQQBmAGUAZQAgAEEAZwBlAG4AdAAnACAAfAAgAFMAZQBsAGUAYwB0AC0ATwBiAGoAZQBjAHQAIABOAGEAbQBlACwAIABWAGUAcgBzAGkAbwBuACkADQAKAA0ACgANAAoAaQBmACAAKAAhACQAcwBlAHIAdgBpAGMAZQAgAC0AbwByACAAIQAkAGEAZwBlAG4AdAAgACkAIAB7AA0ACgANAAoAIAAgACAAIABXAHIAaQB0AGUALQBIAG8AcwB0ACAAJwBIAEIAUwBTACAAaQBzACAAbgBvAHQAIABpAG4AcwB0AGEAbABsAGUAZAAnACAAIAANAAoAfQANAAoADQAKAA0ACgBlAGwAcwBlAGkAZgAgACgAJABzAGUAcgB2AGkAYwBlAC4AUwB0AGEAdABlACAALQBlAHEAIAAnAFIAdQBuAG4AaQBuAGcAJwAgAC0AQQBuAGQAIAAkAHMAZQByAHYAaQBjAGUALgBTAHQAYQByAHQAZQBkACAALQBlAHEAIAAnAFQAcgB1AGUAJwAgAC0AQQBuAGQAIAAkAGEAZwBlAG4AdAAuAHYAZQByAHMAaQBvAG4AIAAtAGcAZQAgACcANAAnACkAIAB7ACAADQAKAA0ACgAgACAAIAAgAFcAcgBpAHQAZQAtAEgAbwBzAHQAIAAnAEgAQgBTAFMAIABpAHMAIABpAG4AcwB0AGEAbABsAGUAZAAgAGEAbgBkACAAcgB1AG4AbgBpAG4AZwAnACAADQAKAA0ACgB9ACAADQAKAA0ACgBlAGwAcwBlAGkAZgAgACgAJABzAGUAcgB2AGkAYwBlAC4AUwB0AGEAdABlACAALQBuAGUAIAAnAFIAdQBuAG4AaQBuAGcAJwAgAC0AbwByACAAJABzAGUAcgB2AGkAYwBlAC4AUwB0AGEAcgB0AGUAZAAgAC0AZQBxACAAJwBGAGEAbABzAGUAJwApACAAewANAAoADQAKACAAIAAgACAAVwByAGkAdABlAC0ASABvAHMAdAAgACcASABCAFMAUwAgAGkAcwAgAG4AbwB0ACAAcgB1AG4AbgBpAG4AZwAnAA0ACgANAAoAfQANAAoADQAKAGUAbABzAGUAIAB7ACAADQAKACAAIAAgACAAVwByAGkAdABlAC0ASABvAHMAdAAgACcAUwBvAG0AZQB0AGgAaQBuAGcAIABlAGwAcwBlACAAaQBzACAAdwByAG8AbgBnACcADQAKAH0AIAA="
    },
    "custom_item_75": {
        "description": "Check if non Active Directory integrated zone exist",
        "value_data": "Non AD Integrated zones exist",
        "powershell_args": "$non_integrated = Get-DnsServerZone | Where {$_.IsDsIntegrated -eq $false} ); if ($non_integrated) {'Non AD Integrated zones exist'}"
    }
}