{
    "custom_item_1": {
        "description": "SQL6-D0-003600 - SQL Server must limit the number of concurrent sessions to an organization-defined number per user for all accounts and/or account types.",
        "info": "Database management includes the ability to control the number of users and user sessions utilizing SQL Server. Unlimited concurrent connections to SQL Server could allow a successful Denial of Service (DoS) attack by exhausting connection resources; and a system can also fail or be degraded by an overload of legitimate users. Limiting the number of concurrent sessions per user is helpful in reducing these risks.\n\nThis requirement addresses concurrent session control for a single account. It does not address concurrent sessions by a single user via multiple system accounts; and it does not deal with the total number of sessions across all accounts.\n\nThe capability to limit the number of concurrent sessions per user must be configured in or added to SQL Server (for example, by use of a logon trigger), when this is technically feasible. Note that it is not sufficient to limit sessions via a web server or application server alone, because legitimate users and adversaries can potentially connect to SQL Server by other means.\n\nThe organization will need to define the maximum number of concurrent sessions by account type, by account, or a combination thereof. In deciding on the appropriate number, it is important to consider the work requirements of the various types of users. For example, 2 might be an acceptable limit for general users accessing the database via an application; but 10 might be too few for a database administrator using a database management GUI tool, where each query tab and navigation pane may count as a separate session.\n\n(Sessions may also be referred to as connections or logons, which for the purposes of this requirement are synonyms.)\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Establish the limit(s) appropriate to the type(s) of user account accessing the SQL Server instance, and record them in the system documentation. Implement one or more logon triggers to enforce the limit(s), without exposing the dynamic management views to general users.\n\nExample script below:\n\nCREATE TRIGGER SQL_STIG_Connection_Limit\nON ALL SERVER WITH EXECUTE AS 'renamed_sa' /*Make sure to use the renamed SA account here*/\nFOR LOGON\nAS\nBEGIN\nIf (Select COUNT(1) from sys.dm_exec_sessions WHERE is_user_process = 1 AND original_login_name = ORIGINAL_LOGIN() ) >\n  (CASE ORIGINAL_LOGIN()\n              WHEN 'renamed_sa' THEN 40  /*i.e. the renamed system administrator SQL Login can have up to 40 concurrent logins... */\n              WHEN 'domain\\ima.dba' THEN 150 /*this is a busy DBA's domain account */\n              WHEN 'application1_login' THEN 6 /* this is a SQL login for an application */\n              WHEN 'application2_login' THEN 20 /* this is a SQL login for another application */\n              ...\n              ELSE 1 /* All unspecified users are restricted to a single login */\n  END)\n              BEGIN\n                             PRINT 'The login [' + ORIGINAL_LOGIN() + '] has exceeded its concurrent session limit.'\n                             ROLLBACK;\n              END\nEND;\n\nReference:  https://msdn.microsoft.com/en-us/library/ms189799.aspx",
        "reference": "800-53|AC-10,800-53r5|AC-10,CAT|II,CCI|CCI-000054,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|AC-10,NESA|T5.5.1,QCSC-v1|5.2.1,QCSC-v1|5.2.2,Rule-ID|SV-213929r951659_rule,STIG-ID|SQL6-D0-003600,STIG-Legacy|SV-93825,STIG-Legacy|V-79119,Vuln-ID|V-213929",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT name FROM master.sys.server_triggers",
        "sql_expect": "ManualReviewRequired"
    },
    "custom_item_2": {
        "description": "SQL6-D0-003700 - SQL Server must integrate with an organization-level authentication/access mechanism providing account management and automation for all users, groups, roles, and any other principals.",
        "info": "Enterprise environments make account management for applications and databases challenging and complex. A manual process for account management functions adds the risk of a potential oversight or other error. Managing accounts for the same person in multiple places is inefficient and prone to problems with consistency and synchronization.\n\nA comprehensive application account management process that includes automation helps to ensure that accounts designated as requiring attention are consistently and promptly addressed.\n\nExamples include, but are not limited to, using automation to take action on multiple accounts designated as inactive, suspended, or terminated, or by disabling accounts located in non-centralized account stores, such as multiple servers. Account management functions can also include: assignment of group or role membership; identifying account type; specifying user access authorizations (i.e., privileges); account removal, update, or termination; and administrative alerts. The use of automated mechanisms can include, for example, using email or text messaging to notify account managers when users are terminated or transferred; using the information system to monitor account usage; and using automated telephone notification to report atypical system account usage.\n\nSQL Server must be configured to automatically utilize organization-level account management functions, and these functions must immediately enforce the organization's current account policy.\n\nAutomation may be composed of differing technologies that when placed together contain an overall mechanism supporting an organization's automated account management requirements.",
        "solution": "If mixed mode is required, document the need and justification; describe the measures taken to ensure the use of SQL Server authentication is kept to a minimum; describe the measures taken to safeguard passwords; list or describe the SQL Logins used.\n\nRisk must be accepted by the ISSO/ISSM.\n\nIf mixed mode is not required, disable it as follows:\n\nIn the SSMS Object Explorer, right-click on the server instance.\nSelect 'Properties'.\nSelect the Security page.\nClick on the radio button for 'Windows Authentication Mode'.\nClick on 'OK'.\nRestart the SQL Server instance.\n\nOR\n\nRun the statement:\nUSE [master]\nEXEC xp_instance_regwrite N'HKEY_LOCAL_MACHINE', N'Software\\Microsoft\\MSSQLServer\\MSSQLServer', N'LoginMode', REG_DWORD, 2\nGO\n\nRestart the SQL Server instance.\n\nFor each account being managed by SQL Server but not requiring it, drop or disable the SQL Login. Replace it with an appropriately configured account, as needed.\n\nTo drop or disable a login in the SSMS Object Explorer:\nNavigate to 'Security Logins'.\nRight-click on the login name; click 'Delete' or 'Disable'.\n\nTo drop or disable a login by using a query:\nUSE master;\nDROP LOGIN login_name;\nALTER LOGIN login_name DISABLE;\n\nDropping a login does not delete the equivalent database user(s). There may be more than one database containing a user mapped to the login. Drop the user(s) unless still needed.\n\nTo drop a user in the SSMS Object Explorer:\nNavigate to Databases >> Security Users.\nRight-click on the user name.\nClick 'Delete'.\n\nTo drop a user via a query:\nUSE database_name;\nDROP USER;",
        "reference": "800-171|3.1.1,800-53|AC-2(1),800-53r5|AC-2(1),CAT|I,CCI|CCI-000015,CN-L3|7.1.3.2(d),CSF|PR.AC-1,CSF|PR.AC-4,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2(1),NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,Rule-ID|SV-213930r879522_rule,STIG-ID|SQL6-D0-003700,STIG-Legacy|SV-93827,STIG-Legacy|V-79121,Vuln-ID|V-213930",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT CASE SERVERPROPERTY('IsIntegratedSecurityOnly') WHEN 1 THEN 'Windows Authentication' WHEN 0 THEN 'Windows and SQL Server Authentication' END as [Authentication Mode]",
        "sql_expect": "Windows Authentication"
    },
    "custom_item_3": {
        "description": "SQL6-D0-004100 - SQL Server must protect against a user falsely repudiating by ensuring the NT AUTHORITY SYSTEM account is not used for administration - clustering and availability",
        "info": "Non-repudiation of actions taken is required in order to maintain data integrity. Examples of particular actions taken by individuals include creating information, sending a message, approving information (e.g., indicating concurrence or signing a contract), and receiving a message.\n\nNon-repudiation protects against later claims by a user of not having created, modified, or deleted a particular data item or collection of data in the database.\n\nIn designing a database, the organization must define the types of data and the user actions that must be protected from repudiation. The implementation must then include building audit features into the application data tables and configuring the DBMS's audit tools to capture the necessary audit trail. Design and implementation also must ensure that applications pass individual user identification to the DBMS, even where the application connects to the DBMS with a standard, shared account.\n\nAny user with enough access to the server can execute a task that will be run as NT AUTHORITY\\SYSTEM either using task scheduler or other tools. At this point, NT AUTHORITY\\SYSTEM essentially becomes a shared account because the operating system and SQL Server are unable to determine who created the process.\n\nPrior to SQL Server 2012, NT AUTHORITY\\SYSTEM was a member of the sysadmin role by default. This allowed jobs/tasks to be executed in SQL Server without the approval or knowledge of the DBA because it looked like operating system activity.",
        "solution": "Remove permissions that were identified as not allowed in the check content.\n\nUSE Master;\n\nREVOKETO [NT AUTHORITY\\SYSTEM]\n\nGO\n\n\nTo grant permissions to services or applications, utilize the Service SID of the service or a domain service account.",
        "reference": "800-53|AU-10,800-53r5|AU-10,CAT|II,CCI|CCI-000166,CSF|PR.PT-1,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-10,NESA|T4.3.1,NESA|T7.3.3,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-213934r944382_rule,STIG-ID|SQL6-D0-004100,STIG-Legacy|SV-93835,STIG-Legacy|V-79129,Vuln-ID|V-213934",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT SERVERPROPERTY('IsClustered') AS [IsClustered], SERVERPROPERTY('IsHadrEnabled') AS [IsHadrEnabled]",
        "sql_expect": "[01]"
    },
    "custom_item_4": {
        "description": "Check if IsClustered is 1 and IsHadrEnabled is 0",
        "sql_request": "SELECT SERVERPROPERTY('IsClustered') AS [IsClustered], SERVERPROPERTY('IsHadrEnabled') AS [IsHadrEnabled]",
        "sql_expect": "1"
    },
    "custom_item_5": {
        "description": "SQL6-D0-004100 - SQL Server must protect against a user falsely repudiating by ensuring the NT AUTHORITY SYSTEM account is not used for administration - permissions",
        "info": "Non-repudiation of actions taken is required in order to maintain data integrity. Examples of particular actions taken by individuals include creating information, sending a message, approving information (e.g., indicating concurrence or signing a contract), and receiving a message.\n\nNon-repudiation protects against later claims by a user of not having created, modified, or deleted a particular data item or collection of data in the database.\n\nIn designing a database, the organization must define the types of data and the user actions that must be protected from repudiation. The implementation must then include building audit features into the application data tables and configuring the DBMS's audit tools to capture the necessary audit trail. Design and implementation also must ensure that applications pass individual user identification to the DBMS, even where the application connects to the DBMS with a standard, shared account.\n\nAny user with enough access to the server can execute a task that will be run as NT AUTHORITY\\SYSTEM either using task scheduler or other tools. At this point, NT AUTHORITY\\SYSTEM essentially becomes a shared account because the operating system and SQL Server are unable to determine who created the process.\n\nPrior to SQL Server 2012, NT AUTHORITY\\SYSTEM was a member of the sysadmin role by default. This allowed jobs/tasks to be executed in SQL Server without the approval or knowledge of the DBA because it looked like operating system activity.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Remove permissions that were identified as not allowed in the check content.\n\nUSE Master;\n\nREVOKETO [NT AUTHORITY\\SYSTEM]\n\nGO\n\n\nTo grant permissions to services or applications, utilize the Service SID of the service or a domain service account.",
        "reference": "800-53|AU-10,800-53r5|AU-10,CAT|II,CCI|CCI-000166,CSF|PR.PT-1,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-10,NESA|T4.3.1,NESA|T7.3.3,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-213934r944382_rule,STIG-ID|SQL6-D0-004100,STIG-Legacy|SV-93835,STIG-Legacy|V-79129,Vuln-ID|V-213934",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "EXECUTE AS LOGIN = 'NT AUTHORITY\\SYSTEM' SELECT * FROM fn_my_permissions(NULL, 'server') WHERE permission_name NOT IN ('CONNECT SQL', 'VIEW SERVER STATE', 'VIEW ANY DATABASE') REVERT"
    },
    "custom_item_6": {
        "description": "Check if IsClustered is 1 and IsHadrEnabled is 0",
        "sql_request": "SELECT SERVERPROPERTY('IsClustered') AS [IsClustered], SERVERPROPERTY('IsHadrEnabled') AS [IsHadrEnabled]",
        "sql_expect": "0"
    },
    "custom_item_7": {
        "description": "SQL6-D0-004100 - SQL Server must protect against a user falsely repudiating by ensuring the NT AUTHORITY SYSTEM account is not used for administration - permissions",
        "info": "Non-repudiation of actions taken is required in order to maintain data integrity. Examples of particular actions taken by individuals include creating information, sending a message, approving information (e.g., indicating concurrence or signing a contract), and receiving a message.\n\nNon-repudiation protects against later claims by a user of not having created, modified, or deleted a particular data item or collection of data in the database.\n\nIn designing a database, the organization must define the types of data and the user actions that must be protected from repudiation. The implementation must then include building audit features into the application data tables and configuring the DBMS's audit tools to capture the necessary audit trail. Design and implementation also must ensure that applications pass individual user identification to the DBMS, even where the application connects to the DBMS with a standard, shared account.\n\nAny user with enough access to the server can execute a task that will be run as NT AUTHORITY\\SYSTEM either using task scheduler or other tools. At this point, NT AUTHORITY\\SYSTEM essentially becomes a shared account because the operating system and SQL Server are unable to determine who created the process.\n\nPrior to SQL Server 2012, NT AUTHORITY\\SYSTEM was a member of the sysadmin role by default. This allowed jobs/tasks to be executed in SQL Server without the approval or knowledge of the DBA because it looked like operating system activity.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Remove permissions that were identified as not allowed in the check content.\n\nUSE Master;\n\nREVOKETO [NT AUTHORITY\\SYSTEM]\n\nGO\n\n\nTo grant permissions to services or applications, utilize the Service SID of the service or a domain service account.",
        "reference": "800-53|AU-10,800-53r5|AU-10,CAT|II,CCI|CCI-000166,CSF|PR.PT-1,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-10,NESA|T4.3.1,NESA|T7.3.3,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-213934r944382_rule,STIG-ID|SQL6-D0-004100,STIG-Legacy|SV-93835,STIG-Legacy|V-79129,Vuln-ID|V-213934",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "EXECUTE AS LOGIN = 'NT AUTHORITY\\SYSTEM' SELECT * FROM fn_my_permissions(NULL, 'server') WHERE permission_name NOT IN ('CONNECT SQL', 'VIEW ANY DATABASE') REVERT"
    },
    "custom_item_8": {
        "description": "SQL6-D0-004100 - SQL Server must protect against a user falsely repudiating by ensuring the NT AUTHORITY SYSTEM account is not used for administration - permissions",
        "info": "Non-repudiation of actions taken is required in order to maintain data integrity. Examples of particular actions taken by individuals include creating information, sending a message, approving information (e.g., indicating concurrence or signing a contract), and receiving a message.\n\nNon-repudiation protects against later claims by a user of not having created, modified, or deleted a particular data item or collection of data in the database.\n\nIn designing a database, the organization must define the types of data and the user actions that must be protected from repudiation. The implementation must then include building audit features into the application data tables and configuring the DBMS's audit tools to capture the necessary audit trail. Design and implementation also must ensure that applications pass individual user identification to the DBMS, even where the application connects to the DBMS with a standard, shared account.\n\nAny user with enough access to the server can execute a task that will be run as NT AUTHORITY\\SYSTEM either using task scheduler or other tools. At this point, NT AUTHORITY\\SYSTEM essentially becomes a shared account because the operating system and SQL Server are unable to determine who created the process.\n\nPrior to SQL Server 2012, NT AUTHORITY\\SYSTEM was a member of the sysadmin role by default. This allowed jobs/tasks to be executed in SQL Server without the approval or knowledge of the DBA because it looked like operating system activity.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Remove permissions that were identified as not allowed in the check content.\n\nUSE Master;\n\nREVOKETO [NT AUTHORITY\\SYSTEM]\n\nGO\n\n\nTo grant permissions to services or applications, utilize the Service SID of the service or a domain service account.",
        "reference": "800-53|AU-10,800-53r5|AU-10,CAT|II,CCI|CCI-000166,CSF|PR.PT-1,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-10,NESA|T4.3.1,NESA|T7.3.3,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-213934r944382_rule,STIG-ID|SQL6-D0-004100,STIG-Legacy|SV-93835,STIG-Legacy|V-79129,Vuln-ID|V-213934",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "EXECUTE AS LOGIN = 'NT AUTHORITY\\SYSTEM' SELECT * FROM fn_my_permissions(NULL, 'server') WHERE permission_name NOT IN ('CONNECT SQL', 'CREATE AVAILABILITY GROUP', 'ALTER ANY AVAILABILITY GROUP', 'VIEW SERVER STATE', 'VIEW ANY DATABASE') REVERT"
    },
    "custom_item_9": {
        "description": "SQL6-D0-004200 - SQL Server must protect against a user falsely repudiating by ensuring only clearly unique Active Directory user accounts can connect to the instance.",
        "info": "Non-repudiation of actions taken is required in order to maintain data integrity. Examples of particular actions taken by individuals include creating information, sending a message, approving information (e.g., indicating concurrence or signing a contract), and receiving a message.\n\nNon-repudiation protects against later claims by a user of not having created, modified, or deleted a particular data item or collection of data in the database.\n\nIn designing a database, the organization must define the types of data and the user actions that must be protected from repudiation. The implementation must then include building audit features into the application data tables and configuring the DBMS's audit tools to capture the necessary audit trail. Design and implementation also must ensure that applications pass individual user identification to the DBMS, even where the application connects to the DBMS with a standard, shared account.\n\nIf the computer account of a remote computer is granted access to SQL Server, any service or scheduled task running as NT AUTHORITY\\SYSTEM or NT AUTHORITY\\NETWORK SERVICE can log into the instance and perform actions. These actions cannot be traced back to a specific user or process.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Remove all logins that were returned in the check content.",
        "reference": "800-53|AU-10,800-53r5|AU-10,CAT|II,CCI|CCI-000166,CSF|PR.PT-1,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-10,NESA|T4.3.1,NESA|T7.3.3,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-213935r879554_rule,STIG-ID|SQL6-D0-004200,STIG-Legacy|SV-93837,STIG-Legacy|V-79131,Vuln-ID|V-213935",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT name FROM sys.server_principals WHERE type in ('U','G') AND name LIKE '%$'"
    },
    "custom_item_10": {
        "description": "installed audits",
        "sql_request": "SELECT name AS 'Audit Name', status_desc AS 'Audit Status', audit_file_path AS 'Current Audit File' FROM sys.dm_server_audit_status",
        "sql_expect": "ManualReviewRequired"
    },
    "custom_item_11": {
        "description": "audit events",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1",
        "sql_expect": "ManualReviewRequired"
    },
    "custom_item_12": {
        "description": "SQL6-D0-004400 - SQL Server must allow only the ISSM (or individuals or roles appointed by the ISSM) to select which auditable events are to be audited.",
        "info": "Without the capability to restrict which roles and individuals can select which events are audited, unauthorized personnel may be able to prevent or interfere with the auditing of critical events.\n\nSuppression of auditing could permit an adversary to evade detection.\n\nMisconfigured audits can degrade the system's performance by overwhelming the audit log. Misconfigured audits may also make it more difficult to establish, correlate, and investigate the events relating to an incident or identify those responsible for one.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Create a server role specifically for audit maintainers and give it permission to maintain audits without granting it unnecessary permissions (the role name used here is an example; other names may be used):\n\nCREATE SERVER ROLE SERVER_AUDIT_MAINTAINERS;\nGO\n\nGRANT ALTER ANY SERVER AUDIT TO SERVER_AUDIT_MAINTAINERS;\nGO\n\nUse REVOKE and/or DENY and/or ALTER SERVER ROLE ... DROP MEMBER ... statements to remove the ALTER ANY SERVER AUDIT permission from all logins.  Then, for each authorized login, run the statement:\n\nALTER SERVER ROLE SERVER_AUDIT_MAINTAINERS ADD MEMBER;\nGO\n\nUse REVOKE and/or DENY and/or ALTER SERVER ROLE ... DROP MEMBER ... statements to remove CONTROL SERVER, ALTER ANY DATABASE and CREATE ANY DATABASE permissions from logins that do not need them.",
        "reference": "800-171|3.3.1,800-171|3.3.2,800-53|AU-12b.,800-53r5|AU-12b.,CAT|II,CCI|CCI-000171,CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-12b.,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-213937r879560_rule,STIG-ID|SQL6-D0-004400,STIG-Legacy|SV-93841,STIG-Legacy|V-79135,SWIFT-CSCv1|6.4,Vuln-ID|V-213937",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT CASE WHEN SP.class_desc IS NOT NULL THEN CASE WHEN SP.class_desc = 'SERVER' AND S.is_linked = 0 THEN 'SERVER' WHEN SP.class_desc = 'SERVER' AND S.is_linked = 1 THEN 'SERVER (linked)' ELSE SP.class_desc END WHEN E.name IS NOT NULL THEN 'ENDPOINT' WHEN S.name IS NOT NULL AND S.is_linked = 0 THEN 'SERVER' WHEN S.name IS NOT NULL AND S.is_linked = 1 THEN 'SERVER (linked)' WHEN P.name IS NOT NULL THEN 'SERVER_PRINCIPAL' ELSE '???' END AS [Securable Class], CASE WHEN E.name IS NOT NULL THEN E.name WHEN S.name IS NOT NULL THEN S.name WHEN P.name IS NOT NULL THEN P.name ELSE '???' END AS [Securable], P1.name AS [Grantee], P1.type_desc AS [Grantee Type], sp.permission_name AS [Permission], sp.state_desc AS [State], P2.name AS [Grantor], P2.type_desc AS [Grantor Type], R.name AS [Role Name] FROM sys.server_permissions SP INNER JOIN sys.server_principals P1 ON P1.principal_id = SP.grantee_principal_id INNER JOIN sys.server_principals P2 ON P2.principal_id = SP.grantor_principal_id FULL OUTER JOIN sys.servers S ON  SP.class_desc = 'SERVER' AND S.server_id = SP.major_id FULL OUTER JOIN sys.endpoints E ON  SP.class_desc = 'ENDPOINT' AND E.endpoint_id = SP.major_id FULL OUTER JOIN sys.server_principals P ON SP.class_desc = 'SERVER_PRINCIPAL' AND P.principal_id = SP.major_id FULL OUTER JOIN sys.server_role_members SRM ON P.principal_id = SRM.member_principal_id LEFT OUTER JOIN sys.server_principals R ON SRM.role_principal_id = R.principal_id WHERE sp.permission_name IN ('ALTER ANY SERVER AUDIT','CONTROL SERVER','ALTER ANY DATABASE','CREATE ANY DATABASE') OR R.name IN ('sysadmin','dbcreator')"
    },
    "custom_item_13": {
        "description": "audit",
        "sql_request": "SELECT name AS 'Audit Name', status_desc AS 'Audit Status', audit_file_path AS 'Current Audit File' FROM sys.dm_server_audit_status",
        "sql_expect": "ManualReviewRequired"
    },
    "custom_item_14": {
        "description": "retrieval",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SCHEMA_OBJECT_ACCESS_GROUP'",
        "sql_expect": "ManualReviewRequired"
    },
    "custom_item_15": {
        "description": "SQL6-D0-004700 - SQL Server must initiate session auditing upon startup.",
        "info": "Session auditing is for use when a user's activities are under investigation. To be sure of capturing all activity during those periods when session auditing is in use, it needs to be in operation for the whole time SQL Server is running.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Configure the SQL Audit(s) to automatically start during system start-up.\n\nALTER SERVER AUDIT [] WITH STATE = ON\n\nExecute the following query:\n\nSELECT name AS 'Audit Name',\n  status_desc AS 'Audit Status',\n  audit_file_path AS 'Current Audit File'\nFROM sys.dm_server_audit_status\nWHERE status_desc = 'STARTED'\n\nEnsure the SQL STIG Audit is configured to initiate session auditing upon startup.",
        "reference": "800-53|AU-14(1),800-53r5|AU-14(1),CAT|II,CCI|CCI-001464,CSF|PR.PT-1,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-14,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-213940r879562_rule,STIG-ID|SQL6-D0-004700,STIG-Legacy|SV-93847,STIG-Legacy|V-79141,SWIFT-CSCv1|6.4,Vuln-ID|V-213940",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT name AS 'Audit Name', status_desc AS 'Audit Status', audit_file_path AS 'Current Audit File' FROM sys.dm_server_audit_status WHERE status_desc = 'STARTED'",
        "sql_expect": "ManualReviewRequired"
    },
    "custom_item_16": {
        "description": "SQL6-D0-005600 - SQL Server must by default shut down upon audit failure, to include the unavailability of space for more audit log records; or must be configurable to shut down upon audit failure.",
        "info": "It is critical that when SQL Server is at risk of failing to process audit logs as required, it takes action to mitigate the failure. Audit processing failures include: software/hardware errors; failures in the audit capturing mechanisms; and audit storage capacity being reached or exceeded. Responses to audit failure depend upon the nature of the failure mode.\n\nWhen the need for system availability does not outweigh the need for a complete audit trail, SQL Server should shut down immediately, rolling back all in-flight transactions.\n\nSystems where audit trail completeness is paramount will most likely be at a lower MAC level than MAC I; the final determination is the prerogative of the application owner, subject to Authorizing Official concurrence. In any case, sufficient auditing resources must be allocated to avoid a shutdown in all but the most extreme situations.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "If SQL Server Audit is in use, configure SQL Server Audit to shut SQL Server down upon audit failure, to include running out of space for audit logs.\n\nRun this T-SQL script for each identified audit:\n\nALTER SERVER AUDIT [AuditNameHere] WITH (STATE = OFF);\nGO\nALTER SERVER AUDIT [AuditNameHere] WITH (ON_FAILURE = SHUTDOWN);\nGO\nALTER SERVER AUDIT [AuditNameHere] WITH (STATE = ON);\nGO",
        "reference": "800-171|3.3.4,800-53|AU-5b.,800-53r5|AU-5b.,CAT|II,CCI|CCI-000140,CN-L3|7.1.3.3(e),CSF|PR.PT-1,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-5b.,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-213942r879571_rule,STIG-ID|SQL6-D0-005600,STIG-Legacy|SV-93853,STIG-Legacy|V-79147,Vuln-ID|V-213942",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT audit_id, name, is_state_enabled, on_failure_desc FROM sys.server_audits;",
        "sql_expect": "ManualReviewRequired"
    },
    "custom_item_17": {
        "description": "SQL6-D0-005700 - SQL Server must be configurable to overwrite audit log records, oldest first (First-In-First-Out - FIFO), in the event of unavailability of space for more audit log records.",
        "info": "It is critical that when SQL Server is at risk of failing to process audit logs as required, it take action to mitigate the failure. Audit processing failures include; software/hardware errors; failures in the audit capturing mechanisms; and audit storage capacity being reached or exceeded. Responses to audit failure depend upon the nature of the failure mode.\n\nWhen availability is an overriding concern, approved actions in response to an audit failure are as follows:\n\n(i) If the failure was caused by the lack of audit record storage capacity, SQL Server must continue generating audit records, if possible (automatically restarting the audit service if necessary), overwriting the oldest audit records in a first-in-first-out manner.\n\n(ii) If audit records are sent to a centralized collection server and communication with this server is lost or the server fails, SQL Server must queue audit records locally until communication is restored or until the audit records are retrieved manually. Upon restoration of the connection to the centralized collection server, action should be taken to synchronize the local audit data with the collection server.\n\nSystems where availability is paramount will most likely be MAC I; the final determination is the prerogative of the application owner, subject to Authorizing Official concurrence. In any case, sufficient auditing resources must be allocated to avoid audit data loss in all but the most extreme situations.",
        "solution": "If SQL Server Audit is in use, configure SQL Server Audit to continue to generate audit records, overwriting the oldest existing records, in the case of an auditing failure.\n\nRun this T-SQL script for each identified audit:\n\nALTER SERVER AUDIT [AuditName] WITH (STATE = OFF);\nGO\nALTER SERVER AUDIT [AuditName] to file (max_rollover_files = IntegerValue);\nGO\nALTER SERVER AUDIT [AuditName] WITH (STATE = ON);\nGO",
        "reference": "800-171|3.3.4,800-53|AU-5b.,800-53r5|AU-5b.,CAT|II,CCI|CCI-000140,CN-L3|7.1.3.3(e),CSF|PR.PT-1,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-5b.,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-213943r879571_rule,STIG-ID|SQL6-D0-005700,STIG-Legacy|SV-93855,STIG-Legacy|V-79149,Vuln-ID|V-213943",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT a.name 'audit_name', a.type_desc 'storage_type', CASE a.type_desc WHEN 'FILE' THEN f.max_rollover_files ELSE 1 END AS 'max_rollover_files' FROM sys.server_audits a LEFT JOIN sys.server_file_audits f ON a.audit_id = f.audit_id WHERE a.is_state_enabled = 1",
        "sql_expect": ".+"
    },
    "custom_item_18": {
        "description": "SQL6-D0-005900 - The audit information produced by SQL Server must be protected from unauthorized access, modification, and deletion.",
        "info": "If audit data were to become compromised, then competent forensic analysis and discovery of the true source of potentially malicious system activity is difficult, if not impossible, to achieve. In addition, access to audit records provides information an attacker could potentially use to his or her advantage.\n\nTo ensure the veracity of audit data, the information system and/or the application must protect audit information from any and all unauthorized access. This includes read, write, copy, etc.\n\nThis requirement can be achieved through multiple methods which will depend upon system architecture and design. Some commonly employed methods include ensuring log files enjoy the proper file system permissions utilizing file system protections and limiting log data location.\n\nAdditionally, applications with user interfaces to audit records should not allow for the unfettered manipulation of or access to those records via the application. If the application provides access to the audit data, the application becomes accountable for ensuring that audit information is protected from unauthorized access. SQL Server is an application that is able to view and manipulate audit file data.\n\nAudit information includes all information (e.g., audit records, audit settings, and audit reports) needed to successfully audit information system activity.\n\nSatisfies: SRG-APP-000118-DB-000059, SRG-APP-000119-DB-000060, SRG-APP-000120-DB-000061\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Modify audit file permissions to meet the requirement to protect against unauthorized access.\n\nApplication event log and security log permissions are covered in the Windows Server STIGs. Be sure to reference these depending on the OS in use.\n\nNavigate to audit folder location(s) using a command prompt or Windows Explorer. Right-click the file and click 'Properties'.\n\nOn the Security tab, modify the security permissions to:\nAdministrator (read)\nUsers (none)\nAudit Administrator(Full Control)\nAuditors group (Read)\nSQL Server Service SID OR Service Account (Full Control) [Notes 1, 2]\nSQL Server SQL Agent Service SID OR Service Account, if SQL Server Agent is in use. (Read, Execute, Write) [Notes 1, 2]\n\n-----\nNote 1: It is highly advisable to use a separate account for each service. When installing SQL Server in single-server mode, you can opt to have these provisioned for you. These automatically-generated accounts are referred to as virtual accounts. Each virtual account has an equivalent Service SID, with the same name. The installer also creates an equivalent SQL Server login, also with the same name. Applying folder and file permissions to Service SIDs, rather than to domain accounts or local computer accounts, provides tighter control, because these permissions are available only to the specific service when it is running, and not in any other context. (However, when using failover clustering, a domain account must be specified at installation, rather than a virtual account.) For more on this topic, see http://msdn.microsoft.com/en-us/library/ms143504(v=sql.130).aspx.\n\nNote 2: Tips for adding a service SID/virtual account to a folder's permission list.\n\n1) In Windows Explorer, right-click the folder and select 'Properties'.\n2) Select the 'Security' tab.\n3) Click 'Edit'.\n4) Click 'Add'.\n5) Click 'Locations'.\n6) Select the computer name.\n7) Search for the name.\n7.a) SQL Server Service\n7.a.i) Type 'NT SERVICE\\MSSQL' and click 'Check Names'. (What you have just typed in is the first 16 characters of the name. At least one character must follow 'NT SERVICE\\'; you will be presented with a list of all matches. If you have typed in the full, correct name, step 7.a.ii is bypassed.)\n7.a.ii) Select the 'MSSQL$' user and click 'OK'.\n7.b) SQL Agent Service\n7.b.i) Type 'NT SERVICE\\SQL' and click 'Check Names'.\n7.b.ii) Select the 'SQLAgent$' user and click 'OK'.\n8) Click 'OK'.\n9) Permission like a normal user from here.",
        "reference": "800-171|3.3.8,800-53|AU-9,800-53r5|AU-9,CAT|II,CCI|CCI-000162,CCI|CCI-000163,CCI|CCI-000164,CN-L3|7.1.2.3(d),CN-L3|7.1.3.3(f),CN-L3|8.1.3.5(c),CN-L3|8.1.4.3(c),CSF|PR.PT-1,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.2,ITSG-33|AU-9,NESA|M5.2.3,NESA|M5.5.2,NESA|T3.6.4,NESA|T8.2.9,NIAv2|SM5,NIAv2|SM6,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|10.3.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-213944r879576_rule,STIG-ID|SQL6-D0-005900,STIG-Legacy|SV-93857,STIG-Legacy|V-79151,Vuln-ID|V-213944",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT log_file_path AS 'Audit Path' FROM sys.server_file_audits",
        "sql_expect": "ManualReviewRequired"
    },
    "custom_item_19": {
        "description": "SQL6-D0-006300 - SQL Server must protect its audit configuration from authorized and unauthorized access and modification.",
        "info": "Protecting audit data also includes identifying and protecting the tools used to view and manipulate log data. Therefore, protecting audit tools is necessary to prevent unauthorized operation on audit data.\n\nApplications providing tools to interface with audit data will leverage user permissions and roles identifying the user accessing the tools and the corresponding rights the user enjoys in order make access decisions regarding the modification of audit tools. SQL Server is an application that does provide access to audit data.\n\nAudit tools include, but are not limited to, vendor-provided and open source audit tools needed to successfully view and manipulate audit information system activity and records. Audit tools include custom queries and report generators.\n\nIf an attacker were to gain access to audit tools, they could analyze audit logs for system weaknesses or weaknesses in the auditing itself. An attacker could also manipulate logs to hide evidence of malicious activity.\n\nSatisfies: SRG-APP-000121-DB-000202, SRG-APP-000123-DB-000204\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Remove audit-related permissions from individuals and roles not authorized to have them.\n\nUSE master;\nDENY [ALTER ANY SERVER AUDIT] TO [User];\nGO",
        "reference": "800-171|3.3.8,800-53|AU-9,800-53r5|AU-9,CAT|II,CCI|CCI-001494,CN-L3|7.1.2.3(d),CN-L3|7.1.3.3(f),CN-L3|8.1.3.5(c),CN-L3|8.1.4.3(c),CSF|PR.PT-1,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.2,ITSG-33|AU-9,NESA|M5.2.3,NESA|M5.5.2,NESA|T3.6.4,NESA|T8.2.9,NIAv2|SM5,NIAv2|SM6,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|10.3.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-213948r902986_rule,STIG-ID|SQL6-D0-006300,STIG-Legacy|SV-93865,STIG-Legacy|V-79159,Vuln-ID|V-213948",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT login.name, perm.permission_name, perm.state_desc FROM sys.server_permissions perm JOIN sys.server_principals login ON perm.grantee_principal_id = login.principal_id WHERE permission_name in ('ALTER ANY DATABASE AUDIT', 'ALTER ANY SERVER AUDIT', 'CONTROL SERVER') and login.name not like '##MS_%';"
    },
    "custom_item_20": {
        "description": "SQL6-D0-006900 - Default demonstration and sample databases, database objects, and applications must be removed.",
        "info": "Information systems are capable of providing a wide variety of functions and services. Some of the functions and services, provided by default, may not be necessary to support essential organizational operations (e.g., key missions, functions).\n\nIt is detrimental for software products to provide, or install by default, functionality exceeding requirements or mission objectives. Examples include, but are not limited to, installing advertising software, demonstrations, or browser plugins not related to requirements or providing a wide array of functionality, not required for every mission, that cannot be disabled.\n\nDBMSs must adhere to the principles of least functionality by providing only essential capabilities.\n\nDemonstration and sample database objects and applications present publicly known attack points for malicious users. These demonstration and sample objects are meant to provide simple examples of coding specific functions and are not developed to prevent vulnerabilities from being introduced to SQL Server and host system.",
        "solution": "Remove all demonstration or sample databases from production instances.",
        "reference": "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-213954r879587_rule,STIG-ID|SQL6-D0-006900,STIG-Legacy|SV-93877,STIG-Legacy|V-79171,SWIFT-CSCv1|2.3,Vuln-ID|V-213954",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT name FROM sysdatabases WHERE name LIKE 'pubs%' OR name LIKE 'AdventureWorks%' OR name LIKE 'Northwinds%' OR name LIKE 'WorldwideImporters%';"
    },
    "custom_item_21": {
        "description": "SQL6-D0-007200 - Access to xp_cmdshell must be disabled, unless specifically required and approved.",
        "info": "Information systems are capable of providing a wide variety of functions and services. Some of the functions and services, provided by default, may not be necessary to support essential organizational operations (e.g., key missions, functions).\n\nIt is detrimental for applications to provide, or install by default, functionality exceeding requirements or mission objectives.\n\nApplications must adhere to the principles of least functionality by providing only essential capabilities.\n\nSQL Server may spawn additional external processes to execute procedures that are defined in the SQL Server but stored in external host files (external procedures). The spawned process used to execute the external procedure may operate within a different OS security context than SQL Server and provide unauthorized access to the host system.\n\nThe xp_cmdshell extended stored procedure allows execution of host executables outside the controls of database access permissions. This access may be exploited by malicious users who have compromised the integrity of the SQL Server database process to control the host operating system to perpetrate additional malicious activity.",
        "solution": "Disable use of or remove any external application executable object definitions that are not authorized.\n\nTo disable the use of xp_cmdshell, from the query prompt:\n\nEXEC sp_configure 'show advanced options', 1;\nGO\nRECONFIGURE;\nGO\nEXEC sp_configure 'xp_cmdshell', 0;\nGO\nRECONFIGURE;\nGO??",
        "reference": "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-213957r879587_rule,STIG-ID|SQL6-D0-007200,STIG-Legacy|SV-93883,STIG-Legacy|V-79177,SWIFT-CSCv1|2.3,Vuln-ID|V-213957",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "EXEC SP_CONFIGURE 'show advanced options', '1'; RECONFIGURE WITH OVERRIDE; EXEC SP_CONFIGURE 'xp_cmdshell';",
        "sql_expect": ".+"
    },
    "custom_item_22": {
        "description": "CLR Disabled",
        "sql_request": "EXEC SP_CONFIGURE 'show advanced options', '1'; RECONFIGURE WITH OVERRIDE; EXEC SP_CONFIGURE 'clr enabled';",
        "sql_expect": ".+"
    },
    "custom_item_23": {
        "description": "SQL6-D0-007300 - Access to CLR code must be disabled or restricted, unless specifically required and approved.",
        "info": "Information systems are capable of providing a wide variety of functions and services. Some of the functions and services, provided by default, may not be necessary to support essential organizational operations (e.g., key missions, functions).\n\nIt is detrimental for applications to provide, or install by default, functionality exceeding requirements or mission objectives.\n\nApplications must adhere to the principles of least functionality by providing only essential capabilities.\n\nSQL Server may spawn additional external processes to execute procedures that are defined in the SQL Server but stored in external host files (external procedures). The spawned process used to execute the external procedure may operate within a different OS security context than SQL Server and provide unauthorized access to the host system.\n\nThe common language runtime (CLR) component of the .NET Framework for Microsoft Windows in SQL Server allows you to write stored procedures, triggers, user-defined types, user-defined functions, user-defined aggregates, and streaming table-valued functions, using any .NET Framework language, including Microsoft Visual Basic .NET and Microsoft Visual C#.  CLR packing assemblies can access resources protected by .NET Code Access Security when it runs managed code.  Specifying UNSAFE enables the code in the assembly complete freedom to perform operations in the SQL Server process space that can potentially compromise the robustness of SQL Server. UNSAFE assemblies can also potentially subvert the security system of either SQL Server or the common language runtime.",
        "solution": "Disable use of or remove any CLR code that is not authorized.\n\nTo disable the use of CLR, from the query prompt:\n\nsp_configure 'show advanced options', 1;\nGO\nRECONFIGURE;\nGO\nsp_configure 'clr enabled', 0;\nGO\nRECONFIGURE;\nGO\n\nFor any approved CLR code with Unsafe or External permissions, use the ALTER ASSEMBLY to change the Permission set for the Assembly and ensure a certificate is configured.",
        "reference": "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-213958r879587_rule,STIG-ID|SQL6-D0-007300,STIG-Legacy|SV-93885,STIG-Legacy|V-79179,SWIFT-CSCv1|2.3,Vuln-ID|V-213958",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "EXEC SP_CONFIGURE 'show advanced options', '1'; RECONFIGURE WITH OVERRIDE; EXEC SP_CONFIGURE 'clr enabled';",
        "sql_expect": ".+"
    },
    "custom_item_24": {
        "description": "SQL6-D0-007300 - Access to CLR code must be disabled or restricted, unless specifically required and approved.",
        "info": "Information systems are capable of providing a wide variety of functions and services. Some of the functions and services, provided by default, may not be necessary to support essential organizational operations (e.g., key missions, functions).\n\nIt is detrimental for applications to provide, or install by default, functionality exceeding requirements or mission objectives.\n\nApplications must adhere to the principles of least functionality by providing only essential capabilities.\n\nSQL Server may spawn additional external processes to execute procedures that are defined in the SQL Server but stored in external host files (external procedures). The spawned process used to execute the external procedure may operate within a different OS security context than SQL Server and provide unauthorized access to the host system.\n\nThe common language runtime (CLR) component of the .NET Framework for Microsoft Windows in SQL Server allows you to write stored procedures, triggers, user-defined types, user-defined functions, user-defined aggregates, and streaming table-valued functions, using any .NET Framework language, including Microsoft Visual Basic .NET and Microsoft Visual C#.  CLR packing assemblies can access resources protected by .NET Code Access Security when it runs managed code.  Specifying UNSAFE enables the code in the assembly complete freedom to perform operations in the SQL Server process space that can potentially compromise the robustness of SQL Server. UNSAFE assemblies can also potentially subvert the security system of either SQL Server or the common language runtime.",
        "solution": "Disable use of or remove any CLR code that is not authorized.\n\nTo disable the use of CLR, from the query prompt:\n\nsp_configure 'show advanced options', 1;\nGO\nRECONFIGURE;\nGO\nsp_configure 'clr enabled', 0;\nGO\nRECONFIGURE;\nGO\n\nFor any approved CLR code with Unsafe or External permissions, use the ALTER ASSEMBLY to change the Permission set for the Assembly and ensure a certificate is configured.",
        "reference": "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-213958r879587_rule,STIG-ID|SQL6-D0-007300,STIG-Legacy|SV-93885,STIG-Legacy|V-79179,SWIFT-CSCv1|2.3,Vuln-ID|V-213958",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT * FROM sys.assemblies WHERE permission_set_desc != 'SAFE' AND is_user_defined = 1"
    },
    "custom_item_25": {
        "description": "Is writing to a temp table acceptable",
        "sql_request": "select '@WRITE_TEMP_TABLE@' AS WriteToTempTable",
        "sql_expect": "(Yes|yes|YES)"
    },
    "custom_item_26": {
        "description": "SQL6-D0-007400 - Access to Non-Standard extended stored procedures must be disabled or restricted, unless specifically required and approved.",
        "info": "Information systems are capable of providing a wide variety of functions and services. Some of the functions and services, provided by default, may not be necessary to support essential organizational operations (e.g., key missions, functions).\n\nIt is detrimental for applications to provide, or install by default, functionality exceeding requirements or mission objectives.\n\nApplications must adhere to the principles of least functionality by providing only essential capabilities.\n\nSQL Server may spawn additional external processes to execute procedures that are defined in the SQL Server but stored in external host files (external procedures). The spawned process used to execute the external procedure may operate within a different OS security context than SQL Server and provide unauthorized access to the host system.\n\nExtended stored procedures are DLLs that an instance of SQL Server can dynamically load and run. Extended stored procedures run directly in the address space of an instance of SQL Server and are programmed by using the SQL Server Extended Stored Procedure API.  Non-Standard extended stored procedures can compromise the integrity of the SQL Server process.  This feature will be removed in a future version of Microsoft SQL Server. Do not use this feature in new development work, and modify applications that currently use this feature as soon as possible.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Remove any Non-Standard extended stored procedures that are not documented and approved.\n\nsp_dropextendedproc 'proc name'",
        "reference": "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-213959r879587_rule,STIG-ID|SQL6-D0-007400,STIG-Legacy|SV-93887,STIG-Legacy|V-79181,SWIFT-CSCv1|2.3,Vuln-ID|V-213959",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "USE [master] DECLARE @xplist AS TABLE ( xp_name sysname, source_dll nvarchar(255) ) INSERT INTO @xplist EXEC sp_helpextendedproc SELECT X.xp_name, X.source_dll, O.is_ms_shipped FROM @xplist X JOIN sys.all_objects O ON X.xp_name = O.name WHERE O.is_ms_shipped = 0 ORDER BY X.xp_name"
    },
    "custom_item_27": {
        "description": "linked servers",
        "sql_request": "EXEC sp_linkedservers;"
    },
    "custom_item_28": {
        "description": "linked servers login",
        "sql_request": "SELECT s.name, p.principal_id, l.remote_name FROM sys.servers s JOIN sys.linked_logins l ON s.server_id = l.server_id LEFT JOIN sys.server_principals p ON l.local_principal_id = p.principal_id WHERE s.is_linked = 1"
    },
    "custom_item_29": {
        "description": "Check for SQL Server Authentication",
        "sql_request": "SELECT CASE SERVERPROPERTY('IsIntegratedSecurityOnly') WHEN 1 THEN 'Windows Authentication' WHEN 0 THEN 'SQL Server Authentication' END as [Authentication Mode]",
        "sql_expect": "Windows Authentication"
    },
    "custom_item_30": {
        "description": "SQL6-D0-007900 - If DBMS authentication using passwords is employed, SQL Server must enforce the DOD standards for password complexity and lifetime.",
        "info": "Windows Authentication is the default authentication mode and is much more secure than SQL Server Authentication. Windows Authentication uses Kerberos security protocol, provides password policy enforcement with regard to complexity validation for strong passwords, provides support for account lockout, and supports password expiration. A connection made using Windows Authentication is sometimes called a trusted connection, because SQL Server trusts the credentials provided by Windows.\n\nBy using Windows Authentication, Windows groups can be created at the domain level, and a login can be created on SQL Server for the entire group. Managing access at the domain level can simplify account administration.\n\nOS/enterprise authentication and identification must be used (SRG-APP-000023-DB-000001). Native SQL Server authentication may be used only when circumstances make it unavoidable and must be documented and AO-approved.\n\nThe DOD standard for authentication is DOD-approved PKI certificates. Authentication based on User ID and Password may be used only when it is not possible to employ a PKI certificate and requires AO approval.\n\nIn such cases, the DOD standards for password complexity and lifetime must be implemented. DBMS products that can inherit the rules for these from the operating system or access control program (e.g., Microsoft Active Directory) must be configured to do so. For other DBMSs, the rules must be enforced using available configuration parameters or custom code.",
        "solution": "When possible, use Windows authentication.\n\nIf using SQL Server authentication, configure the SQL Server operating system and SQL Server logins for compliance.\n\n1. Ensure the password complexity requirements for the corresponding DISA Windows Server Security Technical Implementation Guide are met on the server where the SQL Server Instance is installed.\n\n2. Ensure SQL Server is configured to inherit password complexity rules from the operating system for SQL logins. Ensure check of policy and expiration are enforced when SQL logins are created.\n\nCREATE LOGINWITH PASSWORD=, CHECK_EXPIRATION = ON, CHECK_POLICY = ON;",
        "reference": "800-171|3.5.7,800-53|IA-5(1)(a),800-53r5|IA-5(1)(a),CAT|I,CCI|CCI-000192,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1)(a),NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-213964r951662_rule,STIG-ID|SQL6-D0-007900,STIG-Legacy|SV-93897,STIG-Legacy|V-79191,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4,Vuln-ID|V-213964",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT CASE SERVERPROPERTY('IsIntegratedSecurityOnly') WHEN 1 THEN 'Windows Authentication' WHEN 0 THEN 'SQL Server Authentication' END as [Authentication Mode]",
        "sql_expect": "Windows Authentication"
    },
    "custom_item_31": {
        "description": "SQL6-D0-007900 - If DBMS authentication using passwords is employed, SQL Server must enforce the DOD standards for password complexity and lifetime.",
        "info": "Windows Authentication is the default authentication mode and is much more secure than SQL Server Authentication. Windows Authentication uses Kerberos security protocol, provides password policy enforcement with regard to complexity validation for strong passwords, provides support for account lockout, and supports password expiration. A connection made using Windows Authentication is sometimes called a trusted connection, because SQL Server trusts the credentials provided by Windows.\n\nBy using Windows Authentication, Windows groups can be created at the domain level, and a login can be created on SQL Server for the entire group. Managing access at the domain level can simplify account administration.\n\nOS/enterprise authentication and identification must be used (SRG-APP-000023-DB-000001). Native SQL Server authentication may be used only when circumstances make it unavoidable and must be documented and AO-approved.\n\nThe DOD standard for authentication is DOD-approved PKI certificates. Authentication based on User ID and Password may be used only when it is not possible to employ a PKI certificate and requires AO approval.\n\nIn such cases, the DOD standards for password complexity and lifetime must be implemented. DBMS products that can inherit the rules for these from the operating system or access control program (e.g., Microsoft Active Directory) must be configured to do so. For other DBMSs, the rules must be enforced using available configuration parameters or custom code.",
        "solution": "When possible, use Windows authentication.\n\nIf using SQL Server authentication, configure the SQL Server operating system and SQL Server logins for compliance.\n\n1. Ensure the password complexity requirements for the corresponding DISA Windows Server Security Technical Implementation Guide are met on the server where the SQL Server Instance is installed.\n\n2. Ensure SQL Server is configured to inherit password complexity rules from the operating system for SQL logins. Ensure check of policy and expiration are enforced when SQL logins are created.\n\nCREATE LOGINWITH PASSWORD=, CHECK_EXPIRATION = ON, CHECK_POLICY = ON;",
        "reference": "800-171|3.5.7,800-53|IA-5(1)(a),800-53r5|IA-5(1)(a),CAT|I,CCI|CCI-000192,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1)(a),NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-213964r951662_rule,STIG-ID|SQL6-D0-007900,STIG-Legacy|SV-93897,STIG-Legacy|V-79191,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4,Vuln-ID|V-213964",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT [name], is_expiration_checked, is_policy_checked FROM sys.sql_logins WHERE is_policy_checked <> 1 or is_expiration_checked <> 1 AND (is_disabled <> 1 OR name NOT IN('sa', '##MS_PolicyTsqlExecutionLogin##', '##MS_PolicyEventProcessingLogin##'))"
    },
    "custom_item_32": {
        "description": "Contained Databases do not exist",
        "sql_request": "SELECT * FROM sys.databases WHERE containment = 1"
    },
    "custom_item_33": {
        "description": "SQL6-D0-008000 - Contained databases must use Windows principals.",
        "info": "OS/enterprise authentication and identification must be used (SRG-APP-000023-DB-000001).  Native DBMS authentication may be used only when circumstances make it unavoidable; and must be documented and AO-approved.\n\nThe DoD standard for authentication is DoD-approved PKI certificates.  Authentication based on User ID and Password may be used only when it is not possible to employ a PKI certificate, and requires AO approval.\n\nIn such cases, the DoD standards for password complexity and lifetime must be implemented.  DBMS products that can inherit the rules for these from the operating system or access control program (e.g., Microsoft Active Directory) must be configured to do so.  For other DBMSs, the rules must be enforced using available configuration parameters or custom code.",
        "solution": "Configure the SQL Server contained databases to have users originating from Windows principals. Remove any users not created from Windows principals.",
        "reference": "800-171|3.5.7,800-53|IA-5(1)(a),800-53r5|IA-5(1)(a),CAT|II,CCI|CCI-000192,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1)(a),NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-213965r879601_rule,STIG-ID|SQL6-D0-008000,STIG-Legacy|SV-93899,STIG-Legacy|V-79193,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4,Vuln-ID|V-213965",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT * FROM sys.databases WHERE containment = 1"
    },
    "custom_item_34": {
        "description": "SQL6-D0-008000 - Contained databases must use Windows principals.",
        "info": "OS/enterprise authentication and identification must be used (SRG-APP-000023-DB-000001).  Native DBMS authentication may be used only when circumstances make it unavoidable; and must be documented and AO-approved.\n\nThe DoD standard for authentication is DoD-approved PKI certificates.  Authentication based on User ID and Password may be used only when it is not possible to employ a PKI certificate, and requires AO approval.\n\nIn such cases, the DoD standards for password complexity and lifetime must be implemented.  DBMS products that can inherit the rules for these from the operating system or access control program (e.g., Microsoft Active Directory) must be configured to do so.  For other DBMSs, the rules must be enforced using available configuration parameters or custom code.",
        "solution": "Configure the SQL Server contained databases to have users originating from Windows principals. Remove any users not created from Windows principals.",
        "reference": "800-171|3.5.7,800-53|IA-5(1)(a),800-53r5|IA-5(1)(a),CAT|II,CCI|CCI-000192,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1)(a),NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-213965r879601_rule,STIG-ID|SQL6-D0-008000,STIG-Legacy|SV-93899,STIG-Legacy|V-79193,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4,Vuln-ID|V-213965",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "EXEC sp_MSforeachdb 'USE [?]; SELECT DB_NAME() AS DatabaseName, * FROM sys.database_principals WHERE authentication_type = 2'"
    },
    "custom_item_35": {
        "description": "SQL6-D0-008800 - SQL Server must uniquely identify and authenticate non-organizational users (or processes acting on behalf of non-organizational users).",
        "info": "Non-organizational users include all information system users other than organizational users, which include organizational employees or individuals the organization deems to have equivalent status of employees (e.g., contractors, guest researchers, individuals from allied nations).\n\nNon-organizational users must be uniquely identified and authenticated for all accesses other than those accesses explicitly identified and documented by the organization when related to the use of anonymous access, such as accessing a web server.\n\nAccordingly, a risk assessment is used in determining the authentication needs of the organization.\n\nScalability, practicality, and security are simultaneously considered in balancing the need to ensure ease of use for access to federal information and information systems with the need to protect and adequately mitigate risk to organizational operations, organizational assets, individuals, other organizations, and the Nation.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Ensure all logins are uniquely identifiable and authenticate all non-organizational users who log onto the system. This likely would be done via a combination of the operating system with unique accounts and the SQL Server by ensuring mapping to individual accounts. Verify server documentation to ensure accounts are documented and unique.",
        "reference": "800-53|IA-8,800-53r5|IA-8,CAT|II,CCI|CCI-000804,CSF|PR.AC-1,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-8,ITSG-33|IA-8a.,NESA|T4.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-213970r879617_rule,STIG-ID|SQL6-D0-008800,STIG-Legacy|SV-93907,STIG-Legacy|V-79201,SWIFT-CSCv1|2.8,Vuln-ID|V-213970",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT name, type_desc FROM sys.server_principals WHERE type in ('S','U')",
        "sql_expect": "ManualReviewRequired"
    },
    "custom_item_36": {
        "description": "SQL6-D0-009500 - SQL Server must protect the confidentiality and integrity of all information at rest.",
        "info": "This control is intended to address the confidentiality and integrity of information at rest in non-mobile devices and covers user information and system information. Information at rest refers to the state of information when it is located on a secondary storage device (e.g., disk drive, tape drive) within an organizational information system. Applications and application users generate information throughout the course of their application use.\n\nUser data generated, as well as application-specific configuration data, needs to be protected. Organizations may choose to employ different mechanisms to achieve confidentiality and integrity protections, as appropriate.\n\nIf the confidentiality and integrity of SQL Server data is not protected, the data will be open to compromise and unauthorized modification.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Apply appropriate controls to protect the confidentiality and integrity of data on a secondary device. Where encryption is required, this can be done by full-disk encryption or by database encryption.\n\nTo enable database encryption, create a master key, create a database encryption key, and protect it by using mechanisms tied to the master key, and then set encryption on.\n\nImplement physical security measures, operating system access control lists and organizational controls appropriate to the sensitivity level of the data in the database(s).",
        "reference": "800-171|3.13.16,800-53|SC-28,800-53r5|SC-28,CAT|I,CCI|CCI-001199,CN-L3|8.1.4.7(b),CN-L3|8.1.4.8(b),CSF|PR.DS-1,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(e)(2)(ii),ITSG-33|SC-28,ITSG-33|SC-28a.,PCI-DSSv3.2.1|3.4,PCI-DSSv4.0|3.3.2,PCI-DSSv4.0|3.5.1,QCSC-v1|5.2.2,QCSC-v1|6.2,Rule-ID|SV-213972r879642_rule,STIG-ID|SQL6-D0-009500,STIG-Legacy|SV-93911,STIG-Legacy|V-79205,Vuln-ID|V-213972",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT d.name AS [Database Name], CASE e.encryption_state WHEN 0 THEN 'No database encryption key present, no encryption' WHEN 1 THEN 'Unencrypted' WHEN 2 THEN 'Encryption in progress' WHEN 3 THEN 'Encrypted' WHEN 4 THEN 'Key change in progress' WHEN 5 THEN 'Decryption in progress' WHEN 6 THEN 'Protection change in progress' END AS [Encryption State] FROM sys.dm_database_encryption_keys e RIGHT JOIN sys.databases d ON DB_NAME(e.database_id) = d.name WHERE d.name NOT IN ('master','model','msdb') ORDER BY [Database Name] ;",
        "sql_expect": "ManualReviewRequired"
    },
    "custom_item_37": {
        "description": "SQL6-D0-009800 - SQL Server must prevent unauthorized and unintended information transfer via shared system resources.",
        "info": "The purpose of this control is to prevent information, including encrypted representations of information, produced by the actions of a prior user/role (or the actions of a process acting on behalf of a prior user/role) from being available to any current user/role (or current process) that obtains access to a shared system resource (e.g., registers, main memory, secondary storage) after the resource has been released back to the information system. Control of information in shared resources is also referred to as object reuse.",
        "solution": "Configure SQL Server to effectively protect the private resources of one process or user from unauthorized access by another user or process.\n\nsp_configure 'show advanced options', 1;\nGO\nRECONFIGURE;\nGO\nsp_configure 'common criteria compliance enabled', 1;\nGO\nRECONFIGURE\nGO",
        "reference": "800-171|3.13.4,800-53|SC-4,800-53r5|SC-4,CAT|II,CCI|CCI-001090,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-4,ITSG-33|SC-4a.,Rule-ID|SV-213975r879649_rule,STIG-ID|SQL6-D0-009800,STIG-Legacy|SV-93917,STIG-Legacy|V-79211,Vuln-ID|V-213975",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT name, value_in_use FROM sys.configurations WHERE name = 'common criteria compliance enabled'",
        "sql_expect": ".+"
    },
    "custom_item_38": {
        "description": "SQL6-D0-010100 - SQL Server must reveal detailed error messages only to the ISSO, ISSM, SA, and DBA.",
        "info": "If SQL Server provides too much information in error logs and administrative messages to the screen, this could lead to compromise. The structure and content of error messages need to be carefully considered by the organization and development team. The extent to which the information system is able to identify and handle error conditions is guided by organizational policy and operational requirements.\n\nSome default DBMS error messages can contain information that could aid an attacker in, among others things, identifying the database type, host address, or state of the database. Custom errors may contain sensitive customer information.\n\nIt is important that detailed error messages be visible only to those who are authorized to view them; that general users receive only generalized acknowledgment that errors have occurred; and that these generalized messages appear only when relevant to the user's task. For example, a message along the lines of, 'An error has occurred. Unable to save your changes. If this problem persists, please contact your help desk.' would be relevant. A message such as 'Warning: your transaction generated a large number of page splits' would likely not be relevant. 'ABGQ is not a valid widget code.' would be appropriate; but 'The INSERT statement conflicted with the FOREIGN KEY constraint 'WidgetTransactionFK'. The conflict occurred in database 'DB7', table 'dbo.WidgetMaster', column 'WidgetCode'' would not, as it reveals too much about the database structure.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Configure audit logging, tracing and/or custom code in the database or application to record detailed error messages generated by SQL Server, for review by authorized personnel.\n\nIf any non-authorized users have access to the SQL Server Error Log in SQL Server Management Studio.  Use the REVOKE or DENY commands to remove them from the security admin or sysadmin roles.\n\nIf any non-authorized users have access to the SQL Server Error Log located at Program Files\\Microsoft SQL Server\\MSSQL.n\\MSSQL\\LOG, remove their permissions.\n\nConsider enabling trace flag 3625 to mask certain system-level error information returned to non-administrative users.\n\nLaunch SQL Server Configuration Manager >> Click SQL Services >> Open the instance properties >> Click the Service Parameters tab >> Enter '-T3625' >> Click Add >> Click OK >> Restart SQL instance.",
        "reference": "800-53|SI-11b.,800-53r5|SI-11b.,CAT|II,CCI|CCI-001314,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-11c.,Rule-ID|SV-213978r879656_rule,STIG-ID|SQL6-D0-010100,STIG-Legacy|SV-93923,STIG-Legacy|V-79217,Vuln-ID|V-213978",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT Name FROM syslogins WHERE (sysadmin = 1 or securityadmin = 1) and hasaccess = 1;",
        "sql_expect": "ManualReviewRequired"
    },
    "custom_item_39": {
        "description": "assignment",
        "sql_request": "SELECT DISTINCT CASE WHEN SP.class_desc IS NOT NULL THEN CASE WHEN SP.class_desc = 'SERVER' AND S.is_linked = 0 THEN 'SERVER' WHEN SP.class_desc = 'SERVER' AND S.is_linked = 1 THEN 'SERVER (linked)' ELSE SP.class_desc END WHEN E.name IS NOT NULL THEN 'ENDPOINT' WHEN S.name IS NOT NULL AND S.is_linked = 0 THEN 'SERVER' WHEN S.name IS NOT NULL AND S.is_linked = 1 THEN 'SERVER (linked)' WHEN P.name IS NOT NULL THEN 'SERVER_PRINCIPAL' ELSE '???' END AS [Securable Class], CASE WHEN E.name IS NOT NULL THEN E.name WHEN S.name IS NOT NULL THEN S.name WHEN P.name IS NOT NULL THEN P.name ELSE '???' END AS [Securable], P1.name AS [Grantee], P1.type_desc AS [Grantee Type], sp.permission_name AS [Permission], sp.state_desc AS [State], P2.name AS [Grantor], P2.type_desc AS [Grantor Type] FROM sys.server_permissions SP INNER JOIN sys.server_principals P1 ON P1.principal_id = SP.grantee_principal_id INNER JOIN sys.server_principals P2 ON P2.principal_id = SP.grantor_principal_id FULL OUTER JOIN sys.servers S ON  SP.class_desc = 'SERVER' AND S.server_id = SP.major_id FULL OUTER JOIN sys.endpoints E ON  SP.class_desc = 'ENDPOINT' AND E.endpoint_id = SP.major_id FULL OUTER JOIN sys.server_principals P ON  SP.class_desc = 'SERVER_PRINCIPAL' AND P.principal_id = SP.major_id",
        "sql_expect": "ManualReviewRequired"
    },
    "custom_item_40": {
        "description": "membership",
        "sql_request": "SELECT R.name AS [Role], M.name AS [Member] FROM sys.server_role_members X INNER JOIN sys.server_principals R ON R.principal_id = X.role_principal_id INNER JOIN sys.server_principals M ON M.principal_id = X.member_principal_id",
        "sql_expect": "ManualReviewRequired"
    },
    "custom_item_41": {
        "description": "credentials",
        "sql_request": "SELECT name AS credential_name, credential_identity FROM sys.credentials"
    },
    "custom_item_42": {
        "description": "SQL Agent Proxy accounts",
        "sql_request": "SELECT P.name AS proxy_name, C.name AS credential_name, C.credential_identity FROM sys.credentials C JOIN msdb.dbo.sysproxies P ON C.credential_id = P.credential_id WHERE P.enabled = 1"
    },
    "custom_item_43": {
        "description": "SQL6-D0-010900 - SQL Server must allocate audit record storage capacity in accordance with organization-defined audit record storage requirements.",
        "info": "In order to ensure sufficient storage capacity for the audit logs, SQL Server must be able to allocate audit record storage capacity. Although another requirement (SRG-APP-000515-DB-000318) mandates that audit data be off-loaded to a centralized log management system, it remains necessary to provide space on the database server to serve as a buffer against outages and capacity limits of the off-loading mechanism.\n\nThe task of allocating audit record storage capacity is usually performed during initial installation of SQL Server and is closely associated with the DBA and system administrator roles. The DBA or system administrator will usually coordinate the allocation of physical drive space with the application owner/installer and the application will prompt the installer to provide the capacity information, the physical location of the disk, or both.\n\nIn determining the capacity requirements, consider such factors as: total number of users; expected number of concurrent users during busy periods; number and type of events being monitored; types and amounts of data being captured; the frequency/speed with which audit records are off-loaded to the central log management system; and any limitations that exist on SQL Server's ability to reuse the space formerly occupied by off-loaded records.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Review the SQL Audit file location; ensure the destination has enough space available to accommodate the maximum total size of all files that could be written.\n\nConfigure the maximum number of audit log files that are to be generated, staying within the number of logs the system was sized to support.\n\nUpdate the 'max_files' parameter of the audits to ensure the correct number of files is defined.\n\nIf writing to application event logs or security logs, space considerations are covered in the Windows Server STIGs. Be sure to reference these depending on the OS in use.",
        "reference": "800-53|AU-4,800-53r5|AU-4,CAT|II,CCI|CCI-001849,CSF|PR.DS-4,CSF|PR.PT-1,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-4,NESA|T3.3.1,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-213983r879730_rule,STIG-ID|SQL6-D0-010900,STIG-Legacy|SV-93933,STIG-Legacy|V-79227,Vuln-ID|V-213983",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT max_file_size, max_rollover_files, log_file_path AS 'Audit Path' FROM sys.server_file_audits",
        "sql_expect": "ManualReviewRequired"
    },
    "custom_item_44": {
        "description": "permissions",
        "sql_request": "SELECT p.name AS Principal, p.type_desc AS Type, sp.permission_name AS Permission, sp.state_desc AS State FROM sys.server_principals p INNER JOIN sys.server_permissions sp ON p.principal_id = sp.grantee_principal_id WHERE sp.permission_name = 'CONTROL SERVER' OR sp.state = 'W'",
        "sql_expect": "ManualReviewRequired"
    },
    "custom_item_45": {
        "description": "roles",
        "sql_request": "SELECT m.name AS Member, m.type_desc AS Type, r.name AS Role FROM sys.server_principals m INNER JOIN sys.server_role_members rm ON m.principal_id = rm.member_principal_id INNER JOIN sys.server_principals r ON rm.role_principal_id = r.principal_id WHERE r.name IN ('sysadmin','securityadmin','serveradmin')",
        "sql_expect": "ManualReviewRequired"
    },
    "custom_item_46": {
        "description": "audits",
        "sql_request": "SELECT name AS 'Audit Name', status_desc AS 'Audit Status', audit_file_path AS 'Current Audit File' FROM sys.dm_server_audit_status",
        "sql_expect": "ManualReviewRequired"
    },
    "custom_item_47": {
        "description": "APPLICATION_ROLE_CHANGE_PASSWORD_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('APPLICATION_ROLE_CHANGE_PASSWORD_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_48": {
        "description": "AUDIT_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('AUDIT_CHANGE_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_49": {
        "description": "BACKUP_RESTORE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('BACKUP_RESTORE_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_50": {
        "description": "DATABASE_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('DATABASE_CHANGE_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_51": {
        "description": "DATABASE_OBJECT_ACCESS_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('DATABASE_OBJECT_ACCESS_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_52": {
        "description": "DATABASE_OBJECT_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('DATABASE_OBJECT_CHANGE_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_53": {
        "description": "DATABASE_OBJECT_OWNERSHIP_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('DATABASE_OBJECT_OWNERSHIP_CHANGE_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_54": {
        "description": "DATABASE_OBJECT_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('DATABASE_OBJECT_PERMISSION_CHANGE_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_55": {
        "description": "DATABASE_OWNERSHIP_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('DATABASE_OWNERSHIP_CHANGE_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_56": {
        "description": "DATABASE_OPERATION_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('DATABASE_OPERATION_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_57": {
        "description": "DATABASE_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('DATABASE_PERMISSION_CHANGE_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_58": {
        "description": "DATABASE_PRINCIPAL_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('DATABASE_PRINCIPAL_CHANGE_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_59": {
        "description": "DATABASE_PRINCIPAL_IMPERSONATION_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('DATABASE_PRINCIPAL_IMPERSONATION_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_60": {
        "description": "DATABASE_ROLE_MEMBER_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('DATABASE_ROLE_MEMBER_CHANGE_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_61": {
        "description": "DBCC_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('DBCC_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_62": {
        "description": "LOGIN_CHANGE_PASSWORD_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('LOGIN_CHANGE_PASSWORD_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_63": {
        "description": "SCHEMA_OBJECT_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SCHEMA_OBJECT_CHANGE_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_64": {
        "description": "SCHEMA_OBJECT_OWNERSHIP_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SCHEMA_OBJECT_OWNERSHIP_CHANGE_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_65": {
        "description": "SCHEMA_OBJECT_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SCHEMA_OBJECT_PERMISSION_CHANGE_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_66": {
        "description": "SERVER_OBJECT_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SERVER_OBJECT_CHANGE_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_67": {
        "description": "SERVER_OBJECT_OWNERSHIP_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SERVER_OBJECT_OWNERSHIP_CHANGE_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_68": {
        "description": "SERVER_OBJECT_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SERVER_OBJECT_PERMISSION_CHANGE_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_69": {
        "description": "SERVER_OPERATION_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SERVER_OPERATION_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_70": {
        "description": "SERVER_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SERVER_PERMISSION_CHANGE_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_71": {
        "description": "SERVER_PRINCIPAL_IMPERSONATION_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SERVER_PRINCIPAL_IMPERSONATION_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_72": {
        "description": "SERVER_ROLE_MEMBER_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SERVER_ROLE_MEMBER_CHANGE_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_73": {
        "description": "SERVER_STATE_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SERVER_STATE_CHANGE_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_74": {
        "description": "TRACE_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('TRACE_CHANGE_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_75": {
        "description": "SQL6-D0-012300 - SQL Server must maintain a separate execution domain for each executing process.",
        "info": "Database management systems can maintain separate execution domains for each executing process by assigning each process a separate address space.\n\nEach process has a distinct address space so that communication between processes is controlled through the security functions, and one process cannot modify the executing code of another process.\n\nMaintaining separate execution domains for executing processes can be achieved, for example, by implementing separate address spaces.",
        "solution": "Disable CLR support in SQL Server by executing the following query:\n\nEXEC sp_configure 'clr enabled', 0\nGO\n\nRECONFIGURE\nGO",
        "reference": "800-53|SC-39,800-53r5|SC-39,CAT|II,CCI|CCI-002530,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),QCSC-v1|5.2.1,Rule-ID|SV-213991r879802_rule,STIG-ID|SQL6-D0-012300,STIG-Legacy|SV-93949,STIG-Legacy|V-79243,Vuln-ID|V-213991",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT name, value, value_in_use FROM sys.configurations WHERE name = 'clr enabled'",
        "sql_expect": "clr enabled"
    },
    "custom_item_76": {
        "description": "SQL6-D0-012800 - Security-relevant software updates to SQL Server must be installed within the time period directed by an authoritative source (e.g. IAVM, CTOs, DTMs, and STIGs).",
        "info": "Security flaws with software applications, including database management systems, are discovered daily. Vendors are constantly updating and patching their products to address newly discovered security vulnerabilities. Organizations (including any contractor to the organization) are required to promptly install security-relevant software updates (e.g., patches, service packs, and hot fixes). Flaws discovered during security assessments, continuous monitoring, incident response activities, or information system error handling must also be addressed expeditiously.\n\nOrganization-defined time periods for updating security-relevant software may vary based on a variety of factors including, for example, the security category of the information system or the criticality of the update (i.e., severity of the vulnerability related to the discovered flaw).\n\nThis requirement will apply to software patch management solutions that are used to install patches across the enclave and also to applications themselves that are not part of that patch management solution. For example, many browsers today provide the capability to install their own patch software. Patch criticality, as well as system criticality, will vary. Therefore, the tactical situations regarding the patch management process will also vary. This means that the time period utilized must be a configurable parameter. Time frames for application of security-relevant software updates may be dependent upon the Information Assurance Vulnerability Management (IAVM) process.\n\nSQL Server will be configured to check for and install security-relevant software updates within an identified time period from the availability of the update. The specific time period will be defined by an authoritative source (e.g. IAVM, CTOs, DTMs, and STIGs).\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Upgrade SQL Server to the Microsoft-supported version.  Institute and adhere to policies and procedures to ensure that patches are consistently applied to SQL Server within the time allowed.",
        "reference": "800-171|3.14.1,800-53|SI-2c.,800-53r5|SI-2c.,CAT|II,CCI|CCI-002605,CN-L3|8.1.4.4(e),CN-L3|8.1.10.5(a),CN-L3|8.1.10.5(b),CN-L3|8.5.4.1(b),CN-L3|8.5.4.1(d),CN-L3|8.5.4.1(e),CSF|ID.RA-1,CSF|PR.IP-12,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-2,NESA|T7.6.2,NESA|T7.7.1,NIAv2|AM38,NIAv2|AM39,NIAv2|SS14b,PCI-DSSv3.2.1|6.2,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.3,QCSC-v1|11.2,Rule-ID|SV-213994r917657_rule,STIG-ID|SQL6-D0-012800,STIG-Legacy|SV-93955,STIG-Legacy|V-79249,SWIFT-CSCv1|2.2,Vuln-ID|V-213994",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT @@VERSION AS 'SQL Server Version';",
        "sql_expect": "ManualReviewRequired"
    },
    "custom_item_77": {
        "description": "auditing",
        "sql_request": "SELECT name AS 'Audit Name', status_desc AS 'Audit Status', CASE audit_file_path WHEN NULL THEN 'null' ELSE audit_file_path END AS 'Current Audit File' FROM sys.dm_server_audit_status",
        "sql_expect": ".+"
    },
    "custom_item_78": {
        "description": "SCHEMA_OBJECT_ACCESS_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SCHEMA_OBJECT_ACCESS_GROUP'",
        "sql_expect": ".+"
    },
    "custom_item_79": {
        "description": "auditing",
        "sql_request": "SELECT name AS 'Audit Name', status_desc AS 'Audit Status', CASE audit_file_path WHEN NULL THEN 'null' ELSE audit_file_path END AS 'Current Audit File' FROM sys.dm_server_audit_status",
        "sql_expect": ".+"
    },
    "custom_item_80": {
        "description": "SCHEMA_OBJECT_ACCESS_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SCHEMA_OBJECT_ACCESS_GROUP'",
        "sql_expect": ".*"
    },
    "custom_item_81": {
        "description": "active audit",
        "sql_request": "SELECT name AS 'Audit Name', status_desc AS 'Audit Status' FROM sys.dm_server_audit_status",
        "sql_expect": ".+"
    },
    "custom_item_82": {
        "description": "DATABASE_OBJECT_OWNERSHIP_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('DATABASE_OBJECT_OWNERSHIP_CHANGE_GROUP')",
        "sql_expect": ".+"
    },
    "custom_item_83": {
        "description": "DATABASE_OBJECT_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('DATABASE_OBJECT_PERMISSION_CHANGE_GROUP')",
        "sql_expect": ".+"
    },
    "custom_item_84": {
        "description": "DATABASE_OWNERSHIP_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('DATABASE_OWNERSHIP_CHANGE_GROUP')",
        "sql_expect": ".+"
    },
    "custom_item_85": {
        "description": "DATABASE_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('DATABASE_PERMISSION_CHANGE_GROUP')",
        "sql_expect": ".+"
    },
    "custom_item_86": {
        "description": "DATABASE_ROLE_MEMBER_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('DATABASE_ROLE_MEMBER_CHANGE_GROUP')",
        "sql_expect": ".+"
    },
    "custom_item_87": {
        "description": "SCHEMA_OBJECT_OWNERSHIP_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SCHEMA_OBJECT_OWNERSHIP_CHANGE_GROUP')",
        "sql_expect": ".+"
    },
    "custom_item_88": {
        "description": "SCHEMA_OBJECT_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SCHEMA_OBJECT_PERMISSION_CHANGE_GROUP')",
        "sql_expect": ".+"
    },
    "custom_item_89": {
        "description": "SERVER_OBJECT_OWNERSHIP_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SERVER_OBJECT_OWNERSHIP_CHANGE_GROUP')",
        "sql_expect": ".+"
    },
    "custom_item_90": {
        "description": "SERVER_OBJECT_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SERVER_OBJECT_PERMISSION_CHANGE_GROUP')",
        "sql_expect": ".+"
    },
    "custom_item_91": {
        "description": "SERVER_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SERVER_PERMISSION_CHANGE_GROUP')",
        "sql_expect": ".+"
    },
    "custom_item_92": {
        "description": "SERVER_ROLE_MEMBER_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SERVER_ROLE_MEMBER_CHANGE_GROUP')",
        "sql_expect": ".+"
    },
    "custom_item_93": {
        "description": "active audit",
        "sql_request": "SELECT name AS 'Audit Name', status_desc AS 'Audit Status' FROM sys.dm_server_audit_status",
        "sql_expect": ".+"
    },
    "custom_item_94": {
        "description": "DATABASE_OBJECT_OWNERSHIP_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('DATABASE_OBJECT_OWNERSHIP_CHANGE_GROUP')",
        "sql_expect": ".+"
    },
    "custom_item_95": {
        "description": "DATABASE_OBJECT_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('DATABASE_OBJECT_PERMISSION_CHANGE_GROUP')",
        "sql_expect": ".+"
    },
    "custom_item_96": {
        "description": "DATABASE_OWNERSHIP_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('DATABASE_OWNERSHIP_CHANGE_GROUP')",
        "sql_expect": ".+"
    },
    "custom_item_97": {
        "description": "DATABASE_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('DATABASE_PERMISSION_CHANGE_GROUP')",
        "sql_expect": ".+"
    },
    "custom_item_98": {
        "description": "DATABASE_ROLE_MEMBER_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('DATABASE_ROLE_MEMBER_CHANGE_GROUP')",
        "sql_expect": ".+"
    },
    "custom_item_99": {
        "description": "SCHEMA_OBJECT_OWNERSHIP_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SCHEMA_OBJECT_OWNERSHIP_CHANGE_GROUP')",
        "sql_expect": ".+"
    },
    "custom_item_100": {
        "description": "SCHEMA_OBJECT_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SCHEMA_OBJECT_PERMISSION_CHANGE_GROUP')",
        "sql_expect": ".+"
    },
    "custom_item_101": {
        "description": "SERVER_OBJECT_OWNERSHIP_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SERVER_OBJECT_OWNERSHIP_CHANGE_GROUP')",
        "sql_expect": ".+"
    },
    "custom_item_102": {
        "description": "SERVER_OBJECT_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SERVER_OBJECT_PERMISSION_CHANGE_GROUP')",
        "sql_expect": ".+"
    },
    "custom_item_103": {
        "description": "SERVER_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SERVER_PERMISSION_CHANGE_GROUP')",
        "sql_expect": ".+"
    },
    "custom_item_104": {
        "description": "SERVER_ROLE_MEMBER_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SERVER_ROLE_MEMBER_CHANGE_GROUP')",
        "sql_expect": ".+"
    },
    "custom_item_105": {
        "description": "auditing",
        "sql_request": "SELECT name AS 'Audit Name', status_desc AS 'Audit Status', CASE audit_file_path WHEN NULL THEN 'null' ELSE audit_file_path END AS 'Current Audit File' FROM sys.dm_server_audit_status",
        "sql_expect": ".+"
    },
    "custom_item_106": {
        "description": "SCHEMA_OBJECT_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SCHEMA_OBJECT_CHANGE_GROUP'",
        "sql_expect": ".*"
    },
    "custom_item_107": {
        "description": "auditing",
        "sql_request": "SELECT name AS 'Audit Name', status_desc AS 'Audit Status', CASE audit_file_path WHEN NULL THEN 'null' ELSE audit_file_path END AS 'Current Audit File' FROM sys.dm_server_audit_status",
        "sql_expect": ".+"
    },
    "custom_item_108": {
        "description": "SCHEMA_OBJECT_ACCESS_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SCHEMA_OBJECT_ACCESS_GROUP'",
        "sql_expect": ".*"
    },
    "custom_item_109": {
        "description": "auditing",
        "sql_request": "SELECT name AS 'Audit Name', status_desc AS 'Audit Status', CASE audit_file_path WHEN NULL THEN 'null' ELSE audit_file_path END AS 'Current Audit File' FROM sys.dm_server_audit_status",
        "sql_expect": ".+"
    },
    "custom_item_110": {
        "description": "SCHEMA_OBJECT_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SCHEMA_OBJECT_CHANGE_GROUP'",
        "sql_expect": ".*"
    },
    "custom_item_111": {
        "description": "auditing",
        "sql_request": "SELECT name AS 'Audit Name', status_desc AS 'Audit Status', CASE audit_file_path WHEN NULL THEN 'null' ELSE audit_file_path END AS 'Current Audit File' FROM sys.dm_server_audit_status",
        "sql_expect": ".+"
    },
    "custom_item_112": {
        "description": "SCHEMA_OBJECT_ACCESS_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SCHEMA_OBJECT_ACCESS_GROUP'",
        "sql_expect": ".*"
    },
    "custom_item_113": {
        "description": "auditing",
        "sql_request": "SELECT name AS 'Audit Name', status_desc AS 'Audit Status', CASE audit_file_path WHEN NULL THEN 'null' ELSE audit_file_path END AS 'Current Audit File' FROM sys.dm_server_audit_status",
        "sql_expect": ".+"
    },
    "custom_item_114": {
        "description": "FAILED_LOGIN_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name IN ('SUCCESSFUL_LOGIN_GROUP', 'FAILED_LOGIN_GROUP')",
        "sql_expect": ".*"
    },
    "custom_item_115": {
        "description": "audit",
        "sql_request": "SELECT name AS 'Audit Name', status_desc AS 'Audit Status', CASE audit_file_path WHEN NULL THEN 'null' ELSE audit_file_path END AS 'Current Audit File' FROM sys.dm_server_audit_status",
        "sql_expect": ".+"
    },
    "custom_item_116": {
        "description": "APPLICATION_ROLE_CHANGE_PASSWORD_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'APPLICATION_ROLE_CHANGE_PASSWORD_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_117": {
        "description": "AUDIT_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'AUDIT_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_118": {
        "description": "BACKUP_RESTORE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'BACKUP_RESTORE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_119": {
        "description": "DATABASE_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'DATABASE_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_120": {
        "description": "DATABASE_OBJECT_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'DATABASE_OBJECT_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_121": {
        "description": "DATABASE_OBJECT_OWNERSHIP_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'DATABASE_OBJECT_OWNERSHIP_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_122": {
        "description": "DATABASE_OBJECT_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'DATABASE_OBJECT_PERMISSION_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_123": {
        "description": "DATABASE_OPERATION_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'DATABASE_OPERATION_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_124": {
        "description": "DATABASE_OWNERSHIP_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'DATABASE_OWNERSHIP_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_125": {
        "description": "DATABASE_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'DATABASE_PERMISSION_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_126": {
        "description": "DATABASE_PRINCIPAL_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'DATABASE_PRINCIPAL_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_127": {
        "description": "DATABASE_PRINCIPAL_IMPERSONATION_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'DATABASE_PRINCIPAL_IMPERSONATION_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_128": {
        "description": "DATABASE_ROLE_MEMBER_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'DATABASE_ROLE_MEMBER_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_129": {
        "description": "DBCC_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'DBCC_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_130": {
        "description": "LOGIN_CHANGE_PASSWORD_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'LOGIN_CHANGE_PASSWORD_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_131": {
        "description": "SCHEMA_OBJECT_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SCHEMA_OBJECT_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_132": {
        "description": "SCHEMA_OBJECT_OWNERSHIP_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SCHEMA_OBJECT_OWNERSHIP_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_133": {
        "description": "SCHEMA_OBJECT_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SCHEMA_OBJECT_PERMISSION_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_134": {
        "description": "SERVER_OBJECT_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SERVER_OBJECT_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_135": {
        "description": "SERVER_OBJECT_OWNERSHIP_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SERVER_OBJECT_OWNERSHIP_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_136": {
        "description": "SERVER_OBJECT_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SERVER_OBJECT_PERMISSION_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_137": {
        "description": "SERVER_OPERATION_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SERVER_OPERATION_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_138": {
        "description": "SERVER_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SERVER_PERMISSION_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_139": {
        "description": "SERVER_PRINCIPAL_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SERVER_PRINCIPAL_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_140": {
        "description": "SERVER_PRINCIPAL_IMPERSONATION_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SERVER_PRINCIPAL_IMPERSONATION_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_141": {
        "description": "SERVER_ROLE_MEMBER_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SERVER_ROLE_MEMBER_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_142": {
        "description": "SERVER_STATE_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SERVER_STATE_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_143": {
        "description": "TRACE_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'TRACE_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_144": {
        "description": "USER_CHANGE_PASSWORD_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'USER_CHANGE_PASSWORD_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_145": {
        "description": "audit",
        "sql_request": "SELECT name AS 'Audit Name', status_desc AS 'Audit Status', CASE audit_file_path WHEN NULL THEN 'null' ELSE audit_file_path END AS 'Current Audit File' FROM sys.dm_server_audit_status",
        "sql_expect": ".+"
    },
    "custom_item_146": {
        "description": "APPLICATION_ROLE_CHANGE_PASSWORD_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'APPLICATION_ROLE_CHANGE_PASSWORD_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_147": {
        "description": "AUDIT_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'AUDIT_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_148": {
        "description": "LOGOUT_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'LOGOUT_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_149": {
        "description": "BACKUP_RESTORE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'BACKUP_RESTORE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_150": {
        "description": "DATABASE_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'DATABASE_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_151": {
        "description": "DATABASE_OBJECT_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'DATABASE_OBJECT_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_152": {
        "description": "DATABASE_OBJECT_OWNERSHIP_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'DATABASE_OBJECT_OWNERSHIP_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_153": {
        "description": "DATABASE_OBJECT_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'DATABASE_OBJECT_PERMISSION_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_154": {
        "description": "DATABASE_OPERATION_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'DATABASE_OPERATION_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_155": {
        "description": "DATABASE_OWNERSHIP_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'DATABASE_OWNERSHIP_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_156": {
        "description": "DATABASE_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'DATABASE_PERMISSION_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_157": {
        "description": "DATABASE_PRINCIPAL_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'DATABASE_PRINCIPAL_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_158": {
        "description": "DATABASE_PRINCIPAL_IMPERSONATION_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'DATABASE_PRINCIPAL_IMPERSONATION_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_159": {
        "description": "DATABASE_ROLE_MEMBER_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'DATABASE_ROLE_MEMBER_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_160": {
        "description": "DBCC_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'DBCC_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_161": {
        "description": "LOGIN_CHANGE_PASSWORD_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'LOGIN_CHANGE_PASSWORD_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_162": {
        "description": "SCHEMA_OBJECT_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SCHEMA_OBJECT_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_163": {
        "description": "SCHEMA_OBJECT_OWNERSHIP_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SCHEMA_OBJECT_OWNERSHIP_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_164": {
        "description": "SCHEMA_OBJECT_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SCHEMA_OBJECT_PERMISSION_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_165": {
        "description": "SERVER_OBJECT_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SERVER_OBJECT_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_166": {
        "description": "SERVER_OBJECT_OWNERSHIP_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SERVER_OBJECT_OWNERSHIP_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_167": {
        "description": "SERVER_OBJECT_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SERVER_OBJECT_PERMISSION_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_168": {
        "description": "SERVER_OPERATION_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SERVER_OPERATION_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_169": {
        "description": "SERVER_PERMISSION_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SERVER_PERMISSION_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_170": {
        "description": "SERVER_PRINCIPAL_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SERVER_PRINCIPAL_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_171": {
        "description": "SERVER_PRINCIPAL_IMPERSONATION_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SERVER_PRINCIPAL_IMPERSONATION_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_172": {
        "description": "SERVER_ROLE_MEMBER_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SERVER_ROLE_MEMBER_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_173": {
        "description": "SERVER_STATE_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SERVER_STATE_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_174": {
        "description": "TRACE_CHANGE_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'TRACE_CHANGE_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_175": {
        "description": "USER_CHANGE_PASSWORD_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'USER_CHANGE_PASSWORD_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_176": {
        "description": "audit",
        "sql_request": "SELECT name AS 'Audit Name', status_desc AS 'Audit Status', CASE audit_file_path WHEN NULL THEN 'null' ELSE audit_file_path END AS 'Current Audit File' FROM sys.dm_server_audit_status",
        "sql_expect": ".+"
    },
    "custom_item_177": {
        "description": "LOGOUT_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'LOGOUT_GROUP';",
        "sql_expect": ".+"
    },
    "custom_item_178": {
        "description": "auditing",
        "sql_request": "SELECT name AS 'Audit Name', status_desc AS 'Audit Status', CASE audit_file_path WHEN NULL THEN 'null' ELSE audit_file_path END AS 'Current Audit File' FROM sys.dm_server_audit_status",
        "sql_expect": ".+"
    },
    "custom_item_179": {
        "description": "SUCCESSFUL_LOGIN_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SUCCESSFUL_LOGIN_GROUP'",
        "sql_expect": ".*"
    },
    "custom_item_180": {
        "description": "auditing",
        "sql_request": "SELECT name AS 'Audit Name', status_desc AS 'Audit Status', CASE audit_file_path WHEN NULL THEN 'null' ELSE audit_file_path END AS 'Current Audit File' FROM sys.dm_server_audit_status",
        "sql_expect": ".+"
    },
    "custom_item_181": {
        "description": "SCHEMA_OBJECT_ACCESS_GROUP",
        "sql_request": "SELECT a.name AS 'AuditName', s.name AS 'SpecName', d.audit_action_name AS 'ActionName', d.audited_result AS 'Result' FROM sys.server_audit_specifications s JOIN sys.server_audits a ON s.audit_guid = a.audit_guid JOIN sys.server_audit_specification_details d ON s.server_specification_id = d.server_specification_id WHERE a.is_state_enabled = 1 AND d.audit_action_name = 'SCHEMA_OBJECT_ACCESS_GROUP'",
        "sql_expect": ".*"
    },
    "custom_item_182": {
        "description": "SQL6-D0-015500 - SQL Server must generate audit records for all direct access to the database(s) - audits.",
        "info": "In this context, direct access is any query, command, or call to SQL Server that comes from any source other than the application(s) that it supports. Examples would be the command line or a database management utility program. The intent is to capture all activity from administrative and non-standard sources.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Check the system documentation for required SQL Server Audits. Remove any Audit filters that exclude or reduce required auditing. Update filters to ensure administrative activity is not excluded.",
        "reference": "800-171|3.3.1,800-171|3.3.2,800-53|AU-12c.,800-53r5|AU-12c.,CAT|II,CCI|CCI-000172,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12c.,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-214021r879879_rule,STIG-ID|SQL6-D0-015500,STIG-Legacy|SV-94009,STIG-Legacy|V-79303,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1,Vuln-ID|V-214021",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT name AS AuditName, predicate AS AuditFilter FROM sys.server_audits WHERE predicate IS NOT NULL",
        "sql_expect": "ManualReviewRequired"
    },
    "custom_item_183": {
        "description": "SQL6-D0-016200 - The SQL Server default account [sa] must be disabled.",
        "info": "SQL Server's [sa] account has special privileges required to administer the database. The [sa] account is a well-known SQL Server account and is likely to be targeted by attackers and thus more prone to providing unauthorized access to the database.\n\nThis [sa] default account is administrative and could lead to catastrophic consequences, including the complete loss of control over SQL Server. If the [sa] default account is not disabled, an attacker might be able to gain access through the account. SQL Server by default disables the [sa] account at installation.\n\nSome applications that run on SQL Server require the [sa] account to be enabled for the application to function properly. These applications that require the [sa] account to be enabled are usually legacy systems.",
        "solution": "Modify the enabled flag of SQL Server's [sa] (system administrator) account by running the following script.\nUSE master;\nGO\nALTER LOGIN [sa] DISABLE;\nGO",
        "reference": "800-171|3.1.1,800-53|AC-3,800-53r5|AC-3,CAT|I,CCI|CCI-000213,CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|PR.AC-4,CSF|PR.PT-3,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS29,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-214028r879530_rule,STIG-ID|SQL6-D0-016200,STIG-Legacy|SV-94023,STIG-Legacy|V-79317,TBA-FIISB|31.1,Vuln-ID|V-214028",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "USE master; SELECT name, CAST(is_disabled as varchar(1)) FROM sys.sql_logins WHERE principal_id = 1",
        "sql_expect": ".*"
    },
    "custom_item_184": {
        "description": "SQL6-D0-016300 - SQL Server default account [sa] must have its name changed.",
        "info": "SQL Server's [sa] account has special privileges required to administer the database. The [sa] account is a well-known SQL Server account name and is likely to be targeted by attackers, and is thus more prone to providing unauthorized access to the database.\n\nSince the SQL Server [sa] is administrative in nature, the compromise of a default account can have catastrophic consequences, including the complete loss of control over SQL Server. Since SQL Server needs for this account to exist and it should not be removed, one way to mitigate this risk is to change the [sa] account name.",
        "solution": "Modify the SQL Server's [sa] (system administrator) account by running the following script:\n\nUSE master;\nGO\nALTER LOGIN [sa] WITH NAME =GO",
        "reference": "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-214029r879587_rule,STIG-ID|SQL6-D0-016300,STIG-Legacy|SV-94025,STIG-Legacy|V-79319,SWIFT-CSCv1|2.3,Vuln-ID|V-214029",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT name AS 'Account Name' FROM sys.sql_logins WHERE name = 'sa'"
    },
    "custom_item_185": {
        "description": "SQL6-D0-016400 - Execution of startup stored procedures must be restricted to necessary cases only.",
        "info": "In certain situations, to provide required functionality, a DBMS needs to execute internal logic (stored procedures, functions, triggers, etc.) and/or external code modules with elevated privileges. However, if the privileges required for execution are at a higher level than the privileges assigned to organizational users invoking the functionality applications/programs, those users are indirectly provided with greater privileges than assigned by organizations.\n\nWhen 'Scan for startup procs' is enabled, SQL Server scans for and runs all automatically run stored procedures defined on the server.  The execution of start-up stored procedures will be done under a high privileged context, therefore it is a commonly used post-exploitation vector.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "To disable start up stored procedure(s), run the following in Master for each undocumented procedure:\n\nsp_procoption @procname = '', @OptionName = 'Startup', @optionValue = 'Off'",
        "reference": "800-171|3.1.5,800-53|AC-6(8),800-53r5|AC-6(8),CAT|II,CCI|CCI-002233,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.10.6(a),CSF|PR.AC-4,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-6,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|5.2.2,QCSC-v1|6.2,Rule-ID|SV-214030r879719_rule,STIG-ID|SQL6-D0-016400,STIG-Legacy|SV-94027,STIG-Legacy|V-79321,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3,Vuln-ID|V-214030",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "Select [name] as StoredProc From sys.procedures Where OBJECTPROPERTY(OBJECT_ID, 'ExecIsStartup') = 1"
    },
    "custom_item_186": {
        "description": "SQL6-D0-016500 - SQL Server Mirroring endpoint must utilize AES encryption.",
        "info": "Information can be either unintentionally or maliciously disclosed or modified during preparation for transmission, including, for example, during aggregation, at protocol transformation points, and during packing/unpacking. These unauthorized disclosures or modifications compromise the confidentiality or integrity of the information.\n\nUse of this requirement will be limited to situations where the data owner has a strict requirement for ensuring data integrity and confidentiality is maintained at every step of the data transfer and handling process.\n\nSQL Mirroring endpoints support different encryption algorithms, including no-encryption. Using a weak encryption algorithm or plaintext in communication protocols can lead to data loss, data manipulation and/or connection hijacking.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Run the following to enable encryption on the mirroring endpoint:\n\nALTER ENDPOINTFOR DATABASE_MIRRORING\n(ENCRYPTION = REQUIRED ALGORITHM AES)",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-214031r879887_rule,STIG-ID|SQL6-D0-016500,STIG-Legacy|SV-94029,STIG-Legacy|V-79323,SWIFT-CSCv1|2.3,Vuln-ID|V-214031",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT name, type_desc, encryption_algorithm_desc FROM sys.database_mirroring_endpoints WHERE encryption_algorithm != 2"
    },
    "custom_item_187": {
        "description": "SQL6-D0-016600 - SQL Server Service Broker endpoint must utilize AES encryption.",
        "info": "Information can be either unintentionally or maliciously disclosed or modified during preparation for transmission, including, for example, during aggregation, at protocol transformation points, and during packing/unpacking. These unauthorized disclosures or modifications compromise the confidentiality or integrity of the information.\n\nUse of this requirement will be limited to situations where the data owner has a strict requirement for ensuring data integrity and confidentiality is maintained at every step of the data transfer and handling process.\n\nSQL Server Service Broker endpoints support different encryption algorithms, including no-encryption. Using a weak encryption algorithm or plaintext in communication protocols can lead to data loss, data manipulation and/or connection hijacking.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Run the following to enable encryption on the Service Broker endpoint:\n\nALTER ENDPOINTFOR SERVICE_BROKER\n(ENCRYPTION = REQUIRED ALGORITHM AES)",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-214032r879887_rule,STIG-ID|SQL6-D0-016600,STIG-Legacy|SV-94031,STIG-Legacy|V-79325,SWIFT-CSCv1|2.3,Vuln-ID|V-214032",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT name, type_desc, encryption_algorithm_desc FROM sys.service_broker_endpoints WHERE encryption_algorithm != 2"
    },
    "custom_item_188": {
        "description": "SQL6-D0-016700 - SQL Server execute permissions to access the registry must be revoked, unless specifically required and approved.",
        "info": "Information systems are capable of providing a wide variety of functions and services. Some of the functions and services, provided by default, may not be necessary to support essential organizational operations (e.g., key missions, functions).\n\nIt is detrimental for applications to provide, or install by default, functionality exceeding requirements or mission objectives.\n\nApplications must adhere to the principles of least functionality by providing only essential capabilities.\n\nSQL Server may spawn additional external processes to execute procedures that are defined in the SQL Server but stored in external host files (external procedures). The spawned process used to execute the external procedure may operate within a different OS security context than SQL Server and provide unauthorized access to the host system.\n\nThe registry contains sensitive information, including password hashes as well as clear text passwords. Registry extended stored procedures allow Microsoft SQL Server to access the machine's registry. The sensitivity of these procedures are exacerbated if Microsoft SQL Server is run under the Windows account LocalSystem. LocalSystem can read and write nearly all values in the registry, even those not accessible by the Administrator. Unlike the xp_cmdshell extended stored procedure, which runs under a separate context if executed by a login not in the sysadmin role, the registry extended stored procedures always execute under the security context of the MSSQLServer service. Because the sensitive information is stored in the registry, it is essential that access to that information be properly guarded.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Remove execute permissions to any registry extended stored procedure from all users (other than dbo).\n\nUSE master\nGO\nREVOKE EXECUTE ON [] FROM []\nGO",
        "reference": "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-214033r879587_rule,STIG-ID|SQL6-D0-016700,STIG-Legacy|SV-94033,STIG-Legacy|V-79327,SWIFT-CSCv1|2.3,Vuln-ID|V-214033",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT OBJECT_NAME(major_id) AS [Stored Procedure],dpr.NAME AS [Principal] FROM sys.database_permissions AS dp INNER JOIN sys.database_principals AS dpr ON dp.grantee_principal_id = dpr.principal_id WHERE major_id IN (OBJECT_ID('xp_regaddmultistring'),OBJECT_ID('xp_regdeletekey'),OBJECT_ID('xp_regdeletevalue'),OBJECT_ID('xp_regenumvalues'),OBJECT_ID('xp_regenumkeys'),OBJECT_ID('xp_regremovemultistring'),OBJECT_ID('xp_regwrite'),OBJECT_ID('xp_instance_regaddmultistring'),OBJECT_ID('xp_instance_regdeletekey'),OBJECT_ID('xp_instance_regdeletevalue'),OBJECT_ID('xp_instance_regenumkeys'),OBJECT_ID('xp_instance_regenumvalues'),OBJECT_ID('xp_instance_regremovemultistring'),OBJECT_ID('xp_instance_regwrite')) AND dp.[type] = 'EX' ORDER BY dpr.NAME;"
    },
    "custom_item_189": {
        "description": "filestream access level",
        "sql_request": "EXEC sp_configure 'filestream access level'",
        "sql_expect": ".*"
    },
    "custom_item_190": {
        "description": "filestream SQL specific option",
        "sql_request": "SELECT CASE WHEN EXISTS (SELECT * FROM sys.configurations WHERE Name = 'filestream access level' AND Cast(value AS INT) = 0) THEN 'No' ELSE 'Yes' END AS TSQLFileStreamAccess;",
        "sql_expect": "No"
    },
    "custom_item_191": {
        "description": "SQL6-D0-017000 - Ole Automation Procedures feature must be disabled, unless specifically required and approved.",
        "info": "Information systems are capable of providing a wide variety of functions and services. Some of the functions and services, provided by default, may not be necessary to support essential organizational operations (e.g., key missions, functions).\n\nIt is detrimental for applications to provide, or install by default, functionality exceeding requirements or mission objectives.\n\nApplications must adhere to the principles of least functionality by providing only essential capabilities.\n\nSQL Server may spawn additional external processes to execute procedures that are defined in the SQL Server but stored in external host files (external procedures). The spawned process used to execute the external procedure may operate within a different OS security context than SQL Server and provide unauthorized access to the host system.\n\nSQL Server is capable of providing a wide range of features and services. Some of the features and services, provided by default, may not be necessary, and enabling them could adversely affect the security of the system.\n\nThe Ole Automation Procedures option controls whether OLE Automation objects can be instantiated within Transact-SQL batches. These are extended stored procedures that allow SQL Server users to execute functions external to SQL Server in the security context of SQL Server.\n\nThe Ole Automation Procedures extended stored procedure allows execution of host executables outside the controls of database access permissions. This access may be exploited by malicious users who have compromised the integrity of the SQL Server database process to control the host operating system to perpetrate additional malicious activity.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Disable use of or remove any external application executable object definitions that are not authorized. To disable the use of 'Ole Automation Procedures' option, from the query prompt:\n\nsp_configure 'show advanced options', 1;\nGO\nRECONFIGURE;\nGO\nsp_configure 'Ole Automation Procedures', 0;\nGO\nRECONFIGURE;\nGO",
        "reference": "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-214035r879587_rule,STIG-ID|SQL6-D0-017000,STIG-Legacy|SV-94039,STIG-Legacy|V-79333,SWIFT-CSCv1|2.3,Vuln-ID|V-214035",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "EXEC SP_CONFIGURE 'show advanced options', '1'; RECONFIGURE WITH OVERRIDE; EXEC SP_CONFIGURE 'Ole Automation Procedures';",
        "sql_expect": "Ole Automation Procedures"
    },
    "custom_item_192": {
        "description": "SQL6-D0-017100 - SQL Server User Options feature must be disabled, unless specifically required and approved.",
        "info": "SQL Server is capable of providing a wide range of features and services. Some of the features and services, provided by default, may not be necessary, and enabling them could adversely affect the security of the system.\n\nThe user options option specifies global defaults for all users. A list of default query processing options is established for the duration of a user's work session. The user options option allows you to change the default values of the SET options (if the server's default settings are not appropriate).\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Disable use of or remove any external application executable object definitions that are not authorized. To disable the use of 'User Options' option, from the query prompt:\n\nsp_configure 'show advanced options', 1;\nGO\nRECONFIGURE;\nGO\nsp_configure 'user options', 0;\nGO\nRECONFIGURE;\nGO",
        "reference": "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-214036r879587_rule,STIG-ID|SQL6-D0-017100,STIG-Legacy|SV-94041,STIG-Legacy|V-79335,SWIFT-CSCv1|2.3,Vuln-ID|V-214036",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "EXEC SP_CONFIGURE 'show advanced options', '1'; RECONFIGURE WITH OVERRIDE; EXEC SP_CONFIGURE 'user options';",
        "sql_expect": "user options"
    },
    "custom_item_193": {
        "description": "SQL6-D0-017200 - Remote Access feature must be disabled, unless specifically required and approved.",
        "info": "Information systems are capable of providing a wide variety of functions and services. Some of the functions and services, provided by default, may not be necessary to support essential organizational operations (e.g., key missions, functions).\n\nIt is detrimental for applications to provide, or install by default, functionality exceeding requirements or mission objectives.\n\nApplications must adhere to the principles of least functionality by providing only essential capabilities.\n\nSQL Server may spawn additional external processes to execute procedures that are defined in the SQL Server but stored in external host files (external procedures). The spawned process used to execute the external procedure may operate within a different OS security context than SQL Server and provide unauthorized access to the host system.\n\nSQL Server is capable of providing a wide range of features and services. Some of the features and services, provided by default, may not be necessary, and enabling them could adversely affect the security of the system.\n\nThe Remote Access option controls the execution of local stored procedures on remote servers or remote stored procedures on local server.  'Remote access' functionality can be abused to launch a Denial-of-Service (DoS) attack on remote servers by off-loading query processing to a target.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Disable use of or remove any external application executable object definitions that are not authorized. To disable the use of 'Remote Access' option, from the query prompt:\n\nsp_configure 'show advanced options', 1;\nGO\nRECONFIGURE;\nGO\nsp_configure 'remote access', 0;\nGO\nRECONFIGURE;\nGO",
        "reference": "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-214037r879587_rule,STIG-ID|SQL6-D0-017200,STIG-Legacy|SV-94043,STIG-Legacy|V-79337,SWIFT-CSCv1|2.3,Vuln-ID|V-214037",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "EXEC SP_CONFIGURE 'show advanced options', '1'; RECONFIGURE WITH OVERRIDE; EXEC SP_CONFIGURE 'remote access';",
        "sql_expect": "remote access"
    },
    "custom_item_194": {
        "description": "SQL6-D0-017400 - Hadoop Connectivity feature must be disabled, unless specifically required and approved.",
        "info": "Information systems are capable of providing a wide variety of functions and services. Some of the functions and services, provided by default, may not be necessary to support essential organizational operations (e.g., key missions, functions).\n\nIt is detrimental for applications to provide, or install by default, functionality exceeding requirements or mission objectives.\n\nApplications must adhere to the principles of least functionality by providing only essential capabilities.\n\nSQL Server may spawn additional external processes to execute procedures that are defined in the SQL Server but stored in external host files (external procedures). The spawned process used to execute the external procedure may operate within a different OS security context than SQL Server and provide unauthorized access to the host system.\n\nSQL Server is capable of providing a wide range of features and services. Some of the features and services, provided by default, may not be necessary, and enabling them could adversely affect the security of the system.\n\nThe Hadoop Connectivity feature allows multiple types of external data sources to be created and used across all sessions on the server.  An exploit to the SQL Server instance could result in a compromise of the host system and external SQL Server resources.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Disable use of or remove any external application executable object definitions that are not authorized. To disable the use of 'Hadoop Connectivity' option, from the query prompt:\n\nsp_configure 'show advanced options', 1;\nGO\nRECONFIGURE;\nGO\nsp_configure 'hadoop connectivity', 0;\nGO\nRECONFIGURE;\nGO",
        "reference": "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-214038r879587_rule,STIG-ID|SQL6-D0-017400,STIG-Legacy|SV-94047,STIG-Legacy|V-79341,SWIFT-CSCv1|2.3,Vuln-ID|V-214038",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "EXEC SP_CONFIGURE 'show advanced options', '1'; RECONFIGURE WITH OVERRIDE; EXEC SP_CONFIGURE 'hadoop connectivity';",
        "sql_expect": "hadoop connectivity"
    },
    "custom_item_195": {
        "description": "SQL6-D0-017500 - Allow Polybase Export feature must be disabled, unless specifically required and approved.",
        "info": "Information systems are capable of providing a wide variety of functions and services. Some of the functions and services, provided by default, may not be necessary to support essential organizational operations (e.g., key missions, functions).\n\nIt is detrimental for applications to provide, or install by default, functionality exceeding requirements or mission objectives.\n\nApplications must adhere to the principles of least functionality by providing only essential capabilities.\n\nSQL Server may spawn additional external processes to execute procedures that are defined in the SQL Server but stored in external host files (external procedures). The spawned process used to execute the external procedure may operate within a different OS security context than SQL Server and provide unauthorized access to the host system.\n\nSQL Server is capable of providing a wide range of features and services. Some of the features and services, provided by default, may not be necessary, and enabling them could adversely affect the security of the system.\n\nThe Allow Polybase Export feature allows an export of data to an external data source such as Hadoop File System or Azure Data Lake. An exploit to the SQL Server instance could result in a compromise of the host system and external SQL Server resources.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Disable use of or remove any external application executable object definitions that are not authorized. To disable the use of 'Allow Polybase Export' option, from the query prompt:\n\nsp_configure 'show advanced options', 1;\nGO\nRECONFIGURE;\nGO\nsp_configure 'allow polybase export', 0;\nGO\nRECONFIGURE;\nGO",
        "reference": "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-214039r879587_rule,STIG-ID|SQL6-D0-017500,STIG-Legacy|SV-94049,STIG-Legacy|V-79343,SWIFT-CSCv1|2.3,Vuln-ID|V-214039",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "EXEC SP_CONFIGURE 'show advanced options', '1'; RECONFIGURE WITH OVERRIDE; EXEC SP_CONFIGURE 'allow polybase export';",
        "sql_expect": "allow polybase export"
    },
    "custom_item_196": {
        "description": "SQL6-D0-017600 - Remote Data Archive feature must be disabled, unless specifically required and approved.",
        "info": "Information systems are capable of providing a wide variety of functions and services. Some of the functions and services, provided by default, may not be necessary to support essential organizational operations (e.g., key missions, functions).\n\nIt is detrimental for applications to provide, or install by default, functionality exceeding requirements or mission objectives.\n\nApplications must adhere to the principles of least functionality by providing only essential capabilities.\n\nSQL Server may spawn additional external processes to execute procedures that are defined in the SQL Server but stored in external host files (external procedures). The spawned process used to execute the external procedure may operate within a different OS security context than SQL Server and provide unauthorized access to the host system.\n\nSQL Server is capable of providing a wide range of features and services. Some of the features and services, provided by default, may not be necessary, and enabling them could adversely affect the security of the system.\n\nThe Remote Data Archive feature allows an export of local SQL Server data to an Azure SQL Database. An exploit to the SQL Server instance could result in a compromise of the host system and external SQL Server resources.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Disable use of or remove any external application executable object definitions that are not authorized. To disable the use of 'Remote Data Archive' option, from the query prompt:\n\nsp_configure 'show advanced options', 1;\nGO\nRECONFIGURE;\nGO\nsp_configure 'remote data archive', 0;\nGO\nRECONFIGURE;\nGO",
        "reference": "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-214040r879587_rule,STIG-ID|SQL6-D0-017600,STIG-Legacy|SV-94051,STIG-Legacy|V-79345,SWIFT-CSCv1|2.3,Vuln-ID|V-214040",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "EXEC SP_CONFIGURE 'show advanced options', '1'; RECONFIGURE WITH OVERRIDE; EXEC SP_CONFIGURE 'remote data archive';",
        "sql_expect": "remote data archive"
    },
    "custom_item_197": {
        "description": "SQL6-D0-017700 - SQL Server External Scripts Enabled feature must be disabled, unless specifically required and approved.",
        "info": "SQL Server is capable of providing a wide range of features and services. Some of the features and services, provided by default, may not be necessary, and enabling them could adversely affect the security of the system.\n\nThe External Scripts Enabled feature allows scripts external to SQL such as files located in an R library to be executed.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Disable use of or remove any external application executable object definitions that are not authorized. To disable the use of 'External Scripts Enabled' option, from the query prompt:\n\nsp_configure 'show advanced options', 1;\nGO\nRECONFIGURE;\nGO\nsp_configure 'external scripts enabled', 0;\nGO\nRECONFIGURE;\nGO",
        "reference": "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-214041r879587_rule,STIG-ID|SQL6-D0-017700,STIG-Legacy|SV-94053,STIG-Legacy|V-79347,SWIFT-CSCv1|2.3,Vuln-ID|V-214041",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "EXEC SP_CONFIGURE 'show advanced options', '1'; RECONFIGURE WITH OVERRIDE; EXEC SP_CONFIGURE 'external scripts enabled';",
        "sql_expect": "external scripts enabled"
    },
    "custom_item_198": {
        "description": "SQL6-D0-017900 - SQL Server Replication Xps feature must be disabled, unless specifically required and approved.",
        "info": "SQL Server is capable of providing a wide range of features and services. Some of the features and services, provided by default, may not be necessary, and enabling them could adversely affect the security of the system.\n\nEnabling the replication XPs opens a significant attack surface area that can be used by an attacker to gather information about the system and potentially abuse the privileges of SQL Server.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Disable use of or remove any external application executable object definitions that are not authorized. To disable the use of 'Replication Xps' option, from the query prompt:\n\nsp_configure 'show advanced options', 1;\nGO\nRECONFIGURE;\nGO\nsp_configure 'replication xps', 0;\nGO\nRECONFIGURE;\nGO",
        "reference": "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-214043r879587_rule,STIG-ID|SQL6-D0-017900,STIG-Legacy|SV-94057,STIG-Legacy|V-79351,SWIFT-CSCv1|2.3,Vuln-ID|V-214043",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "EXEC SP_CONFIGURE 'show advanced options', '1'; RECONFIGURE WITH OVERRIDE; EXEC SP_CONFIGURE 'replication xps';",
        "sql_expect": "replication xps"
    },
    "custom_item_199": {
        "description": "SQL6-D0-018000 - If the SQL Server Browser Service is specifically required and approved, SQL instances must be hidden.",
        "info": "The SQL Server Browser simplifies the administration of SQL Server, particularly when multiple instances of SQL Server coexist on the same computer. It avoids the need to hard-assign port numbers to the instances and to set and maintain those port numbers in client systems. It enables administrators and authorized users to discover database management system instances, and the databases they support, over the network. SQL Server uses the SQL Server Browser service to enumerate instances of the Database Engine installed on the computer. This enables client applications to browse for a server, and helps clients distinguish between multiple instances of the Database Engine on the same computer.\n\nThis convenience also presents the possibility of unauthorized individuals gaining knowledge of the available SQL Server resources. Therefore, it is necessary to consider whether the SQL Server Browser is needed. Typically, if only a single instance is installed, using the default name (MSSQLSERVER) and port assignment (1433), the Browser is not adding any value. The more complex the installation, the more likely SQL Server Browser is to be helpful.\n\nThis requirement is not intended to prohibit use of the Browser service in any circumstances.  It calls for administrators and management to consider whether the benefits of its use outweigh the potential negative consequences of it being used by an attacker to browse the current infrastructure and retrieve a list of running SQL Server instances.  In order to prevent this, the SQL instance(s) can be hidden.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "If SQL Server Browser is needed, document the justification and obtain the appropriate authorization.\n\nTo hide the SQL instance, in SQL Server Configuration Manager, expand SQL Server Network Configuration, right-click Protocols for, select 'Properties', on the 'Flags' tab, select 'Yes' in the 'HideInstance' box, then click 'OK'.  The change takes effect immediately for new connections.",
        "reference": "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|III,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-214044r879887_rule,STIG-ID|SQL6-D0-018000,STIG-Legacy|SV-94059,STIG-Legacy|V-79353,SWIFT-CSCv1|2.3,Vuln-ID|V-214044",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "DECLARE @HiddenInstance INT EXEC master.dbo.Xp_instance_regread N'HKEY_LOCAL_MACHINE', N'Software\\Microsoft\\MSSQLServer\\MSSQLServer\\SuperSocketNetLib', N'HideInstance', @HiddenInstance output SELECT CASE WHEN @HiddenInstance = 0 AND Serverproperty('IsClustered') = 0 THEN 'No' ELSE 'Yes' END AS [Hidden]",
        "sql_expect": "Yes"
    },
    "custom_item_200": {
        "description": "SQL6-D0-018100 - When using command-line tools such as SQLCMD in a mixed-mode authentication environment, users must use a logon method that does not expose the password.",
        "info": "To prevent the compromise of authentication information, such as passwords and PINs, during the authentication process, the feedback from the information system must not provide any information that would allow an unauthorized user to compromise the authentication mechanism.\n\nObfuscation of user-provided information when typed into the system is a method used in addressing this risk.\n\nFor example, displaying asterisks when a user types in a password or PIN, is an example of obscuring feedback of authentication information.\n\nThis requirement is applicable when mixed-mode authentication is enabled.  When this is the case, password-authenticated accounts can be created in and authenticated by SQL Server.  Other STIG requirements prohibit the use of mixed-mode authentication except when justified and approved.  This deals with the exceptions.\n\nSQLCMD and other command-line tools are part of any SQL Server installation. These tools can accept a plain-text password, but do offer alternative techniques. Since the typical user of these tools is a database administrator, the consequences of password compromise are particularly serious. Therefore, the use of plain-text passwords must be prohibited, as a matter of practice and procedure.",
        "solution": "Where possible, change the login mode to Windows-only:\nUSE [master]\nGO\nEXEC xp_instance_regwrite N'HKEY_LOCAL_MACHINE', N'Software\\Microsoft\\MSSQLServer\\MSSQLServer', N'LoginMode', REG_DWORD, 1;\nGO\n\nIf mixed-mode authentication is necessary, then for SQLCMD, which cannot be configured not to accept a plain-text password when mixed-mode authentication is enabled, and any other essential tool with the same limitation:\n1) Document the need for it, who uses it, and any relevant mitigations, and obtain AO approval.\n2) Train all users of the tool in the importance of not using the plain-text password option and in how to keep the password hidden.",
        "reference": "800-171|3.5.11,800-53|IA-6,800-53r5|IA-6,CAT|I,CCI|CCI-000206,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(d),ITSG-33|IA-6,ITSG-33|IA-6a.,NESA|T5.5.1,QCSC-v1|13.2,Rule-ID|SV-214045r879615_rule,STIG-ID|SQL6-D0-018100,STIG-Legacy|SV-94061,STIG-Legacy|V-79355,Vuln-ID|V-214045",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "EXEC master.sys.xp_loginconfig 'login mode';",
        "sql_expect": "login mode"
    },
    "custom_item_201": {
        "description": "SQL6-D0-018300 - Microsoft SQL Server products must be a version supported by the vendor.",
        "info": "Unsupported commercial and database systems should not be used because fixes to newly identified bugs will not be implemented by the vendor. The lack of support can result in potential vulnerabilities.\n\nSystems at unsupported servicing levels or releases will not receive security updates for new vulnerabilities, which leaves them subject to exploitation.\n\nWhen maintenance updates and patches are no longer available, the database software is no longer considered supported and should be upgraded or decommissioned.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Remove or decommission all unsupported software products.\n\nUpgrade unsupported DBMS or unsupported components to a supported version of the product.\n\nMore information can be found here:\nhttps://learn.microsoft.com/en-us/sql/sql-server/end-of-support/sql-server-end-of-support-overview?view=sql-server-ver16",
        "reference": "800-53|SA-22a.,800-53r5|SA-22a.,CAT|I,CCI|CCI-003376,DISA_Benchmark|MS_SQL_Server_2016_Instance_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),Rule-ID|SV-259739r972858_rule,STIG-ID|SQL6-D0-018300,Vuln-ID|V-259739",
        "see_also": "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_SQL_Server_2016_Y24M04_STIG.zip",
        "sql_request": "SELECT @@VERSION;",
        "sql_expect": "ManualReviewRequired"
    }
}