{
    "custom_item_1": {
        "description": "1.3.6 Ensure the customer lockbox feature is enabled",
        "info": "Customer Lockbox is a security feature that provides an additional layer of control and transparency to customer data in Microsoft 365. It offers an approval process for Microsoft support personnel to access organization data and creates an audited trail to meet compliance requirements.\n\nRationale:\n\nEnabling this feature protects organizational data against data spillage and exfiltration.\n\nImpact:\n\nAdministrators will need to grant Microsoft access to the tenant environment prior to a Microsoft engineer accessing the environment for support or troubleshooting.",
        "solution": "To enable the Customer Lockbox feature:\n\nNavigate to Microsoft 365 admin center https://admin.microsoft.com.\n\nClick to expand Settings then select Org settings.\n\nSelect Security & privacy tab.\n\nClick Customer lockbox.\n\nCheck the box Require approval for all data access requests.\n\nClick Save.\n\nTo set the Customer Lockbox feature to enabled using PowerShell:\n\nConnect to Exchange Online using Connect-ExchangeOnline.\n\nRun the following PowerShell command:\n\nSet-OrganizationConfig -CustomerLockBoxEnabled $true\n\nDefault Value:\n\nRequire approval for all data access requests - Unchecked\n\nCustomerLockboxEnabled - False",
        "reference": "800-171|3.1.5,800-53|AC-6,800-53r5|AC-6,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.10.6(a),CSF|PR.AC-4,CSF|PR.DS-5,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-6,LEVEL|2A,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3",
        "see_also": "https://workbench.cisecurity.org/benchmarks/15279",
        "request": "listSecureScores",
        "regex": "Feature in place:",
        "expect": "Feature in place: true"
    },
    "custom_item_2": {
        "description": "5.2.2.6 Enable Azure AD Identity Protection user risk policies",
        "info": "Microsoft Entra ID Protection user risk policies detect the probability that a user account has been compromised.\n\nNote: While Identity Protection also provides two risk policies with limited conditions, Microsoft highly recommends setting up risk-based policies in Conditional Access as opposed to the 'legacy method' for the following benefits:\n\nEnhanced diagnostic data\n\nReport-only mode integration\n\nGraph API support\n\nUse more Conditional Access attributes like sign-in frequency in the policy\n\nRationale:\n\nWith the user risk policy turned on, Entra ID protection detects the probability that a user account has been compromised. Administrators can configure a user risk conditional access policy to automatically respond to a specific user risk level.\n\nImpact:\n\nUpon policy activation, account access will be either blocked or the user will be required to use multi-factor authentication (MFA) and change their password. Users without registered MFA will be denied access, necessitating an admin to recover the account. To avoid inconvenience, it is advised to configure the MFA registration policy for all users under the User Risk policy.\n\nAdditionally, users identified in the Risky Users section will be affected by this policy. To gain a better understanding of the impact on the organization's environment, the list of Risky Users should be reviewed before enforcing the policy.",
        "solution": "To configure a User risk policy, use the following steps:\n\nNavigate to the Microsoft Entra admin center https://entra.microsoft.com.\n\nClick expand Protection > Conditional Access select Policies.\n\nCreate a new policy by selecting New policy.\n\nSet the following conditions within the policy:\n\nUnder Users or workload identities choose All users\n\nUnder Cloud apps or actions choose All cloud apps\n\nUnder Conditions choose User risk then Yes and select the user risk level High.\n\nUnder Access Controls select Grant then in the right pane click Grant access then select Require multifactor authentication and Require password change.\n\nUnder Session ensure Sign-in frequency is set to Every time.\n\nClick Select.\n\nYou may opt to begin in a state of Report Only as you step through implementation however, the policy will need to be set to On to be in effect.\n\nClick Create.\n\nNOTE: for more information regarding risk levels refer to Microsoft's Identity Protection & Risk Doc",
        "reference": "800-171|3.14.6,800-171|3.14.7,800-53|SI-4,800-53|SI-4(4),800-53r5|SI-4,800-53r5|SI-4(4),CN-L3|7.1.2.2(c),CN-L3|7.1.3.5(a),CN-L3|8.1.10.5(b),CN-L3|8.1.10.6(f),CSCv7|16.13,CSCv8|13.3,CSF|DE.AE-1,CSF|DE.AE-2,CSF|DE.AE-3,CSF|DE.AE-4,CSF|DE.CM-1,CSF|DE.CM-5,CSF|DE.CM-6,CSF|DE.CM-7,CSF|DE.DP-2,CSF|DE.DP-3,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.DS-5,CSF|PR.IP-8,CSF|RS.AN-1,CSF|RS.CO-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|SI-4,ITSG-33|SI-4(4),LEVEL|2M,NESA|M1.2.2,NIAv2|NS32,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|6.5",
        "see_also": "https://workbench.cisecurity.org/benchmarks/15279",
        "request": "listSecureScores",
        "regex": "You have [0-9]+ users out of [0-9]+ that do not have user risk policy enabled",
        "expect": "You have 0 users out of [0-9]+ that do not have user risk policy enabled"
    },
    "custom_item_3": {
        "description": "5.2.2.7 Enable Azure AD Identity Protection sign-in risk policies",
        "info": "Microsoft Entra ID Protection sign-in risk detects risks in real-time and offline. A risky sign-in is an indicator for a sign-in attempt that might not have been performed by the legitimate owner of a user account.\n\nNote: While Identity Protection also provides two risk policies with limited conditions, Microsoft highly recommends setting up risk-based policies in Conditional Access as opposed to the 'legacy method' for the following benefits:\n\nEnhanced diagnostic data\n\nReport-only mode integration\n\nGraph API support\n\nUse more Conditional Access attributes like sign-in frequency in the policy\n\nRationale:\n\nTurning on the sign-in risk policy ensures that suspicious sign-ins are challenged for multi-factor authentication.\n\nImpact:\n\nWhen the policy triggers, the user will need MFA to access the account. In the case of a user who hasn't registered MFA on their account, they would be blocked from accessing their account. It is therefore recommended that the MFA registration policy be configured for all users who are a part of the Sign-in Risk policy.",
        "solution": "To configure a Sign-In risk policy, use the following steps:\n\nNavigate to the Microsoft Entra admin center https://entra.microsoft.com.\n\nClick expand Protection > Conditional Access select Policies.\n\nCreate a new policy by selecting New policy.\n\nSet the following conditions within the policy.\n\nUnder Users or workload identities choose All users\n\nUnder Cloud apps or actions choose All cloud apps\n\nUnder Conditions choose Sign-in risk then Yes and check the risk level boxes High and Medium\n\nUnder Access Controls select Grant then in the right pane click Grant access then select Require multifactor authentication.\n\nUnder Session select Sign-in Frequency and set to Every time.\n\nClick Select\n\nYou may opt to begin in a state of Report Only as you step through implementation however, the policy will need to be set to On to be in effect.\n\nClick Create.\n\nNOTE: for more information regarding risk levels refer to Microsoft's Identity Protection & Risk Doc",
        "reference": "800-171|3.14.6,800-171|3.14.7,800-53|SI-4,800-53|SI-4(4),800-53r5|SI-4,800-53r5|SI-4(4),CN-L3|7.1.2.2(c),CN-L3|7.1.3.5(a),CN-L3|8.1.10.5(b),CN-L3|8.1.10.6(f),CSCv7|16.13,CSCv8|13.3,CSF|DE.AE-1,CSF|DE.AE-2,CSF|DE.AE-3,CSF|DE.AE-4,CSF|DE.CM-1,CSF|DE.CM-5,CSF|DE.CM-6,CSF|DE.CM-7,CSF|DE.DP-2,CSF|DE.DP-3,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.DS-5,CSF|PR.IP-8,CSF|RS.AN-1,CSF|RS.CO-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|SI-4,ITSG-33|SI-4(4),LEVEL|2M,NESA|M1.2.2,NIAv2|NS32,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|6.5",
        "see_also": "https://workbench.cisecurity.org/benchmarks/15279",
        "request": "listSecureScores",
        "regex": "You have [0-9]+ of [0-9]+ users that don't have the sign-in risky policy turned on",
        "expect": "You have 0 of [0-9]+ users that don't have the sign-in risky policy turned on"
    },
    "custom_item_4": {
        "description": "5.3.1 Ensure 'Privileged Identity Management' is used to manage roles",
        "info": "Microsoft Entra Privileged Identity Management can be used to audit roles, allow just in time activation of roles and allow for periodic role attestation. Organizations should remove permanent members from privileged Office 365 roles and instead make them eligible, through a JIT activation workflow.\n\nRationale:\n\nOrganizations want to minimize the number of people who have access to secure information or resources, because that reduces the chance of a malicious actor getting that access, or an authorized user inadvertently impacting a sensitive resource. However, users still need to carry out privileged operations in Entra ID. Organizations can give users just-in-time (JIT) privileged access to roles. There is a need for oversight for what those users are doing with their administrator privileges. PIM helps to mitigate the risk of excessive, unnecessary, or misused access rights.\n\nImpact:\n\nImplementation of Just in Time privileged access is likely to necessitate changes to administrator routine. Administrators will only be granted access to administrative roles when required. When administrators request role activation, they will need to document the reason for requiring role access, anticipated time required to have the access, and to reauthenticate to enable role access.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "To remediate using the UI:\n\nNavigate to Microsoft Entra admin center https://entra.microsoft.com/.\n\nClick to expand Identity Governance select Privileged Identity Management.\n\nSelect Microsoft Entra Roles.\n\nSelect Roles beneath Manage.\n\nInspect at a minimum the following sensitive roles. For each of the members that have an ASSIGNMENT TYPE of Permanent, click on the ... and choose Make eligible:\nApplication Administrator\nAuthentication Administrator\nBilling Administrator\nCloud Application Administrator\nCloud Device Administrator\nCompliance Administrator\nCustomer LockBox Access Approver\nDevice Administrators\nExchange Administrators\nGlobal Administrators\nHelpDesk Administrator\nInformation Protection Administrator\nIntune Service Administrator\nKaizala Administrator\nLicense Administrator\nPassword Administrator\nPowerBI Service Administrator\nPrivileged Authentication Administrator\nPrivileged Role Administrator\nSecurity Administrator\nSharePoint Service Administrator\nSkype for Business Administrator\nTeams Service Administrator\nUser Administrator",
        "reference": "800-171|3.1.1,800-171|3.5.2,800-171|3.5.5,800-171|3.5.6,800-53|AC-1,800-53|AC-2,800-53|AC-2(1),800-53|IA-4,800-53|IA-5,800-53r5|AC-1,800-53r5|AC-2,800-53r5|AC-2(1),800-53r5|IA-4,800-53r5|IA-5,CN-L3|7.1.2.7(b),CN-L3|7.1.3.2(d),CN-L3|8.1.4.2(e),CN-L3|8.1.10.6(c),CSCv7|4.1,CSCv8|6.1,CSCv8|6.2,CSF|DE.CM-1,CSF|DE.CM-3,CSF|ID.GV-1,CSF|ID.GV-3,CSF|PR.AC-1,CSF|PR.AC-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.1.1,ISO/IEC-27001|A.9.2.1,ITSG-33|AC-1,ITSG-33|AC-2,ITSG-33|AC-2(1),ITSG-33|IA-4,ITSG-33|IA-5,LEVEL|2M,NESA|M1.2.2,NESA|T5.2.3,NIAv2|AM28,NIAv2|AM29,NIAv2|AM30,NIAv2|NS5j,NIAv2|SS14e,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,SWIFT-CSCv1|5",
        "see_also": "https://workbench.cisecurity.org/benchmarks/15279",
        "request": "listDirectoryRoleMembers",
        "regex": ".*",
        "expect": "Members: None$"
    }
}