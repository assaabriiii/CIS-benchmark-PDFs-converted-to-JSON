{
    "custom_item_1": {
        "description": "List Users",
        "request": "listUsers",
        "regex": ".+",
        "not_expect": ".+"
    },
    "custom_item_2": {
        "description": "Role Definitions",
        "request": "listRoleDefinitions",
        "regex": ".+",
        "not_expect": ".+"
    },
    "custom_item_3": {
        "description": "Role Assignments",
        "request": "listRoleAssignments",
        "regex": ".+",
        "not_expect": ".+"
    },
    "custom_item_4": {
        "description": "2.1.1 Ensure That Microsoft Defender for Servers Is Set to 'On'",
        "info": "Turning on Microsoft Defender for Servers enables threat detection for Servers, providing threat intelligence, anomaly detection, and behavior analytics in the Microsoft Defender for Cloud.\n\nRationale:\n\nEnabling Microsoft Defender for Servers allows for greater defense-in-depth, with threat detection provided by the Microsoft Security Response Center (MSRC).\n\nImpact:\n\nTurning on Microsoft Defender for Servers in Microsoft Defender for Cloud incurs an additional cost per resource.",
        "solution": "From Azure Portal\n\nGo to Microsoft Defender for Cloud\n\nSelect Environment Settings\n\nClick on the subscription name\n\nSelect Defender plans\n\nSet Server Status to On\n\nSelect Save\n\nFrom Azure CLI\nRun the following command:\n\naz security pricing create -n VirtualMachines --tier 'standard'\n\nFrom PowerShell\nRun the following command:\n\nSet-AzSecurityPricing -Name 'VirtualMachines' -PricingTier 'Standard'\n\nDefault Value:\n\nBy default, Microsoft Defender plan is off.",
        "reference": "800-171|3.11.2,800-171|3.11.3,800-171|3.14.2,800-171|3.14.4,800-171|3.14.5,800-53|RA-5,800-53|SI-3,800-53r5|RA-5,800-53r5|SI-3,CN-L3|7.1.3.6(b),CN-L3|8.1.4.5,CN-L3|8.1.9.6(a),CN-L3|8.1.9.6(b),CN-L3|8.1.10.5(b),CN-L3|8.1.10.7(a),CN-L3|8.1.10.7(b),CSCv7|3.1,CSCv7|8.1,CSCv8|7.5,CSCv8|10.1,CSF|DE.CM-4,CSF|DE.CM-8,CSF|DE.DP-3,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.IP-12,CSF|RS.CO-3,CSF|RS.MI-3,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.2.1,ISO/IEC-27001|A.12.6.1,ITSG-33|RA-5,ITSG-33|SI-3,LEVEL|2A,NESA|M1.2.2,NESA|M5.4.1,NESA|T7.7.1,NIAv2|GS8a,PCI-DSSv3.2.1|5.1,PCI-DSSv3.2.1|5.1.1,PCI-DSSv3.2.1|6.1,PCI-DSSv4.0|5.2.1,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|2.7,TBA-FIISB|49.2.1,TBA-FIISB|49.2.2,TBA-FIISB|49.3.1,TBA-FIISB|49.3.2,TBA-FIISB|50.2.1,TBA-FIISB|51.2.4,TBA-FIISB|51.2.7",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listPricings",
        "regex": "Name: VirtualMachines Pricing Tier:",
        "expect": "Name: VirtualMachines Pricing Tier: Standard"
    },
    "custom_item_5": {
        "description": "2.1.2 Ensure That Microsoft Defender for App Services Is Set To 'On'",
        "info": "Turning on Microsoft Defender for App Service enables threat detection for App Service, providing threat intelligence, anomaly detection, and behavior analytics in the Microsoft Defender for Cloud.\n\nRationale:\n\nEnabling Microsoft Defender for App Service allows for greater defense-in-depth, with threat detection provided by the Microsoft Security Response Center (MSRC).\n\nImpact:\n\nTurning on Microsoft Defender for App Service incurs an additional cost per resource.",
        "solution": "From Azure Portal\n\nGo to Microsoft Defender for Cloud\n\nSelect Environment Settings\n\nClick on the subscription name\n\nSelect Defender plans\n\nSet App Service Status to On\n\nSelect Save\n\nFrom Azure CLI\nRun the following command:\n\naz security pricing create -n Appservices --tier 'standard'\n\nFrom PowerShell\nRun the following command:\n\nSet-AzSecurityPricing -Name 'AppServices' -PricingTier 'Standard'\n\nDefault Value:\n\nBy default, Microsoft Defender plan is off.",
        "reference": "800-171|3.11.2,800-171|3.11.3,800-53|RA-5,800-53|SA-15,800-53r5|RA-5,800-53r5|SA-15,CSCv7|3.1,CSCv8|7.5,CSCv8|7.6,CSCv8|16.11,CSF|DE.CM-8,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.IP-2,CSF|PR.IP-12,CSF|RS.CO-3,CSF|RS.MI-3,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.6.1,ITSG-33|RA-5,LEVEL|2A,NESA|M1.2.2,NESA|M5.4.1,NESA|T7.7.1,NIAv2|SS5,NIAv2|SS6a,PCI-DSSv3.2.1|6.1,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.1,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|2.7",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listPricings",
        "regex": "Name: AppServices Pricing Tier:",
        "expect": "Name: AppServices Pricing Tier: Standard"
    },
    "custom_item_6": {
        "description": "2.1.3 Ensure That Microsoft Defender for (Managed Instance) Azure SQL Databases Is Set To 'On'",
        "info": "Turning on Microsoft Defender for Azure SQL Databases enables threat detection for Managed Instance Azure SQL databases, providing threat intelligence, anomaly detection, and behavior analytics in Microsoft Defender for Cloud.\n\nRationale:\n\nEnabling Microsoft Defender for Azure SQL Databases allows for greater defense-in-depth, includes functionality for discovering and classifying sensitive data, surfacing and mitigating potential database vulnerabilities, and detecting anomalous activities that could indicate a threat to your database.\n\nImpact:\n\nTurning on Microsoft Defender for Azure SQL Databases incurs an additional cost per resource.",
        "solution": "From Azure Portal\n\nGo to Microsoft Defender for Cloud.\n\nSelect Environment Settings blade.\n\nClick on the subscription name.\n\nSelect the Defender plans blade.\n\nClick Select types > in the row for Databases.\n\nSet the radio button next to Azure SQL Databases to On.\n\nSelect Continue.\n\nSelect Save.\n\nFrom Azure CLI\nRun the following command:\n\naz security pricing create -n SqlServers --tier 'standard'\n\nFrom PowerShell\nRun the following command:\n\nSet-AzSecurityPricing -Name 'SqlServers' -PricingTier 'Standard'\n\nDefault Value:\n\nBy default, Microsoft Defender plan is off.",
        "reference": "800-171|3.11.2,800-171|3.11.3,800-53|RA-5,800-53|SA-15,800-53r5|RA-5,800-53r5|SA-15,CSCv7|3.1,CSCv8|7.5,CSCv8|16.11,CSF|DE.CM-8,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.IP-2,CSF|PR.IP-12,CSF|RS.CO-3,CSF|RS.MI-3,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.6.1,ITSG-33|RA-5,LEVEL|2A,NESA|M1.2.2,NESA|M5.4.1,NESA|T7.7.1,NIAv2|SS5,NIAv2|SS6a,PCI-DSSv3.2.1|6.1,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.1,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|2.7",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listPricings",
        "regex": "Name: (SqlServers|SqlServerVirtualMachines|OpenSourceRelationalDatabases|CosmosDbs) Pricing Tier:",
        "expect": "Name: (SqlServers|SqlServerVirtualMachines|OpenSourceRelationalDatabases|CosmosDbs) Pricing Tier: Standard"
    },
    "custom_item_7": {
        "description": "2.1.4 Ensure That Microsoft Defender for SQL Servers on Machines Is Set To 'On'",
        "info": "Turning on Microsoft Defender for SQL servers on machines enables threat detection for SQL servers on machines, providing threat intelligence, anomaly detection, and behavior analytics in Microsoft Defender for Cloud.\n\nRationale:\n\nEnabling Microsoft Defender for SQL servers on machines allows for greater defense-in-depth, functionality for discovering and classifying sensitive data, surfacing and mitigating potential database vulnerabilities, and detecting anomalous activities that could indicate a threat to your database.\n\nImpact:\n\nTurning on Microsoft Defender for SQL servers on machines incurs an additional cost per resource.",
        "solution": "From Azure Portal\n\nGo to Microsoft Defender for Cloud.\n\nSelect Environment Settings blade.\n\nClick on the subscription name.\n\nSelect the Defender plans blade.\n\nClick Select types > in the row for Databases.\n\nSet the radio button next to SQL servers on machines to On.\n\nSelect Continue.\n\nSelect Save.\n\nFrom Azure CLI\nRun the following command:\n\naz security pricing create -n SqlServerVirtualMachines --tier 'standard'\n\nFrom PowerShell\nRun the following command:\n\nSet-AzSecurityPricing -Name 'SqlServerVirtualMachines' -PricingTier 'Standard'\n\nDefault Value:\n\nBy default, Microsoft Defender plan is off.",
        "reference": "800-171|3.11.2,800-171|3.11.3,800-53|RA-5,800-53|SA-15,800-53r5|RA-5,800-53r5|SA-15,CSCv7|3.1,CSCv8|7.5,CSCv8|16.11,CSF|DE.CM-8,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.IP-2,CSF|PR.IP-12,CSF|RS.CO-3,CSF|RS.MI-3,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.6.1,ITSG-33|RA-5,LEVEL|2A,NESA|M1.2.2,NESA|M5.4.1,NESA|T7.7.1,NIAv2|SS5,NIAv2|SS6a,PCI-DSSv3.2.1|6.1,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.1,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|2.7",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listPricings",
        "regex": "Name: SqlServerVirtualMachines Pricing Tier:",
        "expect": "Name: SqlServerVirtualMachines Pricing Tier: Standard"
    },
    "custom_item_8": {
        "description": "2.1.5 Ensure That Microsoft Defender for Open-Source Relational Databases Is Set To 'On'",
        "info": "Turning on Microsoft Defender for Open-source relational databases enables threat detection for Open-source relational databases, providing threat intelligence, anomaly detection, and behavior analytics in the Microsoft Defender for Cloud.\n\nRationale:\n\nEnabling Microsoft Defender for Open-source relational databases allows for greater defense-in-depth, with threat detection provided by the Microsoft Security Response Center (MSRC).\n\nImpact:\n\nTurning on Microsoft Defender for Open-source relational databases incurs an additional cost per resource.",
        "solution": "From Azure Portal\n\nGo to Microsoft Defender for Cloud.\n\nSelect Environment Settings blade.\n\nClick on the subscription name.\n\nSelect the Defender plans blade.\n\nClick Select types > in the row for Databases.\n\nSet the radio button next to Open-source relational databases to On.\n\nSelect Continue.\n\nSelect Save.\n\nFrom Azure CLI\nRun the following command:\n\naz security pricing create -n 'OpenSourceRelationalDatabases' --tier 'standard'\n\nFrom PowerShell\nUse the below command to enable Standard pricing tier for Open-source relational databases\n\nset-azsecuritypricing -name 'OpenSourceRelationalDatabases' -pricingtier 'Standard'\n\nDefault Value:\n\nBy default, Microsoft Defender plan is off.",
        "reference": "800-171|3.11.2,800-171|3.11.3,800-53|RA-5,800-53|SA-15,800-53r5|RA-5,800-53r5|SA-15,CSCv7|3.1,CSCv8|7.5,CSCv8|16.11,CSF|DE.CM-8,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.IP-2,CSF|PR.IP-12,CSF|RS.CO-3,CSF|RS.MI-3,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.6.1,ITSG-33|RA-5,LEVEL|2A,NESA|M1.2.2,NESA|M5.4.1,NESA|T7.7.1,NIAv2|SS5,NIAv2|SS6a,PCI-DSSv3.2.1|6.1,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.1,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|2.7",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listPricings",
        "regex": "Name: OpenSourceRelationalDatabases Pricing Tier:",
        "expect": "Name: OpenSourceRelationalDatabases Pricing Tier: Standard"
    },
    "custom_item_9": {
        "description": "2.1.7 Ensure That Microsoft Defender for Storage Is Set To 'On'",
        "info": "Turning on Microsoft Defender for Storage enables threat detection for Storage, providing threat intelligence, anomaly detection, and behavior analytics in the Microsoft Defender for Cloud.\n\nRationale:\n\nEnabling Microsoft Defender for Storage allows for greater defense-in-depth, with threat detection provided by the Microsoft Security Response Center (MSRC).\n\nImpact:\n\nTurning on Microsoft Defender for Storage incurs an additional cost per resource.",
        "solution": "From Azure Portal\n\nGo to Microsoft Defender for Cloud.\n\nSelect Environment Settings blade.\n\nClick on the subscription name.\n\nSelect the Defender plans blade.\n\nSet Status to On for Storage.\n\nSelect Save.\n\nFrom Azure CLI\nEnsure the output of the below command is Standard\n\naz security pricing create -n StorageAccounts --tier 'standard'\n\nFrom PowerShell\n\nSet-AzSecurityPricing -Name 'StorageAccounts' -PricingTier 'Standard'\n\nDefault Value:\n\nBy default, Microsoft Defender plan is off.",
        "reference": "800-171|3.11.2,800-171|3.11.3,800-53|RA-5,800-53r5|RA-5,CSCv7|3.1,CSCv8|7.5,CSF|DE.CM-8,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.IP-12,CSF|RS.CO-3,CSF|RS.MI-3,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.6.1,ITSG-33|RA-5,LEVEL|2A,NESA|M1.2.2,NESA|M5.4.1,NESA|T7.7.1,PCI-DSSv3.2.1|6.1,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|2.7",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listPricings",
        "regex": "Name: StorageAccounts Pricing Tier:",
        "expect": "Name: StorageAccounts Pricing Tier: Standard"
    },
    "custom_item_10": {
        "description": "2.1.8 Ensure That Microsoft Defender for Containers Is Set To 'On'",
        "info": "Turning on Microsoft Defender for Containers enables threat detection for Container Registries including Kubernetes, providing threat intelligence, anomaly detection, and behavior analytics in the Microsoft Defender for Cloud. The following services will be enabled for container instances:\n\nDefender agent in Azure\n\nAzure Policy for Kubernetes\n\nAgentless discovery for Kubernetes\n\nAgentless container vulnerability assessment\n\nRationale:\n\nEnabling Microsoft Defender for Container Registries allows for greater defense-in-depth, with threat detection provided by the Microsoft Security Response Center (MSRC).\n\nImpact:\n\nTurning on Microsoft Defender for Containers incurs an additional cost per resource.",
        "solution": "From Azure Portal\n\nGo to Microsoft Defender for Cloud.\n\nSelect Environment Settings.\n\nClick on the subscription name.\n\nSelect Defender plans.\n\nSet Status to On for Containers.\n\nClick Save.\n\nFrom Azure CLI\n(Note: 'ContainerRegistry' has been deprecated and is replaced by 'Containers')\nUse the below command to enable Standard pricing tier for Containers.\n\naz security pricing create -n 'Containers' --tier 'standard'\n\nFrom PowerShell\n(Note: 'ContainerRegistry' has been deprecated and is replaced by 'Containers')\nUse the below command to enable Standard pricing tier for Containers.\n\nSet-AzSecurityPricing -Name 'Containers' -PricingTier 'Standard'\n\nDefault Value:\n\nBy default, Microsoft Defender for Containers is off.",
        "reference": "800-171|3.11.2,800-171|3.11.3,800-53|RA-5,800-53r5|RA-5,CSCv7|3.1,CSCv8|7.5,CSF|DE.CM-8,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.IP-12,CSF|RS.CO-3,CSF|RS.MI-3,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.6.1,ITSG-33|RA-5,LEVEL|2A,NESA|M1.2.2,NESA|M5.4.1,NESA|T7.7.1,PCI-DSSv3.2.1|6.1,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|2.7",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listPricings",
        "regex": "Name: ContainerRegistry Pricing Tier:",
        "expect": "Name: ContainerRegistry Pricing Tier: Standard"
    },
    "custom_item_11": {
        "description": "2.1.6 Ensure That Microsoft Defender for Azure Cosmos DB Is Set To 'On'",
        "info": "Microsoft Defender for Azure Cosmos DB scans all incoming network requests for threats to your Azure Cosmos DB resources.\n\nRationale:\n\nIn scanning Azure Cosmos DB requests within a subscription, requests are compared to a heuristic list of potential security threats. These threats could be a result of a security breach within your services, thus scanning for them could prevent a potential security threat from being introduced.\n\nImpact:\n\nEnabling Microsoft Defender for Azure Cosmos DB requires enabling Microsoft Defender for your subscription. Both will incur additional charges.",
        "solution": "From Azure Portal\n\nGo to Microsoft Defender for Cloud.\n\nSelect Environment Settings blade.\n\nClick on the subscription name.\n\nSelect the Defender plans blade.\n\nOn the Database row click on Select types >.\n\nSet the radio button next to Azure Cosmos DB to On.\n\nClick Continue.\n\nClick Save.\n\nFrom Azure CLI\nRun the following command:\n\naz security pricing create -n 'CosmosDbs' --tier 'standard'\n\nFrom PowerShell\nUse the below command to enable Standard pricing tier for Azure Cosmos DB\n\nSet-AzSecurityPricing -Name 'CosmosDbs' -PricingTier 'Standard\n\nDefault Value:\n\nBy default, Microsoft Defender for Azure Cosmos DB is not enabled.",
        "reference": "800-171|3.11.2,800-171|3.11.3,800-53|RA-5,800-53|SA-15,800-53r5|RA-5,800-53r5|SA-15,CSCv7|3.1,CSCv8|7.5,CSCv8|16.11,CSF|DE.CM-8,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.IP-2,CSF|PR.IP-12,CSF|RS.CO-3,CSF|RS.MI-3,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.6.1,ITSG-33|RA-5,LEVEL|2A,NESA|M1.2.2,NESA|M5.4.1,NESA|T7.7.1,NIAv2|SS5,NIAv2|SS6a,PCI-DSSv3.2.1|6.1,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.1,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|2.7",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listPricings",
        "regex": "Name: CosmosDbs Pricing Tier:",
        "expect": "Name: CosmosDbs Pricing Tier: Standard"
    },
    "custom_item_12": {
        "description": "2.1.9 Ensure That Microsoft Defender for Key Vault Is Set To 'On'",
        "info": "Turning on Microsoft Defender for Key Vault enables threat detection for Key Vault, providing threat intelligence, anomaly detection, and behavior analytics in the Microsoft Defender for Cloud.\n\nRationale:\n\nEnabling Microsoft Defender for Key Vault allows for greater defense-in-depth, with threat detection provided by the Microsoft Security Response Center (MSRC).\n\nImpact:\n\nTurning on Microsoft Defender for Key Vault incurs an additional cost per resource.",
        "solution": "From Azure Portal\n\nGo to Microsoft Defender for Cloud\n\nSelect Environment Settings blade\n\nClick on the subscription name\n\nSelect the Defender plans blade\n\nSelect On under Status for Key Vault.\n\nSelect Save.\n\nFrom Azure CLI\nEnable Standard pricing tier for Key Vault:\n\naz security pricing create -n 'KeyVaults' --tier 'Standard'\n\nFrom PowerShell\nEnable Standard pricing tier for Key Vault:\n\nSet-AzSecurityPricing -Name 'KeyVaults' -PricingTier 'Standard'\n\nDefault Value:\n\nBy default, Microsoft Defender plan is off.",
        "reference": "800-171|3.11.2,800-171|3.11.3,800-53|RA-5,800-53r5|RA-5,CSCv7|3.1,CSCv8|7.5,CSF|DE.CM-8,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.IP-12,CSF|RS.CO-3,CSF|RS.MI-3,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.6.1,ITSG-33|RA-5,LEVEL|2A,NESA|M1.2.2,NESA|M5.4.1,NESA|T7.7.1,PCI-DSSv3.2.1|6.1,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|2.7",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listPricings",
        "regex": "Name: KeyVaults Pricing Tier:",
        "expect": "Name: KeyVaults Pricing Tier: Standard"
    },
    "custom_item_13": {
        "description": "2.1.10 [LEGACY] Ensure That Microsoft Defender for DNS Is Set To 'On'",
        "info": "[NOTE: As of August 1, customers with an existing subscription to Defender for DNS can continue to use the service, but new subscribers will receive alerts about suspicious DNS activity as part of Defender for Servers P2.]\n\nMicrosoft Defender for DNS scans all network traffic exiting from within a subscription.\n\nRationale:\n\nDNS lookups within a subscription are scanned and compared to a dynamic list of websites that might be potential security threats. These threats could be a result of a security breach within your services, thus scanning for them could prevent a potential security threat from being introduced.\n\nImpact:\n\nEnabling Microsoft Defender for DNS requires enabling Microsoft Defender for your subscription. Both will incur additional charges, with Defender for DNS being a small amount per million queries.",
        "solution": "From Azure Portal\n\nGo to Microsoft Defender for Cloud.\n\nSelect Environment Settings blade.\n\nClick on the subscription name.\n\nSelect the Defender plans blade.\n\nSelect On under Status for DNS.\n\nSelect Save.\n\nFrom Powershell\nEnable Standard pricing tier for DNS:\n\naz security pricing create -n 'DNS' --tier 'Standard'\n\nFrom PowerShell\nEnable Standard pricing tier for DNS:\n\nSet-AzSecurityPricing -Name 'DNS' -PricingTier 'Standard'\n\nDefault Value:\n\nBy default, Microsoft Defender for DNS is not enabled.",
        "reference": "800-171|3.11.2,800-171|3.11.3,800-171|3.14.6,800-171|3.14.7,800-53|RA-5,800-53|SC-20,800-53|SC-21,800-53|SC-22,800-53|SI-4,800-53|SI-4(4),800-53r5|RA-5,800-53r5|SC-20,800-53r5|SC-21,800-53r5|SC-22,800-53r5|SI-4,800-53r5|SI-4(4),CN-L3|7.1.2.2(c),CN-L3|7.1.3.5(a),CN-L3|8.1.10.5(b),CN-L3|8.1.10.6(f),CSCv7|3.1,CSCv7|7.6,CSCv8|4.9,CSCv8|7.5,CSCv8|13.6,CSF|DE.AE-1,CSF|DE.AE-2,CSF|DE.AE-3,CSF|DE.AE-4,CSF|DE.CM-1,CSF|DE.CM-5,CSF|DE.CM-6,CSF|DE.CM-7,CSF|DE.CM-8,CSF|DE.DP-2,CSF|DE.DP-3,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.DS-5,CSF|PR.IP-8,CSF|PR.IP-12,CSF|RS.AN-1,CSF|RS.CO-3,CSF|RS.MI-3,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.6.1,ITSG-33|RA-5,ITSG-33|SC-20,ITSG-33|SC-21,ITSG-33|SC-21a.,ITSG-33|SC-22,ITSG-33|SC-22a.,ITSG-33|SI-4,ITSG-33|SI-4(4),LEVEL|2A,NESA|M1.2.2,NESA|M5.4.1,NESA|T4.5.1,NESA|T7.7.1,NIAv2|NS17,NIAv2|NS18,NIAv2|NS19,NIAv2|NS20,NIAv2|NS21,NIAv2|NS22,NIAv2|NS23,NIAv2|NS32,PCI-DSSv3.2.1|6.1,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|2.7,SWIFT-CSCv1|6.5",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listPricings",
        "regex": "Name: Dns Pricing Tier:",
        "expect": "Name: Dns Pricing Tier: Standard"
    },
    "custom_item_14": {
        "description": "2.1.11 Ensure That Microsoft Defender for Resource Manager Is Set To 'On'",
        "info": "Microsoft Defender for Resource Manager scans incoming administrative requests to change your infrastructure from both CLI and the Azure portal.\n\nRationale:\n\nScanning resource requests lets you be alerted every time there is suspicious activity in order to prevent a security threat from being introduced.\n\nImpact:\n\nEnabling Microsoft Defender for Resource Manager requires enabling Microsoft Defender for your subscription. Both will incur additional charges.",
        "solution": "From Azure Portal\n\nGo to Microsoft Defender for Cloud.\n\nSelect Environment Settings blade.\n\nClick on the subscription name.\n\nSelect the Defender plans blade.\n\nSelect On under Status for Resource Manager.\n\nSelect 'Save.\n\nFrom Azure CLI\nUse the below command to enable Standard pricing tier for Defender for Resource Manager\n\naz security pricing create -n 'Arm' --tier 'Standard'\n\nFrom PowerShell\nUse the below command to enable Standard pricing tier for Defender for Resource Manager\n\nSet-AzSecurityPricing -Name 'Arm' -PricingTier 'Standard'\n\nDefault Value:\n\nBy default, Microsoft Defender for Resource Manager is not enabled.",
        "reference": "800-171|3.1.5,800-171|3.1.6,800-171|3.11.2,800-171|3.11.3,800-53|AC-6(2),800-53|AC-6(5),800-53|RA-5,800-53r5|AC-6(2),800-53r5|AC-6(5),800-53r5|RA-5,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.10.6(a),CSCv7|3.1,CSCv8|5.4,CSCv8|7.5,CSF|DE.CM-8,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.AC-4,CSF|PR.IP-12,CSF|RS.CO-3,CSF|RS.MI-3,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.2.3,ISO/IEC-27001|A.12.6.1,ITSG-33|AC-6(2),ITSG-33|AC-6(5),ITSG-33|RA-5,LEVEL|2A,NESA|M1.2.2,NESA|M5.4.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.6.1,NESA|T7.7.1,NIAv2|AM1,NIAv2|AM23f,NIAv2|AM32,NIAv2|AM33,NIAv2|SS13c,NIAv2|SS15c,NIAv2|VL3a,PCI-DSSv3.2.1|6.1,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.1,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|1.2,SWIFT-CSCv1|2.7,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listPricings",
        "regex": "Name: Arm Pricing Tier:",
        "expect": "Name: Arm Pricing Tier: Standard"
    },
    "custom_item_15": {
        "description": "2.1.15 Ensure that Auto provisioning of 'Vulnerability assessment for machines' is Set to 'On'",
        "info": "Enable automatic provisioning of vulnerability assessment for machines on both Azure and hybrid (Arc enabled) machines.\n\nRationale:\n\nVulnerability assessment for machines scans for various security-related configurations and events such as system updates, OS vulnerabilities, and endpoint protection, then produces alerts on threat and vulnerability findings.\n\nImpact:\n\nAdditional licensing is required and configuration of Azure Arc introduces complexity beyond this recommendation.",
        "solution": "From Azure Portal\n\nFrom Azure Home select the Portal Menu\n\nSelect Microsoft Defender for Cloud\n\nThen Environment Settings\n\nSelect a subscription\n\nClick on Settings & Monitoring\n\nEnsure that Vulnerability assessment for machines is set to On\n\nRepeat the above for any additional subscriptions.\n\nDefault Value:\n\nBy default, Automatic provisioning of monitoring agent is set to Off.",
        "reference": "800-171|3.11.2,800-171|3.11.3,800-53|RA-5,800-53r5|RA-5,CSCv7|3.1,CSCv8|7.5,CSCv8|7.6,CSF|DE.CM-8,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.IP-12,CSF|RS.CO-3,CSF|RS.MI-3,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.6.1,ITSG-33|RA-5,LEVEL|2M,NESA|M1.2.2,NESA|M5.4.1,NESA|T7.7.1,PCI-DSSv3.2.1|6.1,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|2.7",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listAutoProvisioningSettings",
        "regex": "Auto Provisioning:",
        "not_expect": "Auto Provisioning: Off"
    },
    "custom_item_16": {
        "description": "2.1.16 Ensure that Auto provisioning of 'Microsoft Defender for Containers components' is Set to 'On'",
        "info": "Enable automatic provisioning of the Microsoft Defender for Containers components.\n\nRationale:\n\nAs with any compute resource, Container environments require hardening and run-time protection to ensure safe operations and detection of threats and vulnerabilities.\n\nImpact:\n\nMicrosoft Defender for Containers will require additional licensing.",
        "solution": "From Azure Portal\n\nFrom the Azure Portal Home page, select Microsoft Defender for Cloud\n\nUnder Management, select Environment Settings\n\nSelect a subscription\n\nSet Containers to On\n\nDefault Value:\n\nBy default, Microsoft Defender for Containers is disabled. If Defender for Containers is enabled from the Microsoft Defender for Cloud portal, auto provisioning will be enabled.",
        "reference": "800-171|3.11.2,800-171|3.11.3,800-53|RA-5,800-53r5|RA-5,CSCv7|3.1,CSCv8|7.5,CSCv8|7.6,CSF|DE.CM-8,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.IP-12,CSF|RS.CO-3,CSF|RS.MI-3,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.6.1,ITSG-33|RA-5,LEVEL|2A,NESA|M1.2.2,NESA|M5.4.1,NESA|T7.7.1,PCI-DSSv3.2.1|6.1,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|2.7",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listAutoProvisioningSettings",
        "regex": "Auto Provisioning:",
        "not_expect": "Auto Provisioning: Off"
    },
    "custom_item_17": {
        "description": "Storage Accounts Exist",
        "request": "listStorageAccounts",
        "regex": ".*",
        "expect": ".+"
    },
    "custom_item_18": {
        "description": "3.2 Ensure that 'Enable Infrastructure Encryption' for Each Storage Account in Azure Storage is Set to 'enabled'",
        "info": "Enabling encryption at the hardware level on top of the default software encryption for Storage Accounts accessing Azure storage solutions.\n\nRationale:\n\nAzure Storage automatically encrypts all data in a storage account at the network level using 256-bit AES encryption, which is one of the strongest, FIPS 140-2-compliant block ciphers available. Customers who require higher levels of assurance that their data is secure can also enable 256-bit AES encryption at the Azure Storage infrastructure level for double encryption. Double encryption of Azure Storage data protects against a scenario where one of the encryption algorithms or keys may be compromised. Similarly, data is encrypted even before network transmission and in all backups. In this scenario, the additional layer of encryption continues to protect your data. For the most secure implementation of key based encryption, it is recommended to use a Customer Managed asymmetric RSA 2048 Key in Azure Key Vault.\n\nImpact:\n\nThe read and write speeds to the storage will be impacted if both default encryption and Infrastructure Encryption are checked, as a secondary form of encryption requires more resource overhead for the cryptography of information. This performance impact should be considered in an analysis for justifying use of the feature in your environment. Customer-managed keys are recommended for the most secure implementation, leading to overhead of key management. The key will also need to be backed up in a secure location, as loss of the key will mean loss of the information in the storage.",
        "reference": "800-171|3.5.2,800-171|3.13.16,800-53|IA-5(1),800-53|SC-28,800-53|SC-28(1),800-53r5|IA-5(1),800-53r5|SC-28,800-53r5|SC-28(1),CN-L3|8.1.4.7(b),CN-L3|8.1.4.8(b),CSCv7|14.8,CSCv8|3.11,CSF|PR.AC-1,CSF|PR.DS-1,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(d),HIPAA|164.312(e)(2)(ii),ITSG-33|IA-5(1),ITSG-33|SC-28,ITSG-33|SC-28a.,ITSG-33|SC-28(1),LEVEL|2A,NESA|T5.2.3,PCI-DSSv3.2.1|3.4,PCI-DSSv4.0|3.3.2,PCI-DSSv4.0|3.5.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1,TBA-FIISB|28.1",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listStorageAccounts",
        "regex": "Require Infrastructure Encryption:",
        "expect": "Require Infrastructure Encryption: true"
    },
    "custom_item_19": {
        "description": "3.9 Ensure 'Allow Azure services on the trusted services list to access this storage account' is Enabled for Storage Account Access",
        "info": "Some Azure services that interact with storage accounts operate from networks that can't be granted access through network rules. To help this type of service work as intended, allow the set of trusted Azure services to bypass the network rules. These services will then use strong authentication to access the storage account. If the Allow trusted Azure services exception is enabled, the following services are granted access to the storage account: Azure Backup, Azure Site Recovery, Azure DevTest Labs, Azure Event Grid, Azure Event Hubs, Azure Networking, Azure Monitor, and Azure SQL Data Warehouse (when registered in the subscription).\n\nRationale:\n\nTurning on firewall rules for storage account will block access to incoming requests for data, including from other Azure services. We can re-enable this functionality by enabling 'Trusted Azure Services' through networking exceptions.\n\nImpact:\n\nThis creates authentication credentials for services that need access to storage resources so that services will no longer need to communicate via network request. There may be a temporary loss of communication as you set each Storage Account. It is recommended to not do this on mission-critical resources during business hours.",
        "solution": "From Azure Portal\n\nGo to Storage Accounts\n\nFor each storage account, Click on the Networking blade\n\nClick on the Firewalls and virtual networks heading.\n\nEnsure that Enabled from selected virtual networks and IP addresses is selected.\n\nUnder the 'Exceptions' label, enable check box for Allow Azure services on the trusted services list to access this storage account.\n\nClick Save to apply your changes.\n\nFrom Azure CLI\nUse the below command to update Azure services.\n\naz storage account update --name--resource-group--bypass AzureServices\n\nDefault Value:\n\nBy default, Storage Accounts will accept connections from clients on any network.",
        "reference": "800-171|3.1.1,800-171|3.1.2,800-171|3.1.4,800-171|3.1.5,800-171|3.1.12,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-171|3.13.1,800-171|3.13.5,800-171|3.14.6,800-171|3.14.7,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|AC-17,800-53|AC-17(1),800-53|MP-2,800-53|SC-7,800-53|SI-4,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|AC-17,800-53r5|AC-17(1),800-53r5|MP-2,800-53r5|SC-7,800-53r5|SI-4,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|7.1.3.5(a),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.4(c),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.5(b),CN-L3|8.1.10.6(a),CN-L3|8.1.10.6(f),CN-L3|8.1.10.6(i),CN-L3|8.1.10.6(j),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|13.3,CSCv8|3.3,CSCv8|13.5,CSF|DE.AE-1,CSF|DE.AE-2,CSF|DE.AE-3,CSF|DE.AE-4,CSF|DE.CM-1,CSF|DE.CM-5,CSF|DE.CM-6,CSF|DE.CM-7,CSF|DE.DP-2,CSF|DE.DP-3,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.AC-3,CSF|PR.AC-4,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-8,CSF|PR.PT-2,CSF|PR.PT-3,CSF|PR.PT-4,CSF|RS.AN-1,CSF|RS.CO-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ISO/IEC-27001|A.13.1.3,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|AC-17,ITSG-33|AC-17(1),ITSG-33|MP-2,ITSG-33|MP-2a.,ITSG-33|SC-7,ITSG-33|SI-4,LEVEL|2A,NESA|M1.2.2,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T4.5.4,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|SS13c,NIAv2|SS15c,NIAv2|SS29,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,QCSC-v1|13.2,SWIFT-CSCv1|2.6,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3,TBA-FIISB|43.1",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listStorageAccounts",
        "regex": "Bypass:",
        "expect": "Bypass: .*AzureServices"
    },
    "custom_item_20": {
        "description": "3.12 Ensure Storage for Critical Data are Encrypted with Customer Managed Keys (CMK)",
        "info": "Enable sensitive data encryption at rest using Customer Managed Keys (CMK) rather than Microsoft Managed keys.\n\nRationale:\n\nBy default, data in the storage account is encrypted using Microsoft Managed Keys at rest. All Azure Storage resources are encrypted, including blobs, disks, files, queues, and tables. All object metadata is also encrypted. If you want to control and manage this encryption key yourself, however, you can specify a customer-managed key. That key is used to protect and control access to the key that encrypts your data. You can also choose to automatically update the key version used for Azure Storage encryption whenever a new version is available in the associated Key Vault.\n\nImpact:\n\nIf the key expires by setting the 'activation date' and 'expiration date', the user must rotate the key manually.\n\nUsing Customer Managed Keys may also incur additional man-hour requirements to create, store, manage, and protect the keys as needed.",
        "solution": "From Azure Portal\n\nGo to Storage Accounts\n\nFor each storage account, go to Encryption\n\nSet Customer Managed Keys\n\nSelect the Encryption key and enter the appropriate setting value\n\nClick Save\n\nDefault Value:\n\nBy default, Encryption type is set to Microsoft Managed Keys.",
        "reference": "800-171|3.5.2,800-171|3.13.16,800-53|IA-5(1),800-53|SC-28,800-53|SC-28(1),800-53r5|IA-5(1),800-53r5|SC-28,800-53r5|SC-28(1),CN-L3|8.1.4.7(b),CN-L3|8.1.4.8(b),CSCv7|14.8,CSCv8|3.11,CSF|PR.AC-1,CSF|PR.DS-1,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(d),HIPAA|164.312(e)(2)(ii),ITSG-33|IA-5(1),ITSG-33|SC-28,ITSG-33|SC-28a.,ITSG-33|SC-28(1),LEVEL|2M,NESA|T5.2.3,PCI-DSSv3.2.1|3.4,PCI-DSSv4.0|3.3.2,PCI-DSSv4.0|3.5.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1,TBA-FIISB|28.1",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listStorageAccounts",
        "regex": "Encryption Type:",
        "not_expect": "Encryption Type: Microsoft\\.Storage"
    },
    "custom_item_21": {
        "description": "Test if SQL Servers exist",
        "request": "listSQLServers",
        "regex": "SQL Server:",
        "expect": "SQL Server: .+"
    },
    "custom_item_22": {
        "description": "4.1.3 Ensure SQL server's Transparent Data Encryption (TDE) protector is encrypted with Customer-managed key",
        "info": "Transparent Data Encryption (TDE) with Customer-managed key support provides increased transparency and control over the TDE Protector, increased security with an HSM-backed external service, and promotion of separation of duties.\n\nWith TDE, data is encrypted at rest with a symmetric key (called the database encryption key) stored in the database or data warehouse distribution. To protect this data encryption key (DEK) in the past, only a certificate that the Azure SQL Service managed could be used. Now, with Customer-managed key support for TDE, the DEK can be protected with an asymmetric key that is stored in the Azure Key Vault. The Azure Key Vault is a highly available and scalable cloud-based key store which offers central key management, leverages FIPS 140-2 Level 2 validated hardware security modules (HSMs), and allows separation of management of keys and data for additional security.\n\nBased on business needs or criticality of data/databases hosted on a SQL server, it is recommended that the TDE protector is encrypted by a key that is managed by the data owner (Customer-managed key).\n\nRationale:\n\nCustomer-managed key support for Transparent Data Encryption (TDE) allows user control of TDE encryption keys and restricts who can access them and when. Azure Key Vault, Azure's cloud-based external key management system, is the first key management service where TDE has integrated support for Customer-managed keys. With Customer-managed key support, the database encryption key is protected by an asymmetric key stored in the Key Vault. The asymmetric key is set at the server level and inherited by all databases under that server.\n\nImpact:\n\nOnce TDE protector is encrypted with a Customer-managed key, it transfers entire responsibility of respective key management on to you, and hence you should be more careful about doing any operations on the particular key in order to keep data from corresponding SQL server and Databases hosted accessible.\n\nWhen deploying Customer Managed Keys, it is prudent to ensure that you also deploy an automated toolset for managing these keys (this should include discovery and key rotation), and Keys should be stored in an HSM or hardware backed keystore, such as Azure Key Vault.\n\nAs far as toolsets go, check with your cryptographic key provider, as they may well provide one as an add-on to their service.",
        "solution": "From Azure Console\n\nGo to SQL servers\n\nFor the desired server instance\n\nClick On Transparent data encryption\n\nSet Transparent data encryption to Customer-managed key\n\nBrowse through your key vaults to Select an existing key or create a new key in\nthe Azure Key Vault.\n\nCheck Make selected key the default TDE protector\n\nFrom Azure CLI\nUse the below command to encrypt SQL server's TDE protector with a Customer-managed key\n\naz sql server tde-key set --resource-group--server--server-key-type {AzureKeyVault} --kidFrom PowerShell\nUse the below command to encrypt SQL server's TDE protector with a Customer-managed Key Vault key\n\nSet-AzSqlServerTransparentDataEncryptionProtector -Type AzureKeyVault -KeyId-ServerName-ResourceGroupNameSelect Y when prompted\n\nDefault Value:\n\nBy Default, Microsoft managed TDE protector is enabled for a SQL server.",
        "reference": "800-171|3.5.2,800-171|3.13.16,800-53|IA-5(1),800-53|SC-28,800-53|SC-28(1),800-53r5|IA-5(1),800-53r5|SC-28,800-53r5|SC-28(1),CN-L3|8.1.4.7(b),CN-L3|8.1.4.8(b),CSCv7|16.4,CSCv8|3.11,CSF|PR.AC-1,CSF|PR.DS-1,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(d),HIPAA|164.312(e)(2)(ii),ITSG-33|IA-5(1),ITSG-33|SC-28,ITSG-33|SC-28a.,ITSG-33|SC-28(1),LEVEL|2A,NESA|T5.2.3,PCI-DSSv3.2.1|3.4,PCI-DSSv4.0|3.3.2,PCI-DSSv4.0|3.5.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1,TBA-FIISB|28.1",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "getSQLServerEncryptionProtector",
        "regex": "Kind:"
    },
    "custom_item_23": {
        "description": "MySQL Database Servers exist",
        "request": "listMYSQLServersConfigurations",
        "regex": ".+"
    },
    "custom_item_24": {
        "description": "4.4.3 Ensure server parameter 'audit_log_enabled' is set to 'ON' for MySQL Database Server",
        "info": "Enable audit_log_enabled on MySQL Servers.\n\nRationale:\n\nEnabling audit_log_enabled helps MySQL Database to log items such as connection attempts to the server, DDL/DML access, and more. Log data can be used to identify, troubleshoot, and repair configuration errors and suboptimal performance.\n\nImpact:\n\nThere are further costs incurred for storage of logs. For high traffic databases these logs will be significant. Determine your organization's needs before enabling.",
        "solution": "From Azure Portal\n\nLogin to Azure Portal using https://portal.azure.com.\n\nSelect Azure Database for MySQL Servers.\n\nSelect a database.\n\nUnder Settings, select Server parameters.\n\nUpdate audit_log_enabled parameter to ON\n\nUnder Monitoring, select Diagnostic settings.\n\nSelect + Add diagnostic setting.\n\nProvide a diagnostic setting name.\n\nUnder Categories, select MySQL Audit Logs.\n\nSpecify destination details.\n\nClick Save.\n\nIt may take up to 10 minutes for the logs to appear in the configured destination.\n\nDefault Value:\n\naudit_log_enabled is set to OFF by default",
        "reference": "800-171|3.3.1,800-171|3.3.2,800-171|3.3.6,800-53|AU-2,800-53|AU-7,800-53|AU-12,800-53r5|AU-2,800-53r5|AU-7,800-53r5|AU-12,CN-L3|7.1.2.3(c),CN-L3|8.1.4.3(a),CSCv7|6.2,CSCv8|8.2,CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,CSF|RS.AN-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-2,ITSG-33|AU-7,ITSG-33|AU-12,LEVEL|2M,NESA|M1.2.2,NESA|M5.5.1,NIAv2|AM7,NIAv2|AM11a,NIAv2|AM11b,NIAv2|AM11c,NIAv2|AM11d,NIAv2|AM11e,NIAv2|SS30,NIAv2|VL8,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,QCSC-v1|13.2,SWIFT-CSCv1|6.4",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listMYSQLServersConfigurations",
        "regex": "Audit Log Enabled: ",
        "expect": "Audit Log Enabled: ON"
    },
    "custom_item_25": {
        "description": "4.4.4 Ensure server parameter 'audit_log_events' has 'CONNECTION' set for MySQL Database Server",
        "info": "Set audit_log_enabled to include CONNECTION on MySQL Servers.\n\nRationale:\n\nEnabling CONNECTION helps MySQL Database to log items such as successful and failed connection attempts to the server. Log data can be used to identify, troubleshoot, and repair configuration errors and suboptimal performance.\n\nImpact:\n\nThere are further costs incurred for storage of logs. For high traffic databases these logs will be significant. Determine your organization's needs before enabling.",
        "solution": "From Azure Portal\n\nFrom Azure Home select the Portal Menu.\n\nSelect Azure Database for MySQL servers.\n\nSelect a database.\n\nUnder Settings, select Server parameters.\n\nUpdate audit_log_enabled parameter to ON.\n\nUpdate audit_log_events parameter to have at least CONNECTION checked.\n\nClick Save.\n\nUnder Monitoring, select Diagnostic settings.\n\nSelect + Add diagnostic setting.\n\nProvide a diagnostic setting name.\n\nUnder Categories, select MySQL Audit Logs.\n\nSpecify destination details.\n\nClick Save.\n\nIt may take up to 10 minutes for the logs to appear in the configured destination.\n\nDefault Value:\n\nBy default audit_log_events is disabled.",
        "reference": "800-171|3.3.1,800-171|3.3.2,800-171|3.3.6,800-53|AU-2,800-53|AU-7,800-53|AU-12,800-53r5|AU-2,800-53r5|AU-7,800-53r5|AU-12,CN-L3|7.1.2.3(c),CN-L3|8.1.4.3(a),CSCv7|6.2,CSCv8|8.2,CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,CSF|RS.AN-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-2,ITSG-33|AU-7,ITSG-33|AU-12,LEVEL|2M,NESA|M1.2.2,NESA|M5.5.1,NIAv2|AM7,NIAv2|AM11a,NIAv2|AM11b,NIAv2|AM11c,NIAv2|AM11d,NIAv2|AM11e,NIAv2|SS30,NIAv2|VL8,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,QCSC-v1|13.2,SWIFT-CSCv1|6.4",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listMYSQLServersConfigurations",
        "regex": "Audit Log Events: ",
        "expect": "Audit Log Events: CONNECTION"
    },
    "custom_item_26": {
        "description": "4.5.1 Ensure That 'Firewalls & Networks' Is Limited to Use Selected Networks Instead of All Networks",
        "info": "Limiting your Cosmos DB to only communicate on whitelisted networks lowers its attack footprint.\n\nRationale:\n\nSelecting certain networks for your Cosmos DB to communicate restricts the number of networks including the internet that can interact with what is stored within the database.\n\nImpact:\n\nFailure to whitelist the correct networks will result in a connection loss.",
        "solution": "From Azure Portal\n\nOpen the portal menu.\n\nSelect the Azure Cosmos DB blade.\n\nSelect a Cosmos DB account to audit.\n\nSelect Networking.\n\nUnder Public network access, select Selected networks.\n\nUnder Virtual networks, select + Add existing virtual network or + Add a new virtual network.\n\nFor existing networks, select subscription, virtual network, subnet and click Add. For new networks, provide a name, update the default values if required, and click Create.\n\nClick Save.\n\nDefault Value:\n\nBy default, Cosmos DBs are set to have access all networks.",
        "reference": "800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-171|3.13.5,800-171|3.13.6,800-53|CA-9,800-53|CM-7,800-53|CP-6,800-53|CP-7,800-53|PL-8,800-53|PM-7,800-53|SA-8,800-53|SC-7,800-53|SC-7(5),800-53r5|CA-9,800-53r5|CM-7,800-53r5|CP-6,800-53r5|CP-7,800-53r5|PL-8,800-53r5|PM-7,800-53r5|SA-8,800-53r5|SC-7,800-53r5|SC-7(5),CN-L3|7.1.2.2(c),CN-L3|8.1.10.6(j),CSCv7|9.4,CSCv7|14.1,CSCv8|4.4,CSCv8|12.2,CSF|DE.CM-1,CSF|ID.AM-3,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-4,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,GDPR|32.1.c,GDPR|32.1.d,GDPR|32.2,HIPAA|164.306(a)(1),ISO/IEC-27001|A.13.1.3,ITSG-33|CM-7,ITSG-33|CP-6,ITSG-33|CP-7,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SC-7,ITSG-33|SC-7(5),LEVEL|2A,NESA|T2.2.4,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.6.5,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|GS7b,NIAv2|NS25,NIAv2|SS3,NIAv2|SS15a,NIAv2|VL2,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.3,TBA-FIISB|43.1",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listCosmosDbAccounts",
        "regex": "Virtual Network Filter Enabled:",
        "expect": "Virtual Network Filter Enabled: true"
    },
    "custom_item_27": {
        "description": "5.1.3 Ensure the storage account containing the container with activity logs is encrypted with Customer Managed Key (CMK)",
        "info": "Storage accounts with the activity log exports can be configured to use Customer Managed Keys (CMK).\n\nRationale:\n\nConfiguring the storage account with the activity log export container to use CMKs provides additional confidentiality controls on log data, as a given user must have read permission on the corresponding storage account and must be granted decrypt permission by the CMK.\n\nImpact:\n\nNote: You must have your key vault setup to utilize this. All Audit Logs will be encrypted with a key you provide. You will need to set up customer managed keys separately, and you will select which key to use via the instructions here. You will be responsible for the lifecycle of the keys, and will need to manually replace them at your own determined intervals to keep the data secure.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "From Azure Portal\n\nNavigate to the Storage accounts blade.\n\nClick on the storage account.\n\nUnder Security + networking, click Encryption.\n\nNext to Encryption type, select Customer-managed keys.\n\nComplete the steps to configure a customer-managed key for encryption of the storage account.\n\nFrom Azure CLI\n\naz storage account update --name--resource-group--encryption-key-source=Microsoft.Keyvault --encryption-key-vault--encryption-key-name--encryption-key-versionFrom PowerShell\n\nSet-AzStorageAccount -ResourceGroupName-Name-KeyvaultEncryption -KeyVaultUri-KeyNameDefault Value:\n\nBy default, for a storage account keySource is set to Microsoft.Storage allowing encryption with vendor Managed key and not a Customer Managed Key.",
        "reference": "800-171|3.5.2,800-171|3.13.16,800-53|IA-5(1),800-53|SC-28,800-53|SC-28(1),800-53r5|IA-5(1),800-53r5|SC-28,800-53r5|SC-28(1),CN-L3|8.1.4.7(b),CN-L3|8.1.4.8(b),CSCv7|14.8,CSCv8|3.11,CSF|PR.AC-1,CSF|PR.DS-1,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(d),HIPAA|164.312(e)(2)(ii),ITSG-33|IA-5(1),ITSG-33|SC-28,ITSG-33|SC-28a.,ITSG-33|SC-28(1),LEVEL|2A,NESA|T5.2.3,PCI-DSSv3.2.1|3.4,PCI-DSSv4.0|3.3.2,PCI-DSSv4.0|3.5.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1,TBA-FIISB|28.1",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listLogProfiles",
        "regex": "Storage Account ID: ",
        "expect": "MANUAL_REVIEW"
    },
    "custom_item_28": {
        "description": "Web Apps exist",
        "request": "listWebApps",
        "regex": ".*",
        "expect": ".+"
    },
    "custom_item_29": {
        "description": "5.1.6 Ensure that logging for Azure AppService 'HTTP logs' is enabled",
        "info": "Enable AppServiceHTTPLogs diagnostic log category for Azure App Service instances to ensure all http requests are captured and centrally logged.\n\nRationale:\n\nCapturing web requests can be important supporting information for security analysts performing monitoring and incident response activities. Once logging, these logs can be ingested into SIEM or other central aggregation point for the organization.\n\nImpact:\n\nLog consumption and processing will incur additional cost.",
        "solution": "From Azure Portal\n\nGo to App Services\n\nFor each App Service:\n\nGo to Diagnostic Settings\n\nClick Add Diagnostic Setting\n\nCheck the checkbox next to 'HTTP logs'\n\nConfigure a destination based on your specific logging consumption capability (for example Stream to an event hub and then consuming with SIEM integration for Event Hub logging).\n\nDefault Value:\n\nNot configured.",
        "reference": "800-171|3.3.1,800-171|3.3.2,800-53|AU-2,800-53r5|AU-2,CN-L3|8.1.4.3(a),CSCv7|7.6,CSCv8|8.7,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-2,LEVEL|2M,NESA|M1.2.2,NESA|M5.5.1,NIAv2|AM7,NIAv2|AM11a,NIAv2|AM11b,NIAv2|AM11c,NIAv2|AM11d,NIAv2|AM11e,NIAv2|SS30,NIAv2|VL8,QCSC-v1|8.2.1,QCSC-v1|13.2,SWIFT-CSCv1|6.4",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listAppConfig",
        "regex": "Azure Monitor Log Categories: ",
        "expect": "Azure Monitor Log Categories: .*AppServiceHTTPLogs"
    },
    "custom_item_30": {
        "description": "Security Group Rules are present",
        "request": "listNetworkSecurityGroups",
        "regex": "Access:"
    },
    "custom_item_31": {
        "description": "6.5 Ensure that Network Security Group Flow Log retention period is 'greater than 90 days'",
        "info": "Network Security Group Flow Logs should be enabled and the retention period set to greater than or equal to 90 days.\n\nRationale:\n\nFlow logs enable capturing information about IP traffic flowing in and out of network security groups. Logs can be used to check for anomalies and give insight into suspected breaches.\n\nImpact:\n\nThis will keep IP traffic logs for longer than 90 days. As a level 2, first determine your need to retain data, then apply your selection here. As this is data stored for longer, your monthly storage costs will increase depending on your data use.",
        "solution": "From Azure Portal\n\nGo to Network Watcher\n\nSelect NSG flow logs blade in the Logs section\n\nSelect each Network Security Group from the list\n\nEnsure Status is set to On\n\nEnsure Retention (days) setting greater than 90 days\n\nSelect your storage account in the Storage account field\n\nSelect Save\n\nFrom Azure CLI\nEnable the NSG flow logs and set the Retention (days) to greater than or equal to 90 days.\n\naz network watcher flow-log configure --nsg--enabled true --resource-group--retention 91 --storage-accountDefault Value:\n\nBy default, Network Security Group Flow Logs are disabled.",
        "reference": "800-53|AU-4,800-53|AU-11,800-53r5|AU-4,800-53r5|AU-11,CSCv7|6.4,CSCv8|8.3,CSCv8|8.10,CSF|PR.DS-4,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-4,ITSG-33|AU-11,LEVEL|2A,NESA|M5.2.3,NESA|T3.3.1,NESA|T3.6.2,NIAv2|SM7,PCI-DSSv3.2.1|10.7,PCI-DSSv4.0|10.5.1,QCSC-v1|8.2.1,QCSC-v1|13.2",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listNetworkWatcherFlowLogs",
        "regex": "Enabled: true"
    },
    "custom_item_32": {
        "description": "6.6 Ensure that Network Watcher is 'Enabled'",
        "info": "Enable Network Watcher for physical regions in Azure subscriptions.\n\nRationale:\n\nNetwork diagnostic and visualization tools available with Network Watcher help users understand, diagnose, and gain insights to the network in Azure.\n\nImpact:\n\nThere are additional costs per transaction to run and store network data. For high-volume networks these charges will add up quickly.",
        "solution": "Opting out of Network Watcher automatic enablement is a permanent change. Once you opt-out you cannot opt-in without contacting support.\nTo manually enable Network Watcher in each region where you want to use Network Watcher capabilities, follow the steps below.\n\nFrom Azure Portal\n\nGo to Network Watcher.\n\nClick Create.\n\nSelect a Region from the drop-down menu.\n\nClick Add.\n\nFrom Azure CLI\n\naz network watcher configure --locations--enabled true --resource-groupDefault Value:\n\nNetwork Watcher is automatically enabled. When you create or update a virtual network in your subscription, Network Watcher will be enabled automatically in your Virtual Network's region. There is no impact to your resources or associated charge for automatically enabling Network Watcher.",
        "reference": "800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-171|3.13.5,800-53|CM-7,800-53|CP-6,800-53|CP-7,800-53|PL-8,800-53|PM-5,800-53|PM-7,800-53|SA-8,800-53|SC-7,800-53r5|CM-7,800-53r5|CP-6,800-53r5|CP-7,800-53r5|PL-8,800-53r5|PM-5,800-53r5|PM-7,800-53r5|SA-8,800-53r5|SC-7,CN-L3|8.1.10.6(j),CSCv7|11.2,CSCv7|12.1,CSCv8|12.2,CSCv8|12.4,CSF|DE.CM-1,CSF|ID.AM-3,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-4,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,GDPR|32.1.c,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO/IEC-27001|A.13.1.3,ITSG-33|CM-7,ITSG-33|CP-6,ITSG-33|CP-7,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SC-7,LEVEL|2A,NESA|T1.2.1,NESA|T1.2.2,NESA|T2.2.4,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.6.5,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|SS3,NIAv2|SS15a,NIAv2|VL2,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,SWIFT-CSCv1|2.3,TBA-FIISB|43.1",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listNetworkWatcher",
        "regex": "Provisioning State:",
        "expect": "Provisioning State: Succeeded"
    },
    "custom_item_33": {
        "description": "Test if VMs exist",
        "request": "listVMs"
    },
    "custom_item_34": {
        "description": "7.3 Ensure that 'OS and Data' disks are encrypted with Customer Managed Key (CMK)",
        "info": "Ensure that OS disks (boot volumes) and data disks (non-boot volumes) are encrypted with CMK (Customer Managed Keys). Customer Managed keys can be either ADE or Server Side Encryption (SSE).\n\nRationale:\n\nEncrypting the IaaS VM's OS disk (boot volume) and Data disks (non-boot volume) ensures that the entire content is fully unrecoverable without a key, thus protecting the volume from unwanted reads. PMK (Platform Managed Keys) are enabled by default in Azure-managed disks and allow encryption at rest. CMK is recommended because it gives the customer the option to control which specific keys are used for the encryption and decryption of the disk. The customer can then change keys and increase security by disabling them instead of relying on the PMK key that remains unchanging. There is also the option to increase security further by using automatically rotating keys so that access to disk is ensured to be limited. Organizations should evaluate what their security requirements are, however, for the data stored on the disk. For high-risk data using CMK is a must, as it provides extra steps of security. If the data is low risk, PMK is enabled by default and provides sufficient data security.\n\nImpact:\n\nUsing CMK/BYOK will entail additional management of keys.\n\nNOTE: You must have your key vault set up to utilize this.",
        "solution": "From Azure Portal\nNote: Disks must be detached from VMs to have encryption changed.\n\nGo to Virtual machines\n\nFor each virtual machine, go to Settings\n\nClick on Disks\n\nClick the ellipsis (...), then click Detach to detach the disk from the VM\n\nNow search for Disks and locate the unattached disk\n\nClick the disk then select Encryption\n\nChange your encryption type, then select your encryption set\n\nClick Save\n\nGo back to the VM and re-attach the disk\n\nFrom PowerShell\n\n$KVRGname = 'MyKeyVaultResourceGroup';\n $VMRGName = 'MyVirtualMachineResourceGroup';\n $vmName = 'MySecureVM';\n $KeyVaultName = 'MySecureVault';\n $KeyVault = Get-AzKeyVault -VaultName $KeyVaultName -ResourceGroupName $KVRGname;\n $diskEncryptionKeyVaultUrl = $KeyVault.VaultUri;\n $KeyVaultResourceId = $KeyVault.ResourceId;\n\n Set-AzVMDiskEncryptionExtension -ResourceGroupName $VMRGname -VMName $vmName -DiskEncryptionKeyVaultUrl $diskEncryptionKeyVaultUrl -DiskEncryptionKeyVaultId $KeyVaultResourceId;\n\nNOTE: During encryption it is likely that a reboot will be required. It may take up to 15 minutes to complete the process.\nNOTE 2: This may differ for Linux machines as you may need to set the -skipVmBackup parameter\n\nDefault Value:\n\nBy default, Azure disks are encrypted using SSE with PMK.",
        "reference": "800-171|3.5.2,800-171|3.13.16,800-53|IA-5(1),800-53|SC-28,800-53|SC-28(1),800-53r5|IA-5(1),800-53r5|SC-28,800-53r5|SC-28(1),CN-L3|8.1.4.7(b),CN-L3|8.1.4.8(b),CSCv7|14.8,CSCv8|3.11,CSF|PR.AC-1,CSF|PR.DS-1,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(d),HIPAA|164.312(e)(2)(ii),ITSG-33|IA-5(1),ITSG-33|SC-28,ITSG-33|SC-28a.,ITSG-33|SC-28(1),LEVEL|2A,NESA|T5.2.3,PCI-DSSv3.2.1|3.4,PCI-DSSv4.0|3.3.2,PCI-DSSv4.0|3.5.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1,TBA-FIISB|28.1",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listDisksBySubscription"
    },
    "custom_item_35": {
        "description": "7.1 Ensure an Azure Bastion Host Exists",
        "info": "The Azure Bastion service allows secure remote access to Azure Virtual Machines over the Internet without exposing remote access protocol ports and services directly to the Internet. The Azure Bastion service provides this access using TLS over 443/TCP, and subscribes to hardened configurations within an organization's Azure Active Directory service.\n\nRationale:\n\nThe Azure Bastion service allows organizations a more secure means of accessing Azure Virtual Machines over the Internet without assigning public IP addresses to those Virtual Machines. The Azure Bastion service provides Remote Desktop Protocol (RDP) and Secure Shell (SSH) access to Virtual Machines using TLS within a web browser, thus preventing organizations from opening up 3389/TCP and 22/TCP to the Internet on Azure Virtual Machines. Additional benefits of the Bastion service includes Multi-Factor Authentication, Conditional Access Policies, and any other hardening measures configured within Azure Active Directory using a central point of access.\n\nImpact:\n\nThe Azure Bastion service incurs additional costs and requires a specific virtual network configuration. The Standard tier offers additional configuration options compared to the Basic tier and may incur additional costs for those added features.",
        "solution": "From Azure Portal\n\nClick on Bastions\n\nSelect the Subscription\n\nSelect the Resource group\n\nType a Name for the new Bastion host\n\nSelect a Region\n\nChoose Standard next to Tier\n\nUse the slider to set the Instance count\n\nSelect the Virtual network or Create new\n\nSelect the Subnet named AzureBastionSubnet. Create a Subnet named AzureBastionSubnet using a /26 CIDR range if it doesn't already exist.\n\nSelct the appropriate Public IP address option.\n\nIf Create new is selected for the Public IP address option, provide a Public IP address name.\n\nIf Use existing is selected for Public IP address option, select an IP address from Choose public IP address\n\nClick Next: Tags >\n\nConfigure the appropriate Tags\n\nClick Next: Advanced >\n\nSelect the appropriate Advanced options\n\nClick Next: Review + create >\n\nClick Create\n\nFrom Azure CLI\n\naz network bastion create --location--name--public-ip-address--resource-group--vnet-name--scale-units--sku Standard [--disable-copy-paste true|false] [--enable-ip-connect true|false] [--enable-tunneling true|false]\n\nFrom PowerShell\nCreate the appropriate Virtual network settings and Public IP Address settings.\n\n$subnetName = 'AzureBastionSubnet'\n$subnet = New-AzVirtualNetworkSubnetConfig -Name $subnetName -AddressPrefix$virtualNet = New-AzVirtualNetwork -Name-ResourceGroupName-Location-AddressPrefix-Subnet $subnet\n$publicip = New-AzPublicIpAddress -ResourceGroupName-Name-Location-AllocationMethod Dynamic -Sku Standard\n\nCreate the Azure Bastion service using the information within the created variables from above.\n\nNew-AzBastion -ResourceGroupName-Name-PublicIpAddress $publicip -VirtualNetwork $virtualNet -Sku 'Standard' -ScaleUnitDefault Value:\n\nBy default, the Azure Bastion service is not configured.",
        "reference": "800-171|3.4.1,800-171|3.13.1,800-171|3.13.5,800-53|CA-9,800-53|CM-8,800-53|CM-8(1),800-53|SC-7,800-53r5|CA-9,800-53r5|CM-8,800-53r5|CM-8(1),800-53r5|SC-7,CN-L3|8.1.10.2(a),CN-L3|8.1.10.2(b),CN-L3|8.1.10.6(j),CSCv7|9.2,CSCv7|11.2,CSCv7|12.1,CSCv8|12.1,CSCv8|13.4,CSF|DE.CM-1,CSF|DE.CM-7,CSF|ID.AM-1,CSF|ID.AM-2,CSF|ID.AM-3,CSF|PR.AC-5,CSF|PR.DS-3,CSF|PR.DS-5,CSF|PR.PT-4,GDPR|32.1.b,GDPR|32.1.d,GDPR|32.2,HIPAA|164.306(a)(1),ISO/IEC-27001|A.13.1.3,ITSG-33|CM-8,ITSG-33|CM-8(1),ITSG-33|SC-7,LEVEL|2A,NESA|T1.2.1,NESA|T1.2.2,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,SWIFT-CSCv1|2.1,TBA-FIISB|43.1",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listNetworkBastionHosts",
        "regex": ".*",
        "expect": "Subscription ID:"
    },
    "custom_item_36": {
        "description": "7.4 Ensure that 'Unattached disks' are encrypted with 'Customer Managed Key' (CMK)",
        "info": "Ensure that unattached disks in a subscription are encrypted with a Customer Managed Key (CMK).\n\nRationale:\n\nManaged disks are encrypted by default with Platform-managed keys. Using Customer-managed keys may provide an additional level of security or meet an organization's regulatory requirements. Encrypting managed disks ensures that its entire content is fully unrecoverable without a key and thus protects the volume from unwarranted reads. Even if the disk is not attached to any of the VMs, there is always a risk where a compromised user account with administrative access to VM service can mount/attach these data disks, which may lead to sensitive information disclosure and tampering.\n\nImpact:\n\nNOTE: You must have your key vault set up to utilize this. Encryption is available only on Standard tier VMs. This might cost you more.\n\nUtilizing and maintaining Customer-managed keys will require additional work to create, protect, and rotate keys.",
        "solution": "If data stored in the disk is no longer useful, refer to Azure documentation to delete unattached data disks at:\n\n-https://docs.microsoft.com/en-us/rest/api/compute/disks/delete\n-https://docs.microsoft.com/en-us/cli/azure/disk?view=azure-cli-latest#az-disk-delete\n\nIf data stored in the disk is important, To encrypt the disk refer azure documentation at:\n\n-https://docs.microsoft.com/en-us/azure/virtual-machines/disks-enable-customer-managed-keys-portal\n-https://docs.microsoft.com/en-us/rest/api/compute/disks/update#encryptionsettings\n\nDefault Value:\n\nBy default, managed disks are encrypted with a Platform-managed key.",
        "reference": "800-171|3.5.2,800-171|3.13.16,800-53|IA-5(1),800-53|SC-28,800-53|SC-28(1),800-53r5|IA-5(1),800-53r5|SC-28,800-53r5|SC-28(1),CN-L3|8.1.4.7(b),CN-L3|8.1.4.8(b),CSCv7|14.8,CSCv8|3.11,CSF|PR.AC-1,CSF|PR.DS-1,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(d),HIPAA|164.312(e)(2)(ii),ITSG-33|IA-5(1),ITSG-33|SC-28,ITSG-33|SC-28a.,ITSG-33|SC-28(1),LEVEL|2A,NESA|T5.2.3,PCI-DSSv3.2.1|3.4,PCI-DSSv4.0|3.3.2,PCI-DSSv4.0|3.5.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1,TBA-FIISB|28.1",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listDisksBySubscription"
    },
    "custom_item_37": {
        "description": "7.6 Ensure that Endpoint Protection for all Virtual Machines is installed",
        "info": "Install endpoint protection for all virtual machines.\n\nRationale:\n\nInstalling endpoint protection systems (like anti-malware for Azure) provides for real-time protection capability that helps identify and remove viruses, spyware, and other malicious software. These also offer configurable alerts when known-malicious or unwanted software attempts to install itself or run on Azure systems.\n\nImpact:\n\nEndpoint protection will incur an additional cost to you.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "Follow Microsoft Azure documentation to install endpoint protection from the security center. Alternatively, you can employ your own endpoint protection tool for your OS.\n\nDefault Value:\n\nBy default Endpoint Protection is disabled.",
        "reference": "800-171|3.14.2,800-171|3.14.4,800-171|3.14.5,800-53|SI-3,800-53r5|SI-3,CN-L3|7.1.3.6(b),CN-L3|8.1.4.5,CN-L3|8.1.9.6(a),CN-L3|8.1.9.6(b),CN-L3|8.1.10.5(b),CN-L3|8.1.10.7(a),CN-L3|8.1.10.7(b),CSCv7|8.2,CSCv8|10.2,CSF|DE.CM-4,CSF|DE.DP-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.2.1,ITSG-33|SI-3,LEVEL|2M,NIAv2|GS8a,PCI-DSSv3.2.1|5.1,PCI-DSSv3.2.1|5.1.1,PCI-DSSv4.0|5.2.1,QCSC-v1|3.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,TBA-FIISB|49.2.1,TBA-FIISB|49.2.2,TBA-FIISB|49.3.1,TBA-FIISB|49.3.2,TBA-FIISB|50.2.1,TBA-FIISB|51.2.4,TBA-FIISB|51.2.7",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listVMInstanceView",
        "regex": ".+",
        "not_expect": ".+"
    },
    "custom_item_38": {
        "description": "7.7 [Legacy] Ensure that VHDs are Encrypted",
        "info": "NOTE: This is a legacy recommendation. Managed Disks are encrypted by default and recommended for all new VM implementations.\n\nVHD (Virtual Hard Disks) are stored in blob storage and are the old-style disks that were attached to Virtual Machines. The blob VHD was then leased to the VM. By default, storage accounts are not encrypted, and Microsoft Defender will then recommend that the OS disks should be encrypted. Storage accounts can be encrypted as a whole using PMK or CMK. This should be turned on for storage accounts containing VHDs.\n\nRationale:\n\nWhile it is recommended to use Managed Disks which are encrypted by default, 'legacy' VHDs may exist for a variety of reasons and may need to remain in VHD format. VHDs are not encrypted by default, so this recommendation intends to address the security of these disks. In these niche cases, VHDs should be encrypted using the procedures in this recommendation to encrypt and protect the data content.\n\nIf a virtual machine is using a VHD and can be converted to a managed disk, instructions for this procedure can be found in the resources section of this recommendation under the title 'Convert VHD to Managed Disk.'\n\nImpact:\n\nDepending on how the encryption is implemented will change the size of the impact. If provider-managed keys(PMK) are utilized, the impact is relatively low, but processes need to be put in place to regularly rotate the keys. If Customer-managed keys(CMK) are utilized, a key management process needs to be implemented to store and manage key rotation, thus the impact is medium to high depending on user maturity with key management.",
        "solution": "From Azure Portal\n\nNavigate to the storage account that you wish to encrypt\n\nSelect encryption\n\nSelect the encryption type that you wish to use\n\nIf you wish to use a Microsoft-managed key (the default), you can save at this point and encryption will be applied to the account.\nIf you select Customer-managed keys, it will ask for the location of the key (The default is an Azure Key Vault) and the key name.\nOnce these are captured, save the configuration and the account will be encrypted using the provided key.\n\nFrom Azure CLI:\nCreate the Key Vault\n\naz keyvault create --name--resource-group--location--enabled-for-disk-encryption\n\nEncrypt the disk and store the key in Key Vault\n\naz vm encryption enable -g--name--disk-encryption-keyvault myKV\n\nFrom PowerShell\nThis process uses a Key Vault to store the keys\nCreate the Key Vault\n\nNew-AzKeyvault -name-ResourceGroupName-Location-EnabledForDiskEncryption\n\nEncrypt the disk and store the key in Key Vault\n\n$KeyVault = Get-AzKeyVault -VaultName-ResourceGroupNameSet-AzVMDiskEncryptionExtension -ResourceGroupName-VMName-DiskEncryptionKeyVaultUrl $KeyVault.VaultUri -DiskEncryptionKeyVaultId $KeyVault.ResourceId\n\nDefault Value:\n\nThe default value for encryption is 'NO Encryption'",
        "reference": "800-171|3.5.2,800-171|3.13.16,800-53|IA-5(1),800-53|SC-28,800-53|SC-28(1),800-53r5|IA-5(1),800-53r5|SC-28,800-53r5|SC-28(1),CN-L3|8.1.4.7(b),CN-L3|8.1.4.8(b),CSCv7|14.8,CSCv8|3.11,CSF|PR.AC-1,CSF|PR.DS-1,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(d),HIPAA|164.312(e)(2)(ii),ITSG-33|IA-5(1),ITSG-33|SC-28,ITSG-33|SC-28a.,ITSG-33|SC-28(1),LEVEL|2M,NESA|T5.2.3,PCI-DSSv3.2.1|3.4,PCI-DSSv4.0|3.3.2,PCI-DSSv4.0|3.5.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1,TBA-FIISB|28.1",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listStorageAccounts",
        "regex": "Encryption:",
        "not_expect": "Encryption: false"
    },
    "custom_item_39": {
        "description": "Key Vault Exists",
        "request": "listVaultsByResourceGroup",
        "regex": "Key vaults",
        "expect": "Key vaults exist"
    },
    "custom_item_40": {
        "description": "8.6 Enable Role Based Access Control for Azure Key Vault",
        "info": "WARNING: Role assignments disappear when a Key Vault has been deleted (soft-delete) and recovered. Afterwards it will be required to recreate all role assignments. This is a limitation of the soft-delete feature across all Azure services.\n\nRationale:\n\nThe new RBAC permissions model for Key Vaults enables a much finer grained access control for key vault secrets, keys, certificates, etc., than the vault access policy. This in turn will permit the use of privileged identity management over these roles, thus securing the key vaults with JIT Access management.\n\nImpact:\n\nImplementation needs to be properly designed from the ground up, as this is a fundamental change to the way key vaults are accessed/managed. Changing permissions to key vaults will result in loss of service as permissions are re-applied. For the least amount of downtime, map your current groups and users to their corresponding permission needs.",
        "solution": "From Azure Portal\nKey Vaults can be configured to use Azure role-based access control on creation.\nFor existing Key Vaults:\n\nFrom Azure Home open the Portal Menu in the top left corner\n\nSelect Key Vaults\n\nSelect a Key Vault to audit\n\nSelect Access configuration\n\nSet the Permission model radio button to Azure role-based access control, taking note of the warning message\n\nClick Save\n\nSelect Access Control (IAM)\n\nSelect the Role Assignments tab\n\nReapply permissions as needed to groups or users\n\nFrom Azure CLI*\nTo enable RBAC Authorization for each Key Vault, run the following Azure CLI command:\n\naz keyvault update --resource-group--name--enable-rbac-authorization true\n\nFrom PowerShell\nTo enable RBAC authorization on each Key Vault, run the following PowerShell command:\n\nUpdate-AzKeyVault -ResourceGroupName-VaultName-EnableRbacAuthorization $True\n\nDefault Value:\n\nThe default value for Access control in Key Vaults is Vault Policy.",
        "reference": "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.3.8,800-171|3.3.9,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-53|AC-2,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|AC-6(1),800-53|AC-6(7),800-53|AU-9(4),800-53|MP-2,800-53r5|AC-2,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|AC-6(1),800-53r5|AC-6(7),800-53r5|AU-9(4),800-53r5|MP-2,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(d),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.3(d),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|14.6,CSCv8|3.3,CSCv8|6.8,CSF|DE.CM-1,CSF|DE.CM-3,CSF|PR.AC-1,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-1,CSF|PR.PT-2,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.9.2.5,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.4,ISO/IEC-27001|A.9.4.5,ISO/IEC-27001|A.12.4.2,ITSG-33|AC-2,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|AC-6(1),ITSG-33|AU-9(4),ITSG-33|AU-9(4)(a),ITSG-33|AU-9(4)(b),ITSG-33|MP-2,ITSG-33|MP-2a.,LEVEL|2M,NESA|M1.1.3,NESA|M1.2.2,NESA|M5.2.3,NESA|M5.5.2,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|AM28,NIAv2|AM31,NIAv2|GS3,NIAv2|GS4,NIAv2|GS8c,NIAv2|NS5j,NIAv2|SM5,NIAv2|SM6,NIAv2|SS13c,NIAv2|SS14e,NIAv2|SS15c,NIAv2|SS29,NIAv2|VL3b,PCI-DSSv3.2.1|7.1.2,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,PCI-DSSv4.0|10.3.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listVaultsByResourceGroup",
        "regex": "Enable RBAC Authorization:",
        "expect": "Enable RBAC Authorization: true"
    },
    "custom_item_41": {
        "description": "Web Apps exist",
        "request": "listWebApps",
        "regex": ".*",
        "expect": ".+"
    },
    "custom_item_42": {
        "description": "9.1 Ensure App Service Authentication is set up for apps in Azure App Service",
        "info": "Azure App Service Authentication is a feature that can prevent anonymous HTTP requests from reaching a Web Application or authenticate those with tokens before they reach the app. If an anonymous request is received from a browser, App Service will redirect to a logon page. To handle the logon process, a choice from a set of identity providers can be made, or a custom authentication mechanism can be implemented.\n\nRationale:\n\nBy Enabling App Service Authentication, every incoming HTTP request passes through it before being handled by the application code. It also handles authentication of users with the specified provider (Entra ID, Facebook, Google, Microsoft Account, and Twitter), validation, storing and refreshing of tokens, managing the authenticated sessions and injecting identity information into request headers. Disabling HTTP Basic Authentication functionality further ensures legacy authentication methods are disabled within the application.\n\nImpact:\n\nThis is only required for App Services which require authentication. Enabling on site like a marketing or support website will prevent unauthenticated access which would be undesirable.\n\nAdding Authentication requirement will increase cost of App Service and require additional security components to facilitate the authentication.",
        "solution": "From Azure Portal\n\nLogin to Azure Portal using https://portal.azure.com\n\nGo to App Services\n\nClick on each App\n\nUnder Setting section, click on Authentication\n\nIf no identity providers are set up, then click Add identity provider\n\nChoose other parameters as per your requirements and click on Add\n\nTo disable the Basic Auth Publishing Credentials setting, perform the following steps:\n\nLogin to Azure Portal using https://portal.azure.com\n\nGo to App Services\n\nClick on each App\n\nUnder Settings, click on Configuration\n\nClick on the 'General Settings' tab\n\nUnder Platform settings, ensure Basic Auth Publishing Credentials is set to Off\n\nFrom Azure CLI\nTo set App Service Authentication for an existing app, run the following command:\n\naz webapp auth update --resource-group--name--enabled true\n\nNote\nIn order to access App Service authentication settings for Web app using Microsoft API requires Website contributor permission at subscription level. A custom role can be created in place of Website contributor to provide more specific permission and maintain the principle of least privileged access.\n\nDefault Value:\n\nBy default, App Service Authentication is disabled when a new app is created using the command-line tool or Azure Portal console.",
        "reference": "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|MP-2,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|MP-2,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|14.6,CSCv8|3.3,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-2,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|MP-2,ITSG-33|MP-2a.,LEVEL|2A,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,NIAv2|SS29,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listAppConfig",
        "regex": "App Service Auth: ",
        "expect": "App Service Auth: true"
    },
    "custom_item_43": {
        "description": "9.10 Ensure Azure Key Vaults are Used to Store Secrets",
        "info": "Azure Key Vault will store multiple types of sensitive information such as encryption keys, certificate thumbprints, and Managed Identity Credentials. Access to these 'Secrets' can be controlled through granular permissions.\n\nRationale:\n\nThe credentials given to an application have permissions to create, delete, or modify data stored within the systems they access. If these credentials are stored within the application itself, anyone with access to the application or a copy of the code has access to them. Storing within Azure Key Vault as secrets increases security by controlling access. This also allows for updates of the credentials without redeploying the entire application.\n\nImpact:\n\nIntegrating references to secrets within the key vault are required to be specifically integrated within the application code. This will require additional configuration to be made during the writing of an application, or refactoring of an already written one. There are also additional costs that are charged per 10000 requests to the Key Vault.",
        "solution": "Remediation has 2 steps\n\nSetup the Key Vault\n\nSetup the App Service to use the Key Vault\n\nStep 1: Set up the Key Vault\nFrom Azure CLI\n\naz keyvault create --name '' --resource-group '' --location myLocation\n\nFrom Powershell\n\nNew-AzKeyvault -name-ResourceGroupName-LocationStep 2: Set up the App Service to use the Key Vault\nSample JSON Template for App Service Configuration:\n\n[template continues on following pages]\n\n{\n    //...\n    'resources': [\n        {\n            'type': 'Microsoft.Storage/storageAccounts',\n            'name': '[variables('storageAccountName')]',\n            //...\n        },\n        {\n            'type': 'Microsoft.Insights/components',\n            'name': '[variables('appInsightsName')]',\n            //...\n        },\n        {\n            'type': 'Microsoft.Web/sites',\n            'name': '[variables('functionAppName')]',\n            'identity': {\n                'type': 'SystemAssigned'\n            },\n            //...\n            'resources': [\n                {\n                    'type': 'config',\n                    'name': 'appsettings',\n                    //...\n                    'dependsOn': [\n                        '[resourceId('Microsoft.Web/sites', variables('functionAppName'))]',\n                        '[resourceId('Microsoft.KeyVault/vaults/', variables('keyVaultName'))]',\n                        '[resourceId('Microsoft.KeyVault/vaults/secrets', variables('keyVaultName'), variables('storageConnectionStringName'))]',\n                        '[resourceId('Microsoft.KeyVault/vaults/secrets', variables('keyVaultName'), variables('appInsightsKeyName'))]'\n                    ],\n                    'properties': {\n                        'AzureWebJobsStorage': '[concat('@Microsoft.KeyVault(SecretUri=', reference(variables('storageConnectionStringResourceId')).secretUriWithVersion, ')')]',\n                        'WEBSITE_CONTENTAZUREFILECONNECTIONSTRING': '[concat('@Microsoft.KeyVault(SecretUri=', reference(variables('storageConnectionStringResourceId')).secretUriWithVersion, ')')]',\n                        'APPINSIGHTS_INSTRUMENTATIONKEY': '[concat('@Microsoft.KeyVault(SecretUri=', reference(variables('appInsightsKeyResourceId')).secretUriWithVersion, ')')]',\n                        'WEBSITE_ENABLE_SYNC_UPDATE_SITE': 'true'\n                        //...\n                    }\n                },\n                {\n                    'type': 'sourcecontrols',\n                    'name': 'web',\n                    //...\n                    'dependsOn': [\n                        '[resourceId('Microsoft.Web/sites', variables('functionAppName'))]',\n                        '[resourceId('Microsoft.Web/sites/config', variables('functionAppName'), 'appsettings')]'\n                    ],\n                }\n            ]\n        },\n        {\n            'type': 'Microsoft.KeyVault/vaults',\n            'name': '[variables('keyVaultName')]',\n            //...\n            'dependsOn': [\n                '[resourceId('Microsoft.Web/sites', variables('functionAppName'))]'\n            ],\n            'properties': {\n                //...\n                'accessPolicies': [\n                    {\n                        'tenantId': '[reference(concat('Microsoft.Web/sites/',  variables('functionAppName'), '/providers/Microsoft.ManagedIdentity/Identities/default'), '2015-08-31-PREVIEW').tenantId]',\n                        'objectId': '[reference(concat('Microsoft.Web/sites/',  variables('functionAppName'), '/providers/Microsoft.ManagedIdentity/Identities/default'), '2015-08-31-PREVIEW').principalId]',\n                        'permissions': {\n                            'secrets': [ 'get' ]\n                        }\n                    }\n                ]\n            },\n            'resources': [\n                {\n                    'type': 'secrets',\n                    'name': '[variables('storageConnectionStringName')]',\n                    //...\n                    'dependsOn': [\n                        '[resourceId('Microsoft.KeyVault/vaults/', variables('keyVaultName'))]',\n                        '[resourceId('Microsoft.Storage/storageAccounts', variables('storageAccountName'))]'\n                    ],\n                    'properties': {\n                        'value': '[concat('DefaultEndpointsProtocol=https;AccountName=', variables('storageAccountName'), ';AccountKey=', listKeys(variables('storageAccountResourceId'),'2015-05-01-preview').key1)]'\n                    }\n                },\n                {\n                    'type': 'secrets',\n                    'name': '[variables('appInsightsKeyName')]',\n                    //...\n                    'dependsOn': [\n                        '[resourceId('Microsoft.KeyVault/vaults/', variables('keyVaultName'))]',\n                        '[resourceId('Microsoft.Insights/components', variables('appInsightsName'))]'\n                    ],\n                    'properties': {\n                        'value': '[reference(resourceId('microsoft.insights/components/', variables('appInsightsName')), '2015-05-01').InstrumentationKey]'\n                    }\n                }\n            ]\n        }\n    ]\n}\n\nDefault Value:\n\nBy default, no Azure Key Vaults are created.",
        "reference": "800-53|AU-11,800-53|SI-12,800-53r5|AU-11,800-53r5|SI-12,CSCv7|13.1,CSCv8|3.1,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-11,ITSG-33|SI-12,ITSG-33|SI-12a.,LEVEL|2M,NESA|M5.2.3,NESA|M5.2.4,NESA|M5.3.1,NESA|T3.6.2,NIAv2|DR1,NIAv2|DR1a,NIAv2|DR1b,NIAv2|DR1c,NIAv2|DR2,NIAv2|DR3,NIAv2|DR4,NIAv2|DR5,NIAv2|DR6,NIAv2|SM7,PCI-DSSv3.2.1|3.1,PCI-DSSv3.2.1|10.7,PCI-DSSv4.0|3.2.1,PCI-DSSv4.0|10.5.1,QCSC-v1|8.2.1,QCSC-v1|13.2",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listVaultsByResourceGroup",
        "regex": "Key vaults",
        "expect": "Key vaults exist"
    },
    "custom_item_44": {
        "description": "10.1 Ensure that Resource Locks are set for Mission-Critical Azure Resources",
        "info": "Resource Manager Locks provide a way for administrators to lock down Azure resources to prevent deletion of, or modifications to, a resource. These locks sit outside of the Role Based Access Controls (RBAC) hierarchy and, when applied, will place restrictions on the resource for all users. These locks are very useful when there is an important resource in a subscription that users should not be able to delete or change. Locks can help prevent accidental and malicious changes or deletion.\n\nRationale:\n\nAs an administrator, it may be necessary to lock a subscription, resource group, or resource to prevent other users in the organization from accidentally deleting or modifying critical resources. The lock level can be set to to CanNotDelete or ReadOnly to achieve this purpose.\n\nCanNotDelete means authorized users can still read and modify a resource, but they cannot delete the resource.\n\nReadOnly means authorized users can read a resource, but they cannot delete or update the resource. Applying this lock is similar to restricting all authorized users to the permissions granted by the Reader role.\n\nImpact:\n\nThere can be unintended outcomes of locking a resource. Applying a lock to a parent service will cause it to be inherited by all resources within. Conversely, applying a lock to a resource may not apply to connected storage, leaving it unlocked. Please see the documentation for further information.\n\nNOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance.",
        "solution": "From Azure Portal\n\nNavigate to the specific Azure Resource or Resource Group\n\nFor each mission critical resource, click on Locks\n\nClick Add\n\nGive the lock a name and a description, then select the type, Read-only or Delete as appropriate\n\nClick OK\n\nFrom Azure CLI\nTo lock a resource, provide the name of the resource, its resource type, and its resource group name.\n\naz lock create --name--lock-type--resource-group--resource-name--resource-typeFrom Powershell\n\nGet-AzResourceLock -ResourceName-ResourceType-ResourceGroupName-LocktypeDefault Value:\n\nBy default, no locks are set.",
        "reference": "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|MP-2,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|MP-2,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|14.6,CSCv8|3.3,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-2,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|MP-2,ITSG-33|MP-2a.,LEVEL|2M,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,NIAv2|SS29,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3",
        "see_also": "https://workbench.cisecurity.org/benchmarks/12346",
        "request": "listManagementLocksByResourceGroup",
        "regex": ".+",
        "not_expect": ".+"
    }
}